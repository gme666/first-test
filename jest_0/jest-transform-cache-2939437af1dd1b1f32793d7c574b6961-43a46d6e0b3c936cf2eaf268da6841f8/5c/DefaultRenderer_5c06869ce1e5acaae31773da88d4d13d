0ae4afc5e17c4d5f968ec62766fea9a4
Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();







var _react=require('react');var _react2=_interopRequireDefault(_react);



var _reactNative=require('react-native');





var _reactNativeExperimentalNavigation=require('react-native-experimental-navigation');var _reactNativeExperimentalNavigation2=_interopRequireDefault(_reactNativeExperimentalNavigation);
var _reactAddonsPureRenderMixin=require('react-addons-pure-render-mixin');var _reactAddonsPureRenderMixin2=_interopRequireDefault(_reactAddonsPureRenderMixin);

var _TabBar=require('./TabBar');var _TabBar2=_interopRequireDefault(_TabBar);
var _NavBar=require('./NavBar');var _NavBar2=_interopRequireDefault(_NavBar);
var _Actions=require('./Actions');var _Actions2=_interopRequireDefault(_Actions);
var _Util=require('./Util');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}

var SCREEN_WIDTH=_reactNative.Dimensions.get('window').width;var


NavigationAnimatedView=_reactNativeExperimentalNavigation2.default.AnimatedView,
NavigationCard=_reactNativeExperimentalNavigation2.default.Card;var



NavigationCardStackPanResponder=

NavigationCard.CardStackPanResponder,NavigationCardStackStyleInterpolator=NavigationCard.CardStackStyleInterpolator;

var styles=_reactNative.StyleSheet.create({
animatedView:{
flex:1,
backgroundColor:'transparent'},

sceneStyle:{
flex:1}});



function fadeInScene(props){var

position=

props.position,scene=props.scene;

var index=scene.index;
var inputRange=[index-1,index,index+1];

var opacity=position.interpolate({
inputRange:inputRange,
outputRange:[0,1,0.3]});


var scale=position.interpolate({
inputRange:inputRange,
outputRange:[1,1,0.95]});


var translateY=0;
var translateX=0;

return{
opacity:opacity,
transform:[
{scale:scale},
{translateX:translateX},
{translateY:translateY}]};


}

function leftToRight(props){var

position=

props.position,scene=props.scene;

var index=scene.index;
var inputRange=[index-1,index,index+1];

var translateX=position.interpolate({
inputRange:inputRange,
outputRange:[-SCREEN_WIDTH,0,0]});


return{
transform:[
{translateX:translateX}]};


}var

DefaultRenderer=function(_Component){_inherits(DefaultRenderer,_Component);_createClass(DefaultRenderer,null,[{key:'getPanHandlers',value:function getPanHandlers(










direction,props){
return direction==='vertical'?
NavigationCardStackPanResponder.forVertical(props):
NavigationCardStackPanResponder.forHorizontal(props);
}},{key:'dispatchFocusAction',value:function dispatchFocusAction(_ref)

{var navigationState=_ref.navigationState;
if(!navigationState||navigationState.component||navigationState.tabs){
return;
}
var scene=navigationState.children[navigationState.index];
_Actions2.default.focus({scene:scene});
}},{key:'chooseInterpolator',value:function chooseInterpolator(

direction,props){
switch(direction){
case'vertical':
return NavigationCardStackStyleInterpolator.forVertical(props);
case'fade':
return fadeInScene(props);
case'leftToRight':
return leftToRight(props);
default:
return NavigationCardStackStyleInterpolator.forHorizontal(props);}

}},{key:'renderScene',value:function renderScene(

props){
return(
_react2.default.createElement(DefaultRenderer,{
key:props.scene.navigationState.key,
onNavigate:props.onNavigate,
navigationState:props.scene.navigationState}));


}},{key:'renderHeader',value:function renderHeader(

props){
var state=props.navigationState;
var child=state.children[state.index];
var selected=state.children[state.index];
while({}.hasOwnProperty.call(selected,'children')){
selected=selected.children[selected.index];
}
if(child!==selected){

return null;
}
var hideNavBar=(0,_Util.deepestExplicitValueForKey)(state,'hideNavBar');
if(hideNavBar){

return null;
}



if(selected.component&&selected.component.renderNavigationBar){
return selected.component.renderNavigationBar(_extends({},props,selected));
}

var HeaderComponent=selected.navBar||child.navBar||state.navBar||_NavBar2.default;
var navBarProps=_extends({},state,child,selected);

if(selected.component&&selected.component.onRight){
navBarProps.onRight=selected.component.onRight;
}

if(selected.component&&selected.component.onLeft){
navBarProps.onLeft=selected.component.onLeft;
}

if((navBarProps.leftTitle||navBarProps.leftButtonImage)&&navBarProps.onLeft){
delete navBarProps.leftButton;
}

if((navBarProps.rightTitle||navBarProps.rightButtonImage)&&navBarProps.onRight){
delete navBarProps.rightButton;
}

if(navBarProps.rightButton){
delete navBarProps.rightTitle;
delete navBarProps.onRight;
delete navBarProps.rightButtonImage;
}

if(navBarProps.leftButton){
delete navBarProps.leftTitle;
delete navBarProps.onLeft;
delete navBarProps.leftButtonImage;
}
delete navBarProps.style;

var getTitle=selected.getTitle||function(opts){return opts.title;};
return _react2.default.createElement(HeaderComponent,_extends({},props,navBarProps,{getTitle:getTitle}));
}},{key:'renderCard',value:function renderCard(

props){var _props$scene$navigati=





props.scene.navigationState,key=_props$scene$navigati.key,direction=_props$scene$navigati.direction,animation=_props$scene$navigati.animation,getSceneStyle=_props$scene$navigati.getSceneStyle,getPanHandlers=_props$scene$navigati.getPanHandlers;

var state=props.navigationState;
var child=state.children[state.index];
var selected=state.children[state.index];
while({}.hasOwnProperty.call(selected,'children')){
selected=selected.children[selected.index];
}var _selected=
selected,panHandlers=_selected.panHandlers,animationStyle=_selected.animationStyle;
var isActive=child===selected;
var computedProps={isActive:isActive};
if(isActive){
computedProps.hideNavBar=(0,_Util.deepestExplicitValueForKey)(props.navigationState,'hideNavBar');
computedProps.hideTabBar=(0,_Util.deepestExplicitValueForKey)(props.navigationState,'hideTabBar');
}

var style=getSceneStyle?getSceneStyle(props,computedProps):null;


var animType=animation&&!direction?animation:direction;

if(typeof animationStyle==='undefined'){
animationStyle=DefaultRenderer.chooseInterpolator(animType,props);
}

if(typeof animationStyle==='function'){
animationStyle=animationStyle(props);
}

if(typeof panHandlers==='undefined'){
panHandlers=getPanHandlers?
getPanHandlers(props,direction):
DefaultRenderer.getPanHandlers(direction,props);
}
return(
_react2.default.createElement(NavigationCard,_extends({},
props,{
key:'card_'+key,
style:[animationStyle,style],
panHandlers:panHandlers,
renderScene:DefaultRenderer.renderScene})));


}}]);

function DefaultRenderer(props){_classCallCheck(this,DefaultRenderer);var _this=_possibleConstructorReturn(this,(DefaultRenderer.__proto__||Object.getPrototypeOf(DefaultRenderer)).call(this,
props));

_this.shouldComponentUpdate=_reactAddonsPureRenderMixin2.default.shouldComponentUpdate.bind(_this);return _this;
}_createClass(DefaultRenderer,[{key:'getChildContext',value:function getChildContext()

{
return{
navigationState:this.props.navigationState};

}},{key:'componentDidMount',value:function componentDidMount()

{
DefaultRenderer.dispatchFocusAction(this.props);
}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(

nextProps){
if(nextProps.navigationState!==this.props.navigationState){
DefaultRenderer.dispatchFocusAction(nextProps);
}
}},{key:'render',value:function render()

{var _props=
this.props,navigationState=_props.navigationState,onNavigate=_props.onNavigate;

if(!navigationState||!onNavigate){
console.error('navigationState and onNavigate property should be not null');
return null;
}

var SceneComponent=navigationState.component;

if(navigationState.tabs&&!SceneComponent){
SceneComponent=_TabBar2.default;
}

if(SceneComponent){
return(
_react2.default.createElement(_reactNative.View,{
style:[styles.sceneStyle,navigationState.sceneStyle]},

_react2.default.createElement(SceneComponent,_extends({},this.props,navigationState))));


}

var optionals={};
var selected=navigationState.children[navigationState.index];
var applyAnimation=selected.applyAnimation||navigationState.applyAnimation;
var style=selected.style||navigationState.style;

if(applyAnimation){
optionals.applyAnimation=applyAnimation;
}else{
var duration=selected.duration;
if(duration===null||duration===undefined)duration=navigationState.duration;
if(duration!==null&&duration!==undefined){
optionals.applyAnimation=function(pos,navState){
if(duration===0){
pos.setValue(navState.index);
}else{
_reactNative.Animated.timing(pos,{toValue:navState.index,duration:duration}).start();
}
};
}
}



return(
_react2.default.createElement(NavigationAnimatedView,_extends({
navigationState:navigationState,
style:[styles.animatedView,style],
renderOverlay:DefaultRenderer.renderHeader,
renderScene:DefaultRenderer.renderCard},
optionals)));


}}]);return DefaultRenderer;}(_react.Component);DefaultRenderer.propTypes={navigationState:_react.PropTypes.object,onNavigate:_react.PropTypes.func};DefaultRenderer.childContextTypes={navigationState:_react.PropTypes.any};exports.default=DefaultRenderer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRlZmF1bHRSZW5kZXJlci5qcyJdLCJuYW1lcyI6WyJTQ1JFRU5fV0lEVEgiLCJnZXQiLCJ3aWR0aCIsIk5hdmlnYXRpb25BbmltYXRlZFZpZXciLCJBbmltYXRlZFZpZXciLCJOYXZpZ2F0aW9uQ2FyZCIsIkNhcmQiLCJOYXZpZ2F0aW9uQ2FyZFN0YWNrUGFuUmVzcG9uZGVyIiwiQ2FyZFN0YWNrUGFuUmVzcG9uZGVyIiwiTmF2aWdhdGlvbkNhcmRTdGFja1N0eWxlSW50ZXJwb2xhdG9yIiwiQ2FyZFN0YWNrU3R5bGVJbnRlcnBvbGF0b3IiLCJzdHlsZXMiLCJjcmVhdGUiLCJhbmltYXRlZFZpZXciLCJmbGV4IiwiYmFja2dyb3VuZENvbG9yIiwic2NlbmVTdHlsZSIsImZhZGVJblNjZW5lIiwicHJvcHMiLCJwb3NpdGlvbiIsInNjZW5lIiwiaW5kZXgiLCJpbnB1dFJhbmdlIiwib3BhY2l0eSIsImludGVycG9sYXRlIiwib3V0cHV0UmFuZ2UiLCJzY2FsZSIsInRyYW5zbGF0ZVkiLCJ0cmFuc2xhdGVYIiwidHJhbnNmb3JtIiwibGVmdFRvUmlnaHQiLCJEZWZhdWx0UmVuZGVyZXIiLCJkaXJlY3Rpb24iLCJmb3JWZXJ0aWNhbCIsImZvckhvcml6b250YWwiLCJuYXZpZ2F0aW9uU3RhdGUiLCJjb21wb25lbnQiLCJ0YWJzIiwiY2hpbGRyZW4iLCJmb2N1cyIsImtleSIsIm9uTmF2aWdhdGUiLCJzdGF0ZSIsImNoaWxkIiwic2VsZWN0ZWQiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJoaWRlTmF2QmFyIiwicmVuZGVyTmF2aWdhdGlvbkJhciIsIkhlYWRlckNvbXBvbmVudCIsIm5hdkJhciIsIm5hdkJhclByb3BzIiwib25SaWdodCIsIm9uTGVmdCIsImxlZnRUaXRsZSIsImxlZnRCdXR0b25JbWFnZSIsImxlZnRCdXR0b24iLCJyaWdodFRpdGxlIiwicmlnaHRCdXR0b25JbWFnZSIsInJpZ2h0QnV0dG9uIiwic3R5bGUiLCJnZXRUaXRsZSIsIm9wdHMiLCJ0aXRsZSIsImFuaW1hdGlvbiIsImdldFNjZW5lU3R5bGUiLCJnZXRQYW5IYW5kbGVycyIsInBhbkhhbmRsZXJzIiwiYW5pbWF0aW9uU3R5bGUiLCJpc0FjdGl2ZSIsImNvbXB1dGVkUHJvcHMiLCJoaWRlVGFiQmFyIiwiYW5pbVR5cGUiLCJjaG9vc2VJbnRlcnBvbGF0b3IiLCJyZW5kZXJTY2VuZSIsInNob3VsZENvbXBvbmVudFVwZGF0ZSIsImJpbmQiLCJkaXNwYXRjaEZvY3VzQWN0aW9uIiwibmV4dFByb3BzIiwiY29uc29sZSIsImVycm9yIiwiU2NlbmVDb21wb25lbnQiLCJvcHRpb25hbHMiLCJhcHBseUFuaW1hdGlvbiIsImR1cmF0aW9uIiwidW5kZWZpbmVkIiwicG9zIiwibmF2U3RhdGUiLCJzZXRWYWx1ZSIsInRpbWluZyIsInRvVmFsdWUiLCJzdGFydCIsInJlbmRlckhlYWRlciIsInJlbmRlckNhcmQiLCJwcm9wVHlwZXMiLCJvYmplY3QiLCJmdW5jIiwiY2hpbGRDb250ZXh0VHlwZXMiLCJhbnkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBUUEsNEI7Ozs7QUFJQTs7Ozs7O0FBTUEsdUY7QUFDQSwwRTs7QUFFQSxnQztBQUNBLGdDO0FBQ0Esa0M7QUFDQSw0Qjs7QUFFQSxHQUFNQSxjQUFlLHdCQUFXQyxHQUFYLENBQWUsUUFBZixFQUF5QkMsS0FBOUMsQzs7O0FBR2dCQyxzQiw2Q0FBZEMsWTtBQUNNQyxjLDZDQUFOQyxJOzs7O0FBSXVCQywrQjs7QUFFckJGLGMsQ0FGRkcscUIsQ0FDNEJDLG9DLENBQzFCSixjLENBREZLLDBCOztBQUdGLEdBQU1DLFFBQVMsd0JBQVdDLE1BQVgsQ0FBa0I7QUFDL0JDLGFBQWM7QUFDWkMsS0FBTSxDQURNO0FBRVpDLGdCQUFpQixhQUZMLENBRGlCOztBQUsvQkMsV0FBWTtBQUNWRixLQUFNLENBREksQ0FMbUIsQ0FBbEIsQ0FBZjs7OztBQVVBLFFBQVNHLFlBQVQsQ0FBd0RDLEtBQXhELENBQStEOztBQUUzREMsUUFGMkQ7O0FBSXpERCxLQUp5RCxDQUUzREMsUUFGMkQsQ0FHM0RDLEtBSDJELENBSXpERixLQUp5RCxDQUczREUsS0FIMkQ7O0FBTTdELEdBQU1DLE9BQVFELE1BQU1DLEtBQXBCO0FBQ0EsR0FBTUMsWUFBYSxDQUFDRCxNQUFRLENBQVQsQ0FBWUEsS0FBWixDQUFtQkEsTUFBUSxDQUEzQixDQUFuQjs7QUFFQSxHQUFNRSxTQUFVSixTQUFTSyxXQUFULENBQXFCO0FBQ25DRixxQkFEbUM7QUFFbkNHLFlBQWEsQ0FBQyxDQUFELENBQUksQ0FBSixDQUFPLEdBQVAsQ0FGc0IsQ0FBckIsQ0FBaEI7OztBQUtBLEdBQU1DLE9BQVFQLFNBQVNLLFdBQVQsQ0FBcUI7QUFDakNGLHFCQURpQztBQUVqQ0csWUFBYSxDQUFDLENBQUQsQ0FBSSxDQUFKLENBQU8sSUFBUCxDQUZvQixDQUFyQixDQUFkOzs7QUFLQSxHQUFNRSxZQUFhLENBQW5CO0FBQ0EsR0FBTUMsWUFBYSxDQUFuQjs7QUFFQSxNQUFPO0FBQ0xMLGVBREs7QUFFTE0sVUFBVztBQUNULENBQUVILFdBQUYsQ0FEUztBQUVULENBQUVFLHFCQUFGLENBRlM7QUFHVCxDQUFFRCxxQkFBRixDQUhTLENBRk4sQ0FBUDs7O0FBUUQ7O0FBRUQsUUFBU0csWUFBVCxDQUF3RFosS0FBeEQsQ0FBK0Q7O0FBRTNEQyxRQUYyRDs7QUFJekRELEtBSnlELENBRTNEQyxRQUYyRCxDQUczREMsS0FIMkQsQ0FJekRGLEtBSnlELENBRzNERSxLQUgyRDs7QUFNN0QsR0FBTUMsT0FBUUQsTUFBTUMsS0FBcEI7QUFDQSxHQUFNQyxZQUFhLENBQUNELE1BQVEsQ0FBVCxDQUFZQSxLQUFaLENBQW1CQSxNQUFRLENBQTNCLENBQW5COztBQUVBLEdBQU1PLFlBQWFULFNBQVNLLFdBQVQsQ0FBcUI7QUFDdENGLHFCQURzQztBQUV0Q0csWUFBYSxDQUFDLENBQUN6QixZQUFGLENBQWdCLENBQWhCLENBQW1CLENBQW5CLENBRnlCLENBQXJCLENBQW5COzs7QUFLQSxNQUFPO0FBQ0w2QixVQUFXO0FBQ1QsQ0FBRUQscUJBQUYsQ0FEUyxDQUROLENBQVA7OztBQUtELEM7O0FBRW9CRyxlOzs7Ozs7Ozs7OztBQVdHQyxTLENBQVdkLEssQ0FBTztBQUN0QyxNQUFPYyxhQUFjLFVBQWQ7QUFDTHpCLGdDQUFnQzBCLFdBQWhDLENBQTRDZixLQUE1QyxDQURLO0FBRUxYLGdDQUFnQzJCLGFBQWhDLENBQThDaEIsS0FBOUMsQ0FGRjtBQUdELEM7O0FBRStDLElBQW5CaUIsZ0JBQW1CLE1BQW5CQSxlQUFtQjtBQUM5QyxHQUFJLENBQUNBLGVBQUQsRUFBb0JBLGdCQUFnQkMsU0FBcEMsRUFBaURELGdCQUFnQkUsSUFBckUsQ0FBMkU7QUFDekU7QUFDRDtBQUNELEdBQU1qQixPQUFRZSxnQkFBZ0JHLFFBQWhCLENBQXlCSCxnQkFBZ0JkLEtBQXpDLENBQWQ7QUFDQSxrQkFBUWtCLEtBQVIsQ0FBYyxDQUFFbkIsV0FBRixDQUFkO0FBQ0QsQzs7QUFFeUJZLFMsQ0FBV2QsSyxDQUFPO0FBQzFDLE9BQVFjLFNBQVI7QUFDRSxJQUFLLFVBQUw7QUFDRSxNQUFPdkIsc0NBQXFDd0IsV0FBckMsQ0FBaURmLEtBQWpELENBQVA7QUFDRixJQUFLLE1BQUw7QUFDRSxNQUFPRCxhQUFZQyxLQUFaLENBQVA7QUFDRixJQUFLLGFBQUw7QUFDRSxNQUFPWSxhQUFZWixLQUFaLENBQVA7QUFDRjtBQUNFLE1BQU9ULHNDQUFxQ3lCLGFBQXJDLENBQW1EaEIsS0FBbkQsQ0FBUCxDQVJKOztBQVVELEM7O0FBRXFEQSxLLENBQU87QUFDM0Q7QUFDRSw4QkFBQyxlQUFEO0FBQ0UsSUFBS0EsTUFBTUUsS0FBTixDQUFZZSxlQUFaLENBQTRCSyxHQURuQztBQUVFLFdBQVl0QixNQUFNdUIsVUFGcEI7QUFHRSxnQkFBaUJ2QixNQUFNRSxLQUFOLENBQVllLGVBSC9CLEVBREY7OztBQU9ELEM7O0FBRXNEakIsSyxDQUFPO0FBQzVELEdBQU13QixPQUFReEIsTUFBTWlCLGVBQXBCO0FBQ0EsR0FBTVEsT0FBUUQsTUFBTUosUUFBTixDQUFlSSxNQUFNckIsS0FBckIsQ0FBZDtBQUNBLEdBQUl1QixVQUFXRixNQUFNSixRQUFOLENBQWVJLE1BQU1yQixLQUFyQixDQUFmO0FBQ0EsTUFBTyxHQUFHd0IsY0FBSCxDQUFrQkMsSUFBbEIsQ0FBdUJGLFFBQXZCLENBQWlDLFVBQWpDLENBQVAsQ0FBcUQ7QUFDbkRBLFNBQVdBLFNBQVNOLFFBQVQsQ0FBa0JNLFNBQVN2QixLQUEzQixDQUFYO0FBQ0Q7QUFDRCxHQUFJc0IsUUFBVUMsUUFBZCxDQUF3Qjs7QUFFdEIsTUFBTyxLQUFQO0FBQ0Q7QUFDRCxHQUFNRyxZQUFhLHFDQUEyQkwsS0FBM0IsQ0FBa0MsWUFBbEMsQ0FBbkI7QUFDQSxHQUFJSyxVQUFKLENBQWdCOztBQUVkLE1BQU8sS0FBUDtBQUNEOzs7O0FBSUQsR0FBSUgsU0FBU1IsU0FBVCxFQUFzQlEsU0FBU1IsU0FBVCxDQUFtQlksbUJBQTdDLENBQWtFO0FBQ2hFLE1BQU9KLFVBQVNSLFNBQVQsQ0FBbUJZLG1CQUFuQixhQUE0QzlCLEtBQTVDLENBQXNEMEIsUUFBdEQsRUFBUDtBQUNEOztBQUVELEdBQU1LLGlCQUFrQkwsU0FBU00sTUFBVCxFQUFtQlAsTUFBTU8sTUFBekIsRUFBbUNSLE1BQU1RLE1BQXpDLGtCQUF4QjtBQUNBLEdBQU1DLHlCQUFtQlQsS0FBbkIsQ0FBNkJDLEtBQTdCLENBQXVDQyxRQUF2QyxDQUFOOztBQUVBLEdBQUlBLFNBQVNSLFNBQVQsRUFBc0JRLFNBQVNSLFNBQVQsQ0FBbUJnQixPQUE3QyxDQUFzRDtBQUNwREQsWUFBWUMsT0FBWixDQUFzQlIsU0FBU1IsU0FBVCxDQUFtQmdCLE9BQXpDO0FBQ0Q7O0FBRUQsR0FBSVIsU0FBU1IsU0FBVCxFQUFzQlEsU0FBU1IsU0FBVCxDQUFtQmlCLE1BQTdDLENBQXFEO0FBQ25ERixZQUFZRSxNQUFaLENBQXFCVCxTQUFTUixTQUFULENBQW1CaUIsTUFBeEM7QUFDRDs7QUFFRCxHQUFJLENBQUNGLFlBQVlHLFNBQVosRUFBeUJILFlBQVlJLGVBQXRDLEdBQTBESixZQUFZRSxNQUExRSxDQUFrRjtBQUNoRixNQUFPRixhQUFZSyxVQUFuQjtBQUNEOztBQUVELEdBQUksQ0FBQ0wsWUFBWU0sVUFBWixFQUEwQk4sWUFBWU8sZ0JBQXZDLEdBQTREUCxZQUFZQyxPQUE1RSxDQUFxRjtBQUNuRixNQUFPRCxhQUFZUSxXQUFuQjtBQUNEOztBQUVELEdBQUlSLFlBQVlRLFdBQWhCLENBQTZCO0FBQzNCLE1BQU9SLGFBQVlNLFVBQW5CO0FBQ0EsTUFBT04sYUFBWUMsT0FBbkI7QUFDQSxNQUFPRCxhQUFZTyxnQkFBbkI7QUFDRDs7QUFFRCxHQUFJUCxZQUFZSyxVQUFoQixDQUE0QjtBQUMxQixNQUFPTCxhQUFZRyxTQUFuQjtBQUNBLE1BQU9ILGFBQVlFLE1BQW5CO0FBQ0EsTUFBT0YsYUFBWUksZUFBbkI7QUFDRDtBQUNELE1BQU9KLGFBQVlTLEtBQW5COztBQUVBLEdBQU1DLFVBQVdqQixTQUFTaUIsUUFBVCxFQUFzQixxQkFBUUMsTUFBS0MsS0FBYixFQUF2QztBQUNBLE1BQU8sK0JBQUMsZUFBRCxhQUFxQjdDLEtBQXJCLENBQWdDaUMsV0FBaEMsRUFBNkMsU0FBVVUsUUFBdkQsR0FBUDtBQUNELEM7O0FBRW9EM0MsSyxDQUFPOzs7Ozs7QUFNdERBLE1BQU1FLEtBQU4sQ0FBWWUsZUFOMEMsQ0FDbERLLEdBRGtELHVCQUNsREEsR0FEa0QsQ0FFeERSLFNBRndELHVCQUV4REEsU0FGd0QsQ0FHeERnQyxTQUh3RCx1QkFHeERBLFNBSHdELENBSXhEQyxhQUp3RCx1QkFJeERBLGFBSndELENBS3hEQyxjQUx3RCx1QkFLeERBLGNBTHdEOztBQVExRCxHQUFNeEIsT0FBUXhCLE1BQU1pQixlQUFwQjtBQUNBLEdBQU1RLE9BQVFELE1BQU1KLFFBQU4sQ0FBZUksTUFBTXJCLEtBQXJCLENBQWQ7QUFDQSxHQUFJdUIsVUFBV0YsTUFBTUosUUFBTixDQUFlSSxNQUFNckIsS0FBckIsQ0FBZjtBQUNBLE1BQU8sR0FBR3dCLGNBQUgsQ0FBa0JDLElBQWxCLENBQXVCRixRQUF2QixDQUFpQyxVQUFqQyxDQUFQLENBQXFEO0FBQ25EQSxTQUFXQSxTQUFTTixRQUFULENBQWtCTSxTQUFTdkIsS0FBM0IsQ0FBWDtBQUNELENBYnlEO0FBY3BCdUIsUUFkb0IsQ0FjcER1QixXQWRvRCxXQWNwREEsV0Fkb0QsQ0FjdkNDLGNBZHVDLFdBY3ZDQSxjQWR1QztBQWUxRCxHQUFNQyxVQUFXMUIsUUFBVUMsUUFBM0I7QUFDQSxHQUFNMEIsZUFBZ0IsQ0FBRUQsaUJBQUYsQ0FBdEI7QUFDQSxHQUFJQSxRQUFKLENBQWM7QUFDWkMsY0FBY3ZCLFVBQWQsQ0FBMkIscUNBQTJCN0IsTUFBTWlCLGVBQWpDLENBQWtELFlBQWxELENBQTNCO0FBQ0FtQyxjQUFjQyxVQUFkLENBQTJCLHFDQUEyQnJELE1BQU1pQixlQUFqQyxDQUFrRCxZQUFsRCxDQUEzQjtBQUNEOztBQUVELEdBQU15QixPQUFRSyxjQUFnQkEsY0FBYy9DLEtBQWQsQ0FBcUJvRCxhQUFyQixDQUFoQixDQUFzRCxJQUFwRTs7O0FBR0EsR0FBTUUsVUFBWVIsV0FBYSxDQUFDaEMsU0FBZixDQUE0QmdDLFNBQTVCLENBQXdDaEMsU0FBekQ7O0FBRUEsR0FBSSxNQUFRb0MsZUFBUixHQUE0QixXQUFoQyxDQUE2QztBQUMzQ0EsZUFBaUJyQyxnQkFBZ0IwQyxrQkFBaEIsQ0FBbUNELFFBQW5DLENBQTZDdEQsS0FBN0MsQ0FBakI7QUFDRDs7QUFFRCxHQUFJLE1BQVFrRCxlQUFSLEdBQTRCLFVBQWhDLENBQTRDO0FBQzFDQSxlQUFpQkEsZUFBZWxELEtBQWYsQ0FBakI7QUFDRDs7QUFFRCxHQUFJLE1BQVFpRCxZQUFSLEdBQXlCLFdBQTdCLENBQTBDO0FBQ3hDQSxZQUFjRDtBQUNaQSxlQUFlaEQsS0FBZixDQUFzQmMsU0FBdEIsQ0FEWTtBQUVaRCxnQkFBZ0JtQyxjQUFoQixDQUErQmxDLFNBQS9CLENBQTBDZCxLQUExQyxDQUZGO0FBR0Q7QUFDRDtBQUNFLDhCQUFDLGNBQUQ7QUFDTUEsS0FETjtBQUVFLFlBQWFzQixHQUZmO0FBR0UsTUFBTyxDQUFDNEIsY0FBRCxDQUFpQlIsS0FBakIsQ0FIVDtBQUlFLFlBQWFPLFdBSmY7QUFLRSxZQUFhcEMsZ0JBQWdCMkMsV0FML0IsR0FERjs7O0FBU0QsQzs7QUFFRCx5QkFBWXhELEtBQVosQ0FBbUI7QUFDWEEsS0FEVzs7QUFHakIsTUFBS3lELHFCQUFMLENBQTZCLHFDQUFnQkEscUJBQWhCLENBQXNDQyxJQUF0QyxPQUE3QixDQUhpQjtBQUlsQixDOztBQUVpQjtBQUNoQixNQUFPO0FBQ0x6QyxnQkFBaUIsS0FBS2pCLEtBQUwsQ0FBV2lCLGVBRHZCLENBQVA7O0FBR0QsQzs7QUFFbUI7QUFDbEJKLGdCQUFnQjhDLG1CQUFoQixDQUFvQyxLQUFLM0QsS0FBekM7QUFDRCxDOztBQUV5QjRELFMsQ0FBVztBQUNuQyxHQUFJQSxVQUFVM0MsZUFBVixHQUE4QixLQUFLakIsS0FBTCxDQUFXaUIsZUFBN0MsQ0FBOEQ7QUFDNURKLGdCQUFnQjhDLG1CQUFoQixDQUFvQ0MsU0FBcEM7QUFDRDtBQUNGLEM7O0FBRVE7QUFDaUMsS0FBSzVELEtBRHRDLENBQ0NpQixlQURELFFBQ0NBLGVBREQsQ0FDa0JNLFVBRGxCLFFBQ2tCQSxVQURsQjs7QUFHUCxHQUFJLENBQUNOLGVBQUQsRUFBb0IsQ0FBQ00sVUFBekIsQ0FBcUM7QUFDbkNzQyxRQUFRQyxLQUFSLENBQWMsNERBQWQ7QUFDQSxNQUFPLEtBQVA7QUFDRDs7QUFFRCxHQUFJQyxnQkFBaUI5QyxnQkFBZ0JDLFNBQXJDOztBQUVBLEdBQUlELGdCQUFnQkUsSUFBaEIsRUFBd0IsQ0FBQzRDLGNBQTdCLENBQTZDO0FBQzNDQTtBQUNEOztBQUVELEdBQUlBLGNBQUosQ0FBb0I7QUFDbEI7QUFDRTtBQUNFLE1BQU8sQ0FBQ3RFLE9BQU9LLFVBQVIsQ0FBb0JtQixnQkFBZ0JuQixVQUFwQyxDQURUOztBQUdFLDhCQUFDLGNBQUQsYUFBb0IsS0FBS0UsS0FBekIsQ0FBb0NpQixlQUFwQyxFQUhGLENBREY7OztBQU9EOztBQUVELEdBQU0rQyxXQUFZLEVBQWxCO0FBQ0EsR0FBTXRDLFVBQVdULGdCQUFnQkcsUUFBaEIsQ0FBeUJILGdCQUFnQmQsS0FBekMsQ0FBakI7QUFDQSxHQUFNOEQsZ0JBQWlCdkMsU0FBU3VDLGNBQVQsRUFBMkJoRCxnQkFBZ0JnRCxjQUFsRTtBQUNBLEdBQU12QixPQUFRaEIsU0FBU2dCLEtBQVQsRUFBa0J6QixnQkFBZ0J5QixLQUFoRDs7QUFFQSxHQUFJdUIsY0FBSixDQUFvQjtBQUNsQkQsVUFBVUMsY0FBVixDQUEyQkEsY0FBM0I7QUFDRCxDQUZELElBRU87QUFDTCxHQUFJQyxVQUFXeEMsU0FBU3dDLFFBQXhCO0FBQ0EsR0FBSUEsV0FBYSxJQUFiLEVBQXFCQSxXQUFhQyxTQUF0QyxDQUFpREQsU0FBV2pELGdCQUFnQmlELFFBQTNCO0FBQ2pELEdBQUlBLFdBQWEsSUFBYixFQUFxQkEsV0FBYUMsU0FBdEMsQ0FBaUQ7QUFDL0NILFVBQVVDLGNBQVYsQ0FBMkIsU0FBQ0csR0FBRCxDQUFNQyxRQUFOLENBQW1CO0FBQzVDLEdBQUlILFdBQWEsQ0FBakIsQ0FBb0I7QUFDbEJFLElBQUlFLFFBQUosQ0FBYUQsU0FBU2xFLEtBQXRCO0FBQ0QsQ0FGRCxJQUVPO0FBQ0wsc0JBQVNvRSxNQUFULENBQWdCSCxHQUFoQixDQUFxQixDQUFFSSxRQUFTSCxTQUFTbEUsS0FBcEIsQ0FBMkIrRCxpQkFBM0IsQ0FBckIsRUFBNERPLEtBQTVEO0FBQ0Q7QUFDRixDQU5EO0FBT0Q7QUFDRjs7OztBQUlEO0FBQ0UsOEJBQUMsc0JBQUQ7QUFDRSxnQkFBaUJ4RCxlQURuQjtBQUVFLE1BQU8sQ0FBQ3hCLE9BQU9FLFlBQVIsQ0FBc0IrQyxLQUF0QixDQUZUO0FBR0UsY0FBZTdCLGdCQUFnQjZELFlBSGpDO0FBSUUsWUFBYTdELGdCQUFnQjhELFVBSi9CO0FBS01YLFNBTE4sRUFERjs7O0FBU0QsQywrQ0E1T2tCbkQsZSxDQUVaK0QsUyxDQUFZLENBQ2pCM0QsZ0JBQWlCLGlCQUFVNEQsTUFEVixDQUVqQnRELFdBQVksaUJBQVV1RCxJQUZMLEMsQ0FGQWpFLGUsQ0FPWmtFLGlCLENBQW9CLENBQ3pCOUQsZ0JBQWlCLGlCQUFVK0QsR0FERixDLGlCQVBSbkUsZSIsImZpbGUiOiJEZWZhdWx0UmVuZGVyZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBQYXZlbCBBa3Nvbm92XG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqL1xuaW1wb3J0IFJlYWN0LCB7XG4gIENvbXBvbmVudCxcbiAgUHJvcFR5cGVzLFxufSBmcm9tICdyZWFjdCc7XG5pbXBvcnQge1xuICBBbmltYXRlZCxcbiAgVmlldyxcbiAgU3R5bGVTaGVldCxcbiAgRGltZW5zaW9ucyxcbn0gZnJvbSAncmVhY3QtbmF0aXZlJztcbmltcG9ydCBOYXZpZ2F0aW9uRXhwZXJpbWVudGFsIGZyb20gJ3JlYWN0LW5hdGl2ZS1leHBlcmltZW50YWwtbmF2aWdhdGlvbic7XG5pbXBvcnQgUHVyZVJlbmRlck1peGluIGZyb20gJ3JlYWN0LWFkZG9ucy1wdXJlLXJlbmRlci1taXhpbic7XG5cbmltcG9ydCBUYWJCYXIgZnJvbSAnLi9UYWJCYXInO1xuaW1wb3J0IE5hdkJhciBmcm9tICcuL05hdkJhcic7XG5pbXBvcnQgQWN0aW9ucyBmcm9tICcuL0FjdGlvbnMnO1xuaW1wb3J0IHsgZGVlcGVzdEV4cGxpY2l0VmFsdWVGb3JLZXkgfSBmcm9tICcuL1V0aWwnO1xuXG5jb25zdCBTQ1JFRU5fV0lEVEggPSBEaW1lbnNpb25zLmdldCgnd2luZG93Jykud2lkdGg7XG5cbmNvbnN0IHtcbiAgQW5pbWF0ZWRWaWV3OiBOYXZpZ2F0aW9uQW5pbWF0ZWRWaWV3LFxuICBDYXJkOiBOYXZpZ2F0aW9uQ2FyZCxcbn0gPSBOYXZpZ2F0aW9uRXhwZXJpbWVudGFsO1xuXG5jb25zdCB7XG4gIENhcmRTdGFja1BhblJlc3BvbmRlcjogTmF2aWdhdGlvbkNhcmRTdGFja1BhblJlc3BvbmRlcixcbiAgQ2FyZFN0YWNrU3R5bGVJbnRlcnBvbGF0b3I6IE5hdmlnYXRpb25DYXJkU3RhY2tTdHlsZUludGVycG9sYXRvcixcbn0gPSBOYXZpZ2F0aW9uQ2FyZDtcblxuY29uc3Qgc3R5bGVzID0gU3R5bGVTaGVldC5jcmVhdGUoe1xuICBhbmltYXRlZFZpZXc6IHtcbiAgICBmbGV4OiAxLFxuICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgfSxcbiAgc2NlbmVTdHlsZToge1xuICAgIGZsZXg6IDEsXG4gIH0sXG59KTtcblxuZnVuY3Rpb24gZmFkZUluU2NlbmUoLyogTmF2aWdhdGlvblNjZW5lUmVuZGVyZXJQcm9wcyAqLyBwcm9wcykge1xuICBjb25zdCB7XG4gICAgcG9zaXRpb24sXG4gICAgc2NlbmUsXG4gIH0gPSBwcm9wcztcblxuICBjb25zdCBpbmRleCA9IHNjZW5lLmluZGV4O1xuICBjb25zdCBpbnB1dFJhbmdlID0gW2luZGV4IC0gMSwgaW5kZXgsIGluZGV4ICsgMV07XG5cbiAgY29uc3Qgb3BhY2l0eSA9IHBvc2l0aW9uLmludGVycG9sYXRlKHtcbiAgICBpbnB1dFJhbmdlLFxuICAgIG91dHB1dFJhbmdlOiBbMCwgMSwgMC4zXSxcbiAgfSk7XG5cbiAgY29uc3Qgc2NhbGUgPSBwb3NpdGlvbi5pbnRlcnBvbGF0ZSh7XG4gICAgaW5wdXRSYW5nZSxcbiAgICBvdXRwdXRSYW5nZTogWzEsIDEsIDAuOTVdLFxuICB9KTtcblxuICBjb25zdCB0cmFuc2xhdGVZID0gMDtcbiAgY29uc3QgdHJhbnNsYXRlWCA9IDA7XG5cbiAgcmV0dXJuIHtcbiAgICBvcGFjaXR5LFxuICAgIHRyYW5zZm9ybTogW1xuICAgICAgeyBzY2FsZSB9LFxuICAgICAgeyB0cmFuc2xhdGVYIH0sXG4gICAgICB7IHRyYW5zbGF0ZVkgfSxcbiAgICBdLFxuICB9O1xufVxuXG5mdW5jdGlvbiBsZWZ0VG9SaWdodCgvKiBOYXZpZ2F0aW9uU2NlbmVSZW5kZXJlclByb3BzICovIHByb3BzKSB7XG4gIGNvbnN0IHtcbiAgICBwb3NpdGlvbixcbiAgICBzY2VuZSxcbiAgfSA9IHByb3BzO1xuXG4gIGNvbnN0IGluZGV4ID0gc2NlbmUuaW5kZXg7XG4gIGNvbnN0IGlucHV0UmFuZ2UgPSBbaW5kZXggLSAxLCBpbmRleCwgaW5kZXggKyAxXTtcblxuICBjb25zdCB0cmFuc2xhdGVYID0gcG9zaXRpb24uaW50ZXJwb2xhdGUoe1xuICAgIGlucHV0UmFuZ2UsXG4gICAgb3V0cHV0UmFuZ2U6IFstU0NSRUVOX1dJRFRILCAwLCAwXSxcbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICB0cmFuc2Zvcm06IFtcbiAgICAgIHsgdHJhbnNsYXRlWCB9LFxuICAgIF0sXG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERlZmF1bHRSZW5kZXJlciBleHRlbmRzIENvbXBvbmVudCB7XG5cbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBuYXZpZ2F0aW9uU3RhdGU6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgb25OYXZpZ2F0ZTogUHJvcFR5cGVzLmZ1bmMsXG4gIH07XG5cbiAgc3RhdGljIGNoaWxkQ29udGV4dFR5cGVzID0ge1xuICAgIG5hdmlnYXRpb25TdGF0ZTogUHJvcFR5cGVzLmFueSxcbiAgfTtcblxuICBzdGF0aWMgZ2V0UGFuSGFuZGxlcnMoZGlyZWN0aW9uLCBwcm9wcykge1xuICAgIHJldHVybiBkaXJlY3Rpb24gPT09ICd2ZXJ0aWNhbCcgP1xuICAgICAgTmF2aWdhdGlvbkNhcmRTdGFja1BhblJlc3BvbmRlci5mb3JWZXJ0aWNhbChwcm9wcykgOlxuICAgICAgTmF2aWdhdGlvbkNhcmRTdGFja1BhblJlc3BvbmRlci5mb3JIb3Jpem9udGFsKHByb3BzKTtcbiAgfVxuXG4gIHN0YXRpYyBkaXNwYXRjaEZvY3VzQWN0aW9uKHsgbmF2aWdhdGlvblN0YXRlIH0pIHtcbiAgICBpZiAoIW5hdmlnYXRpb25TdGF0ZSB8fCBuYXZpZ2F0aW9uU3RhdGUuY29tcG9uZW50IHx8IG5hdmlnYXRpb25TdGF0ZS50YWJzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHNjZW5lID0gbmF2aWdhdGlvblN0YXRlLmNoaWxkcmVuW25hdmlnYXRpb25TdGF0ZS5pbmRleF07XG4gICAgQWN0aW9ucy5mb2N1cyh7IHNjZW5lIH0pO1xuICB9XG5cbiAgc3RhdGljIGNob29zZUludGVycG9sYXRvcihkaXJlY3Rpb24sIHByb3BzKSB7XG4gICAgc3dpdGNoIChkaXJlY3Rpb24pIHtcbiAgICAgIGNhc2UgJ3ZlcnRpY2FsJzpcbiAgICAgICAgcmV0dXJuIE5hdmlnYXRpb25DYXJkU3RhY2tTdHlsZUludGVycG9sYXRvci5mb3JWZXJ0aWNhbChwcm9wcyk7XG4gICAgICBjYXNlICdmYWRlJzpcbiAgICAgICAgcmV0dXJuIGZhZGVJblNjZW5lKHByb3BzKTtcbiAgICAgIGNhc2UgJ2xlZnRUb1JpZ2h0JzpcbiAgICAgICAgcmV0dXJuIGxlZnRUb1JpZ2h0KHByb3BzKTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBOYXZpZ2F0aW9uQ2FyZFN0YWNrU3R5bGVJbnRlcnBvbGF0b3IuZm9ySG9yaXpvbnRhbChwcm9wcyk7XG4gICAgfVxuICB9XG5cbiAgc3RhdGljIHJlbmRlclNjZW5lKC8qIE5hdmlnYXRpb25TY2VuZVJlbmRlcmVyUHJvcHMgKi8gcHJvcHMpIHtcbiAgICByZXR1cm4gKFxuICAgICAgPERlZmF1bHRSZW5kZXJlclxuICAgICAgICBrZXk9e3Byb3BzLnNjZW5lLm5hdmlnYXRpb25TdGF0ZS5rZXl9XG4gICAgICAgIG9uTmF2aWdhdGU9e3Byb3BzLm9uTmF2aWdhdGV9XG4gICAgICAgIG5hdmlnYXRpb25TdGF0ZT17cHJvcHMuc2NlbmUubmF2aWdhdGlvblN0YXRlfVxuICAgICAgLz5cbiAgICApO1xuICB9XG5cbiAgc3RhdGljIHJlbmRlckhlYWRlcigvKiBOYXZpZ2F0aW9uU2NlbmVSZW5kZXJlclByb3BzICovIHByb3BzKSB7XG4gICAgY29uc3Qgc3RhdGUgPSBwcm9wcy5uYXZpZ2F0aW9uU3RhdGU7XG4gICAgY29uc3QgY2hpbGQgPSBzdGF0ZS5jaGlsZHJlbltzdGF0ZS5pbmRleF07XG4gICAgbGV0IHNlbGVjdGVkID0gc3RhdGUuY2hpbGRyZW5bc3RhdGUuaW5kZXhdO1xuICAgIHdoaWxlICh7fS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNlbGVjdGVkLCAnY2hpbGRyZW4nKSkge1xuICAgICAgc2VsZWN0ZWQgPSBzZWxlY3RlZC5jaGlsZHJlbltzZWxlY3RlZC5pbmRleF07XG4gICAgfVxuICAgIGlmIChjaGlsZCAhPT0gc2VsZWN0ZWQpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKGBTS0lQUElORyByZW5kZXJIZWFkZXIgYmVjYXVzZSAke2NoaWxkLmtleX0gIT09ICR7c2VsZWN0ZWQua2V5fWApO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGhpZGVOYXZCYXIgPSBkZWVwZXN0RXhwbGljaXRWYWx1ZUZvcktleShzdGF0ZSwgJ2hpZGVOYXZCYXInKTtcbiAgICBpZiAoaGlkZU5hdkJhcikge1xuICAgICAgLy8gY29uc29sZS5sb2coYFNLSVBQSU5HIHJlbmRlckhlYWRlciBiZWNhdXNlICR7Y2hpbGQua2V5fSBoaWRlTmF2QmFyID09PSB0cnVlYCk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBjb25zb2xlLmxvZyhgcmVuZGVySGVhZGVyIGZvciAke2NoaWxkLmtleX1gKTtcblxuICAgIGlmIChzZWxlY3RlZC5jb21wb25lbnQgJiYgc2VsZWN0ZWQuY29tcG9uZW50LnJlbmRlck5hdmlnYXRpb25CYXIpIHtcbiAgICAgIHJldHVybiBzZWxlY3RlZC5jb21wb25lbnQucmVuZGVyTmF2aWdhdGlvbkJhcih7IC4uLnByb3BzLCAuLi5zZWxlY3RlZCB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBIZWFkZXJDb21wb25lbnQgPSBzZWxlY3RlZC5uYXZCYXIgfHwgY2hpbGQubmF2QmFyIHx8IHN0YXRlLm5hdkJhciB8fCBOYXZCYXI7XG4gICAgY29uc3QgbmF2QmFyUHJvcHMgPSB7IC4uLnN0YXRlLCAuLi5jaGlsZCwgLi4uc2VsZWN0ZWQgfTtcblxuICAgIGlmIChzZWxlY3RlZC5jb21wb25lbnQgJiYgc2VsZWN0ZWQuY29tcG9uZW50Lm9uUmlnaHQpIHtcbiAgICAgIG5hdkJhclByb3BzLm9uUmlnaHQgPSBzZWxlY3RlZC5jb21wb25lbnQub25SaWdodDtcbiAgICB9XG5cbiAgICBpZiAoc2VsZWN0ZWQuY29tcG9uZW50ICYmIHNlbGVjdGVkLmNvbXBvbmVudC5vbkxlZnQpIHtcbiAgICAgIG5hdkJhclByb3BzLm9uTGVmdCA9IHNlbGVjdGVkLmNvbXBvbmVudC5vbkxlZnQ7XG4gICAgfVxuXG4gICAgaWYgKChuYXZCYXJQcm9wcy5sZWZ0VGl0bGUgfHwgbmF2QmFyUHJvcHMubGVmdEJ1dHRvbkltYWdlKSAmJiBuYXZCYXJQcm9wcy5vbkxlZnQpIHtcbiAgICAgIGRlbGV0ZSBuYXZCYXJQcm9wcy5sZWZ0QnV0dG9uO1xuICAgIH1cblxuICAgIGlmICgobmF2QmFyUHJvcHMucmlnaHRUaXRsZSB8fCBuYXZCYXJQcm9wcy5yaWdodEJ1dHRvbkltYWdlKSAmJiBuYXZCYXJQcm9wcy5vblJpZ2h0KSB7XG4gICAgICBkZWxldGUgbmF2QmFyUHJvcHMucmlnaHRCdXR0b247XG4gICAgfVxuXG4gICAgaWYgKG5hdkJhclByb3BzLnJpZ2h0QnV0dG9uKSB7XG4gICAgICBkZWxldGUgbmF2QmFyUHJvcHMucmlnaHRUaXRsZTtcbiAgICAgIGRlbGV0ZSBuYXZCYXJQcm9wcy5vblJpZ2h0O1xuICAgICAgZGVsZXRlIG5hdkJhclByb3BzLnJpZ2h0QnV0dG9uSW1hZ2U7XG4gICAgfVxuXG4gICAgaWYgKG5hdkJhclByb3BzLmxlZnRCdXR0b24pIHtcbiAgICAgIGRlbGV0ZSBuYXZCYXJQcm9wcy5sZWZ0VGl0bGU7XG4gICAgICBkZWxldGUgbmF2QmFyUHJvcHMub25MZWZ0O1xuICAgICAgZGVsZXRlIG5hdkJhclByb3BzLmxlZnRCdXR0b25JbWFnZTtcbiAgICB9XG4gICAgZGVsZXRlIG5hdkJhclByb3BzLnN0eWxlO1xuXG4gICAgY29uc3QgZ2V0VGl0bGUgPSBzZWxlY3RlZC5nZXRUaXRsZSB8fCAob3B0cyA9PiBvcHRzLnRpdGxlKTtcbiAgICByZXR1cm4gPEhlYWRlckNvbXBvbmVudCB7Li4ucHJvcHN9IHsuLi5uYXZCYXJQcm9wc30gZ2V0VGl0bGU9e2dldFRpdGxlfSAvPjtcbiAgfVxuXG4gIHN0YXRpYyByZW5kZXJDYXJkKC8qIE5hdmlnYXRpb25TY2VuZVJlbmRlcmVyUHJvcHMgKi8gcHJvcHMpIHtcbiAgICBjb25zdCB7IGtleSxcbiAgICAgIGRpcmVjdGlvbixcbiAgICAgIGFuaW1hdGlvbixcbiAgICAgIGdldFNjZW5lU3R5bGUsXG4gICAgICBnZXRQYW5IYW5kbGVycyxcbiAgICB9ID0gcHJvcHMuc2NlbmUubmF2aWdhdGlvblN0YXRlO1xuXG4gICAgY29uc3Qgc3RhdGUgPSBwcm9wcy5uYXZpZ2F0aW9uU3RhdGU7XG4gICAgY29uc3QgY2hpbGQgPSBzdGF0ZS5jaGlsZHJlbltzdGF0ZS5pbmRleF07XG4gICAgbGV0IHNlbGVjdGVkID0gc3RhdGUuY2hpbGRyZW5bc3RhdGUuaW5kZXhdO1xuICAgIHdoaWxlICh7fS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNlbGVjdGVkLCAnY2hpbGRyZW4nKSkge1xuICAgICAgc2VsZWN0ZWQgPSBzZWxlY3RlZC5jaGlsZHJlbltzZWxlY3RlZC5pbmRleF07XG4gICAgfVxuICAgIGxldCB7IHBhbkhhbmRsZXJzLCBhbmltYXRpb25TdHlsZSB9ID0gc2VsZWN0ZWQ7XG4gICAgY29uc3QgaXNBY3RpdmUgPSBjaGlsZCA9PT0gc2VsZWN0ZWQ7XG4gICAgY29uc3QgY29tcHV0ZWRQcm9wcyA9IHsgaXNBY3RpdmUgfTtcbiAgICBpZiAoaXNBY3RpdmUpIHtcbiAgICAgIGNvbXB1dGVkUHJvcHMuaGlkZU5hdkJhciA9IGRlZXBlc3RFeHBsaWNpdFZhbHVlRm9yS2V5KHByb3BzLm5hdmlnYXRpb25TdGF0ZSwgJ2hpZGVOYXZCYXInKTtcbiAgICAgIGNvbXB1dGVkUHJvcHMuaGlkZVRhYkJhciA9IGRlZXBlc3RFeHBsaWNpdFZhbHVlRm9yS2V5KHByb3BzLm5hdmlnYXRpb25TdGF0ZSwgJ2hpZGVUYWJCYXInKTtcbiAgICB9XG5cbiAgICBjb25zdCBzdHlsZSA9IGdldFNjZW5lU3R5bGUgPyBnZXRTY2VuZVN0eWxlKHByb3BzLCBjb21wdXRlZFByb3BzKSA6IG51bGw7XG5cbiAgICAvLyBkaXJlY3Rpb24gb3ZlcnJpZGVzIGFuaW1hdGlvbiBpZiBib3RoIGFyZSBzdXBwbGllZFxuICAgIGNvbnN0IGFuaW1UeXBlID0gKGFuaW1hdGlvbiAmJiAhZGlyZWN0aW9uKSA/IGFuaW1hdGlvbiA6IGRpcmVjdGlvbjtcblxuICAgIGlmICh0eXBlb2YgKGFuaW1hdGlvblN0eWxlKSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIGFuaW1hdGlvblN0eWxlID0gRGVmYXVsdFJlbmRlcmVyLmNob29zZUludGVycG9sYXRvcihhbmltVHlwZSwgcHJvcHMpO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgKGFuaW1hdGlvblN0eWxlKSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgYW5pbWF0aW9uU3R5bGUgPSBhbmltYXRpb25TdHlsZShwcm9wcyk7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiAocGFuSGFuZGxlcnMpID09PSAndW5kZWZpbmVkJykge1xuICAgICAgcGFuSGFuZGxlcnMgPSBnZXRQYW5IYW5kbGVycyA/XG4gICAgICAgIGdldFBhbkhhbmRsZXJzKHByb3BzLCBkaXJlY3Rpb24pIDpcbiAgICAgICAgRGVmYXVsdFJlbmRlcmVyLmdldFBhbkhhbmRsZXJzKGRpcmVjdGlvbiwgcHJvcHMpO1xuICAgIH1cbiAgICByZXR1cm4gKFxuICAgICAgPE5hdmlnYXRpb25DYXJkXG4gICAgICAgIHsuLi5wcm9wc31cbiAgICAgICAga2V5PXtgY2FyZF8ke2tleX1gfVxuICAgICAgICBzdHlsZT17W2FuaW1hdGlvblN0eWxlLCBzdHlsZV19XG4gICAgICAgIHBhbkhhbmRsZXJzPXtwYW5IYW5kbGVyc31cbiAgICAgICAgcmVuZGVyU2NlbmU9e0RlZmF1bHRSZW5kZXJlci5yZW5kZXJTY2VuZX1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuXG4gICAgdGhpcy5zaG91bGRDb21wb25lbnRVcGRhdGUgPSBQdXJlUmVuZGVyTWl4aW4uc2hvdWxkQ29tcG9uZW50VXBkYXRlLmJpbmQodGhpcyk7XG4gIH1cblxuICBnZXRDaGlsZENvbnRleHQoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hdmlnYXRpb25TdGF0ZTogdGhpcy5wcm9wcy5uYXZpZ2F0aW9uU3RhdGUsXG4gICAgfTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIERlZmF1bHRSZW5kZXJlci5kaXNwYXRjaEZvY3VzQWN0aW9uKHRoaXMucHJvcHMpO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHtcbiAgICBpZiAobmV4dFByb3BzLm5hdmlnYXRpb25TdGF0ZSAhPT0gdGhpcy5wcm9wcy5uYXZpZ2F0aW9uU3RhdGUpIHtcbiAgICAgIERlZmF1bHRSZW5kZXJlci5kaXNwYXRjaEZvY3VzQWN0aW9uKG5leHRQcm9wcyk7XG4gICAgfVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgbmF2aWdhdGlvblN0YXRlLCBvbk5hdmlnYXRlIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgaWYgKCFuYXZpZ2F0aW9uU3RhdGUgfHwgIW9uTmF2aWdhdGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ25hdmlnYXRpb25TdGF0ZSBhbmQgb25OYXZpZ2F0ZSBwcm9wZXJ0eSBzaG91bGQgYmUgbm90IG51bGwnKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGxldCBTY2VuZUNvbXBvbmVudCA9IG5hdmlnYXRpb25TdGF0ZS5jb21wb25lbnQ7XG5cbiAgICBpZiAobmF2aWdhdGlvblN0YXRlLnRhYnMgJiYgIVNjZW5lQ29tcG9uZW50KSB7XG4gICAgICBTY2VuZUNvbXBvbmVudCA9IFRhYkJhcjtcbiAgICB9XG5cbiAgICBpZiAoU2NlbmVDb21wb25lbnQpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxWaWV3XG4gICAgICAgICAgc3R5bGU9e1tzdHlsZXMuc2NlbmVTdHlsZSwgbmF2aWdhdGlvblN0YXRlLnNjZW5lU3R5bGVdfVxuICAgICAgICA+XG4gICAgICAgICAgPFNjZW5lQ29tcG9uZW50IHsuLi50aGlzLnByb3BzfSB7Li4ubmF2aWdhdGlvblN0YXRlfSAvPlxuICAgICAgICA8L1ZpZXc+XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IG9wdGlvbmFscyA9IHt9O1xuICAgIGNvbnN0IHNlbGVjdGVkID0gbmF2aWdhdGlvblN0YXRlLmNoaWxkcmVuW25hdmlnYXRpb25TdGF0ZS5pbmRleF07XG4gICAgY29uc3QgYXBwbHlBbmltYXRpb24gPSBzZWxlY3RlZC5hcHBseUFuaW1hdGlvbiB8fCBuYXZpZ2F0aW9uU3RhdGUuYXBwbHlBbmltYXRpb247XG4gICAgY29uc3Qgc3R5bGUgPSBzZWxlY3RlZC5zdHlsZSB8fCBuYXZpZ2F0aW9uU3RhdGUuc3R5bGU7XG5cbiAgICBpZiAoYXBwbHlBbmltYXRpb24pIHtcbiAgICAgIG9wdGlvbmFscy5hcHBseUFuaW1hdGlvbiA9IGFwcGx5QW5pbWF0aW9uO1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgZHVyYXRpb24gPSBzZWxlY3RlZC5kdXJhdGlvbjtcbiAgICAgIGlmIChkdXJhdGlvbiA9PT0gbnVsbCB8fCBkdXJhdGlvbiA9PT0gdW5kZWZpbmVkKSBkdXJhdGlvbiA9IG5hdmlnYXRpb25TdGF0ZS5kdXJhdGlvbjtcbiAgICAgIGlmIChkdXJhdGlvbiAhPT0gbnVsbCAmJiBkdXJhdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIG9wdGlvbmFscy5hcHBseUFuaW1hdGlvbiA9IChwb3MsIG5hdlN0YXRlKSA9PiB7XG4gICAgICAgICAgaWYgKGR1cmF0aW9uID09PSAwKSB7XG4gICAgICAgICAgICBwb3Muc2V0VmFsdWUobmF2U3RhdGUuaW5kZXgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBBbmltYXRlZC50aW1pbmcocG9zLCB7IHRvVmFsdWU6IG5hdlN0YXRlLmluZGV4LCBkdXJhdGlvbiB9KS5zdGFydCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBjb25zb2xlLmxvZyhgTmF2aWdhdGlvbkFuaW1hdGVkVmlldyBmb3IgJHtuYXZpZ2F0aW9uU3RhdGUua2V5fWApO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxOYXZpZ2F0aW9uQW5pbWF0ZWRWaWV3XG4gICAgICAgIG5hdmlnYXRpb25TdGF0ZT17bmF2aWdhdGlvblN0YXRlfVxuICAgICAgICBzdHlsZT17W3N0eWxlcy5hbmltYXRlZFZpZXcsIHN0eWxlXX1cbiAgICAgICAgcmVuZGVyT3ZlcmxheT17RGVmYXVsdFJlbmRlcmVyLnJlbmRlckhlYWRlcn1cbiAgICAgICAgcmVuZGVyU2NlbmU9e0RlZmF1bHRSZW5kZXJlci5yZW5kZXJDYXJkfVxuICAgICAgICB7Li4ub3B0aW9uYWxzfVxuICAgICAgLz5cbiAgICApO1xuICB9XG59XG4iXX0=