d2f7920097b55600e0da633d1a65c4c7
Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};exports.






































getInitialState=getInitialState;exports.default=











































function(scenes){

var rootRoute=Object.keys(scenes).find(function(route){return(
{}.hasOwnProperty.call(scenes,route)&&!scenes[route].parent);});

return getInitialState(scenes[rootRoute],scenes);
};var _Util=require('./Util');var _ActionConst=require('./ActionConst');var ActionConst=_interopRequireWildcard(_ActionConst);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key];}}newObj.default=obj;return newObj;}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i];}return target;}function getStateFromScenes(route,scenes,props){var getters=[];var result={};var scene=route;while(scene){if(scene.getInitialState){getters.push(scene.getInitialState);}scene=scenes[scene.parent];}if(scenes.rootProps&&scenes.rootProps.getInitialState){getters.push(scenes.rootProps.getInitialState);}getters.reverse().forEach(function(fn){result=_extends({},result,fn(props));});return result;}function getSceneKey(parent,key,position,sceneKey){return[parent,key,position,sceneKey].filter(function(v){return typeof v!=='undefined'&&v!==null;}).join('_');}function getInitialState(route,scenes){var position=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var props=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var parent=props.parent,key=props.key,style=props.style,type=props.type,parentProps=_objectWithoutProperties(props,['parent','key','style','type']);if(!route.children){return _extends({},scenes.rootProps,route,{key:getSceneKey(parent,key,position,route.sceneKey)},parentProps,getStateFromScenes(route,scenes,props));}var res=_extends({},route,scenes.rootProps,parentProps);var index=0;route.children.forEach(function(r,i){(0,_Util.assert)(scenes[r],'Empty scene for key='+route.key);if(scenes[r].initial){index=i;}});if(route.tabs){res.children=route.children.map(function(r,i){return getInitialState(scenes[r],scenes,i,_extends({},props,{parentIndex:position}));});res.index=index;}else{res.children=[getInitialState(scenes[route.children[index]],scenes,0,props)];res.index=0;}if(route.type===ActionConst.JUMP){res.children=res.children.map(function(child){return _extends({},props,child);});}res.key=position+'_'+res.key;return res;}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlN0YXRlLmpzIl0sIm5hbWVzIjpbImdldEluaXRpYWxTdGF0ZSIsInNjZW5lcyIsInJvb3RSb3V0ZSIsIk9iamVjdCIsImtleXMiLCJmaW5kIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwicm91dGUiLCJwYXJlbnQiLCJBY3Rpb25Db25zdCIsImdldFN0YXRlRnJvbVNjZW5lcyIsInByb3BzIiwiZ2V0dGVycyIsInJlc3VsdCIsInNjZW5lIiwicHVzaCIsInJvb3RQcm9wcyIsInJldmVyc2UiLCJmb3JFYWNoIiwiZm4iLCJnZXRTY2VuZUtleSIsImtleSIsInBvc2l0aW9uIiwic2NlbmVLZXkiLCJmaWx0ZXIiLCJ2Iiwiam9pbiIsInN0eWxlIiwidHlwZSIsInBhcmVudFByb3BzIiwiY2hpbGRyZW4iLCJyZXMiLCJpbmRleCIsInIiLCJpIiwiaW5pdGlhbCIsInRhYnMiLCJtYXAiLCJwYXJlbnRJbmRleCIsIkpVTVAiLCJjaGlsZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBdUNnQkEsZSxDQUFBQSxlOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTRDRCxTQUFVQyxNQUFWLENBQWdDOztBQUU3QyxHQUFNQyxXQUFZQyxPQUFPQyxJQUFQLENBQVlILE1BQVosRUFBb0JJLElBQXBCLENBQXlCO0FBQ3hDLEVBQUQsQ0FBS0MsY0FBTCxDQUFvQkMsSUFBcEIsQ0FBeUJOLE1BQXpCLENBQWlDTyxLQUFqQyxHQUEyQyxDQUFDUCxPQUFPTyxLQUFQLEVBQWNDLE1BRGpCLEdBQXpCLENBQWxCOztBQUdBLE1BQU9ULGlCQUFnQkMsT0FBT0MsU0FBUCxDQUFoQixDQUFtQ0QsTUFBbkMsQ0FBUDtBQUNELEMsQ0FqRkQsNEJBQ0EsMEMsR0FBWVMsWSxzZEFFWixRQUFTQyxtQkFBVCxDQUE0QkgsS0FBNUIsQ0FBbUNQLE1BQW5DLENBQTJDVyxLQUEzQyxDQUFrRCxDQUNoRCxHQUFN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ZixDQUNBb0IsSUFBSUMsS0FBSixDQUFZLENBQVosQ0FDRCxDQUdELEdBQUl6QixNQUFNcUIsSUFBTixHQUFlbkIsWUFBWThCLElBQS9CLENBQXFDLENBQ25DUixJQUFJRCxRQUFKLENBQWVDLElBQUlELFFBQUosQ0FBYU8sR0FBYixDQUFpQixtQ0FBZTFCLEtBQWYsQ0FBeUI2QixLQUF6QixHQUFqQixDQUFmLENBQ0QsQ0FFRFQsSUFBSVYsR0FBSixDQUFhQyxRQUFiLEtBQXlCUyxJQUFJVixHQUE3QixDQUNBLE1BQU9VLElBQVAsQ0FDRCIsImZpbGUiOiJTdGF0ZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIFBhdmVsIEFrc29ub3ZcbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICovXG5pbXBvcnQgeyBhc3NlcnQgfSBmcm9tICcuL1V0aWwnO1xuaW1wb3J0ICogYXMgQWN0aW9uQ29uc3QgZnJvbSAnLi9BY3Rpb25Db25zdCc7XG5cbmZ1bmN0aW9uIGdldFN0YXRlRnJvbVNjZW5lcyhyb3V0ZSwgc2NlbmVzLCBwcm9wcykge1xuICBjb25zdCBnZXR0ZXJzID0gW107XG4gIGxldCByZXN1bHQgPSB7fTtcbiAgbGV0IHNjZW5lID0gcm91dGU7XG4gIHdoaWxlIChzY2VuZSkge1xuICAgIGlmIChzY2VuZS5nZXRJbml0aWFsU3RhdGUpIHtcbiAgICAgIGdldHRlcnMucHVzaChzY2VuZS5nZXRJbml0aWFsU3RhdGUpO1xuICAgIH1cbiAgICBzY2VuZSA9IHNjZW5lc1tzY2VuZS5wYXJlbnRdO1xuICB9XG5cbiAgaWYgKHNjZW5lcy5yb290UHJvcHMgJiYgc2NlbmVzLnJvb3RQcm9wcy5nZXRJbml0aWFsU3RhdGUpIHtcbiAgICBnZXR0ZXJzLnB1c2goc2NlbmVzLnJvb3RQcm9wcy5nZXRJbml0aWFsU3RhdGUpO1xuICB9XG5cbiAgZ2V0dGVycy5yZXZlcnNlKCkuZm9yRWFjaCgoZm4pID0+IHtcbiAgICByZXN1bHQgPSB7IC4uLnJlc3VsdCwgLi4uZm4ocHJvcHMpIH07XG4gIH0pO1xuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIGdldFNjZW5lS2V5KHBhcmVudCwga2V5LCBwb3NpdGlvbiwgc2NlbmVLZXkpIHtcbiAgcmV0dXJuIFtwYXJlbnQsIGtleSwgcG9zaXRpb24sIHNjZW5lS2V5XVxuICAgIC5maWx0ZXIodiA9PiB0eXBlb2YgKHYpICE9PSAndW5kZWZpbmVkJyAmJiB2ICE9PSBudWxsKVxuICAgIC5qb2luKCdfJyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRJbml0aWFsU3RhdGUoXG4gIHJvdXRlOiB7c3RyaW5nOiBhbnl9LFxuICBzY2VuZXM6IHtzdHJpbmc6IGFueX0sXG4gIHBvc2l0aW9uID0gMCxcbiAgcHJvcHMgPSB7fSxcbikge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcbiAgY29uc3QgeyBwYXJlbnQsIGtleSwgc3R5bGUsIHR5cGUsIC4uLnBhcmVudFByb3BzIH0gPSBwcm9wcztcbiAgaWYgKCFyb3V0ZS5jaGlsZHJlbikge1xuICAgIHJldHVybiB7XG4gICAgICAuLi5zY2VuZXMucm9vdFByb3BzLFxuICAgICAgLi4ucm91dGUsXG4gICAgICBrZXk6IGdldFNjZW5lS2V5KHBhcmVudCwga2V5LCBwb3NpdGlvbiwgcm91dGUuc2NlbmVLZXkpLFxuICAgICAgLi4ucGFyZW50UHJvcHMsXG4gICAgICAuLi5nZXRTdGF0ZUZyb21TY2VuZXMocm91dGUsIHNjZW5lcywgcHJvcHMpLFxuICAgIH07XG4gIH1cbiAgY29uc3QgcmVzID0geyAuLi5yb3V0ZSwgLi4uc2NlbmVzLnJvb3RQcm9wcywgLi4ucGFyZW50UHJvcHMgfTtcbiAgbGV0IGluZGV4ID0gMDtcbiAgcm91dGUuY2hpbGRyZW4uZm9yRWFjaCgociwgaSkgPT4ge1xuICAgIGFzc2VydChzY2VuZXNbcl0sIGBFbXB0eSBzY2VuZSBmb3Iga2V5PSR7cm91dGUua2V5fWApO1xuICAgIGlmIChzY2VuZXNbcl0uaW5pdGlhbCkge1xuICAgICAgaW5kZXggPSBpO1xuICAgIH1cbiAgfSk7XG5cbiAgaWYgKHJvdXRlLnRhYnMpIHtcbiAgICByZXMuY2hpbGRyZW4gPSByb3V0ZS5jaGlsZHJlbi5tYXAoXG4gICAgICAociwgaSkgPT4gZ2V0SW5pdGlhbFN0YXRlKHNjZW5lc1tyXSwgc2NlbmVzLCBpLCB7IC4uLnByb3BzLCBwYXJlbnRJbmRleDogcG9zaXRpb24gfSkpO1xuICAgIHJlcy5pbmRleCA9IGluZGV4O1xuICB9IGVsc2Uge1xuICAgIHJlcy5jaGlsZHJlbiA9IFtnZXRJbml0aWFsU3RhdGUoc2NlbmVzW3JvdXRlLmNoaWxkcmVuW2luZGV4XV0sIHNjZW5lcywgMCwgcHJvcHMpXTtcbiAgICByZXMuaW5kZXggPSAwO1xuICB9XG5cbiAgLy8gQ29weSBwcm9wcyB0byB0aGUgY2hpbGRyZW4gb2YgdGFiIHJvdXRlc1xuICBpZiAocm91dGUudHlwZSA9PT0gQWN0aW9uQ29uc3QuSlVNUCkge1xuICAgIHJlcy5jaGlsZHJlbiA9IHJlcy5jaGlsZHJlbi5tYXAoY2hpbGQgPT4gKHsgLi4ucHJvcHMsIC4uLmNoaWxkIH0pKTtcbiAgfVxuXG4gIHJlcy5rZXkgPSBgJHtwb3NpdGlvbn1fJHtyZXMua2V5fWA7XG4gIHJldHVybiByZXM7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIChzY2VuZXM6e3N0cmluZzogYW55fSkge1xuICAvLyBmaW5kIFwicm9vdFwiIGNvbXBvbmVudCBhbmQgZ2V0IHN0YXRlIGZyb20gaXRcbiAgY29uc3Qgcm9vdFJvdXRlID0gT2JqZWN0LmtleXMoc2NlbmVzKS5maW5kKHJvdXRlID0+XG4gICAgKHt9KS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNjZW5lcywgcm91dGUpICYmICFzY2VuZXNbcm91dGVdLnBhcmVudCk7XG5cbiAgcmV0dXJuIGdldEluaXRpYWxTdGF0ZShzY2VuZXNbcm9vdFJvdXRlXSwgc2NlbmVzKTtcbn1cbiJdfQ==