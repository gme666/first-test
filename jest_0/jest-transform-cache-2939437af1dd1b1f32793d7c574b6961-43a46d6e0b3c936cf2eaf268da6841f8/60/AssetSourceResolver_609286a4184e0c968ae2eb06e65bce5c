183b7d0be09e68cc70d6e9581e0aaf43











'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}











var PixelRatio=require('PixelRatio');
var Platform=require('Platform');

var assetPathUtils=require('../../local-cli/bundle/assetPathUtils');
var invariant=require('fbjs/lib/invariant');




function getScaledAssetPath(asset){
var scale=AssetSourceResolver.pickScale(asset.scales,PixelRatio.get());
var scaleSuffix=scale===1?'':'@'+scale+'x';
var assetDir=assetPathUtils.getBasePath(asset);
return assetDir+'/'+asset.name+scaleSuffix+'.'+asset.type;
}




function getAssetPathInDrawableFolder(asset){
var scale=AssetSourceResolver.pickScale(asset.scales,PixelRatio.get());
var drawbleFolder=assetPathUtils.getAndroidDrawableFolderName(asset,scale);
var fileName=assetPathUtils.getAndroidResourceIdentifier(asset);
return drawbleFolder+'/'+fileName+'.'+asset.type;
}var

AssetSourceResolver=function(){







function AssetSourceResolver(serverUrl,bundlePath,asset){_classCallCheck(this,AssetSourceResolver);
this.serverUrl=serverUrl;
this.bundlePath=bundlePath;
this.asset=asset;
}_createClass(AssetSourceResolver,[{key:'isLoadedFromServer',value:function isLoadedFromServer()

{
return!!this.serverUrl;
}},{key:'isLoadedFromFileSystem',value:function isLoadedFromFileSystem()

{
return!!this.bundlePath;
}},{key:'defaultAsset',value:function defaultAsset()

{
if(this.isLoadedFromServer()){
return this.assetServerURL();
}

if(Platform.OS==='android'){
return this.isLoadedFromFileSystem()?
this.drawableFolderInBundle():
this.resourceIdentifierWithoutScale();
}else{
return this.scaledAssetPathInBundle();
}
}},{key:'assetServerURL',value:function assetServerURL()





{
invariant(!!this.serverUrl,'need server to load from');
return this.fromSource(
this.serverUrl+getScaledAssetPath(this.asset)+
'?platform='+Platform.OS+'&hash='+this.asset.hash);

}},{key:'scaledAssetPath',value:function scaledAssetPath()





{
return this.fromSource(getScaledAssetPath(this.asset));
}},{key:'scaledAssetPathInBundle',value:function scaledAssetPathInBundle()





{
var path=this.bundlePath||'';
return this.fromSource(path+getScaledAssetPath(this.asset));
}},{key:'resourceIdentifierWithoutScale',value:function resourceIdentifierWithoutScale()







{
invariant(Platform.OS==='android','resource identifiers work on Android');
return this.fromSource(assetPathUtils.getAndroidResourceIdentifier(this.asset));
}},{key:'drawableFolderInBundle',value:function drawableFolderInBundle()






{
var path=this.bundlePath||'';
return this.fromSource(
'file://'+path+getAssetPathInDrawableFolder(this.asset));

}},{key:'fromSource',value:function fromSource(

source){
return{
__packager_asset:true,
width:this.asset.width,
height:this.asset.height,
uri:source,
scale:AssetSourceResolver.pickScale(this.asset.scales,PixelRatio.get())};

}}],[{key:'pickScale',value:function pickScale(

scales,deviceScale){

for(var i=0;i<scales.length;i++){
if(scales[i]>=deviceScale){
return scales[i];
}
}




return scales[scales.length-1]||1;
}}]);return AssetSourceResolver;}();



module.exports=AssetSourceResolver;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFzc2V0U291cmNlUmVzb2x2ZXIuanMiXSwibmFtZXMiOlsiUGl4ZWxSYXRpbyIsInJlcXVpcmUiLCJQbGF0Zm9ybSIsImFzc2V0UGF0aFV0aWxzIiwiaW52YXJpYW50IiwiZ2V0U2NhbGVkQXNzZXRQYXRoIiwiYXNzZXQiLCJzY2FsZSIsIkFzc2V0U291cmNlUmVzb2x2ZXIiLCJwaWNrU2NhbGUiLCJzY2FsZXMiLCJnZXQiLCJzY2FsZVN1ZmZpeCIsImFzc2V0RGlyIiwiZ2V0QmFzZVBhdGgiLCJuYW1lIiwidHlwZSIsImdldEFzc2V0UGF0aEluRHJhd2FibGVGb2xkZXIiLCJkcmF3YmxlRm9sZGVyIiwiZ2V0QW5kcm9pZERyYXdhYmxlRm9sZGVyTmFtZSIsImZpbGVOYW1lIiwiZ2V0QW5kcm9pZFJlc291cmNlSWRlbnRpZmllciIsInNlcnZlclVybCIsImJ1bmRsZVBhdGgiLCJpc0xvYWRlZEZyb21TZXJ2ZXIiLCJhc3NldFNlcnZlclVSTCIsIk9TIiwiaXNMb2FkZWRGcm9tRmlsZVN5c3RlbSIsImRyYXdhYmxlRm9sZGVySW5CdW5kbGUiLCJyZXNvdXJjZUlkZW50aWZpZXJXaXRob3V0U2NhbGUiLCJzY2FsZWRBc3NldFBhdGhJbkJ1bmRsZSIsImZyb21Tb3VyY2UiLCJoYXNoIiwicGF0aCIsInNvdXJjZSIsIl9fcGFja2FnZXJfYXNzZXQiLCJ3aWR0aCIsImhlaWdodCIsInVyaSIsImRldmljZVNjYWxlIiwiaSIsImxlbmd0aCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBV0EsYTs7Ozs7Ozs7Ozs7O0FBWUEsR0FBTUEsWUFBYUMsUUFBUSxZQUFSLENBQW5CO0FBQ0EsR0FBTUMsVUFBV0QsUUFBUSxVQUFSLENBQWpCOztBQUVBLEdBQU1FLGdCQUFpQkYsUUFBUSx1Q0FBUixDQUF2QjtBQUNBLEdBQU1HLFdBQVlILFFBQVEsb0JBQVIsQ0FBbEI7Ozs7O0FBS0EsUUFBU0ksbUJBQVQsQ0FBNEJDLEtBQTVCLENBQTJD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QUFDTEMsaUJBQWtCLElBRGI7QUFFTEMsTUFBTyxLQUFLOUIsS0FBTCxDQUFXOEIsS0FGYjtBQUdMQyxPQUFRLEtBQUsvQixLQUFMLENBQVcrQixNQUhkO0FBSUxDLElBQUtKLE1BSkE7QUFLTDNCLE1BQU9DLG9CQUFvQkMsU0FBcEIsQ0FBOEIsS0FBS0gsS0FBTCxDQUFXSSxNQUF6QyxDQUFpRFYsV0FBV1csR0FBWCxFQUFqRCxDQUxGLENBQVA7O0FBT0QsQzs7QUFFZ0JELE0sQ0FBdUI2QixXLENBQTZCOztBQUVuRSxJQUFLLEdBQUlDLEdBQUksQ0FBYixDQUFnQkEsRUFBSTlCLE9BQU8rQixNQUEzQixDQUFtQ0QsR0FBbkMsQ0FBd0M7QUFDdEMsR0FBSTlCLE9BQU84QixDQUFQLEdBQWFELFdBQWpCLENBQThCO0FBQzVCLE1BQU83QixRQUFPOEIsQ0FBUCxDQUFQO0FBQ0Q7QUFDRjs7Ozs7QUFLRCxNQUFPOUIsUUFBT0EsT0FBTytCLE1BQVAsQ0FBZ0IsQ0FBdkIsR0FBNkIsQ0FBcEM7QUFDRCxDOzs7O0FBSUZDLE9BQU9DLE9BQVAsQ0FBaUJuQyxtQkFBakIiLCJmaWxlIjoiQXNzZXRTb3VyY2VSZXNvbHZlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cbiAqXG4gKiBAcHJvdmlkZXNNb2R1bGUgQXNzZXRTb3VyY2VSZXNvbHZlclxuICogQGZsb3dcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnQgdHlwZSBSZXNvbHZlZEFzc2V0U291cmNlID0ge1xuICBfX3BhY2thZ2VyX2Fzc2V0OiBib29sZWFuLFxuICB3aWR0aDogP251bWJlcixcbiAgaGVpZ2h0OiA/bnVtYmVyLFxuICB1cmk6IHN0cmluZyxcbiAgc2NhbGU6IG51bWJlcixcbn07XG5cbmltcG9ydCB0eXBlIHsgUGFja2FnZXJBc3NldCB9IGZyb20gJ0Fzc2V0UmVnaXN0cnknO1xuXG5jb25zdCBQaXhlbFJhdGlvID0gcmVxdWlyZSgnUGl4ZWxSYXRpbycpO1xuY29uc3QgUGxhdGZvcm0gPSByZXF1aXJlKCdQbGF0Zm9ybScpO1xuXG5jb25zdCBhc3NldFBhdGhVdGlscyA9IHJlcXVpcmUoJy4uLy4uL2xvY2FsLWNsaS9idW5kbGUvYXNzZXRQYXRoVXRpbHMnKTtcbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ZianMvbGliL2ludmFyaWFudCcpO1xuXG4vKipcbiAqIFJldHVybnMgYSBwYXRoIGxpa2UgJ2Fzc2V0cy9Bd2Vzb21lTW9kdWxlL2ljb25AMngucG5nJ1xuICovXG5mdW5jdGlvbiBnZXRTY2FsZWRBc3NldFBhdGgoYXNzZXQpOiBzdHJpbmcge1xuICB2YXIgc2NhbGUgPSBBc3NldFNvdXJjZVJlc29sdmVyLnBpY2tTY2FsZShhc3NldC5zY2FsZXMsIFBpeGVsUmF0aW8uZ2V0KCkpO1xuICB2YXIgc2NhbGVTdWZmaXggPSBzY2FsZSA9PT0gMSA/ICcnIDogJ0AnICsgc2NhbGUgKyAneCc7XG4gIHZhciBhc3NldERpciA9IGFzc2V0UGF0aFV0aWxzLmdldEJhc2VQYXRoKGFzc2V0KTtcbiAgcmV0dXJuIGFzc2V0RGlyICsgJy8nICsgYXNzZXQubmFtZSArIHNjYWxlU3VmZml4ICsgJy4nICsgYXNzZXQudHlwZTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgcGF0aCBsaWtlICdkcmF3YWJsZS1tZHBpL2ljb24ucG5nJ1xuICovXG5mdW5jdGlvbiBnZXRBc3NldFBhdGhJbkRyYXdhYmxlRm9sZGVyKGFzc2V0KTogc3RyaW5nIHtcbiAgdmFyIHNjYWxlID0gQXNzZXRTb3VyY2VSZXNvbHZlci5waWNrU2NhbGUoYXNzZXQuc2NhbGVzLCBQaXhlbFJhdGlvLmdldCgpKTtcbiAgdmFyIGRyYXdibGVGb2xkZXIgPSBhc3NldFBhdGhVdGlscy5nZXRBbmRyb2lkRHJhd2FibGVGb2xkZXJOYW1lKGFzc2V0LCBzY2FsZSk7XG4gIHZhciBmaWxlTmFtZSA9ICBhc3NldFBhdGhVdGlscy5nZXRBbmRyb2lkUmVzb3VyY2VJZGVudGlmaWVyKGFzc2V0KTtcbiAgcmV0dXJuIGRyYXdibGVGb2xkZXIgKyAnLycgKyBmaWxlTmFtZSArICcuJyArIGFzc2V0LnR5cGU7XG59XG5cbmNsYXNzIEFzc2V0U291cmNlUmVzb2x2ZXIge1xuXG4gIHNlcnZlclVybDogP3N0cmluZztcbiAgLy8gd2hlcmUgdGhlIGJ1bmRsZSBpcyBiZWluZyBydW4gZnJvbVxuICBidW5kbGVQYXRoOiA/c3RyaW5nO1xuICAvLyB0aGUgYXNzZXQgdG8gcmVzb2x2ZVxuICBhc3NldDogUGFja2FnZXJBc3NldDtcblxuICBjb25zdHJ1Y3RvcihzZXJ2ZXJVcmw6ID9zdHJpbmcsIGJ1bmRsZVBhdGg6ID9zdHJpbmcsIGFzc2V0OiBQYWNrYWdlckFzc2V0KSB7XG4gICAgdGhpcy5zZXJ2ZXJVcmwgPSBzZXJ2ZXJVcmw7XG4gICAgdGhpcy5idW5kbGVQYXRoID0gYnVuZGxlUGF0aDtcbiAgICB0aGlzLmFzc2V0ID0gYXNzZXQ7XG4gIH1cblxuICBpc0xvYWRlZEZyb21TZXJ2ZXIoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICEhdGhpcy5zZXJ2ZXJVcmw7XG4gIH1cblxuICBpc0xvYWRlZEZyb21GaWxlU3lzdGVtKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIXRoaXMuYnVuZGxlUGF0aDtcbiAgfVxuXG4gIGRlZmF1bHRBc3NldCgpOiBSZXNvbHZlZEFzc2V0U291cmNlIHtcbiAgICBpZiAodGhpcy5pc0xvYWRlZEZyb21TZXJ2ZXIoKSkge1xuICAgICAgcmV0dXJuIHRoaXMuYXNzZXRTZXJ2ZXJVUkwoKTtcbiAgICB9XG5cbiAgICBpZiAoUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJykge1xuICAgICAgcmV0dXJuIHRoaXMuaXNMb2FkZWRGcm9tRmlsZVN5c3RlbSgpID9cbiAgICAgICAgdGhpcy5kcmF3YWJsZUZvbGRlckluQnVuZGxlKCkgOlxuICAgICAgICB0aGlzLnJlc291cmNlSWRlbnRpZmllcldpdGhvdXRTY2FsZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5zY2FsZWRBc3NldFBhdGhJbkJ1bmRsZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGFuIGFic29sdXRlIFVSTCB3aGljaCBjYW4gYmUgdXNlZCB0byBmZXRjaCB0aGUgYXNzZXRcbiAgICogZnJvbSB0aGUgZGV2c2VydmVyXG4gICAqL1xuICBhc3NldFNlcnZlclVSTCgpOiBSZXNvbHZlZEFzc2V0U291cmNlIHtcbiAgICBpbnZhcmlhbnQoISF0aGlzLnNlcnZlclVybCwgJ25lZWQgc2VydmVyIHRvIGxvYWQgZnJvbScpO1xuICAgIHJldHVybiB0aGlzLmZyb21Tb3VyY2UoXG4gICAgICB0aGlzLnNlcnZlclVybCArIGdldFNjYWxlZEFzc2V0UGF0aCh0aGlzLmFzc2V0KSArXG4gICAgICAnP3BsYXRmb3JtPScgKyBQbGF0Zm9ybS5PUyArICcmaGFzaD0nICsgdGhpcy5hc3NldC5oYXNoXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNvbHZlcyB0byBqdXN0IHRoZSBzY2FsZWQgYXNzZXQgZmlsZW5hbWVcbiAgICogRS5nLiAnYXNzZXRzL0F3ZXNvbWVNb2R1bGUvaWNvbkAyeC5wbmcnXG4gICAqL1xuICBzY2FsZWRBc3NldFBhdGgoKTogUmVzb2x2ZWRBc3NldFNvdXJjZSB7XG4gICAgcmV0dXJuIHRoaXMuZnJvbVNvdXJjZShnZXRTY2FsZWRBc3NldFBhdGgodGhpcy5hc3NldCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc29sdmVzIHRvIHdoZXJlIHRoZSBidW5kbGUgaXMgcnVubmluZyBmcm9tLCB3aXRoIGEgc2NhbGVkIGFzc2V0IGZpbGVuYW1lXG4gICAqIEUuZy4gJy9zZGNhcmQvYnVuZGxlL2Fzc2V0cy9Bd2Vzb21lTW9kdWxlL2ljb25AMngucG5nJ1xuICAgKi9cbiAgc2NhbGVkQXNzZXRQYXRoSW5CdW5kbGUoKTogUmVzb2x2ZWRBc3NldFNvdXJjZSB7XG4gICAgY29uc3QgcGF0aCA9IHRoaXMuYnVuZGxlUGF0aCB8fCAnJztcbiAgICByZXR1cm4gdGhpcy5mcm9tU291cmNlKHBhdGggKyBnZXRTY2FsZWRBc3NldFBhdGgodGhpcy5hc3NldCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBkZWZhdWx0IGxvY2F0aW9uIG9mIGFzc2V0cyBidW5kbGVkIHdpdGggdGhlIGFwcCwgbG9jYXRlZCBieVxuICAgKiByZXNvdXJjZSBpZGVudGlmaWVyXG4gICAqIFRoZSBBbmRyb2lkIHJlc291cmNlIHN5c3RlbSBwaWNrcyB0aGUgY29ycmVjdCBzY2FsZS5cbiAgICogRS5nLiAnYXNzZXRzX2F3ZXNvbWVtb2R1bGVfaWNvbidcbiAgICovXG4gIHJlc291cmNlSWRlbnRpZmllcldpdGhvdXRTY2FsZSgpOiBSZXNvbHZlZEFzc2V0U291cmNlIHtcbiAgICBpbnZhcmlhbnQoUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJywgJ3Jlc291cmNlIGlkZW50aWZpZXJzIHdvcmsgb24gQW5kcm9pZCcpO1xuICAgIHJldHVybiB0aGlzLmZyb21Tb3VyY2UoYXNzZXRQYXRoVXRpbHMuZ2V0QW5kcm9pZFJlc291cmNlSWRlbnRpZmllcih0aGlzLmFzc2V0KSk7XG4gIH1cblxuICAvKipcbiAgICogSWYgdGhlIGpzYnVuZGxlIGlzIHJ1bm5pbmcgZnJvbSBhIHNpZGVsb2FkIGxvY2F0aW9uLCB0aGlzIHJlc29sdmVzIGFzc2V0c1xuICAgKiByZWxhdGl2ZSB0byBpdHMgbG9jYXRpb25cbiAgICogRS5nLiAnZmlsZTovLy9zZGNhcmQvQXdlc29tZU1vZHVsZS9kcmF3YWJsZS1tZHBpL2ljb24ucG5nJ1xuICAgKi9cbiAgZHJhd2FibGVGb2xkZXJJbkJ1bmRsZSgpOiBSZXNvbHZlZEFzc2V0U291cmNlIHtcbiAgICBjb25zdCBwYXRoID0gdGhpcy5idW5kbGVQYXRoIHx8ICcnO1xuICAgIHJldHVybiB0aGlzLmZyb21Tb3VyY2UoXG4gICAgICAnZmlsZTovLycgKyBwYXRoICsgZ2V0QXNzZXRQYXRoSW5EcmF3YWJsZUZvbGRlcih0aGlzLmFzc2V0KVxuICAgICk7XG4gIH1cblxuICBmcm9tU291cmNlKHNvdXJjZTogc3RyaW5nKTogUmVzb2x2ZWRBc3NldFNvdXJjZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIF9fcGFja2FnZXJfYXNzZXQ6IHRydWUsXG4gICAgICB3aWR0aDogdGhpcy5hc3NldC53aWR0aCxcbiAgICAgIGhlaWdodDogdGhpcy5hc3NldC5oZWlnaHQsXG4gICAgICB1cmk6IHNvdXJjZSxcbiAgICAgIHNjYWxlOiBBc3NldFNvdXJjZVJlc29sdmVyLnBpY2tTY2FsZSh0aGlzLmFzc2V0LnNjYWxlcywgUGl4ZWxSYXRpby5nZXQoKSksXG4gICAgfTtcbiAgfVxuXG4gIHN0YXRpYyBwaWNrU2NhbGUoc2NhbGVzOiBBcnJheTxudW1iZXI+LCBkZXZpY2VTY2FsZTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAvLyBQYWNrYWdlciBndWFyYW50ZWVzIHRoYXQgYHNjYWxlc2AgYXJyYXkgaXMgc29ydGVkXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzY2FsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChzY2FsZXNbaV0gPj0gZGV2aWNlU2NhbGUpIHtcbiAgICAgICAgcmV0dXJuIHNjYWxlc1tpXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBJZiBub3RoaW5nIG1hdGNoZXMsIGRldmljZSBzY2FsZSBpcyBsYXJnZXIgdGhhbiBhbnkgYXZhaWxhYmxlXG4gICAgLy8gc2NhbGVzLCBzbyB3ZSByZXR1cm4gdGhlIGJpZ2dlc3Qgb25lLiBVbmxlc3MgdGhlIGFycmF5IGlzIGVtcHR5LFxuICAgIC8vIGluIHdoaWNoIGNhc2Ugd2UgZGVmYXVsdCB0byAxXG4gICAgcmV0dXJuIHNjYWxlc1tzY2FsZXMubGVuZ3RoIC0gMV0gfHwgMTtcbiAgfVxuXG59XG5cbiBtb2R1bGUuZXhwb3J0cyA9IEFzc2V0U291cmNlUmVzb2x2ZXI7XG4iXX0=