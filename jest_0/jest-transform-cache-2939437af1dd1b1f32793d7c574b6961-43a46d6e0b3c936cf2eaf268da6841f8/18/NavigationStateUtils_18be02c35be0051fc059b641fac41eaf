502475bbe9aa3333c126a05313f74b4f











'use strict';var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}

var invariant=require('fbjs/lib/invariant');






function getParent(state){
if(
state instanceof Object&&
state.children instanceof Array&&
state.children[0]!==undefined&&
typeof state.index==='number'&&
state.children[state.index]!==undefined)
{
return state;
}
return null;
}

function get(state,key){
var parentState=getParent(state);
if(!parentState){
return null;
}
var childState=parentState.children.find(function(child){return child.key===key;});
return childState||null;
}

function indexOf(state,key){
var parentState=getParent(state);
if(!parentState){
return null;
}
var index=parentState.children.map(function(child){return child.key;}).indexOf(key);
if(index===-1){
return null;
}
return index;
}

function push(state,newChildState){
var lastChildren=state.children;
return _extends({},
state,{
children:[].concat(_toConsumableArray(
lastChildren),[
newChildState]),

index:lastChildren.length});

}

function pop(state){
var lastChildren=state.children;
return _extends({},
state,{
children:lastChildren.slice(0,lastChildren.length-1),
index:lastChildren.length-2});

}

function reset(state,nextChildren,nextIndex){
var parentState=getParent(state);
if(!parentState){
return state;
}
var children=nextChildren||parentState.children;
var index=nextIndex==null?parentState.index:nextIndex;
if(children===parentState.children&&index===parentState.index){
return state;
}
return _extends({},
parentState,{
children:children,
index:index});

}

function set(state,key,nextChildren,nextIndex){
if(!state){
return{
children:nextChildren,
index:nextIndex,
key:key};

}
var parentState=getParent(state);
if(!parentState){
return{
children:nextChildren,
index:nextIndex,
key:key};

}
if(nextChildren===parentState.children&&nextIndex===parentState.index&&key===parentState.key){
return parentState;
}
return _extends({},
parentState,{
children:nextChildren,
index:nextIndex,
key:key});

}

function jumpToIndex(state,index){
var parentState=getParent(state);
if(parentState&&parentState.index===index){
return parentState;
}
return _extends({},
parentState,{
index:index});

}

function jumpTo(state,key){
var parentState=getParent(state);
if(!parentState){
return state;
}
var index=parentState.children.indexOf(parentState.children.find(function(child){return child.key===key;}));
invariant(
index!==-1,
'Cannot find child with matching key in this NavigationState');

return _extends({},
parentState,{
index:index});

}

function replaceAt(state,key,newState){
var parentState=getParent(state);
if(!parentState){
return state;
}
var children=[].concat(_toConsumableArray(parentState.children));
var index=parentState.children.indexOf(parentState.children.find(function(child){return child.key===key;}));
invariant(
index!==-1,
'Cannot find child with matching key in this NavigationState');

children[index]=newState;
return _extends({},
parentState,{
children:children});

}

function replaceAtIndex(state,index,newState){
var parentState=getParent(state);
if(!parentState){
return state;
}
var children=[].concat(_toConsumableArray(parentState.children));
children[index]=newState;
return _extends({},
parentState,{
children:children});

}

var NavigationStateUtils={
getParent:getParent,
get:get,
indexOf:indexOf,
push:push,
pop:pop,
reset:reset,
set:set,
jumpToIndex:jumpToIndex,
jumpTo:jumpTo,
replaceAt:replaceAt,
replaceAtIndex:replaceAtIndex};


module.exports=NavigationStateUtils;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk5hdmlnYXRpb25TdGF0ZVV0aWxzLmpzIl0sIm5hbWVzIjpbImludmFyaWFudCIsInJlcXVpcmUiLCJnZXRQYXJlbnQiLCJzdGF0ZSIsIk9iamVjdCIsImNoaWxkcmVuIiwiQXJyYXkiLCJ1bmRlZmluZWQiLCJpbmRleCIsImdldCIsImtleSIsInBhcmVudFN0YXRlIiwiY2hpbGRTdGF0ZSIsImZpbmQiLCJjaGlsZCIsImluZGV4T2YiLCJtYXAiLCJwdXNoIiwibmV3Q2hpbGRTdGF0ZSIsImxhc3RDaGlsZHJlbiIsImxlbmd0aCIsInBvcCIsInNsaWNlIiwicmVzZXQiLCJuZXh0Q2hpbGRyZW4iLCJuZXh0SW5kZXgiLCJzZXQiLCJqdW1wVG9JbmRleCIsImp1bXBUbyIsInJlcGxhY2VBdCIsIm5ld1N0YXRlIiwicmVwbGFjZUF0SW5kZXgiLCJOYXZpZ2F0aW9uU3RhdGVVdGlscyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBV0EsYTs7QUFFQSxHQUFNQSxXQUFZQyxRQUFRLG9CQUFSLENBQWxCOzs7Ozs7O0FBT0EsUUFBU0MsVUFBVCxDQUFtQkMsS0FBbkIsQ0FBbUU7QUFDakU7QUFDR0EsZ0JBQWlCQyxPQUFsQjtBQUNDRCxNQUFNRSxRQUFOLFdBQTBCQyxNQUQzQjtBQUVDSCxNQUFNRSxRQUFOLENBQWUsQ0FBZixJQUFzQkUsU0FGdkI7QUFHQyxNQUFPSixPQUFNSyxLQUFiLEdBQXVCLFFBSHhCO0FBSUNMLE1BQU1FLFFBQU4sQ0FBZUYsTUFBTUssS0FBckIsSUFBZ0NELFNBTG5DO0FBTUU7QUFDQSxNQUFPSixNQUFQO0FBQ0Q7QUFDRCxNQUFPLEtBQVA7QUFDRDs7QUFFRCxRQUFTTSxJQUFULENBQWFOLEtBQWIsQ0FBcUNPLEdBQXJDLENBQW9FO0FBQ2xFLEdBQU1DLGFBQWNULFVBQVVDLEtBQVYsQ0FBcEI7QUFDQSxHQUFJLENBQUNRLFdBQUwsQ0FBa0I7QUFDaEIsTUFBTyxLQUFQO0FBQ0Q7QUFDRCxHQUFNQyxZ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QUNEO0FBQ0QsR0FBTUUsdUNBQWVNLFlBQVlOLFFBQTNCLEVBQU47QUFDQUEsU0FBU0csS0FBVCxFQUFrQnNCLFFBQWxCO0FBQ0E7QUFDS25CLFdBREw7QUFFRU4saUJBRkY7O0FBSUQ7O0FBRUQsR0FBTTJCLHNCQUF1QjtBQUMzQjlCLG1CQUQyQjtBQUUzQk8sSUFBS0EsR0FGc0I7QUFHM0JNLGVBSDJCO0FBSTNCRSxTQUoyQjtBQUszQkksT0FMMkI7QUFNM0JFLFdBTjJCO0FBTzNCRyxJQUFLQSxHQVBzQjtBQVEzQkMsdUJBUjJCO0FBUzNCQyxhQVQyQjtBQVUzQkMsbUJBVjJCO0FBVzNCRSw2QkFYMkIsQ0FBN0I7OztBQWNBRSxPQUFPQyxPQUFQLENBQWlCRixvQkFBakIiLCJmaWxlIjoiTmF2aWdhdGlvblN0YXRlVXRpbHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4gQW4gYWRkaXRpb25hbCBncmFudFxuICogb2YgcGF0ZW50IHJpZ2h0cyBjYW4gYmUgZm91bmQgaW4gdGhlIFBBVEVOVFMgZmlsZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnkuXG4gKlxuICogQHByb3ZpZGVzTW9kdWxlIE5hdmlnYXRpb25TdGF0ZVV0aWxzXG4gKiBAZmxvd1xuICovXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ZianMvbGliL2ludmFyaWFudCcpO1xuXG5pbXBvcnQgdHlwZSB7XG4gIE5hdmlnYXRpb25TdGF0ZSxcbiAgTmF2aWdhdGlvblBhcmVudFN0YXRlLFxufSBmcm9tICdOYXZpZ2F0aW9uVHlwZURlZmluaXRpb24nO1xuXG5mdW5jdGlvbiBnZXRQYXJlbnQoc3RhdGU6IE5hdmlnYXRpb25TdGF0ZSk6ID9OYXZpZ2F0aW9uUGFyZW50U3RhdGUge1xuICBpZiAoXG4gICAgKHN0YXRlIGluc3RhbmNlb2YgT2JqZWN0KSAmJlxuICAgIChzdGF0ZS5jaGlsZHJlbiBpbnN0YW5jZW9mIEFycmF5KSAmJlxuICAgIChzdGF0ZS5jaGlsZHJlblswXSAhPT0gdW5kZWZpbmVkKSAmJlxuICAgICh0eXBlb2Ygc3RhdGUuaW5kZXggPT09ICdudW1iZXInKSAmJlxuICAgIChzdGF0ZS5jaGlsZHJlbltzdGF0ZS5pbmRleF0gIT09IHVuZGVmaW5lZClcbiAgKSB7XG4gICAgcmV0dXJuIHN0YXRlO1xuICB9XG4gIHJldHVybiBudWxsO1xufVxuXG5mdW5jdGlvbiBnZXQoc3RhdGU6IE5hdmlnYXRpb25TdGF0ZSwga2V5OiBzdHJpbmcpOiA/TmF2aWdhdGlvblN0YXRlIHtcbiAgY29uc3QgcGFyZW50U3RhdGUgPSBnZXRQYXJlbnQoc3RhdGUpO1xuICBpZiAoIXBhcmVudFN0YXRlKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgY29uc3QgY2hpbGRTdGF0ZSA9IHBhcmVudFN0YXRlLmNoaWxkcmVuLmZpbmQoY2hpbGQgPT4gY2hpbGQua2V5ID09PSBrZXkpO1xuICByZXR1cm4gY2hpbGRTdGF0ZSB8fCBudWxsO1xufVxuXG5mdW5jdGlvbiBpbmRleE9mKHN0YXRlOiBOYXZpZ2F0aW9uU3RhdGUsIGtleTogc3RyaW5nKTogP251bWJlciB7XG4gIGNvbnN0IHBhcmVudFN0YXRlID0gZ2V0UGFyZW50KHN0YXRlKTtcbiAgaWYgKCFwYXJlbnRTdGF0ZSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIGNvbnN0IGluZGV4ID0gcGFyZW50U3RhdGUuY2hpbGRyZW4ubWFwKGNoaWxkID0+IGNoaWxkLmtleSkuaW5kZXhPZihrZXkpO1xuICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgcmV0dXJuIGluZGV4O1xufVxuXG5mdW5jdGlvbiBwdXNoKHN0YXRlOiBOYXZpZ2F0aW9uUGFyZW50U3RhdGUsIG5ld0NoaWxkU3RhdGU6IE5hdmlnYXRpb25TdGF0ZSk6IE5hdmlnYXRpb25QYXJlbnRTdGF0ZSB7XG4gIHZhciBsYXN0Q2hpbGRyZW46IEFycmF5PE5hdmlnYXRpb25TdGF0ZT4gPSBzdGF0ZS5jaGlsZHJlbjtcbiAgcmV0dXJuIHtcbiAgICAuLi5zdGF0ZSxcbiAgICBjaGlsZHJlbjogW1xuICAgICAgLi4ubGFzdENoaWxkcmVuLFxuICAgICAgbmV3Q2hpbGRTdGF0ZSxcbiAgICBdLFxuICAgIGluZGV4OiBsYXN0Q2hpbGRyZW4ubGVuZ3RoLFxuICB9O1xufVxuXG5mdW5jdGlvbiBwb3Aoc3RhdGU6IE5hdmlnYXRpb25QYXJlbnRTdGF0ZSk6IE5hdmlnYXRpb25QYXJlbnRTdGF0ZSB7XG4gIGNvbnN0IGxhc3RDaGlsZHJlbiA9IHN0YXRlLmNoaWxkcmVuO1xuICByZXR1cm4ge1xuICAgIC4uLnN0YXRlLFxuICAgIGNoaWxkcmVuOiBsYXN0Q2hpbGRyZW4uc2xpY2UoMCwgbGFzdENoaWxkcmVuLmxlbmd0aCAtIDEpLFxuICAgIGluZGV4OiBsYXN0Q2hpbGRyZW4ubGVuZ3RoIC0gMixcbiAgfTtcbn1cblxuZnVuY3Rpb24gcmVzZXQoc3RhdGU6IE5hdmlnYXRpb25TdGF0ZSwgbmV4dENoaWxkcmVuOiA/QXJyYXk8TmF2aWdhdGlvblN0YXRlPiwgbmV4dEluZGV4OiA/bnVtYmVyKTogTmF2aWdhdGlvblN0YXRlIHtcbiAgY29uc3QgcGFyZW50U3RhdGUgPSBnZXRQYXJlbnQoc3RhdGUpO1xuICBpZiAoIXBhcmVudFN0YXRlKSB7XG4gICAgcmV0dXJuIHN0YXRlO1xuICB9XG4gIGNvbnN0IGNoaWxkcmVuID0gbmV4dENoaWxkcmVuIHx8IHBhcmVudFN0YXRlLmNoaWxkcmVuO1xuICBjb25zdCBpbmRleCA9IG5leHRJbmRleCA9PSBudWxsID8gcGFyZW50U3RhdGUuaW5kZXggOiBuZXh0SW5kZXg7XG4gIGlmIChjaGlsZHJlbiA9PT0gcGFyZW50U3RhdGUuY2hpbGRyZW4gJiYgaW5kZXggPT09IHBhcmVudFN0YXRlLmluZGV4KSB7XG4gICAgcmV0dXJuIHN0YXRlO1xuICB9XG4gIHJldHVybiB7XG4gICAgLi4ucGFyZW50U3RhdGUsXG4gICAgY2hpbGRyZW4sXG4gICAgaW5kZXgsXG4gIH07XG59XG5cbmZ1bmN0aW9uIHNldChzdGF0ZTogP05hdmlnYXRpb25TdGF0ZSwga2V5OiBzdHJpbmcsIG5leHRDaGlsZHJlbjogQXJyYXk8TmF2aWdhdGlvblN0YXRlPiwgbmV4dEluZGV4OiBudW1iZXIpOiBOYXZpZ2F0aW9uU3RhdGUge1xuICBpZiAoIXN0YXRlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNoaWxkcmVuOiBuZXh0Q2hpbGRyZW4sXG4gICAgICBpbmRleDogbmV4dEluZGV4LFxuICAgICAga2V5LFxuICAgIH07XG4gIH1cbiAgY29uc3QgcGFyZW50U3RhdGUgPSBnZXRQYXJlbnQoc3RhdGUpO1xuICBpZiAoIXBhcmVudFN0YXRlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNoaWxkcmVuOiBuZXh0Q2hpbGRyZW4sXG4gICAgICBpbmRleDogbmV4dEluZGV4LFxuICAgICAga2V5LFxuICAgIH07XG4gIH1cbiAgaWYgKG5leHRDaGlsZHJlbiA9PT0gcGFyZW50U3RhdGUuY2hpbGRyZW4gJiYgbmV4dEluZGV4ID09PSBwYXJlbnRTdGF0ZS5pbmRleCAmJiBrZXkgPT09IHBhcmVudFN0YXRlLmtleSkge1xuICAgIHJldHVybiBwYXJlbnRTdGF0ZTtcbiAgfVxuICByZXR1cm4ge1xuICAgIC4uLnBhcmVudFN0YXRlLFxuICAgIGNoaWxkcmVuOiBuZXh0Q2hpbGRyZW4sXG4gICAgaW5kZXg6IG5leHRJbmRleCxcbiAgICBrZXksXG4gIH07XG59XG5cbmZ1bmN0aW9uIGp1bXBUb0luZGV4KHN0YXRlOiBOYXZpZ2F0aW9uU3RhdGUsIGluZGV4OiBudW1iZXIpOiBOYXZpZ2F0aW9uU3RhdGUge1xuICBjb25zdCBwYXJlbnRTdGF0ZSA9IGdldFBhcmVudChzdGF0ZSk7XG4gIGlmIChwYXJlbnRTdGF0ZSAmJiBwYXJlbnRTdGF0ZS5pbmRleCA9PT0gaW5kZXgpIHtcbiAgICByZXR1cm4gcGFyZW50U3RhdGU7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICAuLi5wYXJlbnRTdGF0ZSxcbiAgICBpbmRleCxcbiAgfTtcbn1cblxuZnVuY3Rpb24ganVtcFRvKHN0YXRlOiBOYXZpZ2F0aW9uU3RhdGUsIGtleTogc3RyaW5nKTogTmF2aWdhdGlvblN0YXRlIHtcbiAgY29uc3QgcGFyZW50U3RhdGUgPSBnZXRQYXJlbnQoc3RhdGUpO1xuICBpZiAoIXBhcmVudFN0YXRlKSB7XG4gICAgcmV0dXJuIHN0YXRlO1xuICB9XG4gIGNvbnN0IGluZGV4ID0gcGFyZW50U3RhdGUuY2hpbGRyZW4uaW5kZXhPZihwYXJlbnRTdGF0ZS5jaGlsZHJlbi5maW5kKGNoaWxkID0+IGNoaWxkLmtleSA9PT0ga2V5KSk7XG4gIGludmFyaWFudChcbiAgICBpbmRleCAhPT0gLTEsXG4gICAgJ0Nhbm5vdCBmaW5kIGNoaWxkIHdpdGggbWF0Y2hpbmcga2V5IGluIHRoaXMgTmF2aWdhdGlvblN0YXRlJ1xuICApO1xuICByZXR1cm4ge1xuICAgIC4uLnBhcmVudFN0YXRlLFxuICAgIGluZGV4LFxuICB9O1xufVxuXG5mdW5jdGlvbiByZXBsYWNlQXQoc3RhdGU6IE5hdmlnYXRpb25TdGF0ZSwga2V5OiBzdHJpbmcsIG5ld1N0YXRlOiBOYXZpZ2F0aW9uU3RhdGUpOiBOYXZpZ2F0aW9uU3RhdGUge1xuICBjb25zdCBwYXJlbnRTdGF0ZSA9IGdldFBhcmVudChzdGF0ZSk7XG4gIGlmICghcGFyZW50U3RhdGUpIHtcbiAgICByZXR1cm4gc3RhdGU7XG4gIH1cbiAgY29uc3QgY2hpbGRyZW4gPSBbLi4ucGFyZW50U3RhdGUuY2hpbGRyZW5dO1xuICBjb25zdCBpbmRleCA9IHBhcmVudFN0YXRlLmNoaWxkcmVuLmluZGV4T2YocGFyZW50U3RhdGUuY2hpbGRyZW4uZmluZChjaGlsZCA9PiBjaGlsZC5rZXkgPT09IGtleSkpO1xuICBpbnZhcmlhbnQoXG4gICAgaW5kZXggIT09IC0xLFxuICAgICdDYW5ub3QgZmluZCBjaGlsZCB3aXRoIG1hdGNoaW5nIGtleSBpbiB0aGlzIE5hdmlnYXRpb25TdGF0ZSdcbiAgKTtcbiAgY2hpbGRyZW5baW5kZXhdID0gbmV3U3RhdGU7XG4gIHJldHVybiB7XG4gICAgLi4ucGFyZW50U3RhdGUsXG4gICAgY2hpbGRyZW4sXG4gIH07XG59XG5cbmZ1bmN0aW9uIHJlcGxhY2VBdEluZGV4KHN0YXRlOiBOYXZpZ2F0aW9uU3RhdGUsIGluZGV4OiBudW1iZXIsIG5ld1N0YXRlOiBOYXZpZ2F0aW9uU3RhdGUpOiBOYXZpZ2F0aW9uU3RhdGUge1xuICBjb25zdCBwYXJlbnRTdGF0ZSA9IGdldFBhcmVudChzdGF0ZSk7XG4gIGlmICghcGFyZW50U3RhdGUpIHtcbiAgICByZXR1cm4gc3RhdGU7XG4gIH1cbiAgY29uc3QgY2hpbGRyZW4gPSBbLi4ucGFyZW50U3RhdGUuY2hpbGRyZW5dO1xuICBjaGlsZHJlbltpbmRleF0gPSBuZXdTdGF0ZTtcbiAgcmV0dXJuIHtcbiAgICAuLi5wYXJlbnRTdGF0ZSxcbiAgICBjaGlsZHJlbixcbiAgfTtcbn1cblxuY29uc3QgTmF2aWdhdGlvblN0YXRlVXRpbHMgPSB7XG4gIGdldFBhcmVudCxcbiAgZ2V0OiBnZXQsXG4gIGluZGV4T2YsXG4gIHB1c2gsXG4gIHBvcCxcbiAgcmVzZXQsXG4gIHNldDogc2V0LFxuICBqdW1wVG9JbmRleCxcbiAganVtcFRvLFxuICByZXBsYWNlQXQsXG4gIHJlcGxhY2VBdEluZGV4LFxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBOYXZpZ2F0aW9uU3RhdGVVdGlscztcbiJdfQ==