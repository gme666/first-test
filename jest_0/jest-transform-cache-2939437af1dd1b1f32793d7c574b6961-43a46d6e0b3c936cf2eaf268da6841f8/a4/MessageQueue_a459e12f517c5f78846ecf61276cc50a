44eae8a7a4fe05c6fc1bd2093460cb1b















'use strict';var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}

var ErrorUtils=require('ErrorUtils');
var Systrace=require('Systrace');

var deepFreezeAndThrowOnMutationInDev=require('deepFreezeAndThrowOnMutationInDev');
var invariant=require('fbjs/lib/invariant');
var stringifySafe=require('stringifySafe');












var TO_JS=0;
var TO_NATIVE=1;

var MODULE_IDS=0;
var METHOD_IDS=1;
var PARAMS=2;
var MIN_TIME_BETWEEN_FLUSHES_MS=5;

var TRACE_TAG_REACT_APPS=1<<17;

var DEBUG_INFO_LIMIT=64;


var JSTimers=null;var

MessageQueue=function(){















function MessageQueue(){var _this=this;_classCallCheck(this,MessageQueue);this.


































callFunctionReturnFlushedQueue=function(
module,
method,
args)
{
_this.__guard(function(){
_this.__callFunction(module,method,args);
});

return _this.flushedQueue();
};this.

callFunctionReturnResultAndFlushedQueue=function(
module,
method,
args)
{
var result=void 0;
_this.__guard(function(){
result=_this.__callFunction(module,method,args);
});

return[result,_this.flushedQueue()];
};this.

invokeCallbackAndReturnFlushedQueue=function(cbID,args){
_this.__guard(function(){
_this.__invokeCallback(cbID,args);
});

return _this.flushedQueue();
};this.

flushedQueue=function(){
_this.__guard(function(){
_this.__callImmediates();
});

var queue=_this._queue;
_this._queue=[[],[],[],_this._callID];
return queue[0].length?queue:null;
};this._lazyCallableModules={};this._queue=[[],[],[],0];this._successCallbacks=[];this._failureCallbacks=[];this._callID=0;this._lastFlush=0;this._eventLoopStartTime=new Date().getTime();if(__DEV__){this._debugInfo={};this._remoteModuleTable={};this._remoteMethodTable={};}}_createClass(MessageQueue,[{key:'getEventLoopRunningTime',value:function getEventLoopRunningTime()

{
return new Date().getTime()-this._eventLoopStartTime;
}},{key:'registerCallableModule',value:function registerCallableModule(

name,module){
this._lazyCallableModules[name]=function(){return module;};
}},{key:'registerLazyCallableModule',value:function registerLazyCallableModule(

name,factory){
var module=void 0;
var getValue=factory;
this._lazyCallableModules[name]=function(){
if(getValue){
module=getValue();
getValue=null;
}
return module;
};
}},{key:'getCallableModule',value:function getCallableModule(

name){
var getValue=this._lazyCallableModules[name];
return getValue?getValue():null;
}},{key:'enqueueNativeCall',value:function enqueueNativeCall(


moduleID,
methodID,
params,
onFail,
onSucc)
{
if(onFail||onSucc){
if(__DEV__){
this._debugInfo[this._callID]=[moduleID,methodID];
if(this._callID>DEBUG_INFO_LIMIT){
delete this._debugInfo[this._callID-DEBUG_INFO_LIMIT];
}
}


onFail&&params.push(this._callID<<1);
onSucc&&params.push(this._callID<<1|1);
this._successCallbacks[this._callID]=onSucc;
this._failureCallbacks[this._callID]=onFail;
}

if(__DEV__){
global.nativeTraceBeginAsyncFlow&&
global.nativeTraceBeginAsyncFlow(
TRACE_TAG_REACT_APPS,
'native',
this._callID);

}
this._callID++;

this._queue[MODULE_IDS].push(moduleID);
this._queue[METHOD_IDS].push(methodID);

if(__DEV__){

JSON.stringify(params);


deepFreezeAndThrowOnMutationInDev(params);
}
this._queue[PARAMS].push(params);

var now=new Date().getTime();
if(
global.nativeFlushQueueImmediate&&(
now-this._lastFlush>=MIN_TIME_BETWEEN_FLUSHES_MS||
this._inCall===0))
{
var queue=this._queue;
this._queue=[[],[],[],this._callID];
this._lastFlush=now;
global.nativeFlushQueueImmediate(queue);
}
Systrace.counterEvent('pending_js_to_native_queue',this._queue[0].length);

if(this.__spy){
this.__spyNativeCall(moduleID,methodID,params,{
failCbId:onFail?params[params.length-2]:-1,
successCbId:onSucc?params[params.length-1]:-1});

}
}},{key:'callSyncHook',value:function callSyncHook(

moduleID,methodID,args){
if(__DEV__){
invariant(
global.nativeCallSyncHook,
'Calling synchronous methods on native '+
'modules is not supported in Chrome.\n\n Consider providing alternative '+
'methods to expose this method in debug mode, e.g. by exposing constants '+
'ahead-of-time.');

}
var returnValue=global.nativeCallSyncHook(moduleID,methodID,args);
if(this.__spy){
this.__spyNativeCall(moduleID,methodID,args,{
isSync:true,
returnValue:returnValue});

}
return returnValue;
}},{key:'createDebugLookup',value:function createDebugLookup(

moduleID,name,methods){
if(__DEV__){
this._remoteModuleTable[moduleID]=name;
this._remoteMethodTable[moduleID]=methods;
}
}},{key:'__guard',value:function __guard(





fn){
this._inCall++;
try{
fn();
}catch(error){
ErrorUtils.reportFatalError(error);
}finally{
this._inCall--;
}
}},{key:'__callImmediates',value:function __callImmediates()

{
Systrace.beginEvent('JSTimers.callImmediates()');
if(!JSTimers){
JSTimers=require('JSTimers');
}
JSTimers.callImmediates();
Systrace.endEvent();
}},{key:'__callFunction',value:function __callFunction(

module,method,args){
this._lastFlush=new Date().getTime();
this._eventLoopStartTime=this._lastFlush;
Systrace.beginEvent(module+'.'+method+'()');
if(this.__spy){
this.__spyJSCall(module,method,args);
}
var moduleMethods=this.getCallableModule(module);
invariant(
!!moduleMethods,
'Module %s is not a registered callable module (calling %s)',
module,
method);

invariant(
!!moduleMethods[method],
'Method %s does not exist on module %s',
method,
module);

var result=moduleMethods[method].apply(moduleMethods,args);
Systrace.endEvent();
return result;
}},{key:'__invokeCallback',value:function __invokeCallback(

cbID,args){
this._lastFlush=new Date().getTime();
this._eventLoopStartTime=this._lastFlush;


var callID=cbID>>>1;
var isSuccess=cbID&1;
var callback=isSuccess?
this._successCallbacks[callID]:
this._failureCallbacks[callID];

if(__DEV__){
var debug=this._debugInfo[callID];
var _module=debug&&this._remoteModuleTable[debug[0]];
var _method=debug&&this._remoteMethodTable[debug[0]][debug[1]];
if(!callback){
var errorMessage='Callback with id '+cbID+': '+_module+'.'+_method+'() not found';
if(_method){
errorMessage=
'The callback '+_method+'() exists in module '+_module+', '+
'but only one callback may be registered to a function in a native module.';
}
invariant(callback,errorMessage);
}
var profileName=debug?
'<callback for '+_module+'.'+_method+'>':
cbID+'';
if(this.__spy){
this.__spyJSCall(null,profileName,args,{
failCbId:isSuccess?-1:cbID,
successCbId:isSuccess?cbID:-1});

}
Systrace.beginEvent('MessageQueue.invokeCallback('+
profileName+', '+stringifySafe(args)+')');

}

if(!callback){
return;
}

this._successCallbacks[callID]=this._failureCallbacks[callID]=null;
callback.apply(null,args);

if(__DEV__){
Systrace.endEvent();
}
}},{key:'__spyJSCall',value:function __spyJSCall(


module,
method,
methodArgs,
params)
{
if(!this.__spy){
return;
}
this.__spy(_extends({
type:TO_JS,
isSync:false,
module:module,
method:method,
failCbId:-1,
successCbId:-1,
args:methodArgs},
params));

}},{key:'__spyNativeCall',value:function __spyNativeCall(


moduleID,
methodID,
methodArgs,
params)
{
var spy=this.__spy;
if(!spy){
return;
}

var moduleName=moduleID+'';
var methodName=methodID;
if(__DEV__&&isFinite(moduleID)){
moduleName=this._remoteModuleTable[moduleID];
methodName=this._remoteMethodTable[moduleID][methodID];
}

spy(_extends({
type:TO_NATIVE,
isSync:false,
module:moduleName,
method:methodName,
failCbId:-1,
successCbId:-1,
args:methodArgs},
params));

}}],[{key:'spy',value:function spy(spyOrToggle){if(spyOrToggle===true){MessageQueue.prototype.__spy=function(info){console.log((info.type===TO_JS?'N->JS':'JS->N')+' : '+(''+(info.module?info.module+'.':'')+info.method)+('('+JSON.stringify(info.args)+')'));};}else if(spyOrToggle===false){MessageQueue.prototype.__spy=null;}else{MessageQueue.prototype.__spy=spyOrToggle;}}}]);return MessageQueue;}();


module.exports=MessageQueue;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1lc3NhZ2VRdWV1ZS5qcyJdLCJuYW1lcyI6WyJFcnJvclV0aWxzIiwicmVxdWlyZSIsIlN5c3RyYWNlIiwiZGVlcEZyZWV6ZUFuZFRocm93T25NdXRhdGlvbkluRGV2IiwiaW52YXJpYW50Iiwic3RyaW5naWZ5U2FmZSIsIlRPX0pTIiwiVE9fTkFUSVZFIiwiTU9EVUxFX0lEUyIsIk1FVEhPRF9JRFMiLCJQQVJBTVMiLCJNSU5fVElNRV9CRVRXRUVOX0ZMVVNIRVNfTVMiLCJUUkFDRV9UQUdfUkVBQ1RfQVBQUyIsIkRFQlVHX0lORk9fTElNSVQiLCJKU1RpbWVycyIsIk1lc3NhZ2VRdWV1ZSIsImNhbGxGdW5jdGlvblJldHVybkZsdXNoZWRRdWV1ZSIsIm1vZHVsZSIsIm1ldGhvZCIsImFyZ3MiLCJfX2d1YXJkIiwiX19jYWxsRnVuY3Rpb24iLCJmbHVzaGVkUXVldWUiLCJjYWxsRnVuY3Rpb25SZXR1cm5SZXN1bHRBbmRGbHVzaGVkUXVldWUiLCJyZXN1bHQiLCJpbnZva2VDYWxsYmFja0FuZFJldHVybkZsdXNoZWRRdWV1ZSIsImNiSUQiLCJfX2ludm9rZUNhbGxiYWNrIiwiX19jYWxsSW1tZWRpYXRlcyIsInF1ZXVlIiwiX3F1ZXVlIiwiX2NhbGxJRCIsImxlbmd0aCIsIl9sYXp5Q2FsbGFibGVNb2R1bGVzIiwiX3N1Y2Nlc3NDYWxsYmFja3MiLCJfZmFpbHVyZUNhbGxiYWNrcyIsIl9sYXN0Rmx1c2giLCJfZXZlbnRMb29wU3RhcnRUaW1lIiwiRGF0ZSIsImdldFRpbWUiLCJfX0RFVl9fIiwiX2RlYnVnSW5mbyIsIl9yZW1vdGVNb2R1bGVUYWJsZSIsIl9yZW1vdGVNZXRob2RUYWJsZSIsIm5hbWUiLCJmYWN0b3J5IiwiZ2V0VmFsdWUiLCJtb2R1bGVJRCIsIm1ldGhvZElEIiwicGFyYW1zIiwib25GYWlsIiwib25TdWNjIiwicHVzaCIsImdsb2JhbCIsIm5hdGl2ZVRyYWNlQmVnaW5Bc3luY0Zsb3ciLCJKU09OIiwic3RyaW5naWZ5Iiwibm93IiwibmF0aXZlRmx1c2hRdWV1ZUltbWVkaWF0ZSIsIl9pbkNhbGwiLCJjb3VudGVyRXZlbnQiLCJfX3NweSIsIl9fc3B5TmF0aXZlQ2FsbCIsImZhaWxDYklkIiwic3VjY2Vzc0NiSWQiLCJuYXRpdmVDYWxsU3luY0hvb2siLCJyZXR1cm5WYWx1ZSIsImlzU3luYyIsIm1ldGhvZHMiLCJmbiIsImVycm9yIiwicmVwb3J0RmF0YWxFcnJvciIsImJlZ2luRXZlbnQiLCJjYWxsSW1tZWRpYXRlcyIsImVuZEV2ZW50IiwiX19zcHlKU0NhbGwiLCJtb2R1bGVNZXRob2RzIiwiZ2V0Q2FsbGFibGVNb2R1bGUiLCJhcHBseSIsImNhbGxJRCIsImlzU3VjY2VzcyIsImNhbGxiYWNrIiwiZGVidWciLCJlcnJvck1lc3NhZ2UiLCJwcm9maWxlTmFtZSIsIm1ldGhvZEFyZ3MiLCJ0eXBlIiwic3B5IiwibW9kdWxlTmFtZSIsIm1ldGhvZE5hbWUiLCJpc0Zpbml0ZSIsInNweU9yVG9nZ2xlIiwicHJvdG90eXBlIiwiY29uc29sZSIsImxvZyIsImluZm8iLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFlQSxhOztBQUVBLEdBQU1BLFlBQWFDLFFBQVEsWUFBUixDQUFuQjtBQUNBLEdBQU1DLFVBQVdELFFBQVEsVUFBUixDQUFqQjs7QUFFQSxHQUFNRSxtQ0FBb0NGLFFBQVEsbUNBQVIsQ0FBMUM7QUFDQSxHQUFNRyxXQUFZSCxRQUFRLG9CQUFSLENBQWxCO0FBQ0EsR0FBTUksZUFBZ0JKLFFBQVEsZUFBUixDQUF0Qjs7Ozs7Ozs7Ozs7OztBQWFBLEdBQU1LLE9BQVEsQ0FBZDtBQUNBLEdBQU1DLFdBQVksQ0FBbEI7O0FBRUEsR0FBTUMsWUFBYSxDQUFuQjtBQUNBLEdBQU1DLFlBQWEsQ0FBbkI7QUFDQSxHQUFNQyxRQUFTLENBQWY7QUFDQSxHQUFNQyw2QkFBOEIsQ0FBcEM7O0FBRUEsR0FBTUMsc0JBQXVCLEdBQUssRUFBbEM7O0FBRUEsR0FBTUMsa0JBQW1CLEVBQXpCOzs7QUFHQSxHQUFJQyxV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eXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cbiAqXG4gKiBAcHJvdmlkZXNNb2R1bGUgTWVzc2FnZVF1ZXVlXG4gKiBAZmxvd1xuICogQGZvcm1hdFxuICovXG5cbi8qZXNsaW50IG5vLWJpdHdpc2U6IDAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IEVycm9yVXRpbHMgPSByZXF1aXJlKCdFcnJvclV0aWxzJyk7XG5jb25zdCBTeXN0cmFjZSA9IHJlcXVpcmUoJ1N5c3RyYWNlJyk7XG5cbmNvbnN0IGRlZXBGcmVlemVBbmRUaHJvd09uTXV0YXRpb25JbkRldiA9IHJlcXVpcmUoJ2RlZXBGcmVlemVBbmRUaHJvd09uTXV0YXRpb25JbkRldicpO1xuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnZmJqcy9saWIvaW52YXJpYW50Jyk7XG5jb25zdCBzdHJpbmdpZnlTYWZlID0gcmVxdWlyZSgnc3RyaW5naWZ5U2FmZScpO1xuXG5leHBvcnQgdHlwZSBTcHlEYXRhID0ge1xuICB0eXBlOiBudW1iZXIsXG4gIG1vZHVsZTogP3N0cmluZyxcbiAgbWV0aG9kOiBzdHJpbmcgfCBudW1iZXIsXG4gIGlzU3luYzogYm9vbGVhbixcbiAgc3VjY2Vzc0NiSWQ6IG51bWJlcixcbiAgZmFpbENiSWQ6IG51bWJlcixcbiAgYXJnczogQXJyYXk8YW55PixcbiAgcmV0dXJuVmFsdWU/OiBhbnksXG59O1xuXG5jb25zdCBUT19KUyA9IDA7XG5jb25zdCBUT19OQVRJVkUgPSAxO1xuXG5jb25zdCBNT0RVTEVfSURTID0gMDtcbmNvbnN0IE1FVEhPRF9JRFMgPSAxO1xuY29uc3QgUEFSQU1TID0gMjtcbmNvbnN0IE1JTl9USU1FX0JFVFdFRU5fRkxVU0hFU19NUyA9IDU7XG5cbmNvbnN0IFRSQUNFX1RBR19SRUFDVF9BUFBTID0gMSA8PCAxNztcblxuY29uc3QgREVCVUdfSU5GT19MSU1JVCA9IDY0O1xuXG4vLyBXb3JrIGFyb3VuZCBhbiBpbml0aWFsaXphdGlvbiBvcmRlciBpc3N1ZVxubGV0IEpTVGltZXJzID0gbnVsbDtcblxuY2xhc3MgTWVzc2FnZVF1ZXVlIHtcbiAgX2xhenlDYWxsYWJsZU1vZHVsZXM6IHtba2V5OiBzdHJpbmddOiAodm9pZCkgPT4gT2JqZWN0fTtcbiAgX3F1ZXVlOiBbQXJyYXk8bnVtYmVyPiwgQXJyYXk8bnVtYmVyPiwgQXJyYXk8YW55PiwgbnVtYmVyXTtcbiAgX3N1Y2Nlc3NDYWxsYmFja3M6IEFycmF5PD9GdW5jdGlvbj47XG4gIF9mYWlsdXJlQ2FsbGJhY2tzOiBBcnJheTw/RnVuY3Rpb24+O1xuICBfY2FsbElEOiBudW1iZXI7XG4gIF9pbkNhbGw6IG51bWJlcjtcbiAgX2xhc3RGbHVzaDogbnVtYmVyO1xuICBfZXZlbnRMb29wU3RhcnRUaW1lOiBudW1iZXI7XG5cbiAgX2RlYnVnSW5mbzogT2JqZWN0O1xuICBfcmVtb3RlTW9kdWxlVGFibGU6IE9iamVjdDtcbiAgX3JlbW90ZU1ldGhvZFRhYmxlOiBPYmplY3Q7XG5cbiAgX19zcHk6ID8oZGF0YTogU3B5RGF0YSkgPT4gdm9pZDtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLl9sYXp5Q2FsbGFibGVNb2R1bGVzID0ge307XG4gICAgdGhpcy5fcXVldWUgPSBbW10sIFtdLCBbXSwgMF07XG4gICAgdGhpcy5fc3VjY2Vzc0NhbGxiYWNrcyA9IFtdO1xuICAgIHRoaXMuX2ZhaWx1cmVDYWxsYmFja3MgPSBbXTtcbiAgICB0aGlzLl9jYWxsSUQgPSAwO1xuICAgIHRoaXMuX2xhc3RGbHVzaCA9IDA7XG4gICAgdGhpcy5fZXZlbnRMb29wU3RhcnRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5cbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgdGhpcy5fZGVidWdJbmZvID0ge307XG4gICAgICB0aGlzLl9yZW1vdGVNb2R1bGVUYWJsZSA9IHt9O1xuICAgICAgdGhpcy5fcmVtb3RlTWV0aG9kVGFibGUgPSB7fTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUHVibGljIEFQSXNcbiAgICovXG4gIHN0YXRpYyBzcHkoc3B5T3JUb2dnbGU6IGJvb2xlYW4gfCAoKGRhdGE6IFNweURhdGEpID0+IHZvaWQpKSB7XG4gICAgaWYgKHNweU9yVG9nZ2xlID09PSB0cnVlKSB7XG4gICAgICBNZXNzYWdlUXVldWUucHJvdG90eXBlLl9fc3B5ID0gaW5mbyA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgIGAke2luZm8udHlwZSA9PT0gVE9fSlMgPyAnTi0+SlMnIDogJ0pTLT5OJ30gOiBgICtcbiAgICAgICAgICAgIGAke2luZm8ubW9kdWxlID8gaW5mby5tb2R1bGUgKyAnLicgOiAnJ30ke2luZm8ubWV0aG9kfWAgK1xuICAgICAgICAgICAgYCgke0pTT04uc3RyaW5naWZ5KGluZm8uYXJncyl9KWAsXG4gICAgICAgICk7XG4gICAgICB9O1xuICAgIH0gZWxzZSBpZiAoc3B5T3JUb2dnbGUgPT09IGZhbHNlKSB7XG4gICAgICBNZXNzYWdlUXVldWUucHJvdG90eXBlLl9fc3B5ID0gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgTWVzc2FnZVF1ZXVlLnByb3RvdHlwZS5fX3NweSA9IHNweU9yVG9nZ2xlO1xuICAgIH1cbiAgfVxuXG4gIGNhbGxGdW5jdGlvblJldHVybkZsdXNoZWRRdWV1ZSA9IChcbiAgICBtb2R1bGU6IHN0cmluZyxcbiAgICBtZXRob2Q6IHN0cmluZyxcbiAgICBhcmdzOiBBcnJheTxhbnk+LFxuICApID0+IHtcbiAgICB0aGlzLl9fZ3VhcmQoKCkgPT4ge1xuICAgICAgdGhpcy5fX2NhbGxGdW5jdGlvbihtb2R1bGUsIG1ldGhvZCwgYXJncyk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcy5mbHVzaGVkUXVldWUoKTtcbiAgfTtcblxuICBjYWxsRnVuY3Rpb25SZXR1cm5SZXN1bHRBbmRGbHVzaGVkUXVldWUgPSAoXG4gICAgbW9kdWxlOiBzdHJpbmcsXG4gICAgbWV0aG9kOiBzdHJpbmcsXG4gICAgYXJnczogQXJyYXk8YW55PixcbiAgKSA9PiB7XG4gICAgbGV0IHJlc3VsdDtcbiAgICB0aGlzLl9fZ3VhcmQoKCkgPT4ge1xuICAgICAgcmVzdWx0ID0gdGhpcy5fX2NhbGxGdW5jdGlvbihtb2R1bGUsIG1ldGhvZCwgYXJncyk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gW3Jlc3VsdCwgdGhpcy5mbHVzaGVkUXVldWUoKV07XG4gIH07XG5cbiAgaW52b2tlQ2FsbGJhY2tBbmRSZXR1cm5GbHVzaGVkUXVldWUgPSAoY2JJRDogbnVtYmVyLCBhcmdzOiBBcnJheTxhbnk+KSA9PiB7XG4gICAgdGhpcy5fX2d1YXJkKCgpID0+IHtcbiAgICAgIHRoaXMuX19pbnZva2VDYWxsYmFjayhjYklELCBhcmdzKTtcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLmZsdXNoZWRRdWV1ZSgpO1xuICB9O1xuXG4gIGZsdXNoZWRRdWV1ZSA9ICgpID0+IHtcbiAgICB0aGlzLl9fZ3VhcmQoKCkgPT4ge1xuICAgICAgdGhpcy5fX2NhbGxJbW1lZGlhdGVzKCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBxdWV1ZSA9IHRoaXMuX3F1ZXVlO1xuICAgIHRoaXMuX3F1ZXVlID0gW1tdLCBbXSwgW10sIHRoaXMuX2NhbGxJRF07XG4gICAgcmV0dXJuIHF1ZXVlWzBdLmxlbmd0aCA/IHF1ZXVlIDogbnVsbDtcbiAgfTtcblxuICBnZXRFdmVudExvb3BSdW5uaW5nVGltZSgpIHtcbiAgICByZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLl9ldmVudExvb3BTdGFydFRpbWU7XG4gIH1cblxuICByZWdpc3RlckNhbGxhYmxlTW9kdWxlKG5hbWU6IHN0cmluZywgbW9kdWxlOiBPYmplY3QpIHtcbiAgICB0aGlzLl9sYXp5Q2FsbGFibGVNb2R1bGVzW25hbWVdID0gKCkgPT4gbW9kdWxlO1xuICB9XG5cbiAgcmVnaXN0ZXJMYXp5Q2FsbGFibGVNb2R1bGUobmFtZTogc3RyaW5nLCBmYWN0b3J5OiB2b2lkID0+IE9iamVjdCkge1xuICAgIGxldCBtb2R1bGU6IE9iamVjdDtcbiAgICBsZXQgZ2V0VmFsdWU6ID8odm9pZCkgPT4gT2JqZWN0ID0gZmFjdG9yeTtcbiAgICB0aGlzLl9sYXp5Q2FsbGFibGVNb2R1bGVzW25hbWVdID0gKCkgPT4ge1xuICAgICAgaWYgKGdldFZhbHVlKSB7XG4gICAgICAgIG1vZHVsZSA9IGdldFZhbHVlKCk7XG4gICAgICAgIGdldFZhbHVlID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBtb2R1bGU7XG4gICAgfTtcbiAgfVxuXG4gIGdldENhbGxhYmxlTW9kdWxlKG5hbWU6IHN0cmluZykge1xuICAgIGNvbnN0IGdldFZhbHVlID0gdGhpcy5fbGF6eUNhbGxhYmxlTW9kdWxlc1tuYW1lXTtcbiAgICByZXR1cm4gZ2V0VmFsdWUgPyBnZXRWYWx1ZSgpIDogbnVsbDtcbiAgfVxuXG4gIGVucXVldWVOYXRpdmVDYWxsKFxuICAgIG1vZHVsZUlEOiBudW1iZXIsXG4gICAgbWV0aG9kSUQ6IG51bWJlcixcbiAgICBwYXJhbXM6IEFycmF5PGFueT4sXG4gICAgb25GYWlsOiA/RnVuY3Rpb24sXG4gICAgb25TdWNjOiA/RnVuY3Rpb24sXG4gICkge1xuICAgIGlmIChvbkZhaWwgfHwgb25TdWNjKSB7XG4gICAgICBpZiAoX19ERVZfXykge1xuICAgICAgICB0aGlzLl9kZWJ1Z0luZm9bdGhpcy5fY2FsbElEXSA9IFttb2R1bGVJRCwgbWV0aG9kSURdO1xuICAgICAgICBpZiAodGhpcy5fY2FsbElEID4gREVCVUdfSU5GT19MSU1JVCkge1xuICAgICAgICAgIGRlbGV0ZSB0aGlzLl9kZWJ1Z0luZm9bdGhpcy5fY2FsbElEIC0gREVCVUdfSU5GT19MSU1JVF07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIEVuY29kZSBjYWxsSURzIGludG8gcGFpcnMgb2YgY2FsbGJhY2sgaWRlbnRpZmllcnMgYnkgc2hpZnRpbmcgbGVmdCBhbmQgdXNpbmcgdGhlIHJpZ2h0bW9zdCBiaXRcbiAgICAgIC8vIHRvIGluZGljYXRlIGZhaWwgKDApIG9yIHN1Y2Nlc3MgKDEpXG4gICAgICBvbkZhaWwgJiYgcGFyYW1zLnB1c2godGhpcy5fY2FsbElEIDw8IDEpO1xuICAgICAgb25TdWNjICYmIHBhcmFtcy5wdXNoKCh0aGlzLl9jYWxsSUQgPDwgMSkgfCAxKTtcbiAgICAgIHRoaXMuX3N1Y2Nlc3NDYWxsYmFja3NbdGhpcy5fY2FsbElEXSA9IG9uU3VjYztcbiAgICAgIHRoaXMuX2ZhaWx1cmVDYWxsYmFja3NbdGhpcy5fY2FsbElEXSA9IG9uRmFpbDtcbiAgICB9XG5cbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgZ2xvYmFsLm5hdGl2ZVRyYWNlQmVnaW5Bc3luY0Zsb3cgJiZcbiAgICAgICAgZ2xvYmFsLm5hdGl2ZVRyYWNlQmVnaW5Bc3luY0Zsb3coXG4gICAgICAgICAgVFJBQ0VfVEFHX1JFQUNUX0FQUFMsXG4gICAgICAgICAgJ25hdGl2ZScsXG4gICAgICAgICAgdGhpcy5fY2FsbElELFxuICAgICAgICApO1xuICAgIH1cbiAgICB0aGlzLl9jYWxsSUQrKztcblxuICAgIHRoaXMuX3F1ZXVlW01PRFVMRV9JRFNdLnB1c2gobW9kdWxlSUQpO1xuICAgIHRoaXMuX3F1ZXVlW01FVEhPRF9JRFNdLnB1c2gobWV0aG9kSUQpO1xuXG4gICAgaWYgKF9fREVWX18pIHtcbiAgICAgIC8vIEFueSBwYXJhbXMgc2VudCBvdmVyIHRoZSBicmlkZ2Ugc2hvdWxkIGJlIGVuY29kYWJsZSBhcyBKU09OXG4gICAgICBKU09OLnN0cmluZ2lmeShwYXJhbXMpO1xuXG4gICAgICAvLyBUaGUgcGFyYW1zIG9iamVjdCBzaG91bGQgbm90IGJlIG11dGF0ZWQgYWZ0ZXIgYmVpbmcgcXVldWVkXG4gICAgICBkZWVwRnJlZXplQW5kVGhyb3dPbk11dGF0aW9uSW5EZXYoKHBhcmFtczogYW55KSk7XG4gICAgfVxuICAgIHRoaXMuX3F1ZXVlW1BBUkFNU10ucHVzaChwYXJhbXMpO1xuXG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgaWYgKFxuICAgICAgZ2xvYmFsLm5hdGl2ZUZsdXNoUXVldWVJbW1lZGlhdGUgJiZcbiAgICAgIChub3cgLSB0aGlzLl9sYXN0Rmx1c2ggPj0gTUlOX1RJTUVfQkVUV0VFTl9GTFVTSEVTX01TIHx8XG4gICAgICAgIHRoaXMuX2luQ2FsbCA9PT0gMClcbiAgICApIHtcbiAgICAgIHZhciBxdWV1ZSA9IHRoaXMuX3F1ZXVlO1xuICAgICAgdGhpcy5fcXVldWUgPSBbW10sIFtdLCBbXSwgdGhpcy5fY2FsbElEXTtcbiAgICAgIHRoaXMuX2xhc3RGbHVzaCA9IG5vdztcbiAgICAgIGdsb2JhbC5uYXRpdmVGbHVzaFF1ZXVlSW1tZWRpYXRlKHF1ZXVlKTtcbiAgICB9XG4gICAgU3lzdHJhY2UuY291bnRlckV2ZW50KCdwZW5kaW5nX2pzX3RvX25hdGl2ZV9xdWV1ZScsIHRoaXMuX3F1ZXVlWzBdLmxlbmd0aCk7XG5cbiAgICBpZiAodGhpcy5fX3NweSkge1xuICAgICAgdGhpcy5fX3NweU5hdGl2ZUNhbGwobW9kdWxlSUQsIG1ldGhvZElELCBwYXJhbXMsIHtcbiAgICAgICAgZmFpbENiSWQ6IG9uRmFpbCA/IHBhcmFtc1twYXJhbXMubGVuZ3RoIC0gMl0gOiAtMSxcbiAgICAgICAgc3VjY2Vzc0NiSWQ6IG9uU3VjYyA/IHBhcmFtc1twYXJhbXMubGVuZ3RoIC0gMV0gOiAtMSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGNhbGxTeW5jSG9vayhtb2R1bGVJRDogbnVtYmVyLCBtZXRob2RJRDogbnVtYmVyLCBhcmdzOiBBcnJheTxhbnk+KSB7XG4gICAgaWYgKF9fREVWX18pIHtcbiAgICAgIGludmFyaWFudChcbiAgICAgICAgZ2xvYmFsLm5hdGl2ZUNhbGxTeW5jSG9vayxcbiAgICAgICAgJ0NhbGxpbmcgc3luY2hyb25vdXMgbWV0aG9kcyBvbiBuYXRpdmUgJyArXG4gICAgICAgICAgJ21vZHVsZXMgaXMgbm90IHN1cHBvcnRlZCBpbiBDaHJvbWUuXFxuXFxuIENvbnNpZGVyIHByb3ZpZGluZyBhbHRlcm5hdGl2ZSAnICtcbiAgICAgICAgICAnbWV0aG9kcyB0byBleHBvc2UgdGhpcyBtZXRob2QgaW4gZGVidWcgbW9kZSwgZS5nLiBieSBleHBvc2luZyBjb25zdGFudHMgJyArXG4gICAgICAgICAgJ2FoZWFkLW9mLXRpbWUuJyxcbiAgICAgICk7XG4gICAgfVxuICAgIGNvbnN0IHJldHVyblZhbHVlID0gZ2xvYmFsLm5hdGl2ZUNhbGxTeW5jSG9vayhtb2R1bGVJRCwgbWV0aG9kSUQsIGFyZ3MpO1xuICAgIGlmICh0aGlzLl9fc3B5KSB7XG4gICAgICB0aGlzLl9fc3B5TmF0aXZlQ2FsbChtb2R1bGVJRCwgbWV0aG9kSUQsIGFyZ3MsIHtcbiAgICAgICAgaXNTeW5jOiB0cnVlLFxuICAgICAgICByZXR1cm5WYWx1ZSxcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmV0dXJuVmFsdWU7XG4gIH1cblxuICBjcmVhdGVEZWJ1Z0xvb2t1cChtb2R1bGVJRDogbnVtYmVyLCBuYW1lOiBzdHJpbmcsIG1ldGhvZHM6IEFycmF5PHN0cmluZz4pIHtcbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgdGhpcy5fcmVtb3RlTW9kdWxlVGFibGVbbW9kdWxlSURdID0gbmFtZTtcbiAgICAgIHRoaXMuX3JlbW90ZU1ldGhvZFRhYmxlW21vZHVsZUlEXSA9IG1ldGhvZHM7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFByaXZhdGUgbWV0aG9kc1xuICAgKi9cblxuICBfX2d1YXJkKGZuOiAoKSA9PiB2b2lkKSB7XG4gICAgdGhpcy5faW5DYWxsKys7XG4gICAgdHJ5IHtcbiAgICAgIGZuKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIEVycm9yVXRpbHMucmVwb3J0RmF0YWxFcnJvcihlcnJvcik7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMuX2luQ2FsbC0tO1xuICAgIH1cbiAgfVxuXG4gIF9fY2FsbEltbWVkaWF0ZXMoKSB7XG4gICAgU3lzdHJhY2UuYmVnaW5FdmVudCgnSlNUaW1lcnMuY2FsbEltbWVkaWF0ZXMoKScpO1xuICAgIGlmICghSlNUaW1lcnMpIHtcbiAgICAgIEpTVGltZXJzID0gcmVxdWlyZSgnSlNUaW1lcnMnKTtcbiAgICB9XG4gICAgSlNUaW1lcnMuY2FsbEltbWVkaWF0ZXMoKTtcbiAgICBTeXN0cmFjZS5lbmRFdmVudCgpO1xuICB9XG5cbiAgX19jYWxsRnVuY3Rpb24obW9kdWxlOiBzdHJpbmcsIG1ldGhvZDogc3RyaW5nLCBhcmdzOiBBcnJheTxhbnk+KSB7XG4gICAgdGhpcy5fbGFzdEZsdXNoID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgdGhpcy5fZXZlbnRMb29wU3RhcnRUaW1lID0gdGhpcy5fbGFzdEZsdXNoO1xuICAgIFN5c3RyYWNlLmJlZ2luRXZlbnQoYCR7bW9kdWxlfS4ke21ldGhvZH0oKWApO1xuICAgIGlmICh0aGlzLl9fc3B5KSB7XG4gICAgICB0aGlzLl9fc3B5SlNDYWxsKG1vZHVsZSwgbWV0aG9kLCBhcmdzKTtcbiAgICB9XG4gICAgY29uc3QgbW9kdWxlTWV0aG9kcyA9IHRoaXMuZ2V0Q2FsbGFibGVNb2R1bGUobW9kdWxlKTtcbiAgICBpbnZhcmlhbnQoXG4gICAgICAhIW1vZHVsZU1ldGhvZHMsXG4gICAgICAnTW9kdWxlICVzIGlzIG5vdCBhIHJlZ2lzdGVyZWQgY2FsbGFibGUgbW9kdWxlIChjYWxsaW5nICVzKScsXG4gICAgICBtb2R1bGUsXG4gICAgICBtZXRob2QsXG4gICAgKTtcbiAgICBpbnZhcmlhbnQoXG4gICAgICAhIW1vZHVsZU1ldGhvZHNbbWV0aG9kXSxcbiAgICAgICdNZXRob2QgJXMgZG9lcyBub3QgZXhpc3Qgb24gbW9kdWxlICVzJyxcbiAgICAgIG1ldGhvZCxcbiAgICAgIG1vZHVsZSxcbiAgICApO1xuICAgIGNvbnN0IHJlc3VsdCA9IG1vZHVsZU1ldGhvZHNbbWV0aG9kXS5hcHBseShtb2R1bGVNZXRob2RzLCBhcmdzKTtcbiAgICBTeXN0cmFjZS5lbmRFdmVudCgpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBfX2ludm9rZUNhbGxiYWNrKGNiSUQ6IG51bWJlciwgYXJnczogQXJyYXk8YW55Pikge1xuICAgIHRoaXMuX2xhc3RGbHVzaCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgIHRoaXMuX2V2ZW50TG9vcFN0YXJ0VGltZSA9IHRoaXMuX2xhc3RGbHVzaDtcblxuICAgIC8vIFRoZSByaWdodG1vc3QgYml0IG9mIGNiSUQgaW5kaWNhdGVzIGZhaWwgKDApIG9yIHN1Y2Nlc3MgKDEpLCB0aGUgb3RoZXIgYml0cyBhcmUgdGhlIGNhbGxJRCBzaGlmdGVkIGxlZnQuXG4gICAgY29uc3QgY2FsbElEID0gY2JJRCA+Pj4gMTtcbiAgICBjb25zdCBpc1N1Y2Nlc3MgPSBjYklEICYgMTtcbiAgICBjb25zdCBjYWxsYmFjayA9IGlzU3VjY2Vzc1xuICAgICAgPyB0aGlzLl9zdWNjZXNzQ2FsbGJhY2tzW2NhbGxJRF1cbiAgICAgIDogdGhpcy5fZmFpbHVyZUNhbGxiYWNrc1tjYWxsSURdO1xuXG4gICAgaWYgKF9fREVWX18pIHtcbiAgICAgIGNvbnN0IGRlYnVnID0gdGhpcy5fZGVidWdJbmZvW2NhbGxJRF07XG4gICAgICBjb25zdCBtb2R1bGUgPSBkZWJ1ZyAmJiB0aGlzLl9yZW1vdGVNb2R1bGVUYWJsZVtkZWJ1Z1swXV07XG4gICAgICBjb25zdCBtZXRob2QgPSBkZWJ1ZyAmJiB0aGlzLl9yZW1vdGVNZXRob2RUYWJsZVtkZWJ1Z1swXV1bZGVidWdbMV1dO1xuICAgICAgaWYgKCFjYWxsYmFjaykge1xuICAgICAgICBsZXQgZXJyb3JNZXNzYWdlID0gYENhbGxiYWNrIHdpdGggaWQgJHtjYklEfTogJHttb2R1bGV9LiR7bWV0aG9kfSgpIG5vdCBmb3VuZGA7XG4gICAgICAgIGlmIChtZXRob2QpIHtcbiAgICAgICAgICBlcnJvck1lc3NhZ2UgPVxuICAgICAgICAgICAgYFRoZSBjYWxsYmFjayAke21ldGhvZH0oKSBleGlzdHMgaW4gbW9kdWxlICR7bW9kdWxlfSwgYCArXG4gICAgICAgICAgICAnYnV0IG9ubHkgb25lIGNhbGxiYWNrIG1heSBiZSByZWdpc3RlcmVkIHRvIGEgZnVuY3Rpb24gaW4gYSBuYXRpdmUgbW9kdWxlLic7XG4gICAgICAgIH1cbiAgICAgICAgaW52YXJpYW50KGNhbGxiYWNrLCBlcnJvck1lc3NhZ2UpO1xuICAgICAgfVxuICAgICAgY29uc3QgcHJvZmlsZU5hbWUgPSBkZWJ1Z1xuICAgICAgICA/ICc8Y2FsbGJhY2sgZm9yICcgKyBtb2R1bGUgKyAnLicgKyBtZXRob2QgKyAnPidcbiAgICAgICAgOiBjYklEICsgJyc7XG4gICAgICBpZiAodGhpcy5fX3NweSkge1xuICAgICAgICB0aGlzLl9fc3B5SlNDYWxsKG51bGwsIHByb2ZpbGVOYW1lLCBhcmdzLCB7XG4gICAgICAgICAgZmFpbENiSWQ6IGlzU3VjY2VzcyA/IC0xIDogY2JJRCxcbiAgICAgICAgICBzdWNjZXNzQ2JJZDogaXNTdWNjZXNzID8gY2JJRCA6IC0xLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFN5c3RyYWNlLmJlZ2luRXZlbnQoXG4gICAgICAgIGBNZXNzYWdlUXVldWUuaW52b2tlQ2FsbGJhY2soJHtwcm9maWxlTmFtZX0sICR7c3RyaW5naWZ5U2FmZShhcmdzKX0pYCxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKCFjYWxsYmFjaykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuX3N1Y2Nlc3NDYWxsYmFja3NbY2FsbElEXSA9IHRoaXMuX2ZhaWx1cmVDYWxsYmFja3NbY2FsbElEXSA9IG51bGw7XG4gICAgY2FsbGJhY2suYXBwbHkobnVsbCwgYXJncyk7XG5cbiAgICBpZiAoX19ERVZfXykge1xuICAgICAgU3lzdHJhY2UuZW5kRXZlbnQoKTtcbiAgICB9XG4gIH1cblxuICBfX3NweUpTQ2FsbChcbiAgICBtb2R1bGU6ID9zdHJpbmcsXG4gICAgbWV0aG9kOiBzdHJpbmcsXG4gICAgbWV0aG9kQXJnczogQXJyYXk8YW55PixcbiAgICBwYXJhbXM6IGFueSxcbiAgKSB7XG4gICAgaWYgKCF0aGlzLl9fc3B5KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuX19zcHkoe1xuICAgICAgdHlwZTogVE9fSlMsXG4gICAgICBpc1N5bmM6IGZhbHNlLFxuICAgICAgbW9kdWxlLFxuICAgICAgbWV0aG9kLFxuICAgICAgZmFpbENiSWQ6IC0xLFxuICAgICAgc3VjY2Vzc0NiSWQ6IC0xLFxuICAgICAgYXJnczogbWV0aG9kQXJncyxcbiAgICAgIC4uLnBhcmFtcyxcbiAgICB9KTtcbiAgfVxuXG4gIF9fc3B5TmF0aXZlQ2FsbChcbiAgICBtb2R1bGVJRDogbnVtYmVyLFxuICAgIG1ldGhvZElEOiBudW1iZXIsXG4gICAgbWV0aG9kQXJnczogQXJyYXk8YW55PixcbiAgICBwYXJhbXM6IGFueSxcbiAgKSB7XG4gICAgY29uc3Qgc3B5ID0gdGhpcy5fX3NweTtcbiAgICBpZiAoIXNweSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCBtb2R1bGVOYW1lID0gbW9kdWxlSUQgKyAnJztcbiAgICBsZXQgbWV0aG9kTmFtZSA9IG1ldGhvZElEO1xuICAgIGlmIChfX0RFVl9fICYmIGlzRmluaXRlKG1vZHVsZUlEKSkge1xuICAgICAgbW9kdWxlTmFtZSA9IHRoaXMuX3JlbW90ZU1vZHVsZVRhYmxlW21vZHVsZUlEXTtcbiAgICAgIG1ldGhvZE5hbWUgPSB0aGlzLl9yZW1vdGVNZXRob2RUYWJsZVttb2R1bGVJRF1bbWV0aG9kSURdO1xuICAgIH1cblxuICAgIHNweSh7XG4gICAgICB0eXBlOiBUT19OQVRJVkUsXG4gICAgICBpc1N5bmM6IGZhbHNlLFxuICAgICAgbW9kdWxlOiBtb2R1bGVOYW1lLFxuICAgICAgbWV0aG9kOiBtZXRob2ROYW1lLFxuICAgICAgZmFpbENiSWQ6IC0xLFxuICAgICAgc3VjY2Vzc0NiSWQ6IC0xLFxuICAgICAgYXJnczogbWV0aG9kQXJncyxcbiAgICAgIC4uLnBhcmFtcyxcbiAgICB9KTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IE1lc3NhZ2VRdWV1ZTtcbiJdfQ==