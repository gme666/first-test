f4e47b356b45c58c1e9814194401db4d











'use strict';

var invariant=require('fbjs/lib/invariant');














var TRACE_TAG_REACT_APPS=1<<17;
var TRACE_TAG_JSC_CALLS=1<<27;

var _enabled=false;
var _asyncCookie=0;
var _markStack=[];
var _markStackIndex=-1;



var REACT_MARKER='\u269B';
var userTimingPolyfill={
mark:function mark(markName){
if(__DEV__){
if(_enabled){
_markStackIndex++;
_markStack[_markStackIndex]=markName;
var systraceLabel=markName;


if(markName[0]===REACT_MARKER){


var indexOfId=markName.lastIndexOf(' (#');
var cutoffIndex=indexOfId!==-1?indexOfId:markName.length;

systraceLabel=markName.slice(2,cutoffIndex);
}
Systrace.beginEvent(systraceLabel);
}
}
},
measure:function measure(measureName,startMark,endMark){
if(__DEV__){
if(_enabled){
invariant(
typeof measureName==='string'&&
typeof startMark==='string'&&
typeof endMark==='undefined',
'Only performance.measure(string, string) overload is supported.');

var topMark=_markStack[_markStackIndex];
invariant(
startMark===topMark,
'There was a mismatching performance.measure() call. '+
'Expected "%s" but got "%s."',
topMark,
startMark);

_markStackIndex--;


Systrace.endEvent();
}
}
},
clearMarks:function clearMarks(markName){
if(__DEV__){
if(_enabled){
if(_markStackIndex===-1){
return;
}
if(markName===_markStack[_markStackIndex]){


userTimingPolyfill.measure(markName,markName);
}
}
}
},
clearMeasures:function clearMeasures(){


}};


var Systrace={
getUserTimingPolyfill:function getUserTimingPolyfill(){
return userTimingPolyfill;
},

setEnabled:function setEnabled(enabled){
if(_enabled!==enabled){
if(__DEV__){
if(enabled){
global.nativeTraceBeginLegacy&&global.nativeTraceBeginLegacy(TRACE_TAG_JSC_CALLS);
}else{
global.nativeTraceEndLegacy&&global.nativeTraceEndLegacy(TRACE_TAG_JSC_CALLS);
}
}
_enabled=enabled;
}
},

isEnabled:function isEnabled(){
return _enabled;
},




beginEvent:function beginEvent(profileName,args){
if(_enabled){
profileName=typeof profileName==='function'?
profileName():profileName;
global.nativeTraceBeginSection(TRACE_TAG_REACT_APPS,profileName,args);
}
},

endEvent:function endEvent(){
if(_enabled){
global.nativeTraceEndSection(TRACE_TAG_REACT_APPS);
}
},






beginAsyncEvent:function beginAsyncEvent(profileName){
var cookie=_asyncCookie;
if(_enabled){
_asyncCookie++;
profileName=typeof profileName==='function'?
profileName():profileName;
global.nativeTraceBeginAsyncSection(TRACE_TAG_REACT_APPS,profileName,cookie,0);
}
return cookie;
},

endAsyncEvent:function endAsyncEvent(profileName,cookie){
if(_enabled){
profileName=typeof profileName==='function'?
profileName():profileName;
global.nativeTraceEndAsyncSection(TRACE_TAG_REACT_APPS,profileName,cookie,0);
}
},




counterEvent:function counterEvent(profileName,value){
if(_enabled){
profileName=typeof profileName==='function'?
profileName():profileName;
global.nativeTraceCounter&&
global.nativeTraceCounter(TRACE_TAG_REACT_APPS,profileName,value);
}
},





attachToRelayProfiler:function attachToRelayProfiler(relayProfiler){
relayProfiler.attachProfileHandler('*',function(name){
var cookie=Systrace.beginAsyncEvent(name);
return function(){
Systrace.endAsyncEvent(name,cookie);
};
});

relayProfiler.attachAggregateHandler('*',function(name,callback){
Systrace.beginEvent(name);
callback();
Systrace.endEvent();
});
},



swizzleJSON:function swizzleJSON(){
Systrace.measureMethods(JSON,'JSON',[
'parse',
'stringify']);

},









measureMethods:function measureMethods(object,objectName,methodNames){
if(!__DEV__){
return;
}

methodNames.forEach(function(methodName){
object[methodName]=Systrace.measure(
objectName,
methodName,
object[methodName]);

});
},










measure:function measure(objName,fnName,func){
if(!__DEV__){
return func;
}

var profileName=objName+'.'+fnName;
return function(){
if(!_enabled){
return func.apply(this,arguments);
}

Systrace.beginEvent(profileName);
var ret=func.apply(this,arguments);
Systrace.endEvent();
return ret;
};
}};


if(__DEV__){




require.Systrace=Systrace;
}

module.exports=Systrace;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlN5c3RyYWNlLmpzIl0sIm5hbWVzIjpbImludmFyaWFudCIsInJlcXVpcmUiLCJUUkFDRV9UQUdfUkVBQ1RfQVBQUyIsIlRSQUNFX1RBR19KU0NfQ0FMTFMiLCJfZW5hYmxlZCIsIl9hc3luY0Nvb2tpZSIsIl9tYXJrU3RhY2siLCJfbWFya1N0YWNrSW5kZXgiLCJSRUFDVF9NQVJLRVIiLCJ1c2VyVGltaW5nUG9seWZpbGwiLCJtYXJrIiwibWFya05hbWUiLCJfX0RFVl9fIiwic3lzdHJhY2VMYWJlbCIsImluZGV4T2ZJZCIsImxhc3RJbmRleE9mIiwiY3V0b2ZmSW5kZXgiLCJsZW5ndGgiLCJzbGljZSIsIlN5c3RyYWNlIiwiYmVnaW5FdmVudCIsIm1lYXN1cmUiLCJtZWFzdXJlTmFtZSIsInN0YXJ0TWFyayIsImVuZE1hcmsiLCJ0b3BNYXJrIiwiZW5kRXZlbnQiLCJjbGVhck1hcmtzIiwiY2xlYXJNZWFzdXJlcyIsImdldFVzZXJUaW1pbmdQb2x5ZmlsbCIsInNldEVuYWJsZWQiLCJlbmFibGVkIiwiZ2xvYmFsIiwibmF0aXZlVHJhY2VCZWdpbkxlZ2FjeSIsIm5hdGl2ZVRyYWNlRW5kTGVnYWN5IiwiaXNFbmFibGVkIiwicHJvZmlsZU5hbWUiLCJhcmdzIiwibmF0aXZlVHJhY2VCZWdpblNlY3Rpb24iLCJuYXRpdmVUcmFjZUVuZFNlY3Rpb24iLCJiZWdpbkFzeW5jRXZlbnQiLCJjb29raWUiLCJuYXRpdmVUcmFjZUJlZ2luQXN5bmNTZWN0aW9uIiwiZW5kQXN5bmNFdmVudCIsIm5hdGl2ZVRyYWNlRW5kQXN5bmNTZWN0aW9uIiwiY291bnRlckV2ZW50IiwidmFsdWUiLCJuYXRpdmVUcmFjZUNvdW50ZXIiLCJhdHRhY2hUb1JlbGF5UHJvZmlsZXIiLCJyZWxheVByb2ZpbGVyIiwiYXR0YWNoUHJvZmlsZUhhbmRsZXIiLCJuYW1lIiwiYXR0YWNoQWdncmVnYXRlSGFuZGxlciIsImNhbGxiYWNrIiwic3dpenpsZUpTT04iLCJtZWFzdXJlTWV0aG9kcyIsIkpTT04iLCJvYmplY3QiLCJvYmplY3ROYW1lIiwibWV0aG9kTmFtZXMiLCJmb3JFYWNoIiwibWV0aG9kTmFtZSIsIm9iak5hbWUiLCJmbk5hbWUiLCJmdW5jIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJyZXQiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQVdBOztBQUVBLEdBQU1BLFdBQVlDLFFBQVEsb0JBQVIsQ0FBbEI7Ozs7Ozs7Ozs7Ozs7OztBQWVBLEdBQU1DLHNCQUF1QixHQUFLLEVBQWxDO0FBQ0EsR0FBTUMscUJBQXNCLEdBQUssRUFBakM7O0FBRUEsR0FBSUMsVUFBVyxLQUFmO0FBQ0EsR0FBSUMsY0FBZSxDQUFuQjtBQUNBLEdBQU1DLFlBQWEsRUFBbkI7QUFDQSxHQUFJQyxpQkFBa0IsQ0FBQyxDQUF2Qjs7OztBQUlBLEdBQU1DLGNBQWUsUUFBckI7QUFDQSxHQUFNQyxvQkFBcUI7QUFDekJDLElBRHlCLGVBQ3BCQyxRQURvQixDQUNGO0FBQ3JCLEdBQUlDLE9BQUosQ0FBYTtBQUNYLEdBQUlSLFFBQUosQ0FBYztBQUNaRztBQUNBRCxXQUFXQyxlQUFYLEVBQThCSSxRQUE5QjtBQUNBLEdBQUlFLGVBQWdCRixRQUFwQjs7O0FBR0EsR0FBSUEsU0FBUyxDQUFULElBQWdCSCxZQUFwQixDQUFrQzs7O0FBR2hDLEdBQU1NLFdBQVlILFNBQVNJLFdBQVQsQ0FBcUIsS0FBckIsQ0FBbEI7QUFDQSxHQUFNQyxhQUFjRixZQUFjLENBQUMsQ0FBZixDQUFtQkEsU0FBbkIsQ0FBK0JILFNBQVNNLE1BQTVEOztBQUVBSixjQUFnQkYsU0FBU08sS0FBVCxDQUFlLENBQWYsQ0FBa0JGLFdBQWxCLENBQWhCO0FBQ0Q7QUFDREcsU0FBU0MsVUFBVCxDQUFvQlAsYUFBcEI7QUFDRDtBQUNGO0FBQ0YsQ0FwQndCO0FBcUJ6QlEsT0FyQnlCLGtCQXFCakJDLFdBckJpQixDQXFCSUMsU0FyQkosQ0FxQndCQyxPQXJCeEIsQ0FxQjBDO0FBQ2pFLEdBQUlaLE9BQUosQ0FBYTtB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Ozs7Ozs7Ozs7OztBQXNJaEJ4QyxPQXRJZ0Isa0JBc0lSeUMsT0F0SVEsQ0FzSVNDLE1BdElULENBc0l5QkMsSUF0SXpCLENBc0l5QztBQUN2RCxHQUFJLENBQUNwRCxPQUFMLENBQWM7QUFDWixNQUFPb0QsS0FBUDtBQUNEOztBQUVELEdBQU01QixhQUFpQjBCLE9BQWpCLEtBQTRCQyxNQUFsQztBQUNBLE1BQU8sV0FBVztBQUNoQixHQUFJLENBQUMzRCxRQUFMLENBQWU7QUFDYixNQUFPNEQsTUFBS0MsS0FBTCxDQUFXLElBQVgsQ0FBaUJDLFNBQWpCLENBQVA7QUFDRDs7QUFFRC9DLFNBQVNDLFVBQVQsQ0FBb0JnQixXQUFwQjtBQUNBLEdBQU0rQixLQUFNSCxLQUFLQyxLQUFMLENBQVcsSUFBWCxDQUFpQkMsU0FBakIsQ0FBWjtBQUNBL0MsU0FBU08sUUFBVDtBQUNBLE1BQU95QyxJQUFQO0FBQ0QsQ0FURDtBQVVELENBdEplLENBQWpCOzs7QUF5SkEsR0FBSXZELE9BQUosQ0FBYTs7Ozs7QUFLVlgsT0FBRCxDQUFla0IsUUFBZixDQUEwQkEsUUFBMUI7QUFDRDs7QUFFRGlELE9BQU9DLE9BQVAsQ0FBaUJsRCxRQUFqQiIsImZpbGUiOiJTeXN0cmFjZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cbiAqXG4gKiBAcHJvdmlkZXNNb2R1bGUgU3lzdHJhY2VcbiAqIEBmbG93XG4gKi9cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnZmJqcy9saWIvaW52YXJpYW50Jyk7XG5cbnR5cGUgUmVsYXlQcm9maWxlciA9IHtcbiAgYXR0YWNoUHJvZmlsZUhhbmRsZXIoXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIGhhbmRsZXI6IChuYW1lOiBzdHJpbmcsIHN0YXRlPzogYW55KSA9PiAoKSA9PiB2b2lkXG4gICk6IHZvaWQsXG5cbiAgYXR0YWNoQWdncmVnYXRlSGFuZGxlcihcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgaGFuZGxlcjogKG5hbWU6IHN0cmluZywgY2FsbGJhY2s6ICgpID0+IHZvaWQpID0+IHZvaWRcbiAgKTogdm9pZCxcbn07XG5cbi8qIGVzbGludCBuby1iaXR3aXNlOiAwICovXG5jb25zdCBUUkFDRV9UQUdfUkVBQ1RfQVBQUyA9IDEgPDwgMTc7XG5jb25zdCBUUkFDRV9UQUdfSlNDX0NBTExTID0gMSA8PCAyNztcblxubGV0IF9lbmFibGVkID0gZmFsc2U7XG5sZXQgX2FzeW5jQ29va2llID0gMDtcbmNvbnN0IF9tYXJrU3RhY2sgPSBbXTtcbmxldCBfbWFya1N0YWNrSW5kZXggPSAtMTtcblxuLy8gSW1wbGVtZW50cyBhIHN1YnNldCBvZiBVc2VyIFRpbWluZyBBUEkgbmVjZXNzYXJ5IGZvciBSZWFjdCBtZWFzdXJlbWVudHMuXG4vLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvVXNlcl9UaW1pbmdfQVBJXG5jb25zdCBSRUFDVF9NQVJLRVIgPSAnXFx1MjY5Qic7XG5jb25zdCB1c2VyVGltaW5nUG9seWZpbGwgPSB7XG4gIG1hcmsobWFya05hbWU6IHN0cmluZykge1xuICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICBpZiAoX2VuYWJsZWQpIHtcbiAgICAgICAgX21hcmtTdGFja0luZGV4Kys7XG4gICAgICAgIF9tYXJrU3RhY2tbX21hcmtTdGFja0luZGV4XSA9IG1hcmtOYW1lO1xuICAgICAgICBsZXQgc3lzdHJhY2VMYWJlbCA9IG1hcmtOYW1lO1xuICAgICAgICAvLyBTaW5jZSBwZXJmIG1lYXN1cmVtZW50cyBhcmUgYSBzaGFyZWQgbmFtZXNwYWNlIGluIFVzZXIgVGltaW5nIEFQSSxcbiAgICAgICAgLy8gd2UgcHJlZml4IGFsbCBSZWFjdCByZXN1bHRzIHdpdGggYSBSZWFjdCBlbW9qaS5cbiAgICAgICAgaWYgKG1hcmtOYW1lWzBdID09PSBSRUFDVF9NQVJLRVIpIHtcbiAgICAgICAgICAvLyBUaGlzIGlzIGNvbWluZyBmcm9tIFJlYWN0LlxuICAgICAgICAgIC8vIFJlbW92aW5nIGNvbXBvbmVudCBJRHMga2VlcHMgdHJhY2UgY29sb3JzIHN0YWJsZS5cbiAgICAgICAgICBjb25zdCBpbmRleE9mSWQgPSBtYXJrTmFtZS5sYXN0SW5kZXhPZignICgjJyk7XG4gICAgICAgICAgY29uc3QgY3V0b2ZmSW5kZXggPSBpbmRleE9mSWQgIT09IC0xID8gaW5kZXhPZklkIDogbWFya05hbWUubGVuZ3RoO1xuICAgICAgICAgIC8vIEFsc28gY3V0IG9mZiB0aGUgZW1vamkgYmVjYXVzZSBpdCBicmVha3MgU3lzdHJhY2VcbiAgICAgICAgICBzeXN0cmFjZUxhYmVsID0gbWFya05hbWUuc2xpY2UoMiwgY3V0b2ZmSW5kZXgpO1xuICAgICAgICB9XG4gICAgICAgIFN5c3RyYWNlLmJlZ2luRXZlbnQoc3lzdHJhY2VMYWJlbCk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBtZWFzdXJlKG1lYXN1cmVOYW1lOiBzdHJpbmcsIHN0YXJ0TWFyazogP3N0cmluZywgZW5kTWFyazogP3N0cmluZykge1xuICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICBpZiAoX2VuYWJsZWQpIHtcbiAgICAgICAgaW52YXJpYW50KFxuICAgICAgICAgIHR5cGVvZiBtZWFzdXJlTmFtZSA9PT0gJ3N0cmluZycgJiZcbiAgICAgICAgICB0eXBlb2Ygc3RhcnRNYXJrID09PSAnc3RyaW5nJyAmJlxuICAgICAgICAgIHR5cGVvZiBlbmRNYXJrID09PSAndW5kZWZpbmVkJyxcbiAgICAgICAgICAnT25seSBwZXJmb3JtYW5jZS5tZWFzdXJlKHN0cmluZywgc3RyaW5nKSBvdmVybG9hZCBpcyBzdXBwb3J0ZWQuJ1xuICAgICAgICApO1xuICAgICAgICBjb25zdCB0b3BNYXJrID0gX21hcmtTdGFja1tfbWFya1N0YWNrSW5kZXhdO1xuICAgICAgICBpbnZhcmlhbnQoXG4gICAgICAgICAgc3RhcnRNYXJrID09PSB0b3BNYXJrLFxuICAgICAgICAgICdUaGVyZSB3YXMgYSBtaXNtYXRjaGluZyBwZXJmb3JtYW5jZS5tZWFzdXJlKCkgY2FsbC4gJyArXG4gICAgICAgICAgJ0V4cGVjdGVkIFwiJXNcIiBidXQgZ290IFwiJXMuXCInLFxuICAgICAgICAgIHRvcE1hcmssXG4gICAgICAgICAgc3RhcnRNYXJrLFxuICAgICAgICApO1xuICAgICAgICBfbWFya1N0YWNrSW5kZXgtLTtcbiAgICAgICAgLy8gV2UgY2FuJ3QgdXNlIG1vcmUgZGVzY3JpcHRpdmUgbWVhc3VyZU5hbWUgYmVjYXVzZSBTeXN0cmFjZSBkb2Vzbid0XG4gICAgICAgIC8vIGxldCB1cyBlZGl0IGxhYmVscyBwb3N0IGZhY3R1bS5cbiAgICAgICAgU3lzdHJhY2UuZW5kRXZlbnQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGNsZWFyTWFya3MobWFya05hbWU6IHN0cmluZykge1xuICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICBpZiAoX2VuYWJsZWQpIHtcbiAgICAgICAgaWYgKF9tYXJrU3RhY2tJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1hcmtOYW1lID09PSBfbWFya1N0YWNrW19tYXJrU3RhY2tJbmRleF0pIHtcbiAgICAgICAgICAvLyBSZWFjdCB1c2VzIHRoaXMgZm9yIFwiY2FuY2VsbGluZ1wiIHN0YXJ0ZWQgbWVhc3VyZW1lbnRzLlxuICAgICAgICAgIC8vIFN5c3RyYWNlIGRvZXNuJ3Qgc3VwcG9ydCBkZWxldGluZyBtZWFzdXJlbWVudHMsIHNvIHdlIGp1c3Qgc3RvcCB0aGVtLlxuICAgICAgICAgIHVzZXJUaW1pbmdQb2x5ZmlsbC5tZWFzdXJlKG1hcmtOYW1lLCBtYXJrTmFtZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGNsZWFyTWVhc3VyZXMoKSB7XG4gICAgLy8gUmVhY3QgY2FsbHMgdGhpcyB0byBhdm9pZCBtZW1vcnkgbGVha3MgaW4gYnJvd3NlcnMsIGJ1dCB3ZSBkb24ndCBrZWVwXG4gICAgLy8gbWVhc3VyZW1lbnRzIGFueXdheS5cbiAgfSxcbn07XG5cbmNvbnN0IFN5c3RyYWNlID0ge1xuICBnZXRVc2VyVGltaW5nUG9seWZpbGwoKSB7XG4gICAgcmV0dXJuIHVzZXJUaW1pbmdQb2x5ZmlsbDtcbiAgfSxcblxuICBzZXRFbmFibGVkKGVuYWJsZWQ6IGJvb2xlYW4pIHtcbiAgICBpZiAoX2VuYWJsZWQgIT09IGVuYWJsZWQpIHtcbiAgICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICAgIGlmIChlbmFibGVkKSB7XG4gICAgICAgICAgZ2xvYmFsLm5hdGl2ZVRyYWNlQmVnaW5MZWdhY3kgJiYgZ2xvYmFsLm5hdGl2ZVRyYWNlQmVnaW5MZWdhY3koVFJBQ0VfVEFHX0pTQ19DQUxMUyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZ2xvYmFsLm5hdGl2ZVRyYWNlRW5kTGVnYWN5ICYmIGdsb2JhbC5uYXRpdmVUcmFjZUVuZExlZ2FjeShUUkFDRV9UQUdfSlNDX0NBTExTKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgX2VuYWJsZWQgPSBlbmFibGVkO1xuICAgIH1cbiAgfSxcblxuICBpc0VuYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIF9lbmFibGVkO1xuICB9LFxuXG4gIC8qKlxuICAgKiBiZWdpbkV2ZW50L2VuZEV2ZW50IGZvciBzdGFydGluZyBhbmQgdGhlbiBlbmRpbmcgYSBwcm9maWxlIHdpdGhpbiB0aGUgc2FtZSBjYWxsIHN0YWNrIGZyYW1lXG4gICoqL1xuICBiZWdpbkV2ZW50KHByb2ZpbGVOYW1lPzogYW55LCBhcmdzPzogYW55KSB7XG4gICAgaWYgKF9lbmFibGVkKSB7XG4gICAgICBwcm9maWxlTmFtZSA9IHR5cGVvZiBwcm9maWxlTmFtZSA9PT0gJ2Z1bmN0aW9uJyA/XG4gICAgICAgIHByb2ZpbGVOYW1lKCkgOiBwcm9maWxlTmFtZTtcbiAgICAgIGdsb2JhbC5uYXRpdmVUcmFjZUJlZ2luU2VjdGlvbihUUkFDRV9UQUdfUkVBQ1RfQVBQUywgcHJvZmlsZU5hbWUsIGFyZ3MpO1xuICAgIH1cbiAgfSxcblxuICBlbmRFdmVudCgpIHtcbiAgICBpZiAoX2VuYWJsZWQpIHtcbiAgICAgIGdsb2JhbC5uYXRpdmVUcmFjZUVuZFNlY3Rpb24oVFJBQ0VfVEFHX1JFQUNUX0FQUFMpO1xuICAgIH1cbiAgfSxcblxuICAvKipcbiAgICogYmVnaW5Bc3luY0V2ZW50L2VuZEFzeW5jRXZlbnQgZm9yIHN0YXJ0aW5nIGFuZCB0aGVuIGVuZGluZyBhIHByb2ZpbGUgd2hlcmUgdGhlIGVuZCBjYW4gZWl0aGVyXG4gICAqIG9jY3VyIG9uIGFub3RoZXIgdGhyZWFkIG9yIG91dCBvZiB0aGUgY3VycmVudCBzdGFjayBmcmFtZSwgZWcgYXdhaXRcbiAgICogdGhlIHJldHVybmVkIGNvb2tpZSB2YXJpYWJsZSBzaG91bGQgYmUgdXNlZCBhcyBpbnB1dCBpbnRvIHRoZSBlbmRBc3luY0V2ZW50IGNhbGwgdG8gZW5kIHRoZSBwcm9maWxlXG4gICoqL1xuICBiZWdpbkFzeW5jRXZlbnQocHJvZmlsZU5hbWU/OiBhbnkpOiBhbnkge1xuICAgIGNvbnN0IGNvb2tpZSA9IF9hc3luY0Nvb2tpZTtcbiAgICBpZiAoX2VuYWJsZWQpIHtcbiAgICAgIF9hc3luY0Nvb2tpZSsrO1xuICAgICAgcHJvZmlsZU5hbWUgPSB0eXBlb2YgcHJvZmlsZU5hbWUgPT09ICdmdW5jdGlvbicgP1xuICAgICAgICBwcm9maWxlTmFtZSgpIDogcHJvZmlsZU5hbWU7XG4gICAgICBnbG9iYWwubmF0aXZlVHJhY2VCZWdpbkFzeW5jU2VjdGlvbihUUkFDRV9UQUdfUkVBQ1RfQVBQUywgcHJvZmlsZU5hbWUsIGNvb2tpZSwgMCk7XG4gICAgfVxuICAgIHJldHVybiBjb29raWU7XG4gIH0sXG5cbiAgZW5kQXN5bmNFdmVudChwcm9maWxlTmFtZT86IGFueSwgY29va2llPzogYW55KSB7XG4gICAgaWYgKF9lbmFibGVkKSB7XG4gICAgICBwcm9maWxlTmFtZSA9IHR5cGVvZiBwcm9maWxlTmFtZSA9PT0gJ2Z1bmN0aW9uJyA/XG4gICAgICAgIHByb2ZpbGVOYW1lKCkgOiBwcm9maWxlTmFtZTtcbiAgICAgIGdsb2JhbC5uYXRpdmVUcmFjZUVuZEFzeW5jU2VjdGlvbihUUkFDRV9UQUdfUkVBQ1RfQVBQUywgcHJvZmlsZU5hbWUsIGNvb2tpZSwgMCk7XG4gICAgfVxuICB9LFxuXG4gIC8qKlxuICAgKiBjb3VudGVyRXZlbnQgcmVnaXN0ZXJzIHRoZSB2YWx1ZSB0byB0aGUgcHJvZmlsZU5hbWUgb24gdGhlIHN5c3RyYWNlIHRpbWVsaW5lXG4gICoqL1xuICBjb3VudGVyRXZlbnQocHJvZmlsZU5hbWU/OiBhbnksIHZhbHVlPzogYW55KSB7XG4gICAgaWYgKF9lbmFibGVkKSB7XG4gICAgICBwcm9maWxlTmFtZSA9IHR5cGVvZiBwcm9maWxlTmFtZSA9PT0gJ2Z1bmN0aW9uJyA/XG4gICAgICAgIHByb2ZpbGVOYW1lKCkgOiBwcm9maWxlTmFtZTtcbiAgICAgIGdsb2JhbC5uYXRpdmVUcmFjZUNvdW50ZXIgJiZcbiAgICAgICAgZ2xvYmFsLm5hdGl2ZVRyYWNlQ291bnRlcihUUkFDRV9UQUdfUkVBQ1RfQVBQUywgcHJvZmlsZU5hbWUsIHZhbHVlKTtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJlbGF5IHByb2ZpbGVzIHVzZSBhd2FpdCBjYWxscywgc28gbGlrZWx5IG9jY3VyIG91dCBvZiBjdXJyZW50IHN0YWNrIGZyYW1lXG4gICAqIHRoZXJlZm9yZSBhc3luYyB2YXJpYW50IG9mIHByb2ZpbGluZyBpcyB1c2VkXG4gICoqL1xuICBhdHRhY2hUb1JlbGF5UHJvZmlsZXIocmVsYXlQcm9maWxlcjogUmVsYXlQcm9maWxlcikge1xuICAgIHJlbGF5UHJvZmlsZXIuYXR0YWNoUHJvZmlsZUhhbmRsZXIoJyonLCAobmFtZSkgPT4ge1xuICAgICAgY29uc3QgY29va2llID0gU3lzdHJhY2UuYmVnaW5Bc3luY0V2ZW50KG5hbWUpO1xuICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgU3lzdHJhY2UuZW5kQXN5bmNFdmVudChuYW1lLCBjb29raWUpO1xuICAgICAgfTtcbiAgICB9KTtcblxuICAgIHJlbGF5UHJvZmlsZXIuYXR0YWNoQWdncmVnYXRlSGFuZGxlcignKicsIChuYW1lLCBjYWxsYmFjaykgPT4ge1xuICAgICAgU3lzdHJhY2UuYmVnaW5FdmVudChuYW1lKTtcbiAgICAgIGNhbGxiYWNrKCk7XG4gICAgICBTeXN0cmFjZS5lbmRFdmVudCgpO1xuICAgIH0pO1xuICB9LFxuXG4gIC8qIFRoaXMgaXMgbm90IGNhbGxlZCBieSBkZWZhdWx0IGR1ZSB0byBwZXJmIG92ZXJoZWFkIGJ1dCBpdCdzIHVzZWZ1bFxuICAgICBpZiB5b3Ugd2FudCB0byBmaW5kIHRyYWNlcyB3aGljaCBzcGVuZCB0b28gbXVjaCB0aW1lIGluIEpTT04uICovXG4gIHN3aXp6bGVKU09OKCkge1xuICAgIFN5c3RyYWNlLm1lYXN1cmVNZXRob2RzKEpTT04sICdKU09OJywgW1xuICAgICAgJ3BhcnNlJyxcbiAgICAgICdzdHJpbmdpZnknXG4gICAgXSk7XG4gIH0sXG5cbiAvKipcbiAgKiBNZWFzdXJlcyBtdWx0aXBsZSBtZXRob2RzIG9mIGEgY2xhc3MuIEZvciBleGFtcGxlLCB5b3UgY2FuIGRvOlxuICAqIFN5c3RyYWNlLm1lYXN1cmVNZXRob2RzKEpTT04sICdKU09OJywgWydwYXJzZScsICdzdHJpbmdpZnknXSk7XG4gICpcbiAgKiBAcGFyYW0gb2JqZWN0XG4gICogQHBhcmFtIG9iamVjdE5hbWVcbiAgKiBAcGFyYW0gbWV0aG9kTmFtZXMgTWFwIGZyb20gbWV0aG9kIG5hbWVzIHRvIG1ldGhvZCBkaXNwbGF5IG5hbWVzLlxuICAqL1xuIG1lYXN1cmVNZXRob2RzKG9iamVjdDogYW55LCBvYmplY3ROYW1lOiBzdHJpbmcsIG1ldGhvZE5hbWVzOiBBcnJheTxzdHJpbmc+KTogdm9pZCB7XG4gICBpZiAoIV9fREVWX18pIHtcbiAgICAgcmV0dXJuO1xuICAgfVxuXG4gICBtZXRob2ROYW1lcy5mb3JFYWNoKG1ldGhvZE5hbWUgPT4ge1xuICAgICBvYmplY3RbbWV0aG9kTmFtZV0gPSBTeXN0cmFjZS5tZWFzdXJlKFxuICAgICAgIG9iamVjdE5hbWUsXG4gICAgICAgbWV0aG9kTmFtZSxcbiAgICAgICBvYmplY3RbbWV0aG9kTmFtZV1cbiAgICAgKTtcbiAgIH0pO1xuIH0sXG5cbiAvKipcbiAgKiBSZXR1cm5zIGFuIHByb2ZpbGVkIHZlcnNpb24gb2YgdGhlIGlucHV0IGZ1bmN0aW9uLiBGb3IgZXhhbXBsZSwgeW91IGNhbjpcbiAgKiBKU09OLnBhcnNlID0gU3lzdHJhY2UubWVhc3VyZSgnSlNPTicsICdwYXJzZScsIEpTT04ucGFyc2UpO1xuICAqXG4gICogQHBhcmFtIG9iak5hbWVcbiAgKiBAcGFyYW0gZm5OYW1lXG4gICogQHBhcmFtIHtmdW5jdGlvbn0gZnVuY1xuICAqIEByZXR1cm4ge2Z1bmN0aW9ufSByZXBsYWNlbWVudCBmdW5jdGlvblxuICAqL1xuIG1lYXN1cmUob2JqTmFtZTogc3RyaW5nLCBmbk5hbWU6IHN0cmluZywgZnVuYzogYW55KTogYW55IHtcbiAgIGlmICghX19ERVZfXykge1xuICAgICByZXR1cm4gZnVuYztcbiAgIH1cblxuICAgY29uc3QgcHJvZmlsZU5hbWUgPSBgJHtvYmpOYW1lfS4ke2ZuTmFtZX1gO1xuICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICBpZiAoIV9lbmFibGVkKSB7XG4gICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgfVxuXG4gICAgIFN5c3RyYWNlLmJlZ2luRXZlbnQocHJvZmlsZU5hbWUpO1xuICAgICBjb25zdCByZXQgPSBmdW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgIFN5c3RyYWNlLmVuZEV2ZW50KCk7XG4gICAgIHJldHVybiByZXQ7XG4gICB9O1xuIH0sXG59O1xuXG5pZiAoX19ERVZfXykge1xuICAvLyBUaGlzIGlzIG5lZWRlZCwgYmVjYXVzZSByZXF1aXJlIGNhbGxpcyBpbiBwb2x5ZmlsbHMgYXJlIG5vdCBwcm9jZXNzZWQgYXNcbiAgLy8gb3RoZXIgZmlsZXMuIFRoZXJlZm9yZSwgY2FsbHMgdG8gYHJlcXVpcmUoJ21vZHVsZUlkJylgIGFyZSBub3QgcmVwbGFjZWRcbiAgLy8gd2l0aCBudW1lcmljIElEc1xuICAvLyBUT0RPKGRhdmlkYXVyZWxpbykgU2NhbiBwb2x5ZmlsbHMgZm9yIGRlcGVuZGVuY2llcywgdG9vICh0OTc1OTY4NilcbiAgKHJlcXVpcmU6IGFueSkuU3lzdHJhY2UgPSBTeXN0cmFjZTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBTeXN0cmFjZTtcbiJdfQ==