54cb9f1315b56368758ff9dd34631c73












'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}

var EmitterSubscription=require('EmitterSubscription');
var EventSubscriptionVendor=require('EventSubscriptionVendor');

var emptyFunction=require('fbjs/lib/emptyFunction');
var invariant=require('fbjs/lib/invariant');var














EventEmitter=function(){










function EventEmitter(subscriber){_classCallCheck(this,EventEmitter);
this._subscriber=subscriber||new EventSubscriptionVendor();
}_createClass(EventEmitter,[{key:'addListener',value:function addListener(
















eventType,listener,context){

return this._subscriber.addSubscription(
eventType,
new EmitterSubscription(this,this._subscriber,listener,context));

}},{key:'once',value:function once(











eventType,listener,context){var _this=this;
return this.addListener(eventType,function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}
_this.removeCurrentListener();
listener.apply(context,args);
});
}},{key:'removeAllListeners',value:function removeAllListeners(








eventType){
this._subscriber.removeAllSubscriptions(eventType);
}},{key:'removeCurrentListener',value:function removeCurrentListener()






















{
invariant(
!!this._currentSubscription,
'Not in an emitting cycle; there is no current subscription');

this.removeSubscription(this._currentSubscription);
}},{key:'removeSubscription',value:function removeSubscription(





subscription){
invariant(
subscription.emitter===this,
'Subscription does not belong to this emitter.');

this._subscriber.removeSubscription(subscription);
}},{key:'listeners',value:function listeners(








eventType){
var subscriptions=this._subscriber.getSubscriptionsForType(eventType);
return subscriptions?
subscriptions.filter(emptyFunction.thatReturnsTrue).map(
function(subscription){
return subscription.listener;
}):
[];
}},{key:'emit',value:function emit(















eventType){
var subscriptions=this._subscriber.getSubscriptionsForType(eventType);
if(subscriptions){
for(var i=0,l=subscriptions.length;i<l;i++){
var subscription=subscriptions[i];


if(subscription){
this._currentSubscription=subscription;
subscription.listener.apply(
subscription.context,
Array.prototype.slice.call(arguments,1));

}
}
this._currentSubscription=null;
}
}},{key:'removeListener',value:function removeListener(














eventType,listener){
var subscriptions=this._subscriber.getSubscriptionsForType(eventType);
if(subscriptions){
for(var i=0,l=subscriptions.length;i<l;i++){
var subscription=subscriptions[i];



if(subscription&&subscription.listener===listener){
subscription.remove();
}
}
}
}}]);return EventEmitter;}();


module.exports=EventEmitter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkV2ZW50RW1pdHRlci5qcyJdLCJuYW1lcyI6WyJFbWl0dGVyU3Vic2NyaXB0aW9uIiwicmVxdWlyZSIsIkV2ZW50U3Vic2NyaXB0aW9uVmVuZG9yIiwiZW1wdHlGdW5jdGlvbiIsImludmFyaWFudCIsIkV2ZW50RW1pdHRlciIsInN1YnNjcmliZXIiLCJfc3Vic2NyaWJlciIsImV2ZW50VHlwZSIsImxpc3RlbmVyIiwiY29udGV4dCIsImFkZFN1YnNjcmlwdGlvbiIsImFkZExpc3RlbmVyIiwiYXJncyIsInJlbW92ZUN1cnJlbnRMaXN0ZW5lciIsImFwcGx5IiwicmVtb3ZlQWxsU3Vic2NyaXB0aW9ucyIsIl9jdXJyZW50U3Vic2NyaXB0aW9uIiwicmVtb3ZlU3Vic2NyaXB0aW9uIiwic3Vic2NyaXB0aW9uIiwiZW1pdHRlciIsInN1YnNjcmlwdGlvbnMiLCJnZXRTdWJzY3JpcHRpb25zRm9yVHlwZSIsImZpbHRlciIsInRoYXRSZXR1cm5zVHJ1ZSIsIm1hcCIsImkiLCJsIiwibGVuZ3RoIiwiQXJyYXkiLCJwcm90b3R5cGUiLCJzbGljZSIsImNhbGwiLCJhcmd1bWVudHMiLCJyZW1vdmUiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFZQSxhOztBQUVBLEdBQU1BLHFCQUFzQkMsUUFBUSxxQkFBUixDQUE1QjtBQUNBLEdBQU1DLHlCQUEwQkQsUUFBUSx5QkFBUixDQUFoQzs7QUFFQSxHQUFNRSxlQUFnQkYsUUFBUSx3QkFBUixDQUF0QjtBQUNBLEdBQU1HLFdBQVlILFFBQVEsb0JBQVIsQ0FBbEIsQzs7Ozs7Ozs7Ozs7Ozs7O0FBZU1JLFk7Ozs7Ozs7Ozs7O0FBV0osc0JBQVlDLFVBQVosQ0FBa0Q7QUFDaEQsS0FBS0MsV0FBTCxDQUFtQkQsWUFBYyxHQUFJSix3QkFBSixFQUFqQztBQUNELEM7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaUJDTSxTLENBQW1CQyxRLENBQW9CQyxPLENBQXVDOztBQUU5RSxNQUFRLE1BQUtILFdBQUwsQ0FBaUJJLGVBQWpCO0FBQ05ILFNBRE07QUFFTixHQUFJUixvQkFBSixDQUF3QixJQUF4QixDQUE4QixLQUFLTyxXQUFuQyxDQUFnREUsUUFBaEQsQ0FBMERDLE9BQTFELENBRk0sQ0FBUjs7QUFJRCxDOzs7Ozs7Ozs7Ozs7QUFZSUYsUyxDQUFtQkMsUSxDQUFvQkMsTyxDQUF1QztBQUNqRixNQUFPLE1BQUtFLFdBQUwsQ0FBaUJKLFNBQWpCLENBQTRCLFVBQWEsK0JBQVRLLElBQVMsc0NBQVRBLElBQVM7QUFDOUMsTUFBS0MscUJBQUw7QUFDQUwsU0FBU00sS0FBVCxDQUFlTCxPQUFmLENBQXdCRyxJQUF4QjtBQUNELENBSE0sQ0FBUDtBQUlELEM7Ozs7Ozs7OztBQVNrQkwsUyxDQUFvQjtBQUNyQyxLQUFLRCxXQUFMLENBQWlCUyxzQkFBakIsQ0FBd0NSLFNBQXhDO0FBQ0QsQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF1QnVCO0FBQ3RCSjtBQUNFLENBQUMsQ0FBQyxLQUFLYSxvQkFEVDtBQUVFLDREQUZGOztBQUlBLEtBQUtDLGtCQUFMLENBQXdCLEtBQUtELG9CQUE3QjtBQUNELEM7Ozs7OztBQU1rQkUsWSxDQUFtQztBQUNwRGY7QUFDRWUsYUFBYUMsT0FBYixHQUF5QixJQUQzQjtBQUVFLCtDQUZGOztBQUlBLEtBQUtiLFdBQUwsQ0FBaUJXLGtCQUFqQixDQUFvQ0MsWUFBcEM7QUFDRCxDOzs7Ozs7Ozs7QUFTU1gsUyxDQUEwQztBQUNsRCxHQUFNYSxlQUF5QyxLQUFLZCxXQUFMLENBQWlCZSx1QkFBakIsQ0FBeUNkLFNBQXpDLENBQS9DO0FBQ0EsTUFBT2E7QUFDSEEsY0FBY0UsTUFBZCxDQUFxQnBCLGNBQWNxQixlQUFuQyxFQUFvREMsR0FBcEQ7QUFDRSxTQUFTTixZQUFULENBQXVCO0FBQ3JCLE1BQU9BLGNBQWFWLFFBQXBCO0FBQ0QsQ0FISCxDQURHO0FBS0gsRUFMSjtBQU1ELEM7Ozs7Ozs7Ozs7Ozs7Ozs7QUFnQklELFMsQ0FBbUI7QUFDdEIsR0FBTWEsZUFBeUMsS0FBS2QsV0FBTCxDQUFpQmUsdUJBQWpCLENBQXlDZCxTQUF6QyxDQUEvQztBQUNBLEdBQUlhLGFBQUosQ0FBbUI7QUFDakIsSUFBSyxHQUFJSyxHQUFJLENBQVIsQ0FBV0MsRUFBSU4sY0FBY08sTUFBbEMsQ0FBMENGLEVBQUlDLENBQTlDLENBQWlERCxHQUFqRCxDQUFzRDtBQUNwRCxHQUFNUCxjQUFlRSxjQUFjSyxDQUFkLENBQXJCOzs7QUFHQSxHQUFJUCxZQUFKLENBQWtCO0FBQ2hCLEtBQUtGLG9CQUFMLENBQTRCRSxZQUE1QjtBQUNBQSxhQUFhVixRQUFiLENBQXNCTSxLQUF0QjtBQUNFSSxhQUFhVCxPQURmO0FBRUVtQixNQUFNQyxTQUFOLENBQWdCQyxLQUFoQixDQUFzQkMsSUFBdEIsQ0FBMkJDLFNBQTNCLENBQXNDLENBQXRDLENBRkY7O0FBSUQ7QUFDRjtBQUNELEtBQUtoQixvQkFBTCxDQUE0QixJQUE1QjtBQUNEO0FBQ0YsQzs7Ozs7Ozs7Ozs7Ozs7O0FBZWNULFMsQ0FBbUJDLFEsQ0FBVTtBQUMxQyxHQUFNWSxlQUF5QyxLQUFLZCxXQUFMLENBQWlCZSx1QkFBakIsQ0FBeUNkLFNBQXpDLENBQS9DO0FBQ0EsR0FBSWEsYUFBSixDQUFtQjtBQUNqQixJQUFLLEdBQUlLLEdBQUksQ0FBUixDQUFXQyxFQUFJTixjQUFjTyxNQUFsQyxDQUEwQ0YsRUFBSUMsQ0FBOUMsQ0FBaURELEdBQWpELENBQXNEO0FBQ3BELEdBQU1QLGNBQWVFLGNBQWNLLENBQWQsQ0FBckI7Ozs7QUFJQSxHQUFJUCxjQUFnQkEsYUFBYVYsUUFBYixHQUEwQkEsUUFBOUMsQ0FBd0Q7QUFDdERVLGFBQWFlLE1BQWI7QUFDRDtBQUNGO0FBQ0Y7QUFDRixDOzs7QUFHSEMsT0FBT0MsT0FBUCxDQUFpQi9CLFlBQWpCIiwiZmlsZSI6IkV2ZW50RW1pdHRlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cbiAqXG4gKiBAcHJvdmlkZXNNb2R1bGUgRXZlbnRFbWl0dGVyXG4gKiBAbm9mbG93XG4gKiBAdHlwZWNoZWNrXG4gKi9cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgRW1pdHRlclN1YnNjcmlwdGlvbiA9IHJlcXVpcmUoJ0VtaXR0ZXJTdWJzY3JpcHRpb24nKTtcbmNvbnN0IEV2ZW50U3Vic2NyaXB0aW9uVmVuZG9yID0gcmVxdWlyZSgnRXZlbnRTdWJzY3JpcHRpb25WZW5kb3InKTtcblxuY29uc3QgZW1wdHlGdW5jdGlvbiA9IHJlcXVpcmUoJ2ZianMvbGliL2VtcHR5RnVuY3Rpb24nKTtcbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ZianMvbGliL2ludmFyaWFudCcpO1xuXG4vKipcbiAqIEBjbGFzcyBFdmVudEVtaXR0ZXJcbiAqIEBkZXNjcmlwdGlvblxuICogQW4gRXZlbnRFbWl0dGVyIGlzIHJlc3BvbnNpYmxlIGZvciBtYW5hZ2luZyBhIHNldCBvZiBsaXN0ZW5lcnMgYW5kIHB1Ymxpc2hpbmdcbiAqIGV2ZW50cyB0byB0aGVtIHdoZW4gaXQgaXMgdG9sZCB0aGF0IHN1Y2ggZXZlbnRzIGhhcHBlbmVkLiBJbiBhZGRpdGlvbiB0byB0aGVcbiAqIGRhdGEgZm9yIHRoZSBnaXZlbiBldmVudCBpdCBhbHNvIHNlbmRzIGEgZXZlbnQgY29udHJvbCBvYmplY3Qgd2hpY2ggYWxsb3dzXG4gKiB0aGUgbGlzdGVuZXJzL2hhbmRsZXJzIHRvIHByZXZlbnQgdGhlIGRlZmF1bHQgYmVoYXZpb3Igb2YgdGhlIGdpdmVuIGV2ZW50LlxuICpcbiAqIFRoZSBlbWl0dGVyIGlzIGRlc2lnbmVkIHRvIGJlIGdlbmVyaWMgZW5vdWdoIHRvIHN1cHBvcnQgYWxsIHRoZSBkaWZmZXJlbnRcbiAqIGNvbnRleHRzIGluIHdoaWNoIG9uZSBtaWdodCB3YW50IHRvIGVtaXQgZXZlbnRzLiBJdCBpcyBhIHNpbXBsZSBtdWx0aWNhc3RcbiAqIG1lY2hhbmlzbSBvbiB0b3Agb2Ygd2hpY2ggZXh0cmEgZnVuY3Rpb25hbGl0eSBjYW4gYmUgY29tcG9zZWQuIEZvciBleGFtcGxlLCBhXG4gKiBtb3JlIGFkdmFuY2VkIGVtaXR0ZXIgbWF5IHVzZSBhbiBFdmVudEhvbGRlciBhbmQgRXZlbnRGYWN0b3J5LlxuICovXG5jbGFzcyBFdmVudEVtaXR0ZXIge1xuXG4gIF9zdWJzY3JpYmVyOiBFdmVudFN1YnNjcmlwdGlvblZlbmRvcjtcbiAgX2N1cnJlbnRTdWJzY3JpcHRpb246ID9FbWl0dGVyU3Vic2NyaXB0aW9uO1xuXG4gIC8qKlxuICAgKiBAY29uc3RydWN0b3JcbiAgICpcbiAgICogQHBhcmFtIHtFdmVudFN1YnNjcmlwdGlvblZlbmRvcn0gc3Vic2NyaWJlciAtIE9wdGlvbmFsIHN1YnNjcmliZXIgaW5zdGFuY2VcbiAgICogICB0byB1c2UuIElmIG9taXR0ZWQsIGEgbmV3IHN1YnNjcmliZXIgd2lsbCBiZSBjcmVhdGVkIGZvciB0aGUgZW1pdHRlci5cbiAgICovXG4gIGNvbnN0cnVjdG9yKHN1YnNjcmliZXI6ID9FdmVudFN1YnNjcmlwdGlvblZlbmRvcikge1xuICAgIHRoaXMuX3N1YnNjcmliZXIgPSBzdWJzY3JpYmVyIHx8IG5ldyBFdmVudFN1YnNjcmlwdGlvblZlbmRvcigpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgYSBsaXN0ZW5lciB0byBiZSBpbnZva2VkIHdoZW4gZXZlbnRzIG9mIHRoZSBzcGVjaWZpZWQgdHlwZSBhcmVcbiAgICogZW1pdHRlZC4gQW4gb3B0aW9uYWwgY2FsbGluZyBjb250ZXh0IG1heSBiZSBwcm92aWRlZC4gVGhlIGRhdGEgYXJndW1lbnRzXG4gICAqIGVtaXR0ZWQgd2lsbCBiZSBwYXNzZWQgdG8gdGhlIGxpc3RlbmVyIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBUT0RPOiBBbm5vdGF0ZSB0aGUgbGlzdGVuZXIgYXJnJ3MgdHlwZS4gVGhpcyBpcyB0cmlja3kgYmVjYXVzZSBsaXN0ZW5lcnNcbiAgICogICAgICAgY2FuIGJlIGludm9rZWQgd2l0aCB2YXJhcmdzLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnRUeXBlIC0gTmFtZSBvZiB0aGUgZXZlbnQgdG8gbGlzdGVuIHRvXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IGxpc3RlbmVyIC0gRnVuY3Rpb24gdG8gaW52b2tlIHdoZW4gdGhlIHNwZWNpZmllZCBldmVudCBpc1xuICAgKiAgIGVtaXR0ZWRcbiAgICogQHBhcmFtIHsqfSBjb250ZXh0IC0gT3B0aW9uYWwgY29udGV4dCBvYmplY3QgdG8gdXNlIHdoZW4gaW52b2tpbmcgdGhlXG4gICAqICAgbGlzdGVuZXJcbiAgICovXG4gIGFkZExpc3RlbmVyKFxuICAgIGV2ZW50VHlwZTogc3RyaW5nLCBsaXN0ZW5lcjogRnVuY3Rpb24sIGNvbnRleHQ6ID9PYmplY3QpOiBFbWl0dGVyU3Vic2NyaXB0aW9uIHtcblxuICAgIHJldHVybiAodGhpcy5fc3Vic2NyaWJlci5hZGRTdWJzY3JpcHRpb24oXG4gICAgICBldmVudFR5cGUsXG4gICAgICBuZXcgRW1pdHRlclN1YnNjcmlwdGlvbih0aGlzLCB0aGlzLl9zdWJzY3JpYmVyLCBsaXN0ZW5lciwgY29udGV4dClcbiAgICApIDogYW55KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaW1pbGFyIHRvIGFkZExpc3RlbmVyLCBleGNlcHQgdGhhdCB0aGUgbGlzdGVuZXIgaXMgcmVtb3ZlZCBhZnRlciBpdCBpc1xuICAgKiBpbnZva2VkIG9uY2UuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudFR5cGUgLSBOYW1lIG9mIHRoZSBldmVudCB0byBsaXN0ZW4gdG9cbiAgICogQHBhcmFtIHtmdW5jdGlvbn0gbGlzdGVuZXIgLSBGdW5jdGlvbiB0byBpbnZva2Ugb25seSBvbmNlIHdoZW4gdGhlXG4gICAqICAgc3BlY2lmaWVkIGV2ZW50IGlzIGVtaXR0ZWRcbiAgICogQHBhcmFtIHsqfSBjb250ZXh0IC0gT3B0aW9uYWwgY29udGV4dCBvYmplY3QgdG8gdXNlIHdoZW4gaW52b2tpbmcgdGhlXG4gICAqICAgbGlzdGVuZXJcbiAgICovXG4gIG9uY2UoZXZlbnRUeXBlOiBzdHJpbmcsIGxpc3RlbmVyOiBGdW5jdGlvbiwgY29udGV4dDogP09iamVjdCk6IEVtaXR0ZXJTdWJzY3JpcHRpb24ge1xuICAgIHJldHVybiB0aGlzLmFkZExpc3RlbmVyKGV2ZW50VHlwZSwgKC4uLmFyZ3MpID0+IHtcbiAgICAgIHRoaXMucmVtb3ZlQ3VycmVudExpc3RlbmVyKCk7XG4gICAgICBsaXN0ZW5lci5hcHBseShjb250ZXh0LCBhcmdzKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmVzIGFsbCBvZiB0aGUgcmVnaXN0ZXJlZCBsaXN0ZW5lcnMsIGluY2x1ZGluZyB0aG9zZSByZWdpc3RlcmVkIGFzXG4gICAqIGxpc3RlbmVyIG1hcHMuXG4gICAqXG4gICAqIEBwYXJhbSB7P3N0cmluZ30gZXZlbnRUeXBlIC0gT3B0aW9uYWwgbmFtZSBvZiB0aGUgZXZlbnQgd2hvc2UgcmVnaXN0ZXJlZFxuICAgKiAgIGxpc3RlbmVycyB0byByZW1vdmVcbiAgICovXG4gIHJlbW92ZUFsbExpc3RlbmVycyhldmVudFR5cGU6ID9zdHJpbmcpIHtcbiAgICB0aGlzLl9zdWJzY3JpYmVyLnJlbW92ZUFsbFN1YnNjcmlwdGlvbnMoZXZlbnRUeXBlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcm92aWRlcyBhbiBBUEkgdGhhdCBjYW4gYmUgY2FsbGVkIGR1cmluZyBhbiBldmVudGluZyBjeWNsZSB0byByZW1vdmUgdGhlXG4gICAqIGxhc3QgbGlzdGVuZXIgdGhhdCB3YXMgaW52b2tlZC4gVGhpcyBhbGxvd3MgYSBkZXZlbG9wZXIgdG8gcHJvdmlkZSBhbiBldmVudFxuICAgKiBvYmplY3QgdGhhdCBjYW4gcmVtb3ZlIHRoZSBsaXN0ZW5lciAob3IgbGlzdGVuZXIgbWFwKSBkdXJpbmcgdGhlXG4gICAqIGludm9jYXRpb24uXG4gICAqXG4gICAqIElmIGl0IGlzIGNhbGxlZCB3aGVuIG5vdCBpbnNpZGUgb2YgYW4gZW1pdHRpbmcgY3ljbGUgaXQgd2lsbCB0aHJvdy5cbiAgICpcbiAgICogQHRocm93cyB7RXJyb3J9IFdoZW4gY2FsbGVkIG5vdCBkdXJpbmcgYW4gZXZlbnRpbmcgY3ljbGVcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogICB2YXIgc3Vic2NyaXB0aW9uID0gZW1pdHRlci5hZGRMaXN0ZW5lck1hcCh7XG4gICAqICAgICBzb21lRXZlbnQ6IGZ1bmN0aW9uKGRhdGEsIGV2ZW50KSB7XG4gICAqICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgKiAgICAgICBlbWl0dGVyLnJlbW92ZUN1cnJlbnRMaXN0ZW5lcigpO1xuICAgKiAgICAgfVxuICAgKiAgIH0pO1xuICAgKlxuICAgKiAgIGVtaXR0ZXIuZW1pdCgnc29tZUV2ZW50JywgJ2FiYycpOyAvLyBsb2dzICdhYmMnXG4gICAqICAgZW1pdHRlci5lbWl0KCdzb21lRXZlbnQnLCAnZGVmJyk7IC8vIGRvZXMgbm90IGxvZyBhbnl0aGluZ1xuICAgKi9cbiAgcmVtb3ZlQ3VycmVudExpc3RlbmVyKCkge1xuICAgIGludmFyaWFudChcbiAgICAgICEhdGhpcy5fY3VycmVudFN1YnNjcmlwdGlvbixcbiAgICAgICdOb3QgaW4gYW4gZW1pdHRpbmcgY3ljbGU7IHRoZXJlIGlzIG5vIGN1cnJlbnQgc3Vic2NyaXB0aW9uJ1xuICAgICk7XG4gICAgdGhpcy5yZW1vdmVTdWJzY3JpcHRpb24odGhpcy5fY3VycmVudFN1YnNjcmlwdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyBhIHNwZWNpZmljIHN1YnNjcmlwdGlvbi4gQ2FsbGVkIGJ5IHRoZSBgcmVtb3ZlKClgIG1ldGhvZCBvZiB0aGVcbiAgICogc3Vic2NyaXB0aW9uIGl0c2VsZiB0byBlbnN1cmUgYW55IG5lY2Vzc2FyeSBjbGVhbnVwIGlzIHBlcmZvcm1lZC5cbiAgICovXG4gIHJlbW92ZVN1YnNjcmlwdGlvbihzdWJzY3JpcHRpb246IEVtaXR0ZXJTdWJzY3JpcHRpb24pIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICBzdWJzY3JpcHRpb24uZW1pdHRlciA9PT0gdGhpcyxcbiAgICAgICdTdWJzY3JpcHRpb24gZG9lcyBub3QgYmVsb25nIHRvIHRoaXMgZW1pdHRlci4nXG4gICAgKTtcbiAgICB0aGlzLl9zdWJzY3JpYmVyLnJlbW92ZVN1YnNjcmlwdGlvbihzdWJzY3JpcHRpb24pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYW4gYXJyYXkgb2YgbGlzdGVuZXJzIHRoYXQgYXJlIGN1cnJlbnRseSByZWdpc3RlcmVkIGZvciB0aGUgZ2l2ZW5cbiAgICogZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudFR5cGUgLSBOYW1lIG9mIHRoZSBldmVudCB0byBxdWVyeVxuICAgKiBAcmV0dXJucyB7YXJyYXl9XG4gICAqL1xuICBsaXN0ZW5lcnMoZXZlbnRUeXBlOiBzdHJpbmcpOiBbRW1pdHRlclN1YnNjcmlwdGlvbl0ge1xuICAgIGNvbnN0IHN1YnNjcmlwdGlvbnM6ID9bRW1pdHRlclN1YnNjcmlwdGlvbl0gPSAodGhpcy5fc3Vic2NyaWJlci5nZXRTdWJzY3JpcHRpb25zRm9yVHlwZShldmVudFR5cGUpOiBhbnkpO1xuICAgIHJldHVybiBzdWJzY3JpcHRpb25zXG4gICAgICA/IHN1YnNjcmlwdGlvbnMuZmlsdGVyKGVtcHR5RnVuY3Rpb24udGhhdFJldHVybnNUcnVlKS5tYXAoXG4gICAgICAgICAgZnVuY3Rpb24oc3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gc3Vic2NyaXB0aW9uLmxpc3RlbmVyO1xuICAgICAgICAgIH0pXG4gICAgICA6IFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIEVtaXRzIGFuIGV2ZW50IG9mIHRoZSBnaXZlbiB0eXBlIHdpdGggdGhlIGdpdmVuIGRhdGEuIEFsbCBoYW5kbGVycyBvZiB0aGF0XG4gICAqIHBhcnRpY3VsYXIgdHlwZSB3aWxsIGJlIG5vdGlmaWVkLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnRUeXBlIC0gTmFtZSBvZiB0aGUgZXZlbnQgdG8gZW1pdFxuICAgKiBAcGFyYW0gey4uLip9IEFyYml0cmFyeSBhcmd1bWVudHMgdG8gYmUgcGFzc2VkIHRvIGVhY2ggcmVnaXN0ZXJlZCBsaXN0ZW5lclxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAgIGVtaXR0ZXIuYWRkTGlzdGVuZXIoJ3NvbWVFdmVudCcsIGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICogICAgIGNvbnNvbGUubG9nKG1lc3NhZ2UpO1xuICAgKiAgIH0pO1xuICAgKlxuICAgKiAgIGVtaXR0ZXIuZW1pdCgnc29tZUV2ZW50JywgJ2FiYycpOyAvLyBsb2dzICdhYmMnXG4gICAqL1xuICBlbWl0KGV2ZW50VHlwZTogc3RyaW5nKSB7XG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uczogP1tFbWl0dGVyU3Vic2NyaXB0aW9uXSA9ICh0aGlzLl9zdWJzY3JpYmVyLmdldFN1YnNjcmlwdGlvbnNGb3JUeXBlKGV2ZW50VHlwZSk6IGFueSk7XG4gICAgaWYgKHN1YnNjcmlwdGlvbnMpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gc3Vic2NyaXB0aW9ucy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gc3Vic2NyaXB0aW9uc1tpXTtcblxuICAgICAgICAvLyBUaGUgc3Vic2NyaXB0aW9uIG1heSBoYXZlIGJlZW4gcmVtb3ZlZCBkdXJpbmcgdGhpcyBldmVudCBsb29wLlxuICAgICAgICBpZiAoc3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgdGhpcy5fY3VycmVudFN1YnNjcmlwdGlvbiA9IHN1YnNjcmlwdGlvbjtcbiAgICAgICAgICBzdWJzY3JpcHRpb24ubGlzdGVuZXIuYXBwbHkoXG4gICAgICAgICAgICBzdWJzY3JpcHRpb24uY29udGV4dCxcbiAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSlcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLl9jdXJyZW50U3Vic2NyaXB0aW9uID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyB0aGUgZ2l2ZW4gbGlzdGVuZXIgZm9yIGV2ZW50IG9mIHNwZWNpZmljIHR5cGUuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudFR5cGUgLSBOYW1lIG9mIHRoZSBldmVudCB0byBlbWl0XG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IGxpc3RlbmVyIC0gRnVuY3Rpb24gdG8gaW52b2tlIHdoZW4gdGhlIHNwZWNpZmllZCBldmVudCBpc1xuICAgKiAgIGVtaXR0ZWRcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogICBlbWl0dGVyLnJlbW92ZUxpc3RlbmVyKCdzb21lRXZlbnQnLCBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAqICAgICBjb25zb2xlLmxvZyhtZXNzYWdlKTtcbiAgICogICB9KTsgLy8gcmVtb3ZlcyB0aGUgbGlzdGVuZXIgaWYgYWxyZWFkeSByZWdpc3RlcmVkXG4gICAqXG4gICAqL1xuICByZW1vdmVMaXN0ZW5lcihldmVudFR5cGU6IFN0cmluZywgbGlzdGVuZXIpIHtcbiAgICBjb25zdCBzdWJzY3JpcHRpb25zOiA/W0VtaXR0ZXJTdWJzY3JpcHRpb25dID0gKHRoaXMuX3N1YnNjcmliZXIuZ2V0U3Vic2NyaXB0aW9uc0ZvclR5cGUoZXZlbnRUeXBlKTogYW55KTtcbiAgICBpZiAoc3Vic2NyaXB0aW9ucykge1xuICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBzdWJzY3JpcHRpb25zLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICBjb25zdCBzdWJzY3JpcHRpb24gPSBzdWJzY3JpcHRpb25zW2ldO1xuXG4gICAgICAgIC8vIFRoZSBzdWJzY3JpcHRpb24gbWF5IGhhdmUgYmVlbiByZW1vdmVkIGR1cmluZyB0aGlzIGV2ZW50IGxvb3AuXG4gICAgICAgIC8vIGl0cyBsaXN0ZW5lciBtYXRjaGVzIHRoZSBsaXN0ZW5lciBpbiBtZXRob2QgcGFyYW1ldGVyc1xuICAgICAgICBpZiAoc3Vic2NyaXB0aW9uICYmIHN1YnNjcmlwdGlvbi5saXN0ZW5lciA9PT0gbGlzdGVuZXIpIHtcbiAgICAgICAgICBzdWJzY3JpcHRpb24ucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBFdmVudEVtaXR0ZXI7XG4iXX0=