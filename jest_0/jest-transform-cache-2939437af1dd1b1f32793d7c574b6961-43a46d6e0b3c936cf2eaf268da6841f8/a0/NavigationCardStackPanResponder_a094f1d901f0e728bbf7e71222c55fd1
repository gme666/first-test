0d8d51aee35b058e5f2c27063f21ba41












'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}

var Animated=require('react-native').Animated;
var NavigationAbstractPanResponder=require('./NavigationAbstractPanResponder');

var clamp=require('clamp');









var ANIMATION_DURATION=250;






var POSITION_THRESHOLD=1/3;




var RESPOND_THRESHOLD=15;






var RESPOND_POSITION_MAX_HORIZONTAL=30;
var RESPOND_POSITION_MAX_VERTICAL=null;




var DISTANCE_THRESHOLD=100;




var Directions={
'HORIZONTAL':'horizontal',
'VERTICAL':'vertical'};







var Actions={



BACK:{type:'back'}};var
















NavigationCardStackPanResponder=function(_NavigationAbstractPa){_inherits(NavigationCardStackPanResponder,_NavigationAbstractPa);






function NavigationCardStackPanResponder(
direction,
props)
{_classCallCheck(this,NavigationCardStackPanResponder);var _this=_possibleConstructorReturn(this,(NavigationCardStackPanResponder.__proto__||Object.getPrototypeOf(NavigationCardStackPanResponder)).call(this));

_this._isResponding=false;
_this._isVertical=direction===Directions.VERTICAL;
_this._props=props;
_this._startValue=0;return _this;
}_createClass(NavigationCardStackPanResponder,[{key:'onMoveShouldSetPanResponder',value:function onMoveShouldSetPanResponder(

event,gesture){
var props=this._props;

if(props.navigationState.index!==props.scene.index){
return false;
}

var layout=props.layout;
var isVertical=this._isVertical;
var index=props.navigationState.index;
var currentDragDistance=gesture[isVertical?'dy':'dx'];
var currentDragPosition=gesture[isVertical?'moveY':'moveX'];
var maxDragDistance=isVertical?
layout.height.__getValue():
layout.width.__getValue();

var positionMax=isVertical?
RESPOND_POSITION_MAX_VERTICAL:
RESPOND_POSITION_MAX_HORIZONTAL;

if(positionMax!=null&&currentDragPosition>positionMax){
return false;
}

return(
Math.abs(currentDragDistance)>RESPOND_THRESHOLD&&
maxDragDistance>0&&
index>0);

}},{key:'onPanResponderGrant',value:function onPanResponderGrant()

{var _this2=this;
this._isResponding=false;
this._props.position.stopAnimation(function(value){
_this2._isResponding=true;
_this2._startValue=value;
});
}},{key:'onPanResponderMove',value:function onPanResponderMove(

event,gesture){
if(!this._isResponding){
return;
}

var props=this._props;
var layout=props.layout;
var isVertical=this._isVertical;
var axis=isVertical?'dy':'dx';
var index=props.navigationState.index;
var distance=isVertical?
layout.height.__getValue():
layout.width.__getValue();

var value=clamp(
index-1,
this._startValue-gesture[axis]/distance,
index);


props.position.setValue(value);
}},{key:'onPanResponderRelease',value:function onPanResponderRelease(

event,gesture){var _this3=this;
if(!this._isResponding){
return;
}

this._isResponding=false;

var props=this._props;
var isVertical=this._isVertical;
var axis=isVertical?'dy':'dx';
var index=props.navigationState.index;
var distance=gesture[axis];

props.position.stopAnimation(function(value){
_this3._reset();
if(distance>DISTANCE_THRESHOLD||value<=index-POSITION_THRESHOLD){
props.onNavigate(Actions.BACK);
}
});
}},{key:'onPanResponderTerminate',value:function onPanResponderTerminate()

{
this._isResponding=false;
this._reset();
}},{key:'_reset',value:function _reset()

{
var props=this._props;
Animated.timing(
props.position,
{
toValue:props.navigationState.index,
duration:ANIMATION_DURATION}).

start();
}}]);return NavigationCardStackPanResponder;}(NavigationAbstractPanResponder);


function createPanHandlers(
direction,
props)
{
var responder=new NavigationCardStackPanResponder(direction,props);
return responder.panHandlers;
}

function forHorizontal(
props)
{
return createPanHandlers(Directions.HORIZONTAL,props);
}

function forVertical(
props)
{
return createPanHandlers(Directions.VERTICAL,props);
}

module.exports={

ANIMATION_DURATION:ANIMATION_DURATION,
DISTANCE_THRESHOLD:DISTANCE_THRESHOLD,
POSITION_THRESHOLD:POSITION_THRESHOLD,
RESPOND_THRESHOLD:RESPOND_THRESHOLD,


Actions:Actions,
Directions:Directions,


forHorizontal:forHorizontal,
forVertical:forVertical};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk5hdmlnYXRpb25DYXJkU3RhY2tQYW5SZXNwb25kZXIuanMiXSwibmFtZXMiOlsiQW5pbWF0ZWQiLCJyZXF1aXJlIiwiTmF2aWdhdGlvbkFic3RyYWN0UGFuUmVzcG9uZGVyIiwiY2xhbXAiLCJBTklNQVRJT05fRFVSQVRJT04iLCJQT1NJVElPTl9USFJFU0hPTEQiLCJSRVNQT05EX1RIUkVTSE9MRCIsIlJFU1BPTkRfUE9TSVRJT05fTUFYX0hPUklaT05UQUwiLCJSRVNQT05EX1BPU0lUSU9OX01BWF9WRVJUSUNBTCIsIkRJU1RBTkNFX1RIUkVTSE9MRCIsIkRpcmVjdGlvbnMiLCJBY3Rpb25zIiwiQkFDSyIsInR5cGUiLCJOYXZpZ2F0aW9uQ2FyZFN0YWNrUGFuUmVzcG9uZGVyIiwiZGlyZWN0aW9uIiwicHJvcHMiLCJfaXNSZXNwb25kaW5nIiwiX2lzVmVydGljYWwiLCJWRVJUSUNBTCIsIl9wcm9wcyIsIl9zdGFydFZhbHVlIiwiZXZlbnQiLCJnZXN0dXJlIiwibmF2aWdhdGlvblN0YXRlIiwiaW5kZXgiLCJzY2VuZSIsImxheW91dCIsImlzVmVydGljYWwiLCJjdXJyZW50RHJhZ0Rpc3RhbmNlIiwiY3VycmVudERyYWdQb3NpdGlvbiIsIm1heERyYWdEaXN0YW5jZSIsImhlaWdodCIsIl9fZ2V0VmFsdWUiLCJ3aWR0aCIsInBvc2l0aW9uTWF4IiwiTWF0aCIsImFicyIsInBvc2l0aW9uIiwic3RvcEFuaW1hdGlvbiIsInZhbHVlIiwiYXhpcyIsImRpc3RhbmNlIiwic2V0VmFsdWUiLCJfcmVzZXQiLCJvbk5hdmlnYXRlIiwidGltaW5nIiwidG9WYWx1ZSIsImR1cmF0aW9uIiwic3RhcnQiLCJjcmVhdGVQYW5IYW5kbGVycyIsInJlc3BvbmRlciIsInBhbkhhbmRsZXJzIiwiZm9ySG9yaXpvbnRhbCIsIkhPUklaT05UQUwiLCJmb3JWZXJ0aWNhbCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQVlBLGE7O0FBRUEs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K0NDLEtBQS9DLENBQWxCO0FBQ0EsTUFBT21DLFdBQVVDLFdBQWpCO0FBQ0Q7O0FBRUQsUUFBU0MsY0FBVDtBQUNFckMsS0FERjtBQUU0QjtBQUMxQixNQUFPa0MsbUJBQWtCeEMsV0FBVzRDLFVBQTdCLENBQXlDdEMsS0FBekMsQ0FBUDtBQUNEOztBQUVELFFBQVN1QyxZQUFUO0FBQ0V2QyxLQURGO0FBRTRCO0FBQzFCLE1BQU9rQyxtQkFBa0J4QyxXQUFXUyxRQUE3QixDQUF1Q0gsS0FBdkMsQ0FBUDtBQUNEOztBQUVEd0MsT0FBT0MsT0FBUCxDQUFpQjs7QUFFZnJELHFDQUZlO0FBR2ZLLHFDQUhlO0FBSWZKLHFDQUplO0FBS2ZDLG1DQUxlOzs7QUFRZkssZUFSZTtBQVNmRCxxQkFUZTs7O0FBWWYyQywyQkFaZTtBQWFmRSx1QkFiZSxDQUFqQiIsImZpbGUiOiJOYXZpZ2F0aW9uQ2FyZFN0YWNrUGFuUmVzcG9uZGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTMtcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuIEFuIGFkZGl0aW9uYWwgZ3JhbnRcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxuICpcbiAqIEBwcm92aWRlc01vZHVsZSBOYXZpZ2F0aW9uQ2FyZFN0YWNrUGFuUmVzcG9uZGVyXG4gKiBAZmxvd1xuICogQHR5cGVjaGVja3NcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBBbmltYXRlZCA9IHJlcXVpcmUoJ3JlYWN0LW5hdGl2ZScpLkFuaW1hdGVkO1xuY29uc3QgTmF2aWdhdGlvbkFic3RyYWN0UGFuUmVzcG9uZGVyID0gcmVxdWlyZSgnLi9OYXZpZ2F0aW9uQWJzdHJhY3RQYW5SZXNwb25kZXInKTtcblxuY29uc3QgY2xhbXAgPSByZXF1aXJlKCdjbGFtcCcpO1xuXG5pbXBvcnQgdHlwZSB7XG4gIE5hdmlnYXRpb25QYW5QYW5IYW5kbGVycyxcbiAgTmF2aWdhdGlvblNjZW5lUmVuZGVyZXJQcm9wcyxcbn0gZnJvbSAnTmF2aWdhdGlvblR5cGVEZWZpbml0aW9uJztcblxuLyoqXG4gKiBUaGUgZHVyYXRpb24gb2YgdGhlIGNhcmQgYW5pbWF0aW9uIGluIG1pbGxpc2Vjb25kcy5cbiAqL1xuY29uc3QgQU5JTUFUSU9OX0RVUkFUSU9OID0gMjUwO1xuXG4vKipcbiAqIFRoZSB0aHJlc2hvbGQgdG8gaW52b2tlIHRoZSBgb25OYXZpZ2F0ZWAgYWN0aW9uLlxuICogRm9yIGluc3RhbmNlLCBgMSAvIDNgIG1lYW5zIHRoYXQgbW92aW5nIGdyZWF0ZXIgdGhhbiAxIC8gMyBvZiB0aGUgd2lkdGggb2ZcbiAqIHRoZSB2aWV3IHdpbGwgbmF2aWdhdGUuXG4gKi9cbmNvbnN0IFBPU0lUSU9OX1RIUkVTSE9MRCA9IDEgLyAzO1xuXG4vKipcbiAqIFRoZSB0aHJlc2hvbGQgKGluIHBpeGVscykgdG8gc3RhcnQgdGhlIGdlc3R1cmUgYWN0aW9uLlxuICovXG5jb25zdCBSRVNQT05EX1RIUkVTSE9MRCA9IDE1O1xuXG4vKipcbiAqIFRoZSBkaXN0YW5jZSBmcm9tIHRoZSBlZGdlIG9mIHRoZSBuYXZpZ2F0b3Igd2hpY2ggZ2VzdHVyZSByZXNwb25zZSBjYW4gc3RhcnQgZm9yLlxuICogRm9yIGhvcml6b250YWwgc2Nyb2xsIHZpZXdzLCBhIGRpc3RhbmNlIG9mIDMwIGZyb20gdGhlIGxlZnQgb2YgdGhlIHNjcmVlbiBpcyB0aGVcbiAqIHN0YW5kYXJkIG1heGltdW0gcG9zaXRpb24gdG8gc3RhcnQgdG91Y2ggcmVzcG9uc2l2ZW5lc3MuXG4gKi9cbmNvbnN0IFJFU1BPTkRfUE9TSVRJT05fTUFYX0hPUklaT05UQUwgPSAzMDtcbmNvbnN0IFJFU1BPTkRfUE9TSVRJT05fTUFYX1ZFUlRJQ0FMID0gbnVsbDtcblxuLyoqXG4gKiBUaGUgdGhyZXNob2xkIChpbiBwaXhlbHMpIHRvIGZpbmlzaCB0aGUgZ2VzdHVyZSBhY3Rpb24uXG4gKi9cbmNvbnN0IERJU1RBTkNFX1RIUkVTSE9MRCA9IDEwMDtcblxuLyoqXG4gKiBQcmltaXRpdmUgZ2VzdHVyZSBkaXJlY3Rpb25zLlxuICovXG5jb25zdCBEaXJlY3Rpb25zID0ge1xuICAnSE9SSVpPTlRBTCc6ICdob3Jpem9udGFsJyxcbiAgJ1ZFUlRJQ0FMJzogJ3ZlcnRpY2FsJyxcbn07XG5cbmV4cG9ydCB0eXBlIE5hdmlnYXRpb25HZXN0dXJlRGlyZWN0aW9uID0gICdob3Jpem9udGFsJyB8ICd2ZXJ0aWNhbCc7XG5cbi8qKlxuICogUHJpbWl0aXZlIGdlc3R1cmUgYWN0aW9ucy5cbiAqL1xuY29uc3QgQWN0aW9ucyA9IHtcbiAgLy8gVGhlIGdlc3R1cmUgdG8gbmF2aWdhdGUgYmFja3dhcmQuXG4gIC8vIFRoaXMgaXMgZG9uZSBieSBzd2lwaW5nIGZyb20gdGhlIGxlZnQgdG8gdGhlIHJpZ2h0IG9yIGZyb20gdGhlIHRvcCB0byB0aGVcbiAgLy8gYm90dG9tLlxuICBCQUNLOiB7dHlwZTogJ2JhY2snfSxcbn07XG5cbi8qKlxuICogUGFuIHJlc3BvbmRlciB0aGF0IGhhbmRsZXMgZ2VzdHVyZSBmb3IgYSBjYXJkIGluIHRoZSBjYXJkcyBzdGFjay5cbiAqXG4gKiAgICAgKy0tLS0tLS0tLS0tLStcbiAqICAgKy0rICAgICAgICAgICAgfFxuICogKy0rIHwgICAgICAgICAgICB8XG4gKiB8IHwgfCAgICAgICAgICAgIHxcbiAqIHwgfCB8ICBGb2N1c2VkICAgfFxuICogfCB8IHwgICBDYXJkICAgICB8XG4gKiB8IHwgfCAgICAgICAgICAgIHxcbiAqICstKyB8ICAgICAgICAgICAgfFxuICogICArLSsgICAgICAgICAgICB8XG4gKiAgICAgKy0tLS0tLS0tLS0tLStcbiAqL1xuY2xhc3MgTmF2aWdhdGlvbkNhcmRTdGFja1BhblJlc3BvbmRlciBleHRlbmRzIE5hdmlnYXRpb25BYnN0cmFjdFBhblJlc3BvbmRlciB7XG5cbiAgX2lzUmVzcG9uZGluZzogYm9vbGVhbjtcbiAgX2lzVmVydGljYWw6IGJvb2xlYW47XG4gIF9wcm9wczogTmF2aWdhdGlvblNjZW5lUmVuZGVyZXJQcm9wcztcbiAgX3N0YXJ0VmFsdWU6IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBkaXJlY3Rpb246IE5hdmlnYXRpb25HZXN0dXJlRGlyZWN0aW9uLFxuICAgIHByb3BzOiBOYXZpZ2F0aW9uU2NlbmVSZW5kZXJlclByb3BzLFxuICApIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX2lzUmVzcG9uZGluZyA9IGZhbHNlO1xuICAgIHRoaXMuX2lzVmVydGljYWwgPSBkaXJlY3Rpb24gPT09IERpcmVjdGlvbnMuVkVSVElDQUw7XG4gICAgdGhpcy5fcHJvcHMgPSBwcm9wcztcbiAgICB0aGlzLl9zdGFydFZhbHVlID0gMDtcbiAgfVxuXG4gIG9uTW92ZVNob3VsZFNldFBhblJlc3BvbmRlcihldmVudDogYW55LCBnZXN0dXJlOiBhbnkpOiBib29sZWFuIHtcbiAgICBjb25zdCBwcm9wcyA9IHRoaXMuX3Byb3BzO1xuXG4gICAgaWYgKHByb3BzLm5hdmlnYXRpb25TdGF0ZS5pbmRleCAhPT0gcHJvcHMuc2NlbmUuaW5kZXgpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBsYXlvdXQgPSBwcm9wcy5sYXlvdXQ7XG4gICAgY29uc3QgaXNWZXJ0aWNhbCA9IHRoaXMuX2lzVmVydGljYWw7XG4gICAgY29uc3QgaW5kZXggPSBwcm9wcy5uYXZpZ2F0aW9uU3RhdGUuaW5kZXg7XG4gICAgY29uc3QgY3VycmVudERyYWdEaXN0YW5jZSA9IGdlc3R1cmVbaXNWZXJ0aWNhbCA/ICdkeScgOiAnZHgnXTtcbiAgICBjb25zdCBjdXJyZW50RHJhZ1Bvc2l0aW9uID0gZ2VzdHVyZVtpc1ZlcnRpY2FsID8gJ21vdmVZJyA6ICdtb3ZlWCddO1xuICAgIGNvbnN0IG1heERyYWdEaXN0YW5jZSA9IGlzVmVydGljYWwgP1xuICAgICAgbGF5b3V0LmhlaWdodC5fX2dldFZhbHVlKCkgOlxuICAgICAgbGF5b3V0LndpZHRoLl9fZ2V0VmFsdWUoKTtcblxuICAgIGNvbnN0IHBvc2l0aW9uTWF4ID0gaXNWZXJ0aWNhbCA/XG4gICAgICBSRVNQT05EX1BPU0lUSU9OX01BWF9WRVJUSUNBTCA6XG4gICAgICBSRVNQT05EX1BPU0lUSU9OX01BWF9IT1JJWk9OVEFMO1xuXG4gICAgaWYgKHBvc2l0aW9uTWF4ICE9IG51bGwgJiYgY3VycmVudERyYWdQb3NpdGlvbiA+IHBvc2l0aW9uTWF4KSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgIE1hdGguYWJzKGN1cnJlbnREcmFnRGlzdGFuY2UpID4gUkVTUE9ORF9USFJFU0hPTEQgJiZcbiAgICAgIG1heERyYWdEaXN0YW5jZSA+IDAgJiZcbiAgICAgIGluZGV4ID4gMFxuICAgICk7XG4gIH1cblxuICBvblBhblJlc3BvbmRlckdyYW50KCk6IHZvaWQge1xuICAgIHRoaXMuX2lzUmVzcG9uZGluZyA9IGZhbHNlO1xuICAgIHRoaXMuX3Byb3BzLnBvc2l0aW9uLnN0b3BBbmltYXRpb24oKHZhbHVlOiBudW1iZXIpID0+IHtcbiAgICAgIHRoaXMuX2lzUmVzcG9uZGluZyA9IHRydWU7XG4gICAgICB0aGlzLl9zdGFydFZhbHVlID0gdmFsdWU7XG4gICAgfSk7XG4gIH1cblxuICBvblBhblJlc3BvbmRlck1vdmUoZXZlbnQ6IGFueSwgZ2VzdHVyZTogYW55KTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLl9pc1Jlc3BvbmRpbmcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBwcm9wcyA9IHRoaXMuX3Byb3BzO1xuICAgIGNvbnN0IGxheW91dCA9IHByb3BzLmxheW91dDtcbiAgICBjb25zdCBpc1ZlcnRpY2FsID0gdGhpcy5faXNWZXJ0aWNhbDtcbiAgICBjb25zdCBheGlzID0gaXNWZXJ0aWNhbCA/ICdkeScgOiAnZHgnO1xuICAgIGNvbnN0IGluZGV4ID0gcHJvcHMubmF2aWdhdGlvblN0YXRlLmluZGV4O1xuICAgIGNvbnN0IGRpc3RhbmNlID0gaXNWZXJ0aWNhbCA/XG4gICAgICBsYXlvdXQuaGVpZ2h0Ll9fZ2V0VmFsdWUoKSA6XG4gICAgICBsYXlvdXQud2lkdGguX19nZXRWYWx1ZSgpO1xuXG4gICAgY29uc3QgdmFsdWUgPSBjbGFtcChcbiAgICAgIGluZGV4IC0gMSxcbiAgICAgIHRoaXMuX3N0YXJ0VmFsdWUgLSAoZ2VzdHVyZVtheGlzXSAvIGRpc3RhbmNlKSxcbiAgICAgIGluZGV4XG4gICAgKTtcblxuICAgIHByb3BzLnBvc2l0aW9uLnNldFZhbHVlKHZhbHVlKTtcbiAgfVxuXG4gIG9uUGFuUmVzcG9uZGVyUmVsZWFzZShldmVudDogYW55LCBnZXN0dXJlOiBhbnkpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuX2lzUmVzcG9uZGluZykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuX2lzUmVzcG9uZGluZyA9IGZhbHNlO1xuXG4gICAgY29uc3QgcHJvcHMgPSB0aGlzLl9wcm9wcztcbiAgICBjb25zdCBpc1ZlcnRpY2FsID0gdGhpcy5faXNWZXJ0aWNhbDtcbiAgICBjb25zdCBheGlzID0gaXNWZXJ0aWNhbCA/ICdkeScgOiAnZHgnO1xuICAgIGNvbnN0IGluZGV4ID0gcHJvcHMubmF2aWdhdGlvblN0YXRlLmluZGV4O1xuICAgIGNvbnN0IGRpc3RhbmNlID0gZ2VzdHVyZVtheGlzXTtcblxuICAgIHByb3BzLnBvc2l0aW9uLnN0b3BBbmltYXRpb24oKHZhbHVlOiBudW1iZXIpID0+IHtcbiAgICAgIHRoaXMuX3Jlc2V0KCk7XG4gICAgICAgaWYgKGRpc3RhbmNlID4gRElTVEFOQ0VfVEhSRVNIT0xEICB8fCB2YWx1ZSA8PSBpbmRleCAtIFBPU0lUSU9OX1RIUkVTSE9MRCkge1xuICAgICAgICBwcm9wcy5vbk5hdmlnYXRlKEFjdGlvbnMuQkFDSyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBvblBhblJlc3BvbmRlclRlcm1pbmF0ZSgpOiB2b2lkIHtcbiAgICB0aGlzLl9pc1Jlc3BvbmRpbmcgPSBmYWxzZTtcbiAgICB0aGlzLl9yZXNldCgpO1xuICB9XG5cbiAgX3Jlc2V0KCk6IHZvaWQge1xuICAgIGNvbnN0IHByb3BzID0gdGhpcy5fcHJvcHM7XG4gICAgQW5pbWF0ZWQudGltaW5nKFxuICAgICAgcHJvcHMucG9zaXRpb24sXG4gICAgICB7XG4gICAgICAgIHRvVmFsdWU6IHByb3BzLm5hdmlnYXRpb25TdGF0ZS5pbmRleCxcbiAgICAgICAgZHVyYXRpb246IEFOSU1BVElPTl9EVVJBVElPTixcbiAgICAgIH1cbiAgICApLnN0YXJ0KCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gY3JlYXRlUGFuSGFuZGxlcnMoXG4gIGRpcmVjdGlvbjogTmF2aWdhdGlvbkdlc3R1cmVEaXJlY3Rpb24sXG4gIHByb3BzOiBOYXZpZ2F0aW9uU2NlbmVSZW5kZXJlclByb3BzLFxuKTogTmF2aWdhdGlvblBhblBhbkhhbmRsZXJzIHtcbiAgY29uc3QgcmVzcG9uZGVyID0gbmV3IE5hdmlnYXRpb25DYXJkU3RhY2tQYW5SZXNwb25kZXIoZGlyZWN0aW9uLCBwcm9wcyk7XG4gIHJldHVybiByZXNwb25kZXIucGFuSGFuZGxlcnM7XG59XG5cbmZ1bmN0aW9uIGZvckhvcml6b250YWwoXG4gIHByb3BzOiBOYXZpZ2F0aW9uU2NlbmVSZW5kZXJlclByb3BzLFxuKTogTmF2aWdhdGlvblBhblBhbkhhbmRsZXJzIHtcbiAgcmV0dXJuIGNyZWF0ZVBhbkhhbmRsZXJzKERpcmVjdGlvbnMuSE9SSVpPTlRBTCwgcHJvcHMpO1xufVxuXG5mdW5jdGlvbiBmb3JWZXJ0aWNhbChcbiAgcHJvcHM6IE5hdmlnYXRpb25TY2VuZVJlbmRlcmVyUHJvcHMsXG4pOiBOYXZpZ2F0aW9uUGFuUGFuSGFuZGxlcnMge1xuICByZXR1cm4gY3JlYXRlUGFuSGFuZGxlcnMoRGlyZWN0aW9ucy5WRVJUSUNBTCwgcHJvcHMpO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgLy8gY29uc3RhbnRzXG4gIEFOSU1BVElPTl9EVVJBVElPTixcbiAgRElTVEFOQ0VfVEhSRVNIT0xELFxuICBQT1NJVElPTl9USFJFU0hPTEQsXG4gIFJFU1BPTkRfVEhSRVNIT0xELFxuXG4gIC8vIGVudW1zXG4gIEFjdGlvbnMsXG4gIERpcmVjdGlvbnMsXG5cbiAgLy8gbWV0aG9kcy5cbiAgZm9ySG9yaXpvbnRhbCxcbiAgZm9yVmVydGljYWwsXG59O1xuIl19