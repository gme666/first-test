ce8b5e3a80f62ddba24bcf905a68641c
Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _react=require('react');var _react2=_interopRequireDefault(_react);
var _reactNative=require('react-native');


var _propTypes=require('prop-types');var _propTypes2=_interopRequireDefault(_propTypes);
var _xdate=require('xdate');var _xdate2=_interopRequireDefault(_xdate);

var _interface=require('../interface');
var _style=require('./style');var _style2=_interopRequireDefault(_style);
var _dateutils=require('../dateutils');var _dateutils2=_interopRequireDefault(_dateutils);
var _calendar=require('../calendar');var _calendar2=_interopRequireDefault(_calendar);
var _item=require('./item');var _item2=_interopRequireDefault(_item);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}

var calendarHeight=360;var
CalendarList=function(_Component){_inherits(CalendarList,_Component);













function CalendarList(props){_classCallCheck(this,CalendarList);var _this=_possibleConstructorReturn(this,(CalendarList.__proto__||Object.getPrototypeOf(CalendarList)).call(this,
props));
_this.pastScrollRange=props.pastScrollRange===undefined?50:props.pastScrollRange;
_this.futureScrollRange=props.futureScrollRange===undefined?50:props.futureScrollRange;
_this.style=(0,_style2.default)(props.theme);
var rows=[];
var texts=[];
var date=(0,_interface.parseDate)(props.current)||(0,_xdate2.default)();
for(var i=0;i<=_this.pastScrollRange+_this.futureScrollRange;i++){
var text=date.clone().addMonths(i-_this.pastScrollRange).toString('MMM yyyy');
rows.push(text);
texts.push(text);
}
rows[_this.pastScrollRange]=date;
rows[_this.pastScrollRange+1]=date.clone().addMonths(1,true);
if(_this.pastScrollRange){
rows[_this.pastScrollRange-1]=date.clone().addMonths(-1,true);
}else{
rows[_this.pastScrollRange+2]=date.clone().addMonths(2,true);
}
_this.state={
rows:rows,
texts:texts,
openDate:date,
initialized:false};

_this.lastScrollPosition=-1000;return _this;
}_createClass(CalendarList,[{key:'scrollToDay',value:function scrollToDay(

d,offset,animated){
var day=(0,_interface.parseDate)(d);
var diffMonths=Math.round(this.state.openDate.clone().setDate(1).diffMonths(day.clone().setDate(1)));
var scrollAmount=calendarHeight*this.pastScrollRange+diffMonths*calendarHeight+(offset||0);
var week=0;
var days=_dateutils2.default.page(day,this.props.firstDay);
for(var i=0;i<days.length;i++){
week=Math.floor(i/7);
if(_dateutils2.default.sameDate(days[i],day)){
scrollAmount+=46*week;
break;
}
}
this.listView.scrollToOffset({offset:scrollAmount,animated:animated});
}},{key:'scrollToMonth',value:function scrollToMonth(

m){
var month=(0,_interface.parseDate)(m);
var scrollTo=month||this.state.openDate;
var diffMonths=this.state.openDate.diffMonths(scrollTo);
diffMonths=diffMonths<0?Math.ceil(diffMonths):Math.floor(diffMonths);
var scrollAmount=calendarHeight*this.pastScrollRange+diffMonths*calendarHeight;


this.listView.scrollToOffset({offset:scrollAmount,animated:false});
}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(

props){
var current=(0,_interface.parseDate)(this.props.current);
var nextCurrent=(0,_interface.parseDate)(props.current);
if(nextCurrent&&current&&nextCurrent.getTime()!==current.getTime()){
this.scrollToMonth(nextCurrent);
}

var rowclone=this.state.rows;
var newrows=[];
for(var i=0;i<rowclone.length;i++){
var val=this.state.texts[i];
if(rowclone[i].getTime){
val=rowclone[i].clone();
val.propbump=rowclone[i].propbump?rowclone[i].propbump+1:1;
}
newrows.push(val);
}
this.setState({
rows:newrows});

}},{key:'onViewableItemsChanged',value:function onViewableItemsChanged(_ref)

{var viewableItems=_ref.viewableItems;
function rowIsCloseToViewable(index,distance){
for(var i=0;i<viewableItems.length;i++){
if(Math.abs(index-parseInt(viewableItems[i].index))<=distance){
return true;
}
}
return false;
}

var rowclone=this.state.rows;
var newrows=[];
var visibleMonths=[];
for(var i=0;i<rowclone.length;i++){
var val=rowclone[i];
var rowShouldBeRendered=rowIsCloseToViewable(i,1);
if(rowShouldBeRendered&&!rowclone[i].getTime){
val=this.state.openDate.clone().addMonths(i-this.pastScrollRange,true);
}else if(!rowShouldBeRendered){
val=this.state.texts[i];
}
newrows.push(val);
if(rowIsCloseToViewable(i,0)){
visibleMonths.push((0,_interface.xdateToData)(val));
}
}
if(this.props.onVisibleMonthsChange){
this.props.onVisibleMonthsChange(visibleMonths);
}
this.setState({
rows:newrows});

}},{key:'renderCalendar',value:function renderCalendar(_ref2)

{var item=_ref2.item;
return _react2.default.createElement(_item2.default,_extends({item:item,calendarHeight:calendarHeight},this.props));
}},{key:'getItemLayout',value:function getItemLayout(

data,index){
return{length:calendarHeight,offset:calendarHeight*index,index:index};
}},{key:'getMonthIndex',value:function getMonthIndex(

month){
var diffMonths=this.state.openDate.diffMonths(month)+this.pastScrollRange;
return diffMonths;
}},{key:'render',value:function render()

{var _this2=this;
return(
_react2.default.createElement(_reactNative.FlatList,{
ref:function ref(c){return _this2.listView=c;},

style:[this.style.container,this.props.style],
initialListSize:this.pastScrollRange*this.futureScrollRange+1,
data:this.state.rows,


removeClippedSubviews:_reactNative.Platform.OS==='android'?false:true,
pageSize:1,
onViewableItemsChanged:this.onViewableItemsChanged.bind(this),
renderItem:this.renderCalendar.bind(this),
showsVerticalScrollIndicator:false,
scrollEnabled:this.props.scrollingEnabled!==undefined?this.props.scrollingEnabled:true,
keyExtractor:function keyExtractor(item,index){return index;},
initialScrollIndex:this.state.openDate?this.getMonthIndex(this.state.openDate):false,
getItemLayout:this.getItemLayout}));


}}]);return CalendarList;}(_react.Component);CalendarList.propTypes=_extends({},_calendar2.default.propTypes,{pastScrollRange:_propTypes2.default.number,futureScrollRange:_propTypes2.default.number,scrollEnabled:_propTypes2.default.bool});exports.default=


CalendarList;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImNhbGVuZGFySGVpZ2h0IiwiQ2FsZW5kYXJMaXN0IiwicHJvcHMiLCJwYXN0U2Nyb2xsUmFuZ2UiLCJ1bmRlZmluZWQiLCJmdXR1cmVTY3JvbGxSYW5nZSIsInN0eWxlIiwidGhlbWUiLCJyb3dzIiwidGV4dHMiLCJkYXRlIiwiY3VycmVudCIsImkiLCJ0ZXh0IiwiY2xvbmUiLCJhZGRNb250aHMiLCJ0b1N0cmluZyIsInB1c2giLCJzdGF0ZSIsIm9wZW5EYXRlIiwiaW5pdGlhbGl6ZWQiLCJsYXN0U2Nyb2xsUG9zaXRpb24iLCJkIiwib2Zmc2V0IiwiYW5pbWF0ZWQiLCJkYXkiLCJkaWZmTW9udGhzIiwiTWF0aCIsInJvdW5kIiwic2V0RGF0ZSIsInNjcm9sbEFtb3VudCIsIndlZWsiLCJkYXlzIiwicGFnZSIsImZpcnN0RGF5IiwibGVuZ3RoIiwiZmxvb3IiLCJzYW1lRGF0ZSIsImxpc3RWaWV3Iiwic2Nyb2xsVG9PZmZzZXQiLCJtIiwibW9udGgiLCJzY3JvbGxUbyIsImNlaWwiLCJuZXh0Q3VycmVudCIsImdldFRpbWUiLCJzY3JvbGxUb01vbnRoIiwicm93Y2xvbmUiLCJuZXdyb3dzIiwidmFsIiwicHJvcGJ1bXAiLCJzZXRTdGF0ZSIsInZpZXdhYmxlSXRlbXMiLCJyb3dJc0Nsb3NlVG9WaWV3YWJsZSIsImluZGV4IiwiZGlzdGFuY2UiLCJhYnMiLCJwYXJzZUludCIsInZpc2libGVNb250aHMiLCJyb3dTaG91bGRCZVJlbmRlcmVkIiwib25WaXNpYmxlTW9udGhzQ2hhbmdlIiwiaXRlbSIsImRhdGEiLCJjIiwiY29udGFpbmVyIiwiT1MiLCJvblZpZXdhYmxlSXRlbXNDaGFuZ2VkIiwiYmluZCIsInJlbmRlckNhbGVuZGFyIiwic2Nyb2xsaW5nRW5hYmxlZCIsImdldE1vbnRoSW5kZXgiLCJnZXRJdGVtTGF5b3V0IiwicHJvcFR5cGVzIiwibnVtYmVyIiwic2Nyb2xsRW5hYmxlZCIsImJvb2wiXSwibWFwcGlu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RFA7O0FBR0UsTUFBTyxDQUFDLEtBQUt6RCxLQUFMLENBQVcwRCxTQUFaLENBQXVCLEtBQUs5RCxLQUFMLENBQVdJLEtBQWxDLENBSFQ7QUFJRSxnQkFBaUIsS0FBS0gsZUFBTCxDQUF1QixLQUFLRSxpQkFBNUIsQ0FBZ0QsQ0FKbkU7QUFLRSxLQUFNLEtBQUthLEtBQUwsQ0FBV1YsSUFMbkI7OztBQVFFLHNCQUF1QixzQkFBU3lELEVBQVQsR0FBZ0IsU0FBaEIsQ0FBNEIsS0FBNUIsQ0FBb0MsSUFSN0Q7QUFTRSxTQUFVLENBVFo7QUFVRSx1QkFBd0IsS0FBS0Msc0JBQUwsQ0FBNEJDLElBQTVCLENBQWlDLElBQWpDLENBVjFCO0FBV0UsV0FBWSxLQUFLQyxjQUFMLENBQW9CRCxJQUFwQixDQUF5QixJQUF6QixDQVhkO0FBWUUsNkJBQThCLEtBWmhDO0FBYUUsY0FBZSxLQUFLakUsS0FBTCxDQUFXbUUsZ0JBQVgsR0FBZ0NqRSxTQUFoQyxDQUE0QyxLQUFLRixLQUFMLENBQVdtRSxnQkFBdkQsQ0FBMEUsSUFiM0Y7QUFjRSxhQUFjLHNCQUFDUixJQUFELENBQU9QLEtBQVAsUUFBaUJBLE1BQWpCLEVBZGhCO0FBZUUsbUJBQW9CLEtBQUtwQyxLQUFMLENBQVdDLFFBQVgsQ0FBc0IsS0FBS21ELGFBQUwsQ0FBbUIsS0FBS3BELEtBQUwsQ0FBV0MsUUFBOUIsQ0FBdEIsQ0FBZ0UsS0FmdEY7QUFnQkUsY0FBZSxLQUFLb0QsYUFoQnRCLEVBREY7OztBQW9CRCxDLDRDQWhLR3RFLFksQ0FDR3VFLFMsYUFDRixtQkFBU0EsUyxFQUdackUsZ0JBQWlCLG9CQUFVc0UsTSxDQUczQnBFLGtCQUFtQixvQkFBVW9FLE0sQ0FHN0JDLGNBQWUsb0JBQVVDLEk7OztBQXdKZDFFLFkiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHtDb21wb25lbnR9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7XG4gIEZsYXRMaXN0LCBQbGF0Zm9ybVxufSBmcm9tICdyZWFjdC1uYXRpdmUnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBYRGF0ZSBmcm9tICd4ZGF0ZSc7XG5cbmltcG9ydCB7eGRhdGVUb0RhdGEsIHBhcnNlRGF0ZX0gZnJvbSAnLi4vaW50ZXJmYWNlJztcbmltcG9ydCBzdHlsZUNvbnN0cnVjdG9yIGZyb20gJy4vc3R5bGUnO1xuaW1wb3J0IGRhdGV1dGlscyBmcm9tICcuLi9kYXRldXRpbHMnO1xuaW1wb3J0IENhbGVuZGFyIGZyb20gJy4uL2NhbGVuZGFyJztcbmltcG9ydCBDYWxlbmRhckxpc3RJdGVtIGZyb20gJy4vaXRlbSc7XG5cbmNvbnN0IGNhbGVuZGFySGVpZ2h0ID0gMzYwO1xuY2xhc3MgQ2FsZW5kYXJMaXN0IGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICAuLi5DYWxlbmRhci5wcm9wVHlwZXMsXG5cbiAgICAvLyBNYXggYW1vdW50IG9mIG1vbnRocyBhbGxvd2VkIHRvIHNjcm9sbCB0byB0aGUgcGFzdC4gRGVmYXVsdCA9IDUwXG4gICAgcGFzdFNjcm9sbFJhbmdlOiBQcm9wVHlwZXMubnVtYmVyLFxuXG4gICAgLy8gTWF4IGFtb3VudCBvZiBtb250aHMgYWxsb3dlZCB0byBzY3JvbGwgdG8gdGhlIGZ1dHVyZS4gRGVmYXVsdCA9IDUwXG4gICAgZnV0dXJlU2Nyb2xsUmFuZ2U6IFByb3BUeXBlcy5udW1iZXIsXG5cbiAgICAvLyBFbmFibGUgb3IgZGlzYWJsZSBzY3JvbGxpbmcgb2YgY2FsZW5kYXIgbGlzdFxuICAgIHNjcm9sbEVuYWJsZWQ6IFByb3BUeXBlcy5ib29sLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIHRoaXMucGFzdFNjcm9sbFJhbmdlID0gcHJvcHMucGFzdFNjcm9sbFJhbmdlID09PSB1bmRlZmluZWQgPyA1MCA6IHByb3BzLnBhc3RTY3JvbGxSYW5nZTtcbiAgICB0aGlzLmZ1dHVyZVNjcm9sbFJhbmdlID0gcHJvcHMuZnV0dXJlU2Nyb2xsUmFuZ2UgPT09IHVuZGVmaW5lZCA/IDUwIDogcHJvcHMuZnV0dXJlU2Nyb2xsUmFuZ2U7XG4gICAgdGhpcy5zdHlsZSA9IHN0eWxlQ29uc3RydWN0b3IocHJvcHMudGhlbWUpO1xuICAgIGNvbnN0IHJvd3MgPSBbXTtcbiAgICBjb25zdCB0ZXh0cyA9IFtdO1xuICAgIGNvbnN0IGRhdGUgPSBwYXJzZURhdGUocHJvcHMuY3VycmVudCkgfHwgWERhdGUoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSB0aGlzLnBhc3RTY3JvbGxSYW5nZSArIHRoaXMuZnV0dXJlU2Nyb2xsUmFuZ2U7IGkrKykge1xuICAgICAgY29uc3QgdGV4dCA9IGRhdGUuY2xvbmUoKS5hZGRNb250aHMoaSAtIHRoaXMucGFzdFNjcm9sbFJhbmdlKS50b1N0cmluZygnTU1NIHl5eXknKTtcbiAgICAgIHJvd3MucHVzaCh0ZXh0KTtcbiAgICAgIHRleHRzLnB1c2godGV4dCk7XG4gICAgfVxuICAgIHJvd3NbdGhpcy5wYXN0U2Nyb2xsUmFuZ2VdID0gZGF0ZTtcbiAgICByb3dzW3RoaXMucGFzdFNjcm9sbFJhbmdlICsgMV0gPSBkYXRlLmNsb25lKCkuYWRkTW9udGhzKDEsIHRydWUpO1xuICAgIGlmICh0aGlzLnBhc3RTY3JvbGxSYW5nZSkge1xuICAgICAgcm93c1t0aGlzLnBhc3RTY3JvbGxSYW5nZSAtIDFdID0gZGF0ZS5jbG9uZSgpLmFkZE1vbnRocygtMSwgdHJ1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJvd3NbdGhpcy5wYXN0U2Nyb2xsUmFuZ2UgKyAyXSA9IGRhdGUuY2xvbmUoKS5hZGRNb250aHMoMiwgdHJ1ZSk7XG4gICAgfVxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICByb3dzLFxuICAgICAgdGV4dHMsXG4gICAgICBvcGVuRGF0ZTogZGF0ZSxcbiAgICAgIGluaXRpYWxpemVkOiBmYWxzZVxuICAgIH07XG4gICAgdGhpcy5sYXN0U2Nyb2xsUG9zaXRpb24gPSAtMTAwMDtcbiAgfVxuXG4gIHNjcm9sbFRvRGF5KGQsIG9mZnNldCwgYW5pbWF0ZWQpIHtcbiAgICBjb25zdCBkYXkgPSBwYXJzZURhdGUoZCk7XG4gICAgY29uc3QgZGlmZk1vbnRocyA9IE1hdGgucm91bmQodGhpcy5zdGF0ZS5vcGVuRGF0ZS5jbG9uZSgpLnNldERhdGUoMSkuZGlmZk1vbnRocyhkYXkuY2xvbmUoKS5zZXREYXRlKDEpKSk7XG4gICAgbGV0IHNjcm9sbEFtb3VudCA9IChjYWxlbmRhckhlaWdodCAqIHRoaXMucGFzdFNjcm9sbFJhbmdlKSArIChkaWZmTW9udGhzICogY2FsZW5kYXJIZWlnaHQpICsgKG9mZnNldCB8fCAwKTtcbiAgICBsZXQgd2VlayA9IDA7XG4gICAgY29uc3QgZGF5cyA9IGRhdGV1dGlscy5wYWdlKGRheSwgdGhpcy5wcm9wcy5maXJzdERheSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB3ZWVrID0gTWF0aC5mbG9vcihpIC8gNyk7XG4gICAgICBpZiAoZGF0ZXV0aWxzLnNhbWVEYXRlKGRheXNbaV0sIGRheSkpIHtcbiAgICAgICAgc2Nyb2xsQW1vdW50ICs9IDQ2ICogd2VlaztcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMubGlzdFZpZXcuc2Nyb2xsVG9PZmZzZXQoe29mZnNldDogc2Nyb2xsQW1vdW50LCBhbmltYXRlZH0pO1xuICB9XG5cbiAgc2Nyb2xsVG9Nb250aChtKSB7XG4gICAgY29uc3QgbW9udGggPSBwYXJzZURhdGUobSk7XG4gICAgY29uc3Qgc2Nyb2xsVG8gPSBtb250aCB8fCB0aGlzLnN0YXRlLm9wZW5EYXRlO1xuICAgIGxldCBkaWZmTW9udGhzID0gdGhpcy5zdGF0ZS5vcGVuRGF0ZS5kaWZmTW9udGhzKHNjcm9sbFRvKTtcbiAgICBkaWZmTW9udGhzID0gZGlmZk1vbnRocyA8IDAgPyBNYXRoLmNlaWwoZGlmZk1vbnRocykgOiBNYXRoLmZsb29yKGRpZmZNb250aHMpO1xuICAgIGNvbnN0IHNjcm9sbEFtb3VudCA9IChjYWxlbmRhckhlaWdodCAqIHRoaXMucGFzdFNjcm9sbFJhbmdlKSArIChkaWZmTW9udGhzICogY2FsZW5kYXJIZWlnaHQpO1xuICAgIC8vY29uc29sZS5sb2cobW9udGgsIHRoaXMuc3RhdGUub3BlbkRhdGUpO1xuICAgIC8vY29uc29sZS5sb2coc2Nyb2xsQW1vdW50LCBkaWZmTW9udGhzKTtcbiAgICB0aGlzLmxpc3RWaWV3LnNjcm9sbFRvT2Zmc2V0KHtvZmZzZXQ6IHNjcm9sbEFtb3VudCwgYW5pbWF0ZWQ6IGZhbHNlfSk7XG4gIH1cblxuICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKHByb3BzKSB7XG4gICAgY29uc3QgY3VycmVudCA9IHBhcnNlRGF0ZSh0aGlzLnByb3BzLmN1cnJlbnQpO1xuICAgIGNvbnN0IG5leHRDdXJyZW50ID0gcGFyc2VEYXRlKHByb3BzLmN1cnJlbnQpO1xuICAgIGlmIChuZXh0Q3VycmVudCAmJiBjdXJyZW50ICYmIG5leHRDdXJyZW50LmdldFRpbWUoKSAhPT0gY3VycmVudC5nZXRUaW1lKCkpIHtcbiAgICAgIHRoaXMuc2Nyb2xsVG9Nb250aChuZXh0Q3VycmVudCk7XG4gICAgfVxuXG4gICAgY29uc3Qgcm93Y2xvbmUgPSB0aGlzLnN0YXRlLnJvd3M7XG4gICAgY29uc3QgbmV3cm93cyA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm93Y2xvbmUubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCB2YWwgPSB0aGlzLnN0YXRlLnRleHRzW2ldO1xuICAgICAgaWYgKHJvd2Nsb25lW2ldLmdldFRpbWUpIHtcbiAgICAgICAgdmFsID0gcm93Y2xvbmVbaV0uY2xvbmUoKTtcbiAgICAgICAgdmFsLnByb3BidW1wID0gcm93Y2xvbmVbaV0ucHJvcGJ1bXAgPyByb3djbG9uZVtpXS5wcm9wYnVtcCArIDEgOiAxO1xuICAgICAgfVxuICAgICAgbmV3cm93cy5wdXNoKHZhbCk7XG4gICAgfVxuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgcm93czogbmV3cm93c1xuICAgIH0pO1xuICB9XG5cbiAgb25WaWV3YWJsZUl0ZW1zQ2hhbmdlZCh7dmlld2FibGVJdGVtc30pIHtcbiAgICBmdW5jdGlvbiByb3dJc0Nsb3NlVG9WaWV3YWJsZShpbmRleCwgZGlzdGFuY2UpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmlld2FibGVJdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoTWF0aC5hYnMoaW5kZXggLSBwYXJzZUludCh2aWV3YWJsZUl0ZW1zW2ldLmluZGV4KSkgPD0gZGlzdGFuY2UpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IHJvd2Nsb25lID0gdGhpcy5zdGF0ZS5yb3dzO1xuICAgIGNvbnN0IG5ld3Jvd3MgPSBbXTtcbiAgICBjb25zdCB2aXNpYmxlTW9udGhzID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCByb3djbG9uZS5sZW5ndGg7IGkrKykge1xuICAgICAgbGV0IHZhbCA9IHJvd2Nsb25lW2ldO1xuICAgICAgY29uc3Qgcm93U2hvdWxkQmVSZW5kZXJlZCA9IHJvd0lzQ2xvc2VUb1ZpZXdhYmxlKGksIDEpO1xuICAgICAgaWYgKHJvd1Nob3VsZEJlUmVuZGVyZWQgJiYgIXJvd2Nsb25lW2ldLmdldFRpbWUpIHtcbiAgICAgICAgdmFsID0gdGhpcy5zdGF0ZS5vcGVuRGF0ZS5jbG9uZSgpLmFkZE1vbnRocyhpIC0gdGhpcy5wYXN0U2Nyb2xsUmFuZ2UsIHRydWUpO1xuICAgICAgfSBlbHNlIGlmICghcm93U2hvdWxkQmVSZW5kZXJlZCkge1xuICAgICAgICB2YWwgPSB0aGlzLnN0YXRlLnRleHRzW2ldO1xuICAgICAgfVxuICAgICAgbmV3cm93cy5wdXNoKHZhbCk7XG4gICAgICBpZiAocm93SXNDbG9zZVRvVmlld2FibGUoaSwgMCkpIHtcbiAgICAgICAgdmlzaWJsZU1vbnRocy5wdXNoKHhkYXRlVG9EYXRhKHZhbCkpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodGhpcy5wcm9wcy5vblZpc2libGVNb250aHNDaGFuZ2UpIHtcbiAgICAgIHRoaXMucHJvcHMub25WaXNpYmxlTW9udGhzQ2hhbmdlKHZpc2libGVNb250aHMpO1xuICAgIH1cbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIHJvd3M6IG5ld3Jvd3NcbiAgICB9KTtcbiAgfVxuXG4gIHJlbmRlckNhbGVuZGFyKHtpdGVtfSkge1xuICAgIHJldHVybiAoPENhbGVuZGFyTGlzdEl0ZW0gaXRlbT17aXRlbX0gY2FsZW5kYXJIZWlnaHQ9e2NhbGVuZGFySGVpZ2h0fSB7Li4udGhpcy5wcm9wc30gLz4pO1xuICB9XG5cbiAgZ2V0SXRlbUxheW91dChkYXRhLCBpbmRleCkge1xuICAgIHJldHVybiB7bGVuZ3RoOiBjYWxlbmRhckhlaWdodCwgb2Zmc2V0OiBjYWxlbmRhckhlaWdodCAqIGluZGV4LCBpbmRleH07XG4gIH1cblxuICBnZXRNb250aEluZGV4KG1vbnRoKSB7XG4gICAgbGV0IGRpZmZNb250aHMgPSB0aGlzLnN0YXRlLm9wZW5EYXRlLmRpZmZNb250aHMobW9udGgpICsgdGhpcy5wYXN0U2Nyb2xsUmFuZ2U7XG4gICAgcmV0dXJuIGRpZmZNb250aHM7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxGbGF0TGlzdFxuICAgICAgICByZWY9eyhjKSA9PiB0aGlzLmxpc3RWaWV3ID0gY31cbiAgICAgICAgLy9zY3JvbGxFdmVudFRocm90dGxlPXsxMDAwfVxuICAgICAgICBzdHlsZT17W3RoaXMuc3R5bGUuY29udGFpbmVyLCB0aGlzLnByb3BzLnN0eWxlXX1cbiAgICAgICAgaW5pdGlhbExpc3RTaXplPXt0aGlzLnBhc3RTY3JvbGxSYW5nZSAqIHRoaXMuZnV0dXJlU2Nyb2xsUmFuZ2UgKyAxfVxuICAgICAgICBkYXRhPXt0aGlzLnN0YXRlLnJvd3N9XG4gICAgICAgIC8vc25hcFRvQWxpZ25tZW50PSdzdGFydCdcbiAgICAgICAgLy9zbmFwVG9JbnRlcnZhbD17Y2FsZW5kYXJIZWlnaHR9XG4gICAgICAgIHJlbW92ZUNsaXBwZWRTdWJ2aWV3cz17UGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJyA/IGZhbHNlIDogdHJ1ZX1cbiAgICAgICAgcGFnZVNpemU9ezF9XG4gICAgICAgIG9uVmlld2FibGVJdGVtc0NoYW5nZWQ9e3RoaXMub25WaWV3YWJsZUl0ZW1zQ2hhbmdlZC5iaW5kKHRoaXMpfVxuICAgICAgICByZW5kZXJJdGVtPXt0aGlzLnJlbmRlckNhbGVuZGFyLmJpbmQodGhpcyl9XG4gICAgICAgIHNob3dzVmVydGljYWxTY3JvbGxJbmRpY2F0b3I9e2ZhbHNlfVxuICAgICAgICBzY3JvbGxFbmFibGVkPXt0aGlzLnByb3BzLnNjcm9sbGluZ0VuYWJsZWQgIT09IHVuZGVmaW5lZCA/IHRoaXMucHJvcHMuc2Nyb2xsaW5nRW5hYmxlZCA6IHRydWV9XG4gICAgICAgIGtleUV4dHJhY3Rvcj17KGl0ZW0sIGluZGV4KSA9PiBpbmRleH1cbiAgICAgICAgaW5pdGlhbFNjcm9sbEluZGV4PXt0aGlzLnN0YXRlLm9wZW5EYXRlID8gdGhpcy5nZXRNb250aEluZGV4KHRoaXMuc3RhdGUub3BlbkRhdGUpIDogZmFsc2V9XG4gICAgICAgIGdldEl0ZW1MYXlvdXQ9e3RoaXMuZ2V0SXRlbUxheW91dH1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBDYWxlbmRhckxpc3Q7Il19