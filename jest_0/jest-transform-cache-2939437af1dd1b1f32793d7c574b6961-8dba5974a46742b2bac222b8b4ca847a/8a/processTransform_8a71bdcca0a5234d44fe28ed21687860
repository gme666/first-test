5e8989c3e0d293681ca187805ef5c7d4











'use strict';

var MatrixMath=require('MatrixMath');
var Platform=require('Platform');

var invariant=require('fbjs/lib/invariant');
var stringifySafe=require('stringifySafe');









function processTransform(transform){
if(__DEV__){
_validateTransforms(transform);
}




if(Platform.OS==='android'||Platform.OS==='ios'){
return transform;
}

var result=MatrixMath.createIdentityMatrix();

transform.forEach(function(transformation){
var key=Object.keys(transformation)[0];
var value=transformation[key];

switch(key){
case'matrix':
MatrixMath.multiplyInto(result,result,value);
break;
case'perspective':
_multiplyTransform(result,MatrixMath.reusePerspectiveCommand,[value]);
break;
case'rotateX':
_multiplyTransform(result,MatrixMath.reuseRotateXCommand,[_convertToRadians(value)]);
break;
case'rotateY':
_multiplyTransform(result,MatrixMath.reuseRotateYCommand,[_convertToRadians(value)]);
break;
case'rotate':
case'rotateZ':
_multiplyTransform(result,MatrixMath.reuseRotateZCommand,[_convertToRadians(value)]);
break;
case'scale':
_multiplyTransform(result,MatrixMath.reuseScaleCommand,[value]);
break;
case'scaleX':
_multiplyTransform(result,MatrixMath.reuseScaleXCommand,[value]);
break;
case'scaleY':
_multiplyTransform(result,MatrixMath.reuseScaleYCommand,[value]);
break;
case'translate':
_multiplyTransform(result,MatrixMath.reuseTranslate3dCommand,[value[0],value[1],value[2]||0]);
break;
case'translateX':
_multiplyTransform(result,MatrixMath.reuseTranslate2dCommand,[value,0]);
break;
case'translateY':
_multiplyTransform(result,MatrixMath.reuseTranslate2dCommand,[0,value]);
break;
case'skewX':
_multiplyTransform(result,MatrixMath.reuseSkewXCommand,[_convertToRadians(value)]);
break;
case'skewY':
_multiplyTransform(result,MatrixMath.reuseSkewYCommand,[_convertToRadians(value)]);
break;
default:
throw new Error('Invalid transform name: '+key);}

});

return result;
}




function _multiplyTransform(
result,
matrixMathFunction,
args)
{
var matrixToApply=MatrixMath.createIdentityMatrix();
var argsWithIdentity=[matrixToApply].concat(args);
matrixMathFunction.apply(this,argsWithIdentity);
MatrixMath.multiplyInto(result,result,matrixToApply);
}





function _convertToRadians(value){
var floatValue=parseFloat(value);
return value.indexOf('rad')>-1?floatValue:floatValue*Math.PI/180;
}

function _validateTransforms(transform){
transform.forEach(function(transformation){
var keys=Object.keys(transformation);
invariant(
keys.length===1,
'You must specify exactly one property per transform object. Passed properties: %s',
stringifySafe(transformation));

var key=keys[0];
var value=transformation[key];
_validateTransform(key,value,transformation);
});
}

function _validateTransform(key,value,transformation){
invariant(
!value.getValue,
'You passed an Animated.Value to a normal component. '+
'You need to wrap that component in an Animated. For example, '+
'replace <View /> by <Animated.View />.');


var multivalueTransforms=[
'matrix',
'translate'];

if(multivalueTransforms.indexOf(key)!==-1){
invariant(
Array.isArray(value),
'Transform with key of %s must have an array as the value: %s',
key,
stringifySafe(transformation));

}
switch(key){
case'matrix':
invariant(
value.length===9||value.length===16,
'Matrix transform must have a length of 9 (2d) or 16 (3d). '+
'Provided matrix has a length of %s: %s',
value.length,
stringifySafe(transformation));

break;
case'translate':
invariant(
value.length===2||value.length===3,
'Transform with key translate must be an array of length 2 or 3, found %s: %s',
value.length,
stringifySafe(transformation));

break;
case'rotateX':
case'rotateY':
case'rotateZ':
case'rotate':
case'skewX':
case'skewY':
invariant(
typeof value==='string',
'Transform with key of "%s" must be a string: %s',
key,
stringifySafe(transformation));

invariant(
value.indexOf('deg')>-1||value.indexOf('rad')>-1,
'Rotate transform must be expressed in degrees (deg) or radians '+
'(rad): %s',
stringifySafe(transformation));

break;
case'perspective':
invariant(
typeof value==='number',
'Transform with key of "%s" must be a number: %s',
key,
stringifySafe(transformation));

invariant(
value!==0,
'Transform with key of "%s" cannot be zero: %s',
key,
stringifySafe(transformation));

break;
case'translateX':
case'translateY':
case'scale':
case'scaleX':
case'scaleY':
invariant(
typeof value==='number',
'Transform with key of "%s" must be a number: %s',
key,
stringifySafe(transformation));

break;
default:
invariant(false,'Invalid transform %s: %s',key,stringifySafe(transformation));}

}

module.exports=processTransform;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb2Nlc3NUcmFuc2Zvcm0uanMiXSwibmFtZXMiOlsiTWF0cml4TWF0aCIsInJlcXVpcmUiLCJQbGF0Zm9ybSIsImludmFyaWFudCIsInN0cmluZ2lmeVNhZmUiLCJwcm9jZXNzVHJhbnNmb3JtIiwidHJhbnNmb3JtIiwiX19ERVZfXyIsIl92YWxpZGF0ZVRyYW5zZm9ybXMiLCJPUyIsInJlc3VsdCIsImNyZWF0ZUlkZW50aXR5TWF0cml4IiwiZm9yRWFjaCIsImtleSIsIk9iamVjdCIsImtleXMiLCJ0cmFuc2Zvcm1hdGlvbiIsInZhbHVlIiwibXVsdGlwbHlJbnRvIiwiX211bHRpcGx5VHJhbnNmb3JtIiwicmV1c2VQZXJzcGVjdGl2ZUNvbW1hbmQiLCJyZXVzZVJvdGF0ZVhDb21tYW5kIiwiX2NvbnZlcnRUb1JhZGlhbnMiLCJyZXVzZVJvdGF0ZVlDb21tYW5kIiwicmV1c2VSb3RhdGVaQ29tbWFuZCIsInJldXNlU2NhbGVDb21tYW5kIiwicmV1c2VTY2FsZVhDb21tYW5kIiwicmV1c2VTY2FsZVlDb21tYW5kIiwicmV1c2VUcmFuc2xhdGUzZENvbW1hbmQiLCJyZXVzZVRyYW5zbGF0ZTJkQ29tbWFuZCIsInJldXNlU2tld1hDb21tYW5kIiwicmV1c2VTa2V3WUNvbW1hbmQiLCJFcnJvciIsIm1hdHJpeE1hdGhGdW5jdGlvbiIsImFyZ3MiLCJtYXRyaXhUb0FwcGx5IiwiYXJnc1dpdGhJZGVudGl0eSIsImNvbmNhdCIsImFwcGx5IiwiZmxvYXRWYWx1ZSIsInBhcnNlRmxvYXQiLCJpbmRleE9mIiwiTWF0aCIsIlBJIiwibGVuZ3RoIiwiX3ZhbGlkYXRlVHJhbnNmb3JtIiwiZ2V0VmFsdWUiLCJtdWx0aXZhbHVlVHJhbnNmb3JtcyIsIkFycmF5IiwiaXNBcnJheSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBV0E7O0FBRUEsR0FBSUEsWUFBYUMsUUFBUSxZQUFSLENBQWpCO0FBQ0EsR0FBSUMsVUFBV0QsUUFBUSxV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LENBRFo7QUFFRSwrQ0FGRjtBQUdFSixHQUhGO0FBSUVULGNBQWNZLGNBQWQsQ0FKRjs7QUFNQTtBQUNGLElBQUssWUFBTDtBQUNBLElBQUssWUFBTDtBQUNBLElBQUssT0FBTDtBQUNBLElBQUssUUFBTDtBQUNBLElBQUssUUFBTDtBQUNFYjtBQUNFLE1BQU9jLE1BQVAsR0FBaUIsUUFEbkI7QUFFRSxpREFGRjtBQUdFSixHQUhGO0FBSUVULGNBQWNZLGNBQWQsQ0FKRjs7QUFNQTtBQUNGO0FBQ0ViLFVBQVUsS0FBVixDQUFpQiwwQkFBakIsQ0FBNkNVLEdBQTdDLENBQWtEVCxjQUFjWSxjQUFkLENBQWxELEVBaEVKOztBQWtFRDs7QUFFRGtDLE9BQU9DLE9BQVAsQ0FBaUI5QyxnQkFBakIiLCJmaWxlIjoicHJvY2Vzc1RyYW5zZm9ybS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cbiAqXG4gKiBAcHJvdmlkZXNNb2R1bGUgcHJvY2Vzc1RyYW5zZm9ybVxuICogQGZsb3dcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG52YXIgTWF0cml4TWF0aCA9IHJlcXVpcmUoJ01hdHJpeE1hdGgnKTtcbnZhciBQbGF0Zm9ybSA9IHJlcXVpcmUoJ1BsYXRmb3JtJyk7XG5cbnZhciBpbnZhcmlhbnQgPSByZXF1aXJlKCdmYmpzL2xpYi9pbnZhcmlhbnQnKTtcbnZhciBzdHJpbmdpZnlTYWZlID0gcmVxdWlyZSgnc3RyaW5naWZ5U2FmZScpO1xuXG4vKipcbiAqIEdlbmVyYXRlIGEgdHJhbnNmb3JtIG1hdHJpeCBiYXNlZCBvbiB0aGUgcHJvdmlkZWQgdHJhbnNmb3JtcywgYW5kIHVzZSB0aGF0XG4gKiB3aXRoaW4gdGhlIHN0eWxlIG9iamVjdCBpbnN0ZWFkLlxuICpcbiAqIFRoaXMgYWxsb3dzIHVzIHRvIHByb3ZpZGUgYW4gQVBJIHRoYXQgaXMgc2ltaWxhciB0byBDU1MsIHdoZXJlIHRyYW5zZm9ybXMgbWF5XG4gKiBiZSBhcHBsaWVkIGluIGFuIGFyYml0cmFyeSBvcmRlciwgYW5kIHlldCBoYXZlIGEgdW5pdmVyc2FsLCBzaW5ndWxhclxuICogaW50ZXJmYWNlIHRvIG5hdGl2ZSBjb2RlLlxuICovXG5mdW5jdGlvbiBwcm9jZXNzVHJhbnNmb3JtKHRyYW5zZm9ybTogQXJyYXk8T2JqZWN0Pik6IEFycmF5PE9iamVjdD4gfCBBcnJheTxudW1iZXI+IHtcbiAgaWYgKF9fREVWX18pIHtcbiAgICBfdmFsaWRhdGVUcmFuc2Zvcm1zKHRyYW5zZm9ybSk7XG4gIH1cblxuICAvLyBBbmRyb2lkICYgaU9TIGltcGxlbWVudGF0aW9ucyBvZiB0cmFuc2Zvcm0gcHJvcGVydHkgYWNjZXB0IHRoZSBsaXN0IG9mXG4gIC8vIHRyYW5zZm9ybSBwcm9wZXJ0aWVzIGFzIG9wcG9zZWQgdG8gYSB0cmFuc2Zvcm0gTWF0cml4LiBUaGlzIGlzIG5lY2Vzc2FyeVxuICAvLyB0byBjb250cm9sIHRyYW5zZm9ybSBwcm9wZXJ0eSB1cGRhdGVzIGNvbXBsZXRlbHkgb24gdGhlIG5hdGl2ZSB0aHJlYWQuXG4gIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnIHx8IFBsYXRmb3JtLk9TID09PSAnaW9zJykge1xuICAgIHJldHVybiB0cmFuc2Zvcm07XG4gIH1cblxuICB2YXIgcmVzdWx0ID0gTWF0cml4TWF0aC5jcmVhdGVJZGVudGl0eU1hdHJpeCgpO1xuXG4gIHRyYW5zZm9ybS5mb3JFYWNoKHRyYW5zZm9ybWF0aW9uID0+IHtcbiAgICB2YXIga2V5ID0gT2JqZWN0LmtleXModHJhbnNmb3JtYXRpb24pWzBdO1xuICAgIHZhciB2YWx1ZSA9IHRyYW5zZm9ybWF0aW9uW2tleV07XG5cbiAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgY2FzZSAnbWF0cml4JzpcbiAgICAgICAgTWF0cml4TWF0aC5tdWx0aXBseUludG8ocmVzdWx0LCByZXN1bHQsIHZhbHVlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdwZXJzcGVjdGl2ZSc6XG4gICAgICAgIF9tdWx0aXBseVRyYW5zZm9ybShyZXN1bHQsIE1hdHJpeE1hdGgucmV1c2VQZXJzcGVjdGl2ZUNvbW1hbmQsIFt2YWx1ZV0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3JvdGF0ZVgnOlxuICAgICAgICBfbXVsdGlwbHlUcmFuc2Zvcm0ocmVzdWx0LCBNYXRyaXhNYXRoLnJldXNlUm90YXRlWENvbW1hbmQsIFtfY29udmVydFRvUmFkaWFucyh2YWx1ZSldKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdyb3RhdGVZJzpcbiAgICAgICAgX211bHRpcGx5VHJhbnNmb3JtKHJlc3VsdCwgTWF0cml4TWF0aC5yZXVzZVJvdGF0ZVlDb21tYW5kLCBbX2NvbnZlcnRUb1JhZGlhbnModmFsdWUpXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncm90YXRlJzpcbiAgICAgIGNhc2UgJ3JvdGF0ZVonOlxuICAgICAgICBfbXVsdGlwbHlUcmFuc2Zvcm0ocmVzdWx0LCBNYXRyaXhNYXRoLnJldXNlUm90YXRlWkNvbW1hbmQsIFtfY29udmVydFRvUmFkaWFucyh2YWx1ZSldKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdzY2FsZSc6XG4gICAgICAgIF9tdWx0aXBseVRyYW5zZm9ybShyZXN1bHQsIE1hdHJpeE1hdGgucmV1c2VTY2FsZUNvbW1hbmQsIFt2YWx1ZV0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3NjYWxlWCc6XG4gICAgICAgIF9tdWx0aXBseVRyYW5zZm9ybShyZXN1bHQsIE1hdHJpeE1hdGgucmV1c2VTY2FsZVhDb21tYW5kLCBbdmFsdWVdKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdzY2FsZVknOlxuICAgICAgICBfbXVsdGlwbHlUcmFuc2Zvcm0ocmVzdWx0LCBNYXRyaXhNYXRoLnJldXNlU2NhbGVZQ29tbWFuZCwgW3ZhbHVlXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAndHJhbnNsYXRlJzpcbiAgICAgICAgX211bHRpcGx5VHJhbnNmb3JtKHJlc3VsdCwgTWF0cml4TWF0aC5yZXVzZVRyYW5zbGF0ZTNkQ29tbWFuZCwgW3ZhbHVlWzBdLCB2YWx1ZVsxXSwgdmFsdWVbMl0gfHwgMF0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3RyYW5zbGF0ZVgnOlxuICAgICAgICBfbXVsdGlwbHlUcmFuc2Zvcm0ocmVzdWx0LCBNYXRyaXhNYXRoLnJldXNlVHJhbnNsYXRlMmRDb21tYW5kLCBbdmFsdWUsIDBdKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICd0cmFuc2xhdGVZJzpcbiAgICAgICAgX211bHRpcGx5VHJhbnNmb3JtKHJlc3VsdCwgTWF0cml4TWF0aC5yZXVzZVRyYW5zbGF0ZTJkQ29tbWFuZCwgWzAsIHZhbHVlXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnc2tld1gnOlxuICAgICAgICBfbXVsdGlwbHlUcmFuc2Zvcm0ocmVzdWx0LCBNYXRyaXhNYXRoLnJldXNlU2tld1hDb21tYW5kLCBbX2NvbnZlcnRUb1JhZGlhbnModmFsdWUpXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnc2tld1knOlxuICAgICAgICBfbXVsdGlwbHlUcmFuc2Zvcm0ocmVzdWx0LCBNYXRyaXhNYXRoLnJldXNlU2tld1lDb21tYW5kLCBbX2NvbnZlcnRUb1JhZGlhbnModmFsdWUpXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHRyYW5zZm9ybSBuYW1lOiAnICsga2V5KTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbi8qKlxuICogUGVyZm9ybXMgYSBkZXN0cnVjdGl2ZSBvcGVyYXRpb24gb24gYSB0cmFuc2Zvcm0gbWF0cml4LlxuICovXG5mdW5jdGlvbiBfbXVsdGlwbHlUcmFuc2Zvcm0oXG4gIHJlc3VsdDogQXJyYXk8bnVtYmVyPixcbiAgbWF0cml4TWF0aEZ1bmN0aW9uOiBGdW5jdGlvbixcbiAgYXJnczogQXJyYXk8bnVtYmVyPlxuKTogdm9pZCB7XG4gIHZhciBtYXRyaXhUb0FwcGx5ID0gTWF0cml4TWF0aC5jcmVhdGVJZGVudGl0eU1hdHJpeCgpO1xuICB2YXIgYXJnc1dpdGhJZGVudGl0eSA9IFttYXRyaXhUb0FwcGx5XS5jb25jYXQoYXJncyk7XG4gIG1hdHJpeE1hdGhGdW5jdGlvbi5hcHBseSh0aGlzLCBhcmdzV2l0aElkZW50aXR5KTtcbiAgTWF0cml4TWF0aC5tdWx0aXBseUludG8ocmVzdWx0LCByZXN1bHQsIG1hdHJpeFRvQXBwbHkpO1xufVxuXG4vKipcbiAqIFBhcnNlcyBhIHN0cmluZyBsaWtlICcwLjVyYWQnIG9yICc2MGRlZycgaW50byByYWRpYW5zIGV4cHJlc3NlZCBpbiBhIGZsb2F0LlxuICogTm90ZSB0aGF0IHZhbGlkYXRpb24gb24gdGhlIHN0cmluZyBpcyBkb25lIGluIGBfdmFsaWRhdGVUcmFuc2Zvcm0oKWAuXG4gKi9cbmZ1bmN0aW9uIF9jb252ZXJ0VG9SYWRpYW5zKHZhbHVlOiBzdHJpbmcpOiBudW1iZXIge1xuICB2YXIgZmxvYXRWYWx1ZSA9IHBhcnNlRmxvYXQodmFsdWUpO1xuICByZXR1cm4gdmFsdWUuaW5kZXhPZigncmFkJykgPiAtMSA/IGZsb2F0VmFsdWUgOiBmbG9hdFZhbHVlICogTWF0aC5QSSAvIDE4MDtcbn1cblxuZnVuY3Rpb24gX3ZhbGlkYXRlVHJhbnNmb3Jtcyh0cmFuc2Zvcm06IEFycmF5PE9iamVjdD4pOiB2b2lkIHtcbiAgdHJhbnNmb3JtLmZvckVhY2godHJhbnNmb3JtYXRpb24gPT4ge1xuICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXModHJhbnNmb3JtYXRpb24pO1xuICAgIGludmFyaWFudChcbiAgICAgIGtleXMubGVuZ3RoID09PSAxLFxuICAgICAgJ1lvdSBtdXN0IHNwZWNpZnkgZXhhY3RseSBvbmUgcHJvcGVydHkgcGVyIHRyYW5zZm9ybSBvYmplY3QuIFBhc3NlZCBwcm9wZXJ0aWVzOiAlcycsXG4gICAgICBzdHJpbmdpZnlTYWZlKHRyYW5zZm9ybWF0aW9uKSxcbiAgICApO1xuICAgIHZhciBrZXkgPSBrZXlzWzBdO1xuICAgIHZhciB2YWx1ZSA9IHRyYW5zZm9ybWF0aW9uW2tleV07XG4gICAgX3ZhbGlkYXRlVHJhbnNmb3JtKGtleSwgdmFsdWUsIHRyYW5zZm9ybWF0aW9uKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIF92YWxpZGF0ZVRyYW5zZm9ybShrZXksIHZhbHVlLCB0cmFuc2Zvcm1hdGlvbikge1xuICBpbnZhcmlhbnQoXG4gICAgIXZhbHVlLmdldFZhbHVlLFxuICAgICdZb3UgcGFzc2VkIGFuIEFuaW1hdGVkLlZhbHVlIHRvIGEgbm9ybWFsIGNvbXBvbmVudC4gJyArXG4gICAgJ1lvdSBuZWVkIHRvIHdyYXAgdGhhdCBjb21wb25lbnQgaW4gYW4gQW5pbWF0ZWQuIEZvciBleGFtcGxlLCAnICtcbiAgICAncmVwbGFjZSA8VmlldyAvPiBieSA8QW5pbWF0ZWQuVmlldyAvPi4nXG4gICk7XG5cbiAgdmFyIG11bHRpdmFsdWVUcmFuc2Zvcm1zID0gW1xuICAgICdtYXRyaXgnLFxuICAgICd0cmFuc2xhdGUnLFxuICBdO1xuICBpZiAobXVsdGl2YWx1ZVRyYW5zZm9ybXMuaW5kZXhPZihrZXkpICE9PSAtMSkge1xuICAgIGludmFyaWFudChcbiAgICAgIEFycmF5LmlzQXJyYXkodmFsdWUpLFxuICAgICAgJ1RyYW5zZm9ybSB3aXRoIGtleSBvZiAlcyBtdXN0IGhhdmUgYW4gYXJyYXkgYXMgdGhlIHZhbHVlOiAlcycsXG4gICAgICBrZXksXG4gICAgICBzdHJpbmdpZnlTYWZlKHRyYW5zZm9ybWF0aW9uKSxcbiAgICApO1xuICB9XG4gIHN3aXRjaCAoa2V5KSB7XG4gICAgY2FzZSAnbWF0cml4JzpcbiAgICAgIGludmFyaWFudChcbiAgICAgICAgdmFsdWUubGVuZ3RoID09PSA5IHx8IHZhbHVlLmxlbmd0aCA9PT0gMTYsXG4gICAgICAgICdNYXRyaXggdHJhbnNmb3JtIG11c3QgaGF2ZSBhIGxlbmd0aCBvZiA5ICgyZCkgb3IgMTYgKDNkKS4gJyArXG4gICAgICAgICAgJ1Byb3ZpZGVkIG1hdHJpeCBoYXMgYSBsZW5ndGggb2YgJXM6ICVzJyxcbiAgICAgICAgdmFsdWUubGVuZ3RoLFxuICAgICAgICBzdHJpbmdpZnlTYWZlKHRyYW5zZm9ybWF0aW9uKSxcbiAgICAgICk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICd0cmFuc2xhdGUnOlxuICAgICAgaW52YXJpYW50KFxuICAgICAgICB2YWx1ZS5sZW5ndGggPT09IDIgfHwgdmFsdWUubGVuZ3RoID09PSAzLFxuICAgICAgICAnVHJhbnNmb3JtIHdpdGgga2V5IHRyYW5zbGF0ZSBtdXN0IGJlIGFuIGFycmF5IG9mIGxlbmd0aCAyIG9yIDMsIGZvdW5kICVzOiAlcycsXG4gICAgICAgIHZhbHVlLmxlbmd0aCxcbiAgICAgICAgc3RyaW5naWZ5U2FmZSh0cmFuc2Zvcm1hdGlvbiksXG4gICAgICApO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAncm90YXRlWCc6XG4gICAgY2FzZSAncm90YXRlWSc6XG4gICAgY2FzZSAncm90YXRlWic6XG4gICAgY2FzZSAncm90YXRlJzpcbiAgICBjYXNlICdza2V3WCc6XG4gICAgY2FzZSAnc2tld1knOlxuICAgICAgaW52YXJpYW50KFxuICAgICAgICB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnLFxuICAgICAgICAnVHJhbnNmb3JtIHdpdGgga2V5IG9mIFwiJXNcIiBtdXN0IGJlIGEgc3RyaW5nOiAlcycsXG4gICAgICAgIGtleSxcbiAgICAgICAgc3RyaW5naWZ5U2FmZSh0cmFuc2Zvcm1hdGlvbiksXG4gICAgICApO1xuICAgICAgaW52YXJpYW50KFxuICAgICAgICB2YWx1ZS5pbmRleE9mKCdkZWcnKSA+IC0xIHx8IHZhbHVlLmluZGV4T2YoJ3JhZCcpID4gLTEsXG4gICAgICAgICdSb3RhdGUgdHJhbnNmb3JtIG11c3QgYmUgZXhwcmVzc2VkIGluIGRlZ3JlZXMgKGRlZykgb3IgcmFkaWFucyAnICtcbiAgICAgICAgICAnKHJhZCk6ICVzJyxcbiAgICAgICAgc3RyaW5naWZ5U2FmZSh0cmFuc2Zvcm1hdGlvbiksXG4gICAgICApO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAncGVyc3BlY3RpdmUnOlxuICAgICAgaW52YXJpYW50KFxuICAgICAgICB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInLFxuICAgICAgICAnVHJhbnNmb3JtIHdpdGgga2V5IG9mIFwiJXNcIiBtdXN0IGJlIGEgbnVtYmVyOiAlcycsXG4gICAgICAgIGtleSxcbiAgICAgICAgc3RyaW5naWZ5U2FmZSh0cmFuc2Zvcm1hdGlvbiksXG4gICAgICApO1xuICAgICAgaW52YXJpYW50KFxuICAgICAgICB2YWx1ZSAhPT0gMCxcbiAgICAgICAgJ1RyYW5zZm9ybSB3aXRoIGtleSBvZiBcIiVzXCIgY2Fubm90IGJlIHplcm86ICVzJyxcbiAgICAgICAga2V5LFxuICAgICAgICBzdHJpbmdpZnlTYWZlKHRyYW5zZm9ybWF0aW9uKSxcbiAgICAgICk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICd0cmFuc2xhdGVYJzpcbiAgICBjYXNlICd0cmFuc2xhdGVZJzpcbiAgICBjYXNlICdzY2FsZSc6XG4gICAgY2FzZSAnc2NhbGVYJzpcbiAgICBjYXNlICdzY2FsZVknOlxuICAgICAgaW52YXJpYW50KFxuICAgICAgICB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInLFxuICAgICAgICAnVHJhbnNmb3JtIHdpdGgga2V5IG9mIFwiJXNcIiBtdXN0IGJlIGEgbnVtYmVyOiAlcycsXG4gICAgICAgIGtleSxcbiAgICAgICAgc3RyaW5naWZ5U2FmZSh0cmFuc2Zvcm1hdGlvbiksXG4gICAgICApO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIGludmFyaWFudChmYWxzZSwgJ0ludmFsaWQgdHJhbnNmb3JtICVzOiAlcycsIGtleSwgc3RyaW5naWZ5U2FmZSh0cmFuc2Zvcm1hdGlvbikpO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gcHJvY2Vzc1RyYW5zZm9ybTtcbiJdfQ==