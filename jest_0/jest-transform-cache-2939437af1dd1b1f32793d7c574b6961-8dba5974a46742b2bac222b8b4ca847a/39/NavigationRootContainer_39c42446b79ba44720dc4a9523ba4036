9437e55f196f8fb0b113d035dfd40385











'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}

var AsyncStorage=require('react-native').AsyncStorage;
var Linking=require('react-native').Linking;
var NavigationPropTypes=require('./NavigationPropTypes');
var NavigationStateUtils=require('./NavigationStateUtils');
var Platform=require('react-native').Platform;
var React=require('react');


















































function getBackAction(){
return{type:'BackAction'};
}var

PropTypes=React.PropTypes;var

NavigationRootContainer=function(_React$Component){_inherits(NavigationRootContainer,_React$Component);
























function NavigationRootContainer(props){_classCallCheck(this,NavigationRootContainer);var _this=_possibleConstructorReturn(this,(NavigationRootContainer.__proto__||Object.getPrototypeOf(NavigationRootContainer)).call(this,
props));

var navState=null;
if(!_this.props.persistenceKey){
navState=NavigationStateUtils.getParent(
_this.props.reducer(null,props.initialAction));

}
_this.state={navState:navState};return _this;
}_createClass(NavigationRootContainer,[{key:'componentWillMount',value:function componentWillMount()

{
this.handleNavigation=this.handleNavigation.bind(this);
this._handleOpenURLEvent=this._handleOpenURLEvent.bind(this);
}},{key:'componentDidMount',value:function componentDidMount()

{var _this2=this;
if(this.props.linkingActionMap){
Linking.getInitialURL().then(this._handleOpenURL.bind(this));
Platform.OS==='ios'&&Linking.addEventListener('url',this._handleOpenURLEvent);
}
if(this.props.persistenceKey){
AsyncStorage.getItem(this.props.persistenceKey,function(err,storedString){
if(err||!storedString){
_this2.setState({

navState:_this2.props.reducer(null,_this2.props.initialAction)});

return;
}
_this2.setState({
navState:JSON.parse(storedString)});

});
}
}},{key:'componentWillUnmount',value:function componentWillUnmount()

{
if(Platform.OS==='ios'){
Linking.removeEventListener('url',this._handleOpenURLEvent);
}
}},{key:'_handleOpenURLEvent',value:function _handleOpenURLEvent(

event){
this._handleOpenURL(event.url);
}},{key:'_handleOpenURL',value:function _handleOpenURL(

url){
if(!this.props.linkingActionMap){
return;
}
var action=this.props.linkingActionMap(url);
if(action){
this.handleNavigation(action);
}
}},{key:'getChildContext',value:function getChildContext()

{
return{
onNavigate:this.handleNavigation};

}},{key:'handleNavigation',value:function handleNavigation(

action){
var navState=this.props.reducer(this.state.navState,action);
if(navState===this.state.navState){
return false;
}
this.setState({

navState:navState});


if(this.props.persistenceKey){
AsyncStorage.setItem(this.props.persistenceKey,JSON.stringify(navState));
}

return true;
}},{key:'render',value:function render()

{
var navigation=this.props.renderNavigation(
this.state.navState,
this.handleNavigation);

return navigation;
}}]);return NavigationRootContainer;}(React.Component);NavigationRootContainer.propTypes={initialAction:NavigationPropTypes.action.isRequired,linkingActionMap:PropTypes.func,persistenceKey:PropTypes.string,reducer:PropTypes.func.isRequired,renderNavigation:PropTypes.func.isRequired};NavigationRootContainer.defaultProps={initialAction:{type:'RootContainerInitialAction'}};NavigationRootContainer.childContextTypes={onNavigate:PropTypes.func};NavigationRootContainer.getBackAction=getBackAction;


module.exports=NavigationRootContainer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk5hdmlnYXRpb25Sb290Q29udGFpbmVyLmpzIl0sIm5hbWVzIjpbIkFzeW5jU3RvcmFnZSIsInJlcXVpcmUiLCJMaW5raW5nIiwiTmF2aWdhdGlvblByb3BUeXBlcyIsIk5hdmlnYXRpb25TdGF0ZVV0aWxzIiwiUGxhdGZvcm0iLCJSZWFjdCIsImdldEJhY2tBY3Rpb24iLCJ0eXBlIiwiUHJvcFR5cGVzIiwiTmF2aWdhdGlvblJvb3RDb250YWluZXIiLCJwcm9wcyIsIm5hdlN0YXRlIiwicGVyc2lzdGVuY2VLZXkiLCJnZXRQYXJlbnQiLCJyZWR1Y2VyIiwiaW5pdGlhbEFjdGlvbiIsInN0YXRlIiwiaGFuZGxlTmF2aWdhdGlvbiIsImJpbmQiLCJfaGFuZGxlT3BlblVSTEV2ZW50IiwibGlua2luZ0FjdGlvbk1hcCIsImdldEluaXRpYWxVUkwiLCJ0aGVuIiwiX2hhbmRsZU9wZW5VUkwiLCJPUyIsImFkZEV2ZW50TGlzdGVuZXIiLCJnZXRJdGVtIiwiZXJyIiwic3RvcmVkU3RyaW5nIiwic2V0U3RhdGUiLCJKU09OIiwicGFyc2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJ1cmwiLCJhY3Rpb24iLCJvbk5hdmlnYXRlIiwic2V0SXRlbSIsInN0cmluZ2lmeSIsIm5hdmlnYXRpb24iLCJyZW5kZXJOYXZpZ2F0aW9uIiwiQ29tcG9uZW50IiwicHJvcFR5cGVzIiwiaXNSZXF1aXJlZCIsImZ1bmMiLCJzdHJpbmciLCJkZWZhdWx0UHJvcHMiLCJjaGlsZENvbnRleHRUeXBlcyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBV0EsYTs7QUFFQSxHQUFNQSxjQUFlQyxRQUFRLGNBQVIsRUFBd0JELFlBQTdDO0FBQ0EsR0FBTUUsU0FBVUQsUUFBUSxjQUFSLEVBQXdCQyxPQUF4QztBQUNBLEdBQU1DLHFCQUFzQkYsUUFBUSx1QkFBUixDQUE1QjtBQUNBLEdBQU1HLHNCQUF1QkgsUUFBUSx3QkFBUixDQUE3QjtBQUNB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TCxRQUE1QixDQUFzQztBQUNwQyxNQUFPLE1BQVA7QUFDRDtBQUNELEtBQUtrQixRQUFMLENBQWM7O0FBRVpsQixpQkFGWSxDQUFkOzs7QUFLQSxHQUFJLEtBQUtELEtBQUwsQ0FBV0UsY0FBZixDQUErQjtBQUM3QmIsYUFBYXNDLE9BQWIsQ0FBcUIsS0FBSzNCLEtBQUwsQ0FBV0UsY0FBaEMsQ0FBZ0RrQixLQUFLUSxTQUFMLENBQWUzQixRQUFmLENBQWhEO0FBQ0Q7O0FBRUQsTUFBTyxLQUFQO0FBQ0QsQzs7QUFFc0I7QUFDckIsR0FBTTRCLFlBQWEsS0FBSzdCLEtBQUwsQ0FBVzhCLGdCQUFYO0FBQ2pCLEtBQUt4QixLQUFMLENBQVdMLFFBRE07QUFFakIsS0FBS00sZ0JBRlksQ0FBbkI7O0FBSUEsTUFBT3NCLFdBQVA7QUFDRCxDLHFDQWhIbUNsQyxNQUFNb0MsUyxFQUF0Q2hDLHVCLENBTUdpQyxTLENBQVksQ0FDakIzQixjQUFlYixvQkFBb0JpQyxNQUFwQixDQUEyQlEsVUFEekIsQ0FFakJ2QixpQkFBa0JaLFVBQVVvQyxJQUZYLENBR2pCaEMsZUFBZ0JKLFVBQVVxQyxNQUhULENBSWpCL0IsUUFBU04sVUFBVW9DLElBQVYsQ0FBZUQsVUFKUCxDQUtqQkgsaUJBQWtCaEMsVUFBVW9DLElBQVYsQ0FBZUQsVUFMaEIsQyxDQU5mbEMsdUIsQ0FjR3FDLFksQ0FBZSxDQUNwQi9CLGNBQWUsQ0FBRVIsS0FBTSw0QkFBUixDQURLLEMsQ0FkbEJFLHVCLENBa0JHc0MsaUIsQ0FBb0IsQ0FDekJYLFdBQVk1QixVQUFVb0MsSUFERyxDLENBbEJ2Qm5DLHVCLENBdUJHSCxhLENBQWdCQSxhOzs7QUE0RnpCMEMsT0FBT0MsT0FBUCxDQUFpQnhDLHVCQUFqQiIsImZpbGUiOiJOYXZpZ2F0aW9uUm9vdENvbnRhaW5lci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cbiAqXG4gKiBAcHJvdmlkZXNNb2R1bGUgTmF2aWdhdGlvblJvb3RDb250YWluZXJcbiAqIEBmbG93XG4gKi9cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgQXN5bmNTdG9yYWdlID0gcmVxdWlyZSgncmVhY3QtbmF0aXZlJykuQXN5bmNTdG9yYWdlO1xuY29uc3QgTGlua2luZyA9IHJlcXVpcmUoJ3JlYWN0LW5hdGl2ZScpLkxpbmtpbmc7XG5jb25zdCBOYXZpZ2F0aW9uUHJvcFR5cGVzID0gcmVxdWlyZSgnLi9OYXZpZ2F0aW9uUHJvcFR5cGVzJyk7XG5jb25zdCBOYXZpZ2F0aW9uU3RhdGVVdGlscyA9IHJlcXVpcmUoJy4vTmF2aWdhdGlvblN0YXRlVXRpbHMnKTtcbmNvbnN0IFBsYXRmb3JtID0gcmVxdWlyZSgncmVhY3QtbmF0aXZlJykuUGxhdGZvcm07XG5jb25zdCBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5cbmltcG9ydCB0eXBlIHtcbiAgTmF2aWdhdGlvbkFjdGlvbixcbiAgTmF2aWdhdGlvblBhcmVudFN0YXRlLFxuICBOYXZpZ2F0aW9uUmVkdWNlcixcbiAgTmF2aWdhdGlvblJlbmRlcmVyLFxufSBmcm9tICdOYXZpZ2F0aW9uVHlwZURlZmluaXRpb24nO1xuXG5leHBvcnQgdHlwZSBCYWNrQWN0aW9uID0ge1xuICB0eXBlOiAnQmFja0FjdGlvbicsXG59O1xuXG50eXBlIFByb3BzID0ge1xuICAvKlxuICAgKiBUaGUgZGVmYXVsdCBhY3Rpb24gdG8gYmUgcGFzc2VkIGludG8gdGhlIHJlZHVjZXIgd2hlbiBnZXR0aW5nIHRoZSBmaXJzdFxuICAgKiBzdGF0ZS4gRGVmYXVsdHMgdG8ge3R5cGU6ICdSb290Q29udGFpbmVySW5pdGlhbEFjdGlvbid9XG4gICAqL1xuICBpbml0aWFsQWN0aW9uOiBOYXZpZ2F0aW9uQWN0aW9uLFxuXG4gIC8qXG4gICAqIFByb3ZpZGUgbGlua2luZ0FjdGlvbk1hcCB0byBpbnN0cnVjdCB0aGUgY29udGFpbmVyIHRvIHN1YnNjcmliZSB0byBsaW5raW5nXG4gICAqIGV2ZW50cywgYW5kIHVzZSB0aGlzIG1hcHBlciB0byBjb252ZXJ0IFVSSXMgaW50byBhY3Rpb25zIHRoYXQgeW91ciBhcHAgY2FuXG4gICAqIGhhbmRsZVxuICAgKi9cbiAgbGlua2luZ0FjdGlvbk1hcDogPygodXJpOiA/c3RyaW5nKSA9PiBOYXZpZ2F0aW9uQWN0aW9uKSxcblxuICAvKlxuICAgKiBQcm92aWRlIHRoaXMga2V5LCBhbmQgdGhlIGNvbnRhaW5lciB3aWxsIHN0b3JlIHRoZSBuYXZpZ2F0aW9uIHN0YXRlIGluXG4gICAqIEFzeW5jU3RvcmFnZSB0aHJvdWdoIHJlZnJlc2hlcywgd2l0aCB0aGUgcHJvdmlkZWQga2V5XG4gICAqL1xuICBwZXJzaXN0ZW5jZUtleTogP3N0cmluZyxcblxuXG4gIC8qXG4gICAqIEEgZnVuY3Rpb24gdGhhdCB3aWxsIG91dHB1dCB0aGUgbGF0ZXN0IG5hdmlnYXRpb24gc3RhdGUgYXMgYSBmdW5jdGlvbiBvZlxuICAgKiB0aGUgKG9wdGlvbmFsKSBwcmV2aW91cyBzdGF0ZSwgYW5kIGFuIGFjdGlvblxuICAgKi9cbiAgcmVkdWNlcjogTmF2aWdhdGlvblJlZHVjZXIsXG5cblxuICAvKlxuICAgKiBTZXQgdXAgdGhlIHJlbmRlcmluZyBvZiB0aGUgYXBwIGZvciBhIGdpdmVuIG5hdmlnYXRpb24gc3RhdGVcbiAgICovXG4gIHJlbmRlck5hdmlnYXRpb246IE5hdmlnYXRpb25SZW5kZXJlcixcbn07XG5cbnR5cGUgU3RhdGUgPSB7XG4gIG5hdlN0YXRlOiA/TmF2aWdhdGlvblBhcmVudFN0YXRlLFxufTtcblxuZnVuY3Rpb24gZ2V0QmFja0FjdGlvbigpOiBCYWNrQWN0aW9uIHtcbiAgcmV0dXJuIHsgdHlwZTogJ0JhY2tBY3Rpb24nIH07XG59XG5cbmNvbnN0IHtQcm9wVHlwZXN9ID0gUmVhY3Q7XG5cbmNsYXNzIE5hdmlnYXRpb25Sb290Q29udGFpbmVyIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PGFueSwgUHJvcHMsIFN0YXRlPiB7XG4gIF9oYW5kbGVPcGVuVVJMRXZlbnQ6IEZ1bmN0aW9uO1xuXG4gIHByb3BzOiBQcm9wcztcbiAgc3RhdGU6IFN0YXRlO1xuXG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgaW5pdGlhbEFjdGlvbjogTmF2aWdhdGlvblByb3BUeXBlcy5hY3Rpb24uaXNSZXF1aXJlZCxcbiAgICBsaW5raW5nQWN0aW9uTWFwOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBwZXJzaXN0ZW5jZUtleTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICByZWR1Y2VyOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHJlbmRlck5hdmlnYXRpb246IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gIH07XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBpbml0aWFsQWN0aW9uOiB7IHR5cGU6ICdSb290Q29udGFpbmVySW5pdGlhbEFjdGlvbicgfSxcbiAgfTtcblxuICBzdGF0aWMgY2hpbGRDb250ZXh0VHlwZXMgPSB7XG4gICAgb25OYXZpZ2F0ZTogUHJvcFR5cGVzLmZ1bmMsXG4gIH07XG5cblxuICBzdGF0aWMgZ2V0QmFja0FjdGlvbiA9IGdldEJhY2tBY3Rpb247XG5cbiAgY29uc3RydWN0b3IocHJvcHM6IFByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuXG4gICAgbGV0IG5hdlN0YXRlID0gbnVsbDtcbiAgICBpZiAoIXRoaXMucHJvcHMucGVyc2lzdGVuY2VLZXkpIHtcbiAgICAgIG5hdlN0YXRlID0gTmF2aWdhdGlvblN0YXRlVXRpbHMuZ2V0UGFyZW50KFxuICAgICAgICB0aGlzLnByb3BzLnJlZHVjZXIobnVsbCwgcHJvcHMuaW5pdGlhbEFjdGlvbilcbiAgICAgICk7XG4gICAgfVxuICAgIHRoaXMuc3RhdGUgPSB7IG5hdlN0YXRlIH07XG4gIH1cblxuICBjb21wb25lbnRXaWxsTW91bnQoKTogdm9pZCB7XG4gICAgKHRoaXM6IGFueSkuaGFuZGxlTmF2aWdhdGlvbiA9IHRoaXMuaGFuZGxlTmF2aWdhdGlvbi5iaW5kKHRoaXMpO1xuICAgICh0aGlzOiBhbnkpLl9oYW5kbGVPcGVuVVJMRXZlbnQgPSB0aGlzLl9oYW5kbGVPcGVuVVJMRXZlbnQuYmluZCh0aGlzKTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnByb3BzLmxpbmtpbmdBY3Rpb25NYXApIHtcbiAgICAgIExpbmtpbmcuZ2V0SW5pdGlhbFVSTCgpLnRoZW4odGhpcy5faGFuZGxlT3BlblVSTC5iaW5kKHRoaXMpKTtcbiAgICAgIFBsYXRmb3JtLk9TID09PSAnaW9zJyAmJiBMaW5raW5nLmFkZEV2ZW50TGlzdGVuZXIoJ3VybCcsIHRoaXMuX2hhbmRsZU9wZW5VUkxFdmVudCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnByb3BzLnBlcnNpc3RlbmNlS2V5KSB7XG4gICAgICBBc3luY1N0b3JhZ2UuZ2V0SXRlbSh0aGlzLnByb3BzLnBlcnNpc3RlbmNlS2V5LCAoZXJyLCBzdG9yZWRTdHJpbmcpID0+IHtcbiAgICAgICAgaWYgKGVyciB8fCAhc3RvcmVkU3RyaW5nKSB7XG4gICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAvLyAkRmxvd0ZpeE1lIC0gbmF2U3RhdGUgaXMgbWlzc2luZyBwcm9wZXJ0aWVzIDooXG4gICAgICAgICAgICBuYXZTdGF0ZTogdGhpcy5wcm9wcy5yZWR1Y2VyKG51bGwsIHRoaXMucHJvcHMuaW5pdGlhbEFjdGlvbiksXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgIG5hdlN0YXRlOiBKU09OLnBhcnNlKHN0b3JlZFN0cmluZyksXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKTogdm9pZCB7XG4gICAgaWYgKFBsYXRmb3JtLk9TID09PSAnaW9zJykge1xuICAgICAgTGlua2luZy5yZW1vdmVFdmVudExpc3RlbmVyKCd1cmwnLCB0aGlzLl9oYW5kbGVPcGVuVVJMRXZlbnQpO1xuICAgIH1cbiAgfVxuXG4gIF9oYW5kbGVPcGVuVVJMRXZlbnQoZXZlbnQ6IHt1cmw6IHN0cmluZ30pOiB2b2lkIHtcbiAgICB0aGlzLl9oYW5kbGVPcGVuVVJMKGV2ZW50LnVybCk7XG4gIH1cblxuICBfaGFuZGxlT3BlblVSTCh1cmw6ID9zdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMucHJvcHMubGlua2luZ0FjdGlvbk1hcCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBhY3Rpb24gPSB0aGlzLnByb3BzLmxpbmtpbmdBY3Rpb25NYXAodXJsKTtcbiAgICBpZiAoYWN0aW9uKSB7XG4gICAgICB0aGlzLmhhbmRsZU5hdmlnYXRpb24oYWN0aW9uKTtcbiAgICB9XG4gIH1cblxuICBnZXRDaGlsZENvbnRleHQoKTogT2JqZWN0IHtcbiAgICByZXR1cm4ge1xuICAgICAgb25OYXZpZ2F0ZTogdGhpcy5oYW5kbGVOYXZpZ2F0aW9uLFxuICAgIH07XG4gIH1cblxuICBoYW5kbGVOYXZpZ2F0aW9uKGFjdGlvbjogT2JqZWN0KTogYm9vbGVhbiB7XG4gICAgY29uc3QgbmF2U3RhdGUgPSB0aGlzLnByb3BzLnJlZHVjZXIodGhpcy5zdGF0ZS5uYXZTdGF0ZSwgYWN0aW9uKTtcbiAgICBpZiAobmF2U3RhdGUgPT09IHRoaXMuc3RhdGUubmF2U3RhdGUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAvLyAkRmxvd0ZpeE1lIC0gbmF2U3RhdGUgaXMgbWlzc2luZyBwcm9wZXJ0aWVzIDooXG4gICAgICBuYXZTdGF0ZSxcbiAgICB9KTtcblxuICAgIGlmICh0aGlzLnByb3BzLnBlcnNpc3RlbmNlS2V5KSB7XG4gICAgICBBc3luY1N0b3JhZ2Uuc2V0SXRlbSh0aGlzLnByb3BzLnBlcnNpc3RlbmNlS2V5LCBKU09OLnN0cmluZ2lmeShuYXZTdGF0ZSkpO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgcmVuZGVyKCk6IFJlYWN0RWxlbWVudCB7XG4gICAgY29uc3QgbmF2aWdhdGlvbiA9IHRoaXMucHJvcHMucmVuZGVyTmF2aWdhdGlvbihcbiAgICAgIHRoaXMuc3RhdGUubmF2U3RhdGUsXG4gICAgICB0aGlzLmhhbmRsZU5hdmlnYXRpb25cbiAgICApO1xuICAgIHJldHVybiBuYXZpZ2F0aW9uO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gTmF2aWdhdGlvblJvb3RDb250YWluZXI7XG4iXX0=