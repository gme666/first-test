55cc4bf710579849f5c072742559fda1
Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();







var _react=require('react');var _react2=_interopRequireDefault(_react);



var _reactNative=require('react-native');
var _reactNativeExperimentalNavigation=require('react-native-experimental-navigation');var _reactNativeExperimentalNavigation2=_interopRequireDefault(_reactNativeExperimentalNavigation);

var _Actions=require('./Actions');var _Actions2=_interopRequireDefault(_Actions);
var _State=require('./State');var _State2=_interopRequireDefault(_State);
var _Reducer=require('./Reducer');var _Reducer2=_interopRequireDefault(_Reducer);
var _DefaultRenderer=require('./DefaultRenderer');var _DefaultRenderer2=_interopRequireDefault(_DefaultRenderer);
var _Scene=require('./Scene');var _Scene2=_interopRequireDefault(_Scene);
var _ActionConst=require('./ActionConst');var ActionConst=_interopRequireWildcard(_ActionConst);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key];}}newObj.default=obj;return newObj;}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i];}return target;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var


NavigationRootContainer=_reactNativeExperimentalNavigation2.default.RootContainer;


var propTypes={
dispatch:_react.PropTypes.func,
backAndroidHandler:_react.PropTypes.func,
onBackAndroid:_react.PropTypes.func,
onExitApp:_react.PropTypes.func};var


Router=function(_Component){_inherits(Router,_Component);




function Router(props){_classCallCheck(this,Router);var _this=_possibleConstructorReturn(this,(Router.__proto__||Object.getPrototypeOf(Router)).call(this,
props));
_this.renderNavigation=_this.renderNavigation.bind(_this);
_this.handleProps=_this.handleProps.bind(_this);
_this.handleBackAndroid=_this.handleBackAndroid.bind(_this);
var reducer=_this.handleProps(props);
_this.state={reducer:reducer};return _this;
}_createClass(Router,[{key:'getChildContext',value:function getChildContext()

{
return{
routes:_Actions2.default};

}},{key:'componentDidMount',value:function componentDidMount()

{
_reactNative.BackHandler.addEventListener('hardwareBackPress',this.handleBackAndroid);
}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(

props){
var reducer=this.handleProps(props);
this.setState({reducer:reducer});
}},{key:'componentWillUnmount',value:function componentWillUnmount()

{
_reactNative.BackHandler.removeEventListener('hardwareBackPress',this.handleBackAndroid);
}},{key:'handleBackAndroid',value:function handleBackAndroid()

{var _props=




this.props,backAndroidHandler=_props.backAndroidHandler,onBackAndroid=_props.onBackAndroid,onExitApp=_props.onExitApp;

if(backAndroidHandler){
return backAndroidHandler();
}

try{
_Actions2.default.androidBack();
if(onBackAndroid){
onBackAndroid();
}
return true;
}catch(err){
if(onExitApp){
return onExitApp();
}

return false;
}
}},{key:'handleProps',value:function handleProps(

props){
var scenesMap=void 0;

if(props.scenes){
scenesMap=props.scenes;
}else{
var _scenes=props.children;

if(Array.isArray(props.children)||props.children.props.component){
_scenes=
_react2.default.createElement(_Scene2.default,_extends({
key:'__root',
hideNav:true},
this.props),

props.children);


}
scenesMap=_Actions2.default.create(_scenes,props.wrapBy);
}var


children=props.children,styles=props.styles,scenes=props.scenes,reducer=props.reducer,createReducer=props.createReducer,parentProps=_objectWithoutProperties(props,['children','styles','scenes','reducer','createReducer']);

scenesMap.rootProps=parentProps;

var initialState=(0,_State2.default)(scenesMap);
var reducerCreator=props.createReducer||_Reducer2.default;

var routerReducer=props.reducer||
reducerCreator({
initialState:initialState,
scenes:scenesMap});


return routerReducer;
}},{key:'renderNavigation',value:function renderNavigation(

navigationState,onNavigate){var _this2=this;
if(!navigationState){
return null;
}
_Actions2.default.get=function(key){return(0,_Reducer.findElement)(navigationState,key,ActionConst.REFRESH);};
_Actions2.default.callback=function(props){
var constAction=props.type&&_Actions.ActionMap[props.type]?_Actions.ActionMap[props.type]:null;
if(_this2.props.dispatch){
if(constAction){
_this2.props.dispatch(_extends({},props,{type:constAction}));
}else{
_this2.props.dispatch(props);
}
}
return constAction?onNavigate(_extends({},props,{type:constAction})):onNavigate(props);
};

return _react2.default.createElement(_DefaultRenderer2.default,{onNavigate:onNavigate,navigationState:navigationState});
}},{key:'render',value:function render()

{
if(!this.state.reducer)return null;

return(
_react2.default.createElement(NavigationRootContainer,{
reducer:this.state.reducer,
renderNavigation:this.renderNavigation}));


}}]);return Router;}(_react.Component);Router.childContextTypes={routes:_react.PropTypes.object};


Router.propTypes=propTypes;exports.default=

Router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlJvdXRlci5qcyJdLCJuYW1lcyI6WyJBY3Rpb25Db25zdCIsIk5hdmlnYXRpb25Sb290Q29udGFpbmVyIiwiUm9vdENvbnRhaW5lciIsInByb3BUeXBlcyIsImRpc3BhdGNoIiwiZnVuYyIsImJhY2tBbmRyb2lkSGFuZGxlciIsIm9uQmFja0FuZHJvaWQiLCJvbkV4aXRBcHAiLCJSb3V0ZXIiLCJwcm9wcyIsInJlbmRlck5hdmlnYXRpb24iLCJiaW5kIiwiaGFuZGxlUHJvcHMiLCJoYW5kbGVCYWNrQW5kcm9pZCIsInJlZHVjZXIiLCJzdGF0ZSIsInJvdXRlcyIsImFkZEV2ZW50TGlzdGVuZXIiLCJzZXRTdGF0ZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJhbmRyb2lkQmFjayIsImVyciIsInNjZW5lc01hcCIsInNjZW5lcyIsImNoaWxkcmVuIiwiQXJyYXkiLCJpc0FycmF5IiwiY29tcG9uZW50IiwiY3JlYXRlIiwid3JhcEJ5Iiwic3R5bGVzIiwiY3JlYXRlUmVkdWNlciIsInBhcmVudFByb3BzIiwicm9vdFByb3BzIiwiaW5pdGlhbFN0YXRlIiwicmVkdWNlckNyZWF0b3IiLCJyb3V0ZXJSZWR1Y2VyIiwibmF2aWdhdGlvblN0YXRlIiwib25OYXZpZ2F0ZSIsImdldCIsImtleSIsIlJFRlJFU0giLCJjYWxsYmFjayIsImNvbnN0QWN0aW9uIiwidHlwZSIsImNoaWxkQ29udGV4dFR5cGVzIiwib2JqZWN0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQVFBLDRCOzs7O0FBSUE7QUFDQSx1Rjs7QUFFQSxrQztBQUNBLDhCO0FBQ0Esa0M7QUFDQSxrRDtBQUNBLDhCO0FBQ0EsMEMsR0FBWUEsWTs7O0FBR0tDLHVCLDZDQUFmQyxhOzs7QUFHRixHQUFNQyxXQUFZO0FBQ2hCQyxTQUFVLGlCQUFVQyxJQURKO0FBRWhCQyxtQkFBb0IsaUJBQVVELElBRmQ7QUFHaEJFLGNBQWUsaUJBQVVGLElBSFQ7QUFJaEJHLFVBQVcsaUJBQVVILElBSkwsQ0FBbEIsQzs7O0FBT01JLE07Ozs7O0FBS0osZ0JBQVlDLEtBQVosQ0FBbUI7QUFDWEEsS0FEVztBQUVqQixNQUFLQyxnQkFBTCxDQUF3QixNQUFLQSxnQkFBTCxDQUFzQkMsSUFBdEIsT0FBeEI7QUFDQSxNQUFLQyxXQUFMLENBQW1CLE1BQUtBLFdBQUwsQ0FBaUJELElBQWpCLE9BQW5CO0FBQ0EsTUFBS0UsaUJBQUwsQ0FBeUIsTUFBS0EsaUJBQUwsQ0FBdUJGLElBQXZCLE9BQXpCO0FBQ0EsR0FBTUcsU0FBVSxNQUFLRixXQUFMLENBQWlCSCxLQUFqQixDQUFoQjtBQUNBLE1BQUtNLEtBQUwsQ0FBYSxDQUFFRCxlQUFGLENBQWIsQ0FOaUI7QUFPbEIsQzs7QUFFaUI7QUFDaEIsTUFBTztBQUNMRSx3QkFESyxDQUFQOztBQUdELEM7O0FBRW1CO0FBQ2xCLHlCQUFZQyxnQkFBWixDQUE2QixtQkFBN0IsQ0FBa0QsS0FBS0osaUJBQXZEO0FBQ0QsQzs7QUFFeUJKLEssQ0FBTztBQUMvQixHQUFNSyxTQUFVLEtBQUtGLFdBQUwsQ0FBaUJILEtBQWpCLENBQWhCO0FBQ0EsS0FBS1MsUUFBTCxDQUFjLENBQUVKLGVBQUYsQ0FBZDtBQUNELEM7O0FBRXNCO0FBQ3JCLHlCQUFZSyxtQkFBWixDQUFnQyxtQkFBaEMsQ0FBcUQsS0FBS04saUJBQTFEO0FBQ0QsQzs7QUFFbUI7Ozs7O0FBS2QsS0FBS0osS0FMUyxDQUVoQkosa0JBRmdCLFFBRWhCQSxrQkFGZ0IsQ0FHaEJDLGFBSGdCLFFBR2hCQSxhQUhnQixDQUloQkMsU0FKZ0IsUUFJaEJBLFNBSmdCOztBQU9sQixHQUFJRixrQkFBSixDQUF3QjtBQUN0QixNQUFPQSxxQkFBUDtBQUNEOztBQUVELEdBQUk7QUFDRixrQkFBUWUsV0FBUjtBQUNBLEdBQUlkLGFBQUosQ0FBbUI7QUFDakJBO0FBQ0Q7QUFDRCxNQUFPLEtBQVA7QUFDRCxDQUFDLE1BQU9lLEdBQVAsQ0FBWTtBQUNaLEdBQUlkLFNBQUosQ0FBZTtBQUNiLE1BQU9BLFlBQVA7QUFDRDs7QUFFRCxNQUFPLE1BQVA7QUFDRDtBQUNGLEM7O0FBRVdFLEssQ0FBTztBQUNqQixHQUFJYSxpQkFBSjs7QUFFQSxHQUFJYixNQUFNYyxNQUFWLENBQWtCO0FBQ2hCRCxVQUFZYixNQUFNYyxNQUFsQjtBQUNELENBRkQsSUFFTztBQUNMLEdBQUlBLFNBQVNkLE1BQU1lLFFBQW5COztBQUVBLEdBQUlDLE1BQU1DLE9BQU4sQ0FBY2pCLE1BQU1lLFFBQXBCLEdBQWlDZixNQUFNZSxRQUFOLENBQWVmLEtBQWYsQ0FBcUJrQixTQUExRCxDQUFxRTtBQUNuRUo7QUFDRTtBQUNFLElBQUksUUFETjtBQUVFLFlBRkY7QUFHTSxLQUFLZCxLQUhYOztBQUtHQSxNQUFNZSxRQUxULENBREY7OztBQVNEO0FBQ0RGLFVBQVksa0JBQVFNLE1BQVIsQ0FBZUwsT0FBZixDQUF1QmQsTUFBTW9CLE1BQTdCLENBQVo7QUFDRCxDQXBCZ0I7OztBQXVCVEwsUUF2QlMsQ0F1QjREZixLQXZCNUQsQ0F1QlRlLFFBdkJTLENBdUJDTSxNQXZCRCxDQXVCNERyQixLQXZCNUQsQ0F1QkNxQixNQXZCRCxDQXVCU1AsTUF2QlQsQ0F1QjREZCxLQXZCNUQsQ0F1QlNjLE1BdkJULENBdUJpQlQsT0F2QmpCLENBdUI0REwsS0F2QjVELENBdUJpQkssT0F2QmpCLENBdUIwQmlCLGFBdkIxQixDQXVCNER0QixLQXZCNUQsQ0F1QjBCc0IsYUF2QjFCLENBdUI0Q0MsV0F2QjVDLDBCQXVCNER2QixLQXZCNUQ7O0FBeUJqQmEsVUFBVVcsU0FBVixDQUFzQkQsV0FBdEI7O0FBRUEsR0FBTUUsY0FBZSxvQkFBd0JaLFNBQXhCLENBQXJCO0FBQ0EsR0FBTWEsZ0JBQWlCMUIsTUFBTXNCLGFBQU4sbUJBQXZCOztBQUVBLEdBQU1LLGVBQWdCM0IsTUFBTUssT0FBTjtBQUNwQnFCLGVBQWU7QUFDYkQseUJBRGE7QUFFYlgsT0FBUUQsU0FGSyxDQUFmLENBREY7OztBQU1BLE1BQU9jLGNBQVA7QUFDRCxDOztBQUVnQkMsZSxDQUFpQkMsVSxDQUFZO0FBQzVDLEdBQUksQ0FBQ0QsZUFBTCxDQUFzQjtBQUNwQixNQUFPLEtBQVA7QUFDRDtBQUNELGtCQUFRRSxHQUFSLENBQWMsb0JBQU8seUJBQVlGLGVBQVosQ0FBNkJHLEdBQTdCLENBQWtDekMsWUFBWTBDLE9BQTlDLENBQVAsRUFBZDtBQUNBLGtCQUFRQyxRQUFSLENBQW1CLFNBQUNqQyxLQUFELENBQVc7QUFDNUIsR0FBTWtDLGFBQWVsQyxNQUFNbUMsSUFBTixFQUFjLG1CQUFVbkMsTUFBTW1DLElBQWhCLENBQWQsQ0FBc0MsbUJBQVVuQyxNQUFNbUMsSUFBaEIsQ0FBdEMsQ0FBOEQsSUFBbkY7QUFDQSxHQUFJLE9BQUtuQyxLQUFMLENBQVdOLFFBQWYsQ0FBeUI7QUFDdkIsR0FBSXdDLFdBQUosQ0FBaUI7QUFDZixPQUFLbEMsS0FBTCxDQUFXTixRQUFYLGFBQXlCTSxLQUF6QixFQUFnQ21DLEtBQU1ELFdBQXRDO0FBQ0QsQ0FGRCxJQUVPO0FBQ0wsT0FBS2xDLEtBQUwsQ0FBV04sUUFBWCxDQUFvQk0sS0FBcEI7QUFDRDtBQUNGO0FBQ0QsTUFBUWtDLGFBQWNMLHVCQUFnQjdCLEtBQWhCLEVBQXVCbUMsS0FBTUQsV0FBN0IsR0FBZCxDQUE0REwsV0FBVzdCLEtBQVgsQ0FBcEU7QUFDRCxDQVZEOztBQVlBLE1BQU8sMERBQWlCLFdBQVk2QixVQUE3QixDQUF5QyxnQkFBaUJELGVBQTFELEVBQVA7QUFDRCxDOztBQUVRO0FBQ1AsR0FBSSxDQUFDLEtBQUt0QixLQUFMLENBQVdELE9BQWhCLENBQXlCLE1BQU8sS0FBUDs7QUFFekI7QUFDRSw4QkFBQyx1QkFBRDtBQUNFLFFBQVMsS0FBS0MsS0FBTCxDQUFXRCxPQUR0QjtBQUVFLGlCQUFrQixLQUFLSixnQkFGekIsRUFERjs7O0FBTUQsQyxzQ0EvSEdGLE0sQ0FDR3FDLGlCLENBQW9CLENBQ3pCN0IsT0FBUSxpQkFBVThCLE1BRE8sQzs7O0FBaUk3QnRDLE9BQU9OLFNBQVAsQ0FBbUJBLFNBQW5CLEM7O0FBRWVNLE0iLCJmaWxlIjoiUm91dGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgUGF2ZWwgQWtzb25vdlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKi9cbmltcG9ydCBSZWFjdCwge1xuICBDb21wb25lbnQsXG4gIFByb3BUeXBlcyxcbn0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgQmFja0hhbmRsZXIgfSBmcm9tICdyZWFjdC1uYXRpdmUnO1xuaW1wb3J0IE5hdmlnYXRpb25FeHBlcmltZW50YWwgZnJvbSAncmVhY3QtbmF0aXZlLWV4cGVyaW1lbnRhbC1uYXZpZ2F0aW9uJztcblxuaW1wb3J0IEFjdGlvbnMsIHsgQWN0aW9uTWFwIH0gZnJvbSAnLi9BY3Rpb25zJztcbmltcG9ydCBnZXRJbml0aWFsU3RhdGVGcm9tUm9vdCBmcm9tICcuL1N0YXRlJztcbmltcG9ydCBSZWR1Y2VyLCB7IGZpbmRFbGVtZW50IH0gZnJvbSAnLi9SZWR1Y2VyJztcbmltcG9ydCBEZWZhdWx0UmVuZGVyZXIgZnJvbSAnLi9EZWZhdWx0UmVuZGVyZXInO1xuaW1wb3J0IFNjZW5lIGZyb20gJy4vU2NlbmUnO1xuaW1wb3J0ICogYXMgQWN0aW9uQ29uc3QgZnJvbSAnLi9BY3Rpb25Db25zdCc7XG5cbmNvbnN0IHtcbiAgUm9vdENvbnRhaW5lcjogTmF2aWdhdGlvblJvb3RDb250YWluZXIsXG59ID0gTmF2aWdhdGlvbkV4cGVyaW1lbnRhbDtcblxuY29uc3QgcHJvcFR5cGVzID0ge1xuICBkaXNwYXRjaDogUHJvcFR5cGVzLmZ1bmMsXG4gIGJhY2tBbmRyb2lkSGFuZGxlcjogUHJvcFR5cGVzLmZ1bmMsXG4gIG9uQmFja0FuZHJvaWQ6IFByb3BUeXBlcy5mdW5jLFxuICBvbkV4aXRBcHA6IFByb3BUeXBlcy5mdW5jLFxufTtcblxuY2xhc3MgUm91dGVyIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgc3RhdGljIGNoaWxkQ29udGV4dFR5cGVzID0ge1xuICAgIHJvdXRlczogUHJvcFR5cGVzLm9iamVjdCxcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIHRoaXMucmVuZGVyTmF2aWdhdGlvbiA9IHRoaXMucmVuZGVyTmF2aWdhdGlvbi5iaW5kKHRoaXMpO1xuICAgIHRoaXMuaGFuZGxlUHJvcHMgPSB0aGlzLmhhbmRsZVByb3BzLmJpbmQodGhpcyk7XG4gICAgdGhpcy5oYW5kbGVCYWNrQW5kcm9pZCA9IHRoaXMuaGFuZGxlQmFja0FuZHJvaWQuYmluZCh0aGlzKTtcbiAgICBjb25zdCByZWR1Y2VyID0gdGhpcy5oYW5kbGVQcm9wcyhwcm9wcyk7XG4gICAgdGhpcy5zdGF0ZSA9IHsgcmVkdWNlciB9O1xuICB9XG5cbiAgZ2V0Q2hpbGRDb250ZXh0KCkge1xuICAgIHJldHVybiB7XG4gICAgICByb3V0ZXM6IEFjdGlvbnMsXG4gICAgfTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIEJhY2tIYW5kbGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2hhcmR3YXJlQmFja1ByZXNzJywgdGhpcy5oYW5kbGVCYWNrQW5kcm9pZCk7XG4gIH1cblxuICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKHByb3BzKSB7XG4gICAgY29uc3QgcmVkdWNlciA9IHRoaXMuaGFuZGxlUHJvcHMocHJvcHMpO1xuICAgIHRoaXMuc2V0U3RhdGUoeyByZWR1Y2VyIH0pO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgQmFja0hhbmRsZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcignaGFyZHdhcmVCYWNrUHJlc3MnLCB0aGlzLmhhbmRsZUJhY2tBbmRyb2lkKTtcbiAgfVxuXG4gIGhhbmRsZUJhY2tBbmRyb2lkKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIGJhY2tBbmRyb2lkSGFuZGxlcixcbiAgICAgIG9uQmFja0FuZHJvaWQsXG4gICAgICBvbkV4aXRBcHAsXG4gICAgfSA9IHRoaXMucHJvcHM7XG4gICAgLy8gb3B0aW9uYWwgZm9yIGN1c3RvbWl6aW5nIGhhbmRsZXJcbiAgICBpZiAoYmFja0FuZHJvaWRIYW5kbGVyKSB7XG4gICAgICByZXR1cm4gYmFja0FuZHJvaWRIYW5kbGVyKCk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIEFjdGlvbnMuYW5kcm9pZEJhY2soKTtcbiAgICAgIGlmIChvbkJhY2tBbmRyb2lkKSB7XG4gICAgICAgIG9uQmFja0FuZHJvaWQoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKG9uRXhpdEFwcCkge1xuICAgICAgICByZXR1cm4gb25FeGl0QXBwKCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVQcm9wcyhwcm9wcykge1xuICAgIGxldCBzY2VuZXNNYXA7XG5cbiAgICBpZiAocHJvcHMuc2NlbmVzKSB7XG4gICAgICBzY2VuZXNNYXAgPSBwcm9wcy5zY2VuZXM7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBzY2VuZXMgPSBwcm9wcy5jaGlsZHJlbjtcblxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkocHJvcHMuY2hpbGRyZW4pIHx8IHByb3BzLmNoaWxkcmVuLnByb3BzLmNvbXBvbmVudCkge1xuICAgICAgICBzY2VuZXMgPSAoXG4gICAgICAgICAgPFNjZW5lXG4gICAgICAgICAgICBrZXk9XCJfX3Jvb3RcIlxuICAgICAgICAgICAgaGlkZU5hdlxuICAgICAgICAgICAgey4uLnRoaXMucHJvcHN9XG4gICAgICAgICAgPlxuICAgICAgICAgICAge3Byb3BzLmNoaWxkcmVufVxuICAgICAgICAgIDwvU2NlbmU+XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBzY2VuZXNNYXAgPSBBY3Rpb25zLmNyZWF0ZShzY2VuZXMsIHByb3BzLndyYXBCeSk7XG4gICAgfVxuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG4gICAgY29uc3QgeyBjaGlsZHJlbiwgc3R5bGVzLCBzY2VuZXMsIHJlZHVjZXIsIGNyZWF0ZVJlZHVjZXIsIC4uLnBhcmVudFByb3BzIH0gPSBwcm9wcztcblxuICAgIHNjZW5lc01hcC5yb290UHJvcHMgPSBwYXJlbnRQcm9wcztcblxuICAgIGNvbnN0IGluaXRpYWxTdGF0ZSA9IGdldEluaXRpYWxTdGF0ZUZyb21Sb290KHNjZW5lc01hcCk7XG4gICAgY29uc3QgcmVkdWNlckNyZWF0b3IgPSBwcm9wcy5jcmVhdGVSZWR1Y2VyIHx8IFJlZHVjZXI7XG5cbiAgICBjb25zdCByb3V0ZXJSZWR1Y2VyID0gcHJvcHMucmVkdWNlciB8fCAoXG4gICAgICByZWR1Y2VyQ3JlYXRvcih7XG4gICAgICAgIGluaXRpYWxTdGF0ZSxcbiAgICAgICAgc2NlbmVzOiBzY2VuZXNNYXAsXG4gICAgICB9KSk7XG5cbiAgICByZXR1cm4gcm91dGVyUmVkdWNlcjtcbiAgfVxuXG4gIHJlbmRlck5hdmlnYXRpb24obmF2aWdhdGlvblN0YXRlLCBvbk5hdmlnYXRlKSB7XG4gICAgaWYgKCFuYXZpZ2F0aW9uU3RhdGUpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBBY3Rpb25zLmdldCA9IGtleSA9PiBmaW5kRWxlbWVudChuYXZpZ2F0aW9uU3RhdGUsIGtleSwgQWN0aW9uQ29uc3QuUkVGUkVTSCk7XG4gICAgQWN0aW9ucy5jYWxsYmFjayA9IChwcm9wcykgPT4ge1xuICAgICAgY29uc3QgY29uc3RBY3Rpb24gPSAocHJvcHMudHlwZSAmJiBBY3Rpb25NYXBbcHJvcHMudHlwZV0gPyBBY3Rpb25NYXBbcHJvcHMudHlwZV0gOiBudWxsKTtcbiAgICAgIGlmICh0aGlzLnByb3BzLmRpc3BhdGNoKSB7XG4gICAgICAgIGlmIChjb25zdEFjdGlvbikge1xuICAgICAgICAgIHRoaXMucHJvcHMuZGlzcGF0Y2goeyAuLi5wcm9wcywgdHlwZTogY29uc3RBY3Rpb24gfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5wcm9wcy5kaXNwYXRjaChwcm9wcyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiAoY29uc3RBY3Rpb24gPyBvbk5hdmlnYXRlKHsgLi4ucHJvcHMsIHR5cGU6IGNvbnN0QWN0aW9uIH0pIDogb25OYXZpZ2F0ZShwcm9wcykpO1xuICAgIH07XG5cbiAgICByZXR1cm4gPERlZmF1bHRSZW5kZXJlciBvbk5hdmlnYXRlPXtvbk5hdmlnYXRlfSBuYXZpZ2F0aW9uU3RhdGU9e25hdmlnYXRpb25TdGF0ZX0gLz47XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgaWYgKCF0aGlzLnN0YXRlLnJlZHVjZXIpIHJldHVybiBudWxsO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxOYXZpZ2F0aW9uUm9vdENvbnRhaW5lclxuICAgICAgICByZWR1Y2VyPXt0aGlzLnN0YXRlLnJlZHVjZXJ9XG4gICAgICAgIHJlbmRlck5hdmlnYXRpb249e3RoaXMucmVuZGVyTmF2aWdhdGlvbn1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxufVxuXG5Sb3V0ZXIucHJvcFR5cGVzID0gcHJvcFR5cGVzO1xuXG5leHBvcnQgZGVmYXVsdCBSb3V0ZXI7XG4iXX0=