8c0521116020ed9606512f44fe02dfe4
Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _react=require('react');var _react2=_interopRequireDefault(_react);
var _reactNative=require('react-native');



var _propTypes=require('prop-types');var _propTypes2=_interopRequireDefault(_propTypes);

var _xdate=require('xdate');var _xdate2=_interopRequireDefault(_xdate);
var _dateutils=require('../dateutils');var _dateutils2=_interopRequireDefault(_dateutils);
var _interface=require('../interface');
var _style=require('./style');var _style2=_interopRequireDefault(_style);
var _basic=require('./day/basic');var _basic2=_interopRequireDefault(_basic);
var _interactive=require('./day/interactive');var _interactive2=_interopRequireDefault(_interactive);
var _header=require('./header');var _header2=_interopRequireDefault(_header);
var _updater=require('./updater');var _updater2=_interopRequireDefault(_updater);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}


var viewPropTypes=_reactNative.ViewPropTypes||_reactNative.View.propTypes;

var EmptyArray=[];var

Calendar=function(_Component){_inherits(Calendar,_Component);














































function Calendar(props){_classCallCheck(this,Calendar);var _this=_possibleConstructorReturn(this,(Calendar.__proto__||Object.getPrototypeOf(Calendar)).call(this,
props));
_this.style=(0,_style2.default)(_this.props.theme);
var currentMonth=void 0;
if(props.current){
currentMonth=(0,_interface.parseDate)(props.current);
}else{
currentMonth=props.selected&&props.selected[0]?(0,_interface.parseDate)(props.selected[0]):(0,_xdate2.default)();
}
_this.state={
currentMonth:currentMonth};


_this.updateMonth=_this.updateMonth.bind(_this);
_this.addMonth=_this.addMonth.bind(_this);
_this.isSelected=_this.isSelected.bind(_this);
_this.pressDay=_this.pressDay.bind(_this);
_this.shouldComponentUpdate=_updater2.default;return _this;
}_createClass(Calendar,[{key:'componentWillReceiveProps',value:function componentWillReceiveProps(

nextProps){
var current=(0,_interface.parseDate)(nextProps.current);
if(current&&current.toString('yyyy MM')!==this.state.currentMonth.toString('yyyy MM')){
this.setState({
currentMonth:current.clone()});

}
}},{key:'updateMonth',value:function updateMonth(

day,doNotTriggerListeners){var _this2=this;
if(day.toString('yyyy MM')===this.state.currentMonth.toString('yyyy MM')){
return;
}
this.setState({
currentMonth:day.clone()},
function(){
if(!doNotTriggerListeners){
var currMont=_this2.state.currentMonth.clone();
if(_this2.props.onMonthChange){
_this2.props.onMonthChange((0,_interface.xdateToData)(currMont));
}
if(_this2.props.onVisibleMonthsChange){
_this2.props.onVisibleMonthsChange([(0,_interface.xdateToData)(currMont)]);
}
}
});
}},{key:'pressDay',value:function pressDay(

day){
var minDate=(0,_interface.parseDate)(this.props.minDate);
var maxDate=(0,_interface.parseDate)(this.props.maxDate);
if(!(minDate&&!_dateutils2.default.isGTE(day,minDate))&&!(maxDate&&!_dateutils2.default.isLTE(day,maxDate))){
var shouldUpdateMonth=this.props.disableMonthChange===undefined||!this.props.disableMonthChange;
if(shouldUpdateMonth){
this.updateMonth(day);
}
if(this.props.onDayPress){
this.props.onDayPress((0,_interface.xdateToData)(day));
}
}
}},{key:'addMonth',value:function addMonth(

count){
this.updateMonth(this.state.currentMonth.clone().addMonths(count,true));
}},{key:'isSelected',value:function isSelected(

day){
var selectedDays=[];
if(this.props.selected){
selectedDays=this.props.selected;
}
for(var i=0;i<selectedDays.length;i++){
if(_dateutils2.default.sameDate(day,(0,_interface.parseDate)(selectedDays[i]))){
return true;
}
}
return false;
}},{key:'renderDay',value:function renderDay(

day,id){
var minDate=(0,_interface.parseDate)(this.props.minDate);
var maxDate=(0,_interface.parseDate)(this.props.maxDate);
var state='';
if(this.isSelected(day)){
state='selected';
}else if(minDate&&!_dateutils2.default.isGTE(day,minDate)||maxDate&&!_dateutils2.default.isLTE(day,maxDate)){
state='disabled';
}else if(!_dateutils2.default.sameMonth(day,this.state.currentMonth)){
state='disabled';
}else if(_dateutils2.default.sameDate(day,(0,_xdate2.default)())){
state='today';
}
var dayComp=void 0;
if(!_dateutils2.default.sameMonth(day,this.state.currentMonth)&&this.props.hideExtraDays){
if(this.props.markingType==='interactive'){
dayComp=_react2.default.createElement(_reactNative.View,{key:id,style:{flex:1}});
}else{
dayComp=_react2.default.createElement(_reactNative.View,{key:id,style:{width:32}});
}
}else{
var DayComp=this.props.markingType==='interactive'?_interactive2.default:_basic2.default;
var markingExists=this.props.markedDates?true:false;
dayComp=
_react2.default.createElement(DayComp,{
key:id,
state:state,
theme:this.props.theme,
onPress:this.pressDay,
day:day,
marked:this.getDateMarking(day),
markingExists:markingExists},

day.getDate());


}
return dayComp;
}},{key:'getDateMarking',value:function getDateMarking(

day){
if(!this.props.markedDates){
return false;
}
var dates=this.props.markedDates[day.toString('yyyy-MM-dd')]||EmptyArray;
if(dates.length||dates){
return dates;
}else{
return false;
}
}},{key:'renderWeek',value:function renderWeek(

days,id){var _this3=this;
var week=[];
days.forEach(function(day,id2){
week.push(_this3.renderDay(day,id2));
},this);
return _react2.default.createElement(_reactNative.View,{style:this.style.week,key:id},week);
}},{key:'render',value:function render()

{

var days=_dateutils2.default.page(this.state.currentMonth,this.props.firstDay);
var weeks=[];
while(days.length){
weeks.push(this.renderWeek(days.splice(0,7),weeks.length));
}
var indicator=void 0;
var current=(0,_interface.parseDate)(this.props.current);
if(current){
var lastMonthOfDay=current.clone().addMonths(1,true).setDate(1).addDays(-1).toString('yyyy-MM-dd');
if(this.props.displayLoadingIndicator&&
!(this.props.markedDates&&this.props.markedDates[lastMonthOfDay])){
indicator=true;
}
}
return(
_react2.default.createElement(_reactNative.View,{style:[this.style.container,this.props.style]},
_react2.default.createElement(_header2.default,{
theme:this.props.theme,
hideArrows:this.props.hideArrows,
month:this.state.currentMonth,
addMonth:this.addMonth,
showIndicator:indicator,
firstDay:this.props.firstDay,
renderArrow:this.props.renderArrow,
monthFormat:this.props.monthFormat,
hideDayNames:this.props.hideDayNames}),

weeks));

}}]);return Calendar;}(_react.Component);Calendar.propTypes={theme:_propTypes2.default.object,markedDates:_propTypes2.default.object,style:viewPropTypes.style,selected:_propTypes2.default.array,current:_propTypes2.default.any,minDate:_propTypes2.default.any,maxDate:_propTypes2.default.any,firstDay:_propTypes2.default.number,markingType:_propTypes2.default.string,hideArrows:_propTypes2.default.bool,displayLoadingIndicator:_propTypes2.default.bool,hideExtraDays:_propTypes2.default.bool,onDayPress:_propTypes2.default.func,onMonthChange:_propTypes2.default.func,onVisibleMonthsChange:_propTypes2.default.func,renderArrow:_propTypes2.default.func,monthFormat:_propTypes2.default.string,disableMonthChange:_propTypes2.default.bool,hideDayNames:_propTypes2.default.bool};exports.default=


Calendar;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbInZpZXdQcm9wVHlwZXMiLCJwcm9wVHlwZXMiLCJFbXB0eUFycmF5IiwiQ2FsZW5kYXIiLCJwcm9wcyIsInN0eWxlIiwidGhlbWUiLCJjdXJyZW50TW9udGgiLCJjdXJyZW50Iiwic2VsZWN0ZWQiLCJzdGF0ZSIsInVwZGF0ZU1vbnRoIiwiYmluZCIsImFkZE1vbnRoIiwiaXNTZWxlY3RlZCIsInByZXNzRGF5Iiwic2hvdWxkQ29tcG9uZW50VXBkYXRlIiwibmV4dFByb3BzIiwidG9TdHJpbmciLCJzZXRTdGF0ZSIsImNsb25lIiwiZGF5IiwiZG9Ob3RUcmlnZ2VyTGlzdGVuZXJzIiwiY3Vyck1vbnQiLCJvbk1vbnRoQ2hhbmdlIiwib25WaXNpYmxlTW9udGhzQ2hhbmdlIiwibWluRGF0ZSIsIm1heERhdGUiLCJpc0dURSIsImlzTFRFIiwic2hvdWxkVXBkYXRlTW9udGgiLCJkaXNhYmxlTW9udGhDaGFuZ2UiLCJ1bmRlZmluZWQiLCJvbkRheVByZXNzIiwiY291bnQiLCJhZGRNb250aHMiLCJzZWxlY3RlZERheXMiLCJpIiwibGVuZ3RoIiwic2FtZURhdGUiLCJpZCIsInNhbWVNb250aCIsImRheUNvbXAiLCJoaWRlRXh0cmFEYXlzIiwibWFya2luZ1R5cGUiLCJmbGV4Iiwid2lkdGgiLCJEYXlDb21wIiwibWFya2luZ0V4aXN0cyIsIm1hcmtlZERhdGVzIiwiZ2V0RGF0ZU1hcmtpbmciLCJnZXREYXRlIiwiZGF0ZXMiLCJkYXlzIiwid2VlayIsImZvckVhY2giLCJpZDIiLCJwdXNoIiwicmVuZGVyRGF5IiwicGFnZSIsImZpcnN0RGF5Iiwid2Vla3MiLCJyZW5kZXJXZWVrIiwic3BsaWNlIiwiaW5kaWNhdG9yIiwibGFzdE1vbnRoT2ZEYXkiLCJzZXREYXRlIiwiYWRkRGF5cyIsImRpc3BsYXlMb2FkaW5nSW5kaWNhdG9yIiwiY29udGFpbmVyIiwiaGlkZUFycm93cyIsInJlbmRlckFycm93IiwibW9udGhGb3JtYXQiLCJoaWRlRGF5TmFtZXMiLCJvYmplY3QiLCJhcnJheSIsImFueSIsIm51bWJlciIsInN0cmluZyIsImJvb2wiLCJmdW5jIl0sIm1hcHBpbmdzIjoidWpCQUFBLDRCO0FBQ0E7Ozs7QUFJQSxxQzs7QUFFQSw0QjtBQUNBLHVDO0FBQ0E7QUFDQSw4QjtBQUNBLGtDO0FBQ0EsOEM7QUFDQSxnQztBQUNBLGtDOzs7QUFHQSxHQUFNQSxlQUFnQiw0QkFBaUIsa0JBQUtDLFNBQTVDOztBQUVBLEdBQU1DLFlBQWEsRUFBbkIsQzs7QUFFTUMsUTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUErQ0osa0JBQVlDLEtBQVosQ0FBbUI7QUFDWEEsS0FEVztBQUVqQixNQUFLQyxLQUFMLENBQWEsb0JBQWlCLE1BQUtELEtBQUwsQ0FBV0UsS0FBNUIsQ0FBYjtBQUNBLEdBQUlDLG9CQUFKO0FBQ0EsR0FBSUgsTUFBTUksT0FBVixDQUFtQjtBQUNqQkQsYUFBZSx5QkFBVUgsTUFBTUksT0FBaEIsQ0FBZjtBQUNELENBRkQsSUFFTztBQUNMRCxhQUFlSCxNQUFNSyxRQUFOLEVBQWtCTCxNQUFNSyxRQUFOLENBQWUsQ0FBZixDQUFsQixDQUFzQyx5QkFBVUwsTUFBTUssUUFBTixDQUFlLENBQWYsQ0FBVixDQUF0QyxDQUFxRSxxQkFBcEY7QUFDRDtBQUNELE1BQUtDLEtBQUwsQ0FBYTtBQUNYSCx5QkFEVyxDQUFiOzs7QUFJQSxNQUFLSSxXQUFMLENBQW1CLE1BQUtBLFdBQUwsQ0FBaUJDLElBQWpCLE9BQW5CO0FBQ0EsTUFBS0MsUUFBTCxDQUFnQixNQUFLQSxRQUFMLENBQWNELElBQWQsT0FBaEI7QUFDQSxNQUFLRSxVQUFMLENBQWtCLE1BQUtBLFVBQUwsQ0FBZ0JGLElBQWhCLE9BQWxCO0FBQ0EsTUFBS0csUUFBTCxDQUFnQixNQUFLQSxRQUFMLENBQWNILElBQWQsT0FBaEI7QUFDQSxNQUFLSSxxQkFBTCxtQkFqQmlCO0FBa0JsQixDOztBQUV5QkMsUyxDQUFXO0FBQ25DLEdB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S0FBS25FLEtBQUwsQ0FBV29FLFdBUjFCO0FBU0UsYUFBYyxLQUFLcEUsS0FBTCxDQUFXcUUsWUFUM0IsRUFERjs7QUFZR1osS0FaSCxDQURGOztBQWVELEMsd0NBek5HMUQsUSxDQUNHRixTLENBQVksQ0FFakJLLE1BQU8sb0JBQVVvRSxNQUZBLENBSWpCekIsWUFBYSxvQkFBVXlCLE1BSk4sQ0FPakJyRSxNQUFPTCxjQUFjSyxLQVBKLENBU2pCSSxTQUFVLG9CQUFVa0UsS0FUSCxDQVlqQm5FLFFBQVMsb0JBQVVvRSxHQVpGLENBY2pCbEQsUUFBUyxvQkFBVWtELEdBZEYsQ0FnQmpCakQsUUFBUyxvQkFBVWlELEdBaEJGLENBbUJqQmhCLFNBQVUsb0JBQVVpQixNQW5CSCxDQXNCakJqQyxZQUFhLG9CQUFVa0MsTUF0Qk4sQ0F5QmpCUixXQUFZLG9CQUFVUyxJQXpCTCxDQTJCakJYLHdCQUF5QixvQkFBVVcsSUEzQmxCLENBNkJqQnBDLGNBQWUsb0JBQVVvQyxJQTdCUixDQWdDakI5QyxXQUFZLG9CQUFVK0MsSUFoQ0wsQ0FrQ2pCeEQsY0FBZSxvQkFBVXdELElBbENSLENBbUNqQnZELHNCQUF1QixvQkFBVXVELElBbkNoQixDQXFDakJULFlBQWEsb0JBQVVTLElBckNOLENBdUNqQlIsWUFBYSxvQkFBVU0sTUF2Q04sQ0F5Q2pCL0MsbUJBQW9CLG9CQUFVZ0QsSUF6Q2IsQ0EyQ2pCTixhQUFjLG9CQUFVTSxJQTNDUCxDOzs7QUEyTk41RSxRIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7Q29tcG9uZW50fSBmcm9tICdyZWFjdCc7XG5pbXBvcnQge1xuICBWaWV3LFxuICBWaWV3UHJvcFR5cGVzLFxufSBmcm9tICdyZWFjdC1uYXRpdmUnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcblxuaW1wb3J0IFhEYXRlIGZyb20gJ3hkYXRlJztcbmltcG9ydCBkYXRldXRpbHMgZnJvbSAnLi4vZGF0ZXV0aWxzJztcbmltcG9ydCB7eGRhdGVUb0RhdGEsIHBhcnNlRGF0ZX0gZnJvbSAnLi4vaW50ZXJmYWNlJztcbmltcG9ydCBzdHlsZUNvbnN0cnVjdG9yIGZyb20gJy4vc3R5bGUnO1xuaW1wb3J0IERheSBmcm9tICcuL2RheS9iYXNpYyc7XG5pbXBvcnQgVW5pdERheSBmcm9tICcuL2RheS9pbnRlcmFjdGl2ZSc7XG5pbXBvcnQgQ2FsZW5kYXJIZWFkZXIgZnJvbSAnLi9oZWFkZXInO1xuaW1wb3J0IHNob3VsZENvbXBvbmVudFVwZGF0ZSBmcm9tICcuL3VwZGF0ZXInO1xuXG4vL0ZhbGxiYWNrIHdoZW4gUk4gdmVyc2lvbiBpcyA8IDAuNDRcbmNvbnN0IHZpZXdQcm9wVHlwZXMgPSBWaWV3UHJvcFR5cGVzIHx8IFZpZXcucHJvcFR5cGVzO1xuXG5jb25zdCBFbXB0eUFycmF5ID0gW107XG5cbmNsYXNzIENhbGVuZGFyIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICAvLyBTcGVjaWZ5IHRoZW1lIHByb3BlcnRpZXMgdG8gb3ZlcnJpZGUgc3BlY2lmaWMgc3R5bGVzIGZvciBjYWxlbmRhciBwYXJ0cy4gRGVmYXVsdCA9IHt9XG4gICAgdGhlbWU6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgLy8gQ29sbGVjdGlvbiBvZiBkYXRlcyB0aGF0IGhhdmUgdG8gYmUgbWFya2VkLiBEZWZhdWx0ID0ge31cbiAgICBtYXJrZWREYXRlczogUHJvcFR5cGVzLm9iamVjdCxcblxuICAgIC8vIFNwZWNpZnkgc3R5bGUgZm9yIGNhbGVuZGFyIGNvbnRhaW5lciBlbGVtZW50LiBEZWZhdWx0ID0ge31cbiAgICBzdHlsZTogdmlld1Byb3BUeXBlcy5zdHlsZSxcblxuICAgIHNlbGVjdGVkOiBQcm9wVHlwZXMuYXJyYXksXG5cbiAgICAvLyBJbml0aWFsbHkgdmlzaWJsZSBtb250aC4gRGVmYXVsdCA9IERhdGUoKVxuICAgIGN1cnJlbnQ6IFByb3BUeXBlcy5hbnksXG4gICAgLy8gTWluaW11bSBkYXRlIHRoYXQgY2FuIGJlIHNlbGVjdGVkLCBkYXRlcyBiZWZvcmUgbWluRGF0ZSB3aWxsIGJlIGdyYXllZCBvdXQuIERlZmF1bHQgPSB1bmRlZmluZWRcbiAgICBtaW5EYXRlOiBQcm9wVHlwZXMuYW55LFxuICAgIC8vIE1heGltdW0gZGF0ZSB0aGF0IGNhbiBiZSBzZWxlY3RlZCwgZGF0ZXMgYWZ0ZXIgbWF4RGF0ZSB3aWxsIGJlIGdyYXllZCBvdXQuIERlZmF1bHQgPSB1bmRlZmluZWRcbiAgICBtYXhEYXRlOiBQcm9wVHlwZXMuYW55LFxuXG4gICAgLy8gSWYgZmlyc3REYXk9MSB3ZWVrIHN0YXJ0cyBmcm9tIE1vbmRheS4gTm90ZSB0aGF0IGRheU5hbWVzIGFuZCBkYXlOYW1lc1Nob3J0IHNob3VsZCBzdGlsbCBzdGFydCBmcm9tIFN1bmRheS5cbiAgICBmaXJzdERheTogUHJvcFR5cGVzLm51bWJlcixcblxuICAgIC8vIERhdGUgbWFya2luZyBzdHlsZSBbc2ltcGxlL2ludGVyYWN0aXZlXS4gRGVmYXVsdCA9ICdzaW1wbGUnXG4gICAgbWFya2luZ1R5cGU6IFByb3BUeXBlcy5zdHJpbmcsXG5cbiAgICAvLyBIaWRlIG1vbnRoIG5hdmlnYXRpb24gYXJyb3dzLiBEZWZhdWx0ID0gZmFsc2VcbiAgICBoaWRlQXJyb3dzOiBQcm9wVHlwZXMuYm9vbCxcbiAgICAvLyBEaXNwbGF5IGxvYWRpbmcgaW5kaWNhZG9yLiBEZWZhdWx0ID0gZmFsc2VcbiAgICBkaXNwbGF5TG9hZGluZ0luZGljYXRvcjogUHJvcFR5cGVzLmJvb2wsXG4gICAgLy8gRG8gbm90IHNob3cgZGF5cyBvZiBvdGhlciBtb250aHMgaW4gbW9udGggcGFnZS4gRGVmYXVsdCA9IGZhbHNlXG4gICAgaGlkZUV4dHJhRGF5czogUHJvcFR5cGVzLmJvb2wsXG5cbiAgICAvLyBIYW5kbGVyIHdoaWNoIGdldHMgZXhlY3V0ZWQgb24gZGF5IHByZXNzLiBEZWZhdWx0ID0gdW5kZWZpbmVkXG4gICAgb25EYXlQcmVzczogUHJvcFR5cGVzLmZ1bmMsXG4gICAgLy8gSGFuZGxlciB3aGljaCBnZXRzIGV4ZWN1dGVkIHdoZW4gdmlzaWJsZSBtb250aCBjaGFuZ2VzIGluIGNhbGVuZGFyLiBEZWZhdWx0ID0gdW5kZWZpbmVkXG4gICAgb25Nb250aENoYW5nZTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25WaXNpYmxlTW9udGhzQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYyxcbiAgICAvLyBSZXBsYWNlIGRlZmF1bHQgYXJyb3dzIHdpdGggY3VzdG9tIG9uZXMgKGRpcmVjdGlvbiBjYW4gYmUgJ2xlZnQnIG9yICdyaWdodCcpXG4gICAgcmVuZGVyQXJyb3c6IFByb3BUeXBlcy5mdW5jLFxuICAgIC8vIE1vbnRoIGZvcm1hdCBpbiBjYWxlbmRhciB0aXRsZS4gRm9ybWF0dGluZyB2YWx1ZXM6IGh0dHA6Ly9hcnNoYXcuY29tL3hkYXRlLyNGb3JtYXR0aW5nXG4gICAgbW9udGhGb3JtYXQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgLy8gRGlzYWJsZXMgY2hhbmdpbmcgbW9udGggd2hlbiBjbGljayBvbiBkYXlzIG9mIG90aGVyIG1vbnRocyAod2hlbiBoaWRlRXh0cmFEYXlzIGlzIGZhbHNlKS4gRGVmYXVsdCA9IGZhbHNlXG4gICAgZGlzYWJsZU1vbnRoQ2hhbmdlOiBQcm9wVHlwZXMuYm9vbCxcbiAgICAvL0hpZGUgZGF5IG5hbWVzLiBEZWZhdWx0ID0gZmFsc2VcbiAgICBoaWRlRGF5TmFtZXM6IFByb3BUeXBlcy5ib29sXG4gIH07XG5cbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgdGhpcy5zdHlsZSA9IHN0eWxlQ29uc3RydWN0b3IodGhpcy5wcm9wcy50aGVtZSk7XG4gICAgbGV0IGN1cnJlbnRNb250aDtcbiAgICBpZiAocHJvcHMuY3VycmVudCkge1xuICAgICAgY3VycmVudE1vbnRoID0gcGFyc2VEYXRlKHByb3BzLmN1cnJlbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjdXJyZW50TW9udGggPSBwcm9wcy5zZWxlY3RlZCAmJiBwcm9wcy5zZWxlY3RlZFswXSA/IHBhcnNlRGF0ZShwcm9wcy5zZWxlY3RlZFswXSkgOiBYRGF0ZSgpO1xuICAgIH1cbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgY3VycmVudE1vbnRoXG4gICAgfTtcblxuICAgIHRoaXMudXBkYXRlTW9udGggPSB0aGlzLnVwZGF0ZU1vbnRoLmJpbmQodGhpcyk7XG4gICAgdGhpcy5hZGRNb250aCA9IHRoaXMuYWRkTW9udGguYmluZCh0aGlzKTtcbiAgICB0aGlzLmlzU2VsZWN0ZWQgPSB0aGlzLmlzU2VsZWN0ZWQuYmluZCh0aGlzKTtcbiAgICB0aGlzLnByZXNzRGF5ID0gdGhpcy5wcmVzc0RheS5iaW5kKHRoaXMpO1xuICAgIHRoaXMuc2hvdWxkQ29tcG9uZW50VXBkYXRlID0gc2hvdWxkQ29tcG9uZW50VXBkYXRlO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHtcbiAgICBjb25zdCBjdXJyZW50PSBwYXJzZURhdGUobmV4dFByb3BzLmN1cnJlbnQpO1xuICAgIGlmIChjdXJyZW50ICYmIGN1cnJlbnQudG9TdHJpbmcoJ3l5eXkgTU0nKSAhPT0gdGhpcy5zdGF0ZS5jdXJyZW50TW9udGgudG9TdHJpbmcoJ3l5eXkgTU0nKSkge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIGN1cnJlbnRNb250aDogY3VycmVudC5jbG9uZSgpXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICB1cGRhdGVNb250aChkYXksIGRvTm90VHJpZ2dlckxpc3RlbmVycykge1xuICAgIGlmIChkYXkudG9TdHJpbmcoJ3l5eXkgTU0nKSA9PT0gdGhpcy5zdGF0ZS5jdXJyZW50TW9udGgudG9TdHJpbmcoJ3l5eXkgTU0nKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGN1cnJlbnRNb250aDogZGF5LmNsb25lKClcbiAgICB9LCAoKSA9PiB7XG4gICAgICBpZiAoIWRvTm90VHJpZ2dlckxpc3RlbmVycykge1xuICAgICAgICBjb25zdCBjdXJyTW9udCA9IHRoaXMuc3RhdGUuY3VycmVudE1vbnRoLmNsb25lKCk7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLm9uTW9udGhDaGFuZ2UpIHtcbiAgICAgICAgICB0aGlzLnByb3BzLm9uTW9udGhDaGFuZ2UoeGRhdGVUb0RhdGEoY3Vyck1vbnQpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wcm9wcy5vblZpc2libGVNb250aHNDaGFuZ2UpIHtcbiAgICAgICAgICB0aGlzLnByb3BzLm9uVmlzaWJsZU1vbnRoc0NoYW5nZShbeGRhdGVUb0RhdGEoY3Vyck1vbnQpXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByZXNzRGF5KGRheSkge1xuICAgIGNvbnN0IG1pbkRhdGUgPSBwYXJzZURhdGUodGhpcy5wcm9wcy5taW5EYXRlKTtcbiAgICBjb25zdCBtYXhEYXRlID0gcGFyc2VEYXRlKHRoaXMucHJvcHMubWF4RGF0ZSk7XG4gICAgaWYgKCEobWluRGF0ZSAmJiAhZGF0ZXV0aWxzLmlzR1RFKGRheSwgbWluRGF0ZSkpICYmICEobWF4RGF0ZSAmJiAhZGF0ZXV0aWxzLmlzTFRFKGRheSwgbWF4RGF0ZSkpKSB7XG4gICAgICBjb25zdCBzaG91bGRVcGRhdGVNb250aCA9IHRoaXMucHJvcHMuZGlzYWJsZU1vbnRoQ2hhbmdlID09PSB1bmRlZmluZWQgfHwgIXRoaXMucHJvcHMuZGlzYWJsZU1vbnRoQ2hhbmdlO1xuICAgICAgaWYgKHNob3VsZFVwZGF0ZU1vbnRoKSB7XG4gICAgICAgIHRoaXMudXBkYXRlTW9udGgoZGF5KTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLnByb3BzLm9uRGF5UHJlc3MpIHtcbiAgICAgICAgdGhpcy5wcm9wcy5vbkRheVByZXNzKHhkYXRlVG9EYXRhKGRheSkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFkZE1vbnRoKGNvdW50KSB7XG4gICAgdGhpcy51cGRhdGVNb250aCh0aGlzLnN0YXRlLmN1cnJlbnRNb250aC5jbG9uZSgpLmFkZE1vbnRocyhjb3VudCwgdHJ1ZSkpO1xuICB9XG5cbiAgaXNTZWxlY3RlZChkYXkpIHtcbiAgICBsZXQgc2VsZWN0ZWREYXlzID0gW107XG4gICAgaWYgKHRoaXMucHJvcHMuc2VsZWN0ZWQpIHtcbiAgICAgIHNlbGVjdGVkRGF5cyA9IHRoaXMucHJvcHMuc2VsZWN0ZWQ7XG4gICAgfVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2VsZWN0ZWREYXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoZGF0ZXV0aWxzLnNhbWVEYXRlKGRheSwgcGFyc2VEYXRlKHNlbGVjdGVkRGF5c1tpXSkpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICByZW5kZXJEYXkoZGF5LCBpZCkge1xuICAgIGNvbnN0IG1pbkRhdGUgPSBwYXJzZURhdGUodGhpcy5wcm9wcy5taW5EYXRlKTtcbiAgICBjb25zdCBtYXhEYXRlID0gcGFyc2VEYXRlKHRoaXMucHJvcHMubWF4RGF0ZSk7XG4gICAgbGV0IHN0YXRlID0gJyc7XG4gICAgaWYgKHRoaXMuaXNTZWxlY3RlZChkYXkpKSB7XG4gICAgICBzdGF0ZSA9ICdzZWxlY3RlZCc7XG4gICAgfSBlbHNlIGlmICgobWluRGF0ZSAmJiAhZGF0ZXV0aWxzLmlzR1RFKGRheSwgbWluRGF0ZSkpIHx8IChtYXhEYXRlICYmICFkYXRldXRpbHMuaXNMVEUoZGF5LCBtYXhEYXRlKSkpIHtcbiAgICAgIHN0YXRlID0gJ2Rpc2FibGVkJztcbiAgICB9IGVsc2UgaWYgKCFkYXRldXRpbHMuc2FtZU1vbnRoKGRheSwgdGhpcy5zdGF0ZS5jdXJyZW50TW9udGgpKSB7XG4gICAgICBzdGF0ZSA9ICdkaXNhYmxlZCc7XG4gICAgfSBlbHNlIGlmIChkYXRldXRpbHMuc2FtZURhdGUoZGF5LCBYRGF0ZSgpKSkge1xuICAgICAgc3RhdGUgPSAndG9kYXknO1xuICAgIH1cbiAgICBsZXQgZGF5Q29tcDtcbiAgICBpZiAoIWRhdGV1dGlscy5zYW1lTW9udGgoZGF5LCB0aGlzLnN0YXRlLmN1cnJlbnRNb250aCkgJiYgdGhpcy5wcm9wcy5oaWRlRXh0cmFEYXlzKSB7XG4gICAgICBpZiAodGhpcy5wcm9wcy5tYXJraW5nVHlwZSA9PT0gJ2ludGVyYWN0aXZlJykge1xuICAgICAgICBkYXlDb21wID0gKDxWaWV3IGtleT17aWR9IHN0eWxlPXt7ZmxleDogMX19Lz4pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGF5Q29tcCA9ICg8VmlldyBrZXk9e2lkfSBzdHlsZT17e3dpZHRoOiAzMn19Lz4pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBEYXlDb21wID0gdGhpcy5wcm9wcy5tYXJraW5nVHlwZSA9PT0gJ2ludGVyYWN0aXZlJyA/IFVuaXREYXkgOiBEYXk7XG4gICAgICBjb25zdCBtYXJraW5nRXhpc3RzID0gdGhpcy5wcm9wcy5tYXJrZWREYXRlcyA/IHRydWUgOiBmYWxzZTtcbiAgICAgIGRheUNvbXAgPSAoXG4gICAgICAgIDxEYXlDb21wXG4gICAgICAgICAgICBrZXk9e2lkfVxuICAgICAgICAgICAgc3RhdGU9e3N0YXRlfVxuICAgICAgICAgICAgdGhlbWU9e3RoaXMucHJvcHMudGhlbWV9XG4gICAgICAgICAgICBvblByZXNzPXt0aGlzLnByZXNzRGF5fVxuICAgICAgICAgICAgZGF5PXtkYXl9XG4gICAgICAgICAgICBtYXJrZWQ9e3RoaXMuZ2V0RGF0ZU1hcmtpbmcoZGF5KX1cbiAgICAgICAgICAgIG1hcmtpbmdFeGlzdHM9e21hcmtpbmdFeGlzdHN9XG4gICAgICAgICAgPlxuICAgICAgICAgICAge2RheS5nZXREYXRlKCl9XG4gICAgICAgICAgPC9EYXlDb21wPlxuICAgICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gZGF5Q29tcDtcbiAgfVxuXG4gIGdldERhdGVNYXJraW5nKGRheSkge1xuICAgIGlmICghdGhpcy5wcm9wcy5tYXJrZWREYXRlcykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBkYXRlcyA9IHRoaXMucHJvcHMubWFya2VkRGF0ZXNbZGF5LnRvU3RyaW5nKCd5eXl5LU1NLWRkJyldIHx8IEVtcHR5QXJyYXk7XG4gICAgaWYgKGRhdGVzLmxlbmd0aCB8fCBkYXRlcykge1xuICAgICAgcmV0dXJuIGRhdGVzO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcmVuZGVyV2VlayhkYXlzLCBpZCkge1xuICAgIGNvbnN0IHdlZWsgPSBbXTtcbiAgICBkYXlzLmZvckVhY2goKGRheSwgaWQyKSA9PiB7XG4gICAgICB3ZWVrLnB1c2godGhpcy5yZW5kZXJEYXkoZGF5LCBpZDIpKTtcbiAgICB9LCB0aGlzKTtcbiAgICByZXR1cm4gKDxWaWV3IHN0eWxlPXt0aGlzLnN0eWxlLndlZWt9IGtleT17aWR9Pnt3ZWVrfTwvVmlldz4pO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIC8vY29uc29sZS5sb2coJ3JlbmRlciBjYWxlbmRhciAnKTtcbiAgICBjb25zdCBkYXlzID0gZGF0ZXV0aWxzLnBhZ2UodGhpcy5zdGF0ZS5jdXJyZW50TW9udGgsIHRoaXMucHJvcHMuZmlyc3REYXkpO1xuICAgIGNvbnN0IHdlZWtzID0gW107XG4gICAgd2hpbGUgKGRheXMubGVuZ3RoKSB7XG4gICAgICB3ZWVrcy5wdXNoKHRoaXMucmVuZGVyV2VlayhkYXlzLnNwbGljZSgwLCA3KSwgd2Vla3MubGVuZ3RoKSk7XG4gICAgfVxuICAgIGxldCBpbmRpY2F0b3I7XG4gICAgY29uc3QgY3VycmVudCA9IHBhcnNlRGF0ZSh0aGlzLnByb3BzLmN1cnJlbnQpO1xuICAgIGlmIChjdXJyZW50KSB7XG4gICAgICBjb25zdCBsYXN0TW9udGhPZkRheSA9IGN1cnJlbnQuY2xvbmUoKS5hZGRNb250aHMoMSwgdHJ1ZSkuc2V0RGF0ZSgxKS5hZGREYXlzKC0xKS50b1N0cmluZygneXl5eS1NTS1kZCcpO1xuICAgICAgaWYgKHRoaXMucHJvcHMuZGlzcGxheUxvYWRpbmdJbmRpY2F0b3IgJiZcbiAgICAgICAgICAhKHRoaXMucHJvcHMubWFya2VkRGF0ZXMgJiYgdGhpcy5wcm9wcy5tYXJrZWREYXRlc1tsYXN0TW9udGhPZkRheV0pKSB7XG4gICAgICAgIGluZGljYXRvciA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICA8VmlldyBzdHlsZT17W3RoaXMuc3R5bGUuY29udGFpbmVyLCB0aGlzLnByb3BzLnN0eWxlXX0+XG4gICAgICAgIDxDYWxlbmRhckhlYWRlclxuICAgICAgICAgIHRoZW1lPXt0aGlzLnByb3BzLnRoZW1lfVxuICAgICAgICAgIGhpZGVBcnJvd3M9e3RoaXMucHJvcHMuaGlkZUFycm93c31cbiAgICAgICAgICBtb250aD17dGhpcy5zdGF0ZS5jdXJyZW50TW9udGh9XG4gICAgICAgICAgYWRkTW9udGg9e3RoaXMuYWRkTW9udGh9XG4gICAgICAgICAgc2hvd0luZGljYXRvcj17aW5kaWNhdG9yfVxuICAgICAgICAgIGZpcnN0RGF5PXt0aGlzLnByb3BzLmZpcnN0RGF5fVxuICAgICAgICAgIHJlbmRlckFycm93PXt0aGlzLnByb3BzLnJlbmRlckFycm93fVxuICAgICAgICAgIG1vbnRoRm9ybWF0PXt0aGlzLnByb3BzLm1vbnRoRm9ybWF0fVxuICAgICAgICAgIGhpZGVEYXlOYW1lcz17dGhpcy5wcm9wcy5oaWRlRGF5TmFtZXN9XG4gICAgICAgIC8+XG4gICAgICAgIHt3ZWVrc31cbiAgICAgIDwvVmlldz4pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IENhbGVuZGFyO1xuIl19