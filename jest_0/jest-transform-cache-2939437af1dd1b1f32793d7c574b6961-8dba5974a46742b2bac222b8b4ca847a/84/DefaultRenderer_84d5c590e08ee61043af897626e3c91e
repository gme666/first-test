05616939e736250d32db530dbbfefae6
Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();







var _react=require('react');var _react2=_interopRequireDefault(_react);



var _reactNative=require('react-native');





var _reactNativeExperimentalNavigation=require('react-native-experimental-navigation');var _reactNativeExperimentalNavigation2=_interopRequireDefault(_reactNativeExperimentalNavigation);

var _TabBar=require('./TabBar');var _TabBar2=_interopRequireDefault(_TabBar);
var _NavBar=require('./NavBar');var _NavBar2=_interopRequireDefault(_NavBar);
var _Actions=require('./Actions');var _Actions2=_interopRequireDefault(_Actions);
var _Util=require('./Util');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}

var SCREEN_WIDTH=_reactNative.Dimensions.get('window').width;
var SCREEN_HEIGHT=_reactNative.Dimensions.get('window').height;var


NavigationAnimatedView=_reactNativeExperimentalNavigation2.default.AnimatedView,
NavigationCard=_reactNativeExperimentalNavigation2.default.Card;var



NavigationCardStackPanResponder=

NavigationCard.CardStackPanResponder,NavigationCardStackStyleInterpolator=NavigationCard.CardStackStyleInterpolator;

var styles=_reactNative.StyleSheet.create({
animatedView:{
flex:1,
backgroundColor:'transparent'},

sceneStyle:{
flex:1}});



function fadeInScene(props){var

position=

props.position,scene=props.scene;

var index=scene.index;
var inputRange=[index-1,index,index+1];

var opacity=position.interpolate({
inputRange:inputRange,
outputRange:[0,1,0.3]});


var scale=position.interpolate({
inputRange:inputRange,
outputRange:[1,1,0.95]});


var translateY=0;
var translateX=0;

return{
opacity:opacity,
transform:[
{scale:scale},
{translateX:translateX},
{translateY:translateY}]};


}

function leftToRight(props){var

position=

props.position,scene=props.scene;

var index=scene.index;
var inputRange=[index-1,index,index+1];

var translateX=position.interpolate({
inputRange:inputRange,
outputRange:[-SCREEN_WIDTH,0,0]});


return{
transform:[
{translateX:translateX}]};


}

function topToBottom(props){var

position=

props.position,scene=props.scene;

var index=scene.index;
var inputRange=[index-1,index,index+1];

var translateY=position.interpolate({
inputRange:inputRange,
outputRange:[-SCREEN_HEIGHT*3,0,0]});


return{
transform:[
{translateY:translateY}]};


}var

DefaultRenderer=function(_PureComponent){_inherits(DefaultRenderer,_PureComponent);function DefaultRenderer(){_classCallCheck(this,DefaultRenderer);return _possibleConstructorReturn(this,(DefaultRenderer.__proto__||Object.getPrototypeOf(DefaultRenderer)).apply(this,arguments));}_createClass(DefaultRenderer,[{key:'getChildContext',value:function getChildContext()


































































































































































{
return{
navigationState:this.props.navigationState};

}},{key:'componentDidMount',value:function componentDidMount()

{
DefaultRenderer.dispatchFocusAction(this.props);
}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(

nextProps){
if(nextProps.navigationState!==this.props.navigationState){
DefaultRenderer.dispatchFocusAction(nextProps);
}
}},{key:'render',value:function render()

{var _props=
this.props,navigationState=_props.navigationState,onNavigate=_props.onNavigate;

if(!navigationState||!onNavigate){
console.error('navigationState and onNavigate property should be not null');
return null;
}

var SceneComponent=navigationState.component;

if(navigationState.tabs&&!SceneComponent){
SceneComponent=_TabBar2.default;
}

if(SceneComponent){
return(
_react2.default.createElement(_reactNative.View,{
style:[styles.sceneStyle,navigationState.sceneStyle]},

_react2.default.createElement(SceneComponent,_extends({},this.props,navigationState))));


}

var optionals={};
var selected=navigationState.children[navigationState.index];
var applyAnimation=selected.applyAnimation||navigationState.applyAnimation;
var style=selected.style||navigationState.style;

if(applyAnimation){
optionals.applyAnimation=applyAnimation;
}else{
var duration=selected.duration;
if(duration===null||duration===undefined)duration=navigationState.duration;
if(duration!==null&&duration!==undefined){
optionals.applyAnimation=function(pos,navState){
if(duration===0){
pos.setValue(navState.index);
}else{
_reactNative.Animated.timing(pos,{toValue:navState.index,duration:duration}).start();
}
};
}
}



return(
_react2.default.createElement(NavigationAnimatedView,_extends({
navigationState:navigationState,
style:[styles.animatedView,style],
renderOverlay:DefaultRenderer.renderHeader,
renderScene:DefaultRenderer.renderCard},
optionals)));


}}],[{key:'getPanHandlers',value:function getPanHandlers(direction,props){return direction==='vertical'?NavigationCardStackPanResponder.forVertical(props):NavigationCardStackPanResponder.forHorizontal(props);}},{key:'dispatchFocusAction',value:function dispatchFocusAction(_ref){var navigationState=_ref.navigationState;if(!navigationState||navigationState.component||navigationState.tabs){return;}var scene=navigationState.children[navigationState.index];_Actions2.default.focus({scene:scene});}},{key:'chooseInterpolator',value:function chooseInterpolator(direction,props){switch(direction){case'vertical':return NavigationCardStackStyleInterpolator.forVertical(props);case'fade':return fadeInScene(props);case'leftToRight':return leftToRight(props);case'topToBottom':return topToBottom(props);default:return NavigationCardStackStyleInterpolator.forHorizontal(props);}}},{key:'renderScene',value:function renderScene(props){return _react2.default.createElement(DefaultRenderer,{key:props.scene.navigationState.key,onNavigate:props.onNavigate,navigationState:props.scene.navigationState});}},{key:'renderHeader',value:function renderHeader(props){var state=props.navigationState;var child=state.children[state.index];var selected=state.children[state.index];while({}.hasOwnProperty.call(selected,'children')){selected=selected.children[selected.index];}if(child!==selected){return null;}var hideNavBar=(0,_Util.deepestExplicitValueForKey)(state,'hideNavBar');if(hideNavBar){return null;}if(selected.component&&selected.component.renderNavigationBar){return selected.component.renderNavigationBar(_extends({},props,selected));}var HeaderComponent=selected.navBar||child.navBar||state.navBar||_NavBar2.default;var navBarProps=_extends({},state,child,selected);if(selected.component&&selected.component.onRight){navBarProps.onRight=selected.component.onRight;}if(selected.component&&selected.component.onLeft){navBarProps.onLeft=selected.component.onLeft;}if((navBarProps.leftTitle||navBarProps.leftButtonImage)&&navBarProps.onLeft){delete navBarProps.leftButton;}if((navBarProps.rightTitle||navBarProps.rightButtonImage)&&navBarProps.onRight){delete navBarProps.rightButton;}if(navBarProps.rightButton){delete navBarProps.rightTitle;delete navBarProps.onRight;delete navBarProps.rightButtonImage;}if(navBarProps.leftButton){delete navBarProps.leftTitle;delete navBarProps.onLeft;delete navBarProps.leftButtonImage;}delete navBarProps.style;var getTitle=selected.getTitle||function(opts){return opts.title;};return _react2.default.createElement(HeaderComponent,_extends({},props,navBarProps,{getTitle:getTitle}));}},{key:'renderCard',value:function renderCard(props){var _props$scene$navigati=props.scene.navigationState,key=_props$scene$navigati.key,direction=_props$scene$navigati.direction,animation=_props$scene$navigati.animation,getSceneStyle=_props$scene$navigati.getSceneStyle;var state=props.navigationState;var child=state.children[state.index];var selected=state.children[state.index];while({}.hasOwnProperty.call(selected,'children')){selected=selected.children[selected.index];}var _selected=selected,getPanHandlers=_selected.getPanHandlers;var _selected2=selected,panHandlers=_selected2.panHandlers;var animationStyle=props.scene.navigationState.animationStyle;var isActive=child===selected;var computedProps={isActive:isActive};if(isActive){computedProps.hideNavBar=(0,_Util.deepestExplicitValueForKey)(props.navigationState,'hideNavBar');computedProps.hideTabBar=(0,_Util.deepestExplicitValueForKey)(props.navigationState,'hideTabBar');}var style=getSceneStyle?getSceneStyle(props,computedProps):null;var animType=animation&&!direction?animation:direction;if(typeof animationStyle==='undefined'){animationStyle=DefaultRenderer.chooseInterpolator(animType,props);}if(typeof animationStyle==='function'){animationStyle=animationStyle(props);}if(typeof panHandlers==='undefined'){panHandlers=getPanHandlers?getPanHandlers(props,direction):DefaultRenderer.getPanHandlers(direction,props);}return _react2.default.createElement(NavigationCard,_extends({},props,{key:'card_'+key,style:[animationStyle,style],panHandlers:panHandlers,renderScene:DefaultRenderer.renderScene}));}}]);return DefaultRenderer;}(_react.PureComponent);DefaultRenderer.propTypes={navigationState:_react.PropTypes.object.isRequired,onNavigate:_react.PropTypes.func.isRequired};DefaultRenderer.childContextTypes={navigationState:_react.PropTypes.any};exports.default=DefaultRenderer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRlZmF1bHRSZW5kZXJlci5qcyJdLCJuYW1lcyI6WyJTQ1JFRU5fV0lEVEgiLCJnZXQiLCJ3aWR0aCIsIlNDUkVFTl9IRUlHSFQiLCJoZWlnaHQiLCJOYXZpZ2F0aW9uQW5pbWF0ZWRWaWV3IiwiQW5pbWF0ZWRWaWV3IiwiTmF2aWdhdGlvbkNhcmQiLCJDYXJkIiwiTmF2aWdhdGlvbkNhcmRTdGFja1BhblJlc3BvbmRlciIsIkNhcmRTdGFja1BhblJlc3BvbmRlciIsIk5hdmlnYXRpb25DYXJkU3RhY2tTdHlsZUludGVycG9sYXRvciIsIkNhcmRTdGFja1N0eWxlSW50ZXJwb2xhdG9yIiwic3R5bGVzIiwiY3JlYXRlIiwiYW5pbWF0ZWRWaWV3IiwiZmxleCIsImJhY2tncm91bmRDb2xvciIsInNjZW5lU3R5bGUiLCJmYWRlSW5TY2VuZSIsInByb3BzIiwicG9zaXRpb24iLCJzY2VuZSIsImluZGV4IiwiaW5wdXRSYW5nZSIsIm9wYWNpdHkiLCJpbnRlcnBvbGF0ZSIsIm91dHB1dFJhbmdlIiwic2NhbGUiLCJ0cmFuc2xhdGVZIiwidHJhbnNsYXRlWCIsInRyYW5zZm9ybSIsImxlZnRUb1JpZ2h0IiwidG9wVG9Cb3R0b20iLCJEZWZhdWx0UmVuZGVyZXIiLCJuYXZpZ2F0aW9uU3RhdGUiLCJkaXNwYXRjaEZvY3VzQWN0aW9uIiwibmV4dFByb3BzIiwib25OYXZpZ2F0ZSIsImNvbnNvbGUiLCJlcnJvciIsIlNjZW5lQ29tcG9uZW50IiwiY29tcG9uZW50IiwidGFicyIsIm9wdGlvbmFscyIsInNlbGVjdGVkIiwiY2hpbGRyZW4iLCJhcHBseUFuaW1hdGlvbiIsInN0eWxlIiwiZHVyYXRpb24iLCJ1bmRlZmluZWQiLCJwb3MiLCJuYXZTdGF0ZSIsInNldFZhbHVlIiwidGltaW5nIiwidG9WYWx1ZSIsInN0YXJ0IiwicmVuZGVySGVhZGVyIiwicmVuZGVyQ2FyZCIsImRpcmVjdGlvbiIsImZvclZlcnRpY2FsIiwiZm9ySG9yaXpvbnRhbCIsImZvY3VzIiwia2V5Iiwic3RhdGUiLCJjaGlsZCIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImhpZGVOYXZCYXIiLCJyZW5kZXJOYXZpZ2F0aW9uQmFyIiwiSGVhZGVyQ29tcG9uZW50IiwibmF2QmFyIiwibmF2QmFyUHJvcHMiLCJvblJpZ2h0Iiwib25MZWZ0IiwibGVmdFRpdGxlIiwibGVmdEJ1dHRvbkltYWdlIiwibGVmdEJ1dHRvbiIsInJpZ2h0VGl0bGUiLCJyaWdodEJ1dHRvbkltYWdlIiwicmlnaHRCdXR0b24iLCJnZXRUaXRsZSIsIm9wdHMiLCJ0aXRsZSIsImFuaW1hdGlvbiIsImdldFNjZW5lU3R5bGUiLCJnZXRQYW5IYW5kbGVycyIsInBhbkhhbmRsZXJzIiwiYW5pbWF0aW9uU3R5bGUiLCJpc0FjdGl2ZSIsImNvbXB1dGVkUHJvcHMiLCJoaWRlVGFiQmFyIiwiYW5pbVR5cGUiLCJjaG9vc2VJbnRlcnBvbGF0b3IiLCJyZW5kZXJTY2VuZSIsInByb3BUeXBlcyIsIm9iamVjdCIsImlzUmVxdWlyZWQiLCJmdW5jIiwiY2hpbGRDb250ZXh0VHlwZXMiLCJhbnkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBUUEsNEI7Ozs7QUFJQTs7Ozs7O0FBTUEsdUY7O0FBRUEsZ0M7QUFDQSxnQztBQUNBLGtDO0FBQ0EsNEI7O0FBRUEsR0FBTUEsY0FBZSx3QkFBV0MsR0FBWCxDQUFlLFFBQWYsRUFBeUJDLEtBQTlDO0FBQ0EsR0FBTUMsZUFBZ0Isd0JBQVdGLEdBQVgsQ0FBZSxRQUFmLEVBQXlCRyxNQUEvQyxDOzs7QUFHZ0JDLHNCLDZDQUFkQyxZO0FBQ01DLGMsNkNBQU5DLEk7Ozs7QUFJdUJDLCtCOztBQUVyQkYsYyxDQUZGRyxxQixDQUM0QkMsb0MsQ0FDMUJKLGMsQ0FERkssMEI7O0FBR0YsR0FBTUMsUUFBUyx3QkFBV0MsTUFBWCxDQUFrQjtBQUMvQkMsYUFBYztBQUNaQyxLQUFNLENBRE07QUFFWkMsZ0JBQWlCLGFBRkwsQ0FEaUI7O0FBSy9CQyxXQUFZO0FBQ1ZGLEtBQU0sQ0FESSxDQUxtQixDQUFsQixDQUFm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QUVBLEdBQUksTUFBUTZCLGVBQVIsR0FBNEIsV0FBaEMsQ0FBNkMsQ0FDM0NBLGVBQWlCdEQsZ0JBQWdCMkQsa0JBQWhCLENBQW1DRCxRQUFuQyxDQUE2Q3hFLEtBQTdDLENBQWpCLENBQ0QsQ0FFRCxHQUFJLE1BQVFvRSxlQUFSLEdBQTRCLFVBQWhDLENBQTRDLENBQzFDQSxlQUFpQkEsZUFBZXBFLEtBQWYsQ0FBakIsQ0FDRCxDQUVELEdBQUksTUFBUW1FLFlBQVIsR0FBeUIsV0FBN0IsQ0FBMEMsQ0FDeENBLFlBQWNELGVBQ1pBLGVBQWVsRSxLQUFmLENBQXNCdUMsU0FBdEIsQ0FEWSxDQUVaekIsZ0JBQWdCb0QsY0FBaEIsQ0FBK0IzQixTQUEvQixDQUEwQ3ZDLEtBQTFDLENBRkYsQ0FHRCxDQUNELE1BQ0UsK0JBQUMsY0FBRCxhQUNNQSxLQUROLEVBRUUsWUFBYTJDLEdBRmYsQ0FHRSxNQUFPLENBQUN5QixjQUFELENBQWlCeEMsS0FBakIsQ0FIVCxDQUlFLFlBQWF1QyxXQUpmLENBS0UsWUFBYXJELGdCQUFnQjRELFdBTC9CLEdBREYsQ0FTRCxDLG1EQWpLa0I1RCxlLENBRVo2RCxTLENBQVksQ0FDakI1RCxnQkFBaUIsaUJBQVU2RCxNQUFWLENBQWlCQyxVQURqQixDQUVqQjNELFdBQVksaUJBQVU0RCxJQUFWLENBQWVELFVBRlYsQyxDQUZBL0QsZSxDQU9aaUUsaUIsQ0FBb0IsQ0FDekJoRSxnQkFBaUIsaUJBQVVpRSxHQURGLEMsaUJBUFJsRSxlIiwiZmlsZSI6IkRlZmF1bHRSZW5kZXJlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIFBhdmVsIEFrc29ub3ZcbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICovXG5pbXBvcnQgUmVhY3QsIHtcbiAgUHVyZUNvbXBvbmVudCxcbiAgUHJvcFR5cGVzLFxufSBmcm9tICdyZWFjdCc7XG5pbXBvcnQge1xuICBBbmltYXRlZCxcbiAgVmlldyxcbiAgU3R5bGVTaGVldCxcbiAgRGltZW5zaW9ucyxcbn0gZnJvbSAncmVhY3QtbmF0aXZlJztcbmltcG9ydCBOYXZpZ2F0aW9uRXhwZXJpbWVudGFsIGZyb20gJ3JlYWN0LW5hdGl2ZS1leHBlcmltZW50YWwtbmF2aWdhdGlvbic7XG5cbmltcG9ydCBUYWJCYXIgZnJvbSAnLi9UYWJCYXInO1xuaW1wb3J0IE5hdkJhciBmcm9tICcuL05hdkJhcic7XG5pbXBvcnQgQWN0aW9ucyBmcm9tICcuL0FjdGlvbnMnO1xuaW1wb3J0IHsgZGVlcGVzdEV4cGxpY2l0VmFsdWVGb3JLZXkgfSBmcm9tICcuL1V0aWwnO1xuXG5jb25zdCBTQ1JFRU5fV0lEVEggPSBEaW1lbnNpb25zLmdldCgnd2luZG93Jykud2lkdGg7XG5jb25zdCBTQ1JFRU5fSEVJR0hUID0gRGltZW5zaW9ucy5nZXQoJ3dpbmRvdycpLmhlaWdodDtcblxuY29uc3Qge1xuICBBbmltYXRlZFZpZXc6IE5hdmlnYXRpb25BbmltYXRlZFZpZXcsXG4gIENhcmQ6IE5hdmlnYXRpb25DYXJkLFxufSA9IE5hdmlnYXRpb25FeHBlcmltZW50YWw7XG5cbmNvbnN0IHtcbiAgQ2FyZFN0YWNrUGFuUmVzcG9uZGVyOiBOYXZpZ2F0aW9uQ2FyZFN0YWNrUGFuUmVzcG9uZGVyLFxuICBDYXJkU3RhY2tTdHlsZUludGVycG9sYXRvcjogTmF2aWdhdGlvbkNhcmRTdGFja1N0eWxlSW50ZXJwb2xhdG9yLFxufSA9IE5hdmlnYXRpb25DYXJkO1xuXG5jb25zdCBzdHlsZXMgPSBTdHlsZVNoZWV0LmNyZWF0ZSh7XG4gIGFuaW1hdGVkVmlldzoge1xuICAgIGZsZXg6IDEsXG4gICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICB9LFxuICBzY2VuZVN0eWxlOiB7XG4gICAgZmxleDogMSxcbiAgfSxcbn0pO1xuXG5mdW5jdGlvbiBmYWRlSW5TY2VuZSgvKiBOYXZpZ2F0aW9uU2NlbmVSZW5kZXJlclByb3BzICovIHByb3BzKSB7XG4gIGNvbnN0IHtcbiAgICBwb3NpdGlvbixcbiAgICBzY2VuZSxcbiAgfSA9IHByb3BzO1xuXG4gIGNvbnN0IGluZGV4ID0gc2NlbmUuaW5kZXg7XG4gIGNvbnN0IGlucHV0UmFuZ2UgPSBbaW5kZXggLSAxLCBpbmRleCwgaW5kZXggKyAxXTtcblxuICBjb25zdCBvcGFjaXR5ID0gcG9zaXRpb24uaW50ZXJwb2xhdGUoe1xuICAgIGlucHV0UmFuZ2UsXG4gICAgb3V0cHV0UmFuZ2U6IFswLCAxLCAwLjNdLFxuICB9KTtcblxuICBjb25zdCBzY2FsZSA9IHBvc2l0aW9uLmludGVycG9sYXRlKHtcbiAgICBpbnB1dFJhbmdlLFxuICAgIG91dHB1dFJhbmdlOiBbMSwgMSwgMC45NV0sXG4gIH0pO1xuXG4gIGNvbnN0IHRyYW5zbGF0ZVkgPSAwO1xuICBjb25zdCB0cmFuc2xhdGVYID0gMDtcblxuICByZXR1cm4ge1xuICAgIG9wYWNpdHksXG4gICAgdHJhbnNmb3JtOiBbXG4gICAgICB7IHNjYWxlIH0sXG4gICAgICB7IHRyYW5zbGF0ZVggfSxcbiAgICAgIHsgdHJhbnNsYXRlWSB9LFxuICAgIF0sXG4gIH07XG59XG5cbmZ1bmN0aW9uIGxlZnRUb1JpZ2h0KC8qIE5hdmlnYXRpb25TY2VuZVJlbmRlcmVyUHJvcHMgKi8gcHJvcHMpIHtcbiAgY29uc3Qge1xuICAgIHBvc2l0aW9uLFxuICAgIHNjZW5lLFxuICB9ID0gcHJvcHM7XG5cbiAgY29uc3QgaW5kZXggPSBzY2VuZS5pbmRleDtcbiAgY29uc3QgaW5wdXRSYW5nZSA9IFtpbmRleCAtIDEsIGluZGV4LCBpbmRleCArIDFdO1xuXG4gIGNvbnN0IHRyYW5zbGF0ZVggPSBwb3NpdGlvbi5pbnRlcnBvbGF0ZSh7XG4gICAgaW5wdXRSYW5nZSxcbiAgICBvdXRwdXRSYW5nZTogWy1TQ1JFRU5fV0lEVEgsIDAsIDBdLFxuICB9KTtcblxuICByZXR1cm4ge1xuICAgIHRyYW5zZm9ybTogW1xuICAgICAgeyB0cmFuc2xhdGVYIH0sXG4gICAgXSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gdG9wVG9Cb3R0b20oLyogTmF2aWdhdGlvblNjZW5lUmVuZGVyZXJQcm9wcyAqLyBwcm9wcykge1xuICBjb25zdCB7XG4gICAgcG9zaXRpb24sXG4gICAgc2NlbmUsXG4gIH0gPSBwcm9wcztcblxuICBjb25zdCBpbmRleCA9IHNjZW5lLmluZGV4O1xuICBjb25zdCBpbnB1dFJhbmdlID0gW2luZGV4IC0gMSwgaW5kZXgsIGluZGV4ICsgMV07XG5cbiAgY29uc3QgdHJhbnNsYXRlWSA9IHBvc2l0aW9uLmludGVycG9sYXRlKHtcbiAgICBpbnB1dFJhbmdlLFxuICAgIG91dHB1dFJhbmdlOiBbLVNDUkVFTl9IRUlHSFQgKiAzLCAwLCAwXSxcbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICB0cmFuc2Zvcm06IFtcbiAgICAgIHsgdHJhbnNsYXRlWSB9LFxuICAgIF0sXG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERlZmF1bHRSZW5kZXJlciBleHRlbmRzIFB1cmVDb21wb25lbnQge1xuXG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgbmF2aWdhdGlvblN0YXRlOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgb25OYXZpZ2F0ZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgfTtcblxuICBzdGF0aWMgY2hpbGRDb250ZXh0VHlwZXMgPSB7XG4gICAgbmF2aWdhdGlvblN0YXRlOiBQcm9wVHlwZXMuYW55LFxuICB9O1xuXG4gIHN0YXRpYyBnZXRQYW5IYW5kbGVycyhkaXJlY3Rpb24sIHByb3BzKSB7XG4gICAgcmV0dXJuIGRpcmVjdGlvbiA9PT0gJ3ZlcnRpY2FsJyA/XG4gICAgICBOYXZpZ2F0aW9uQ2FyZFN0YWNrUGFuUmVzcG9uZGVyLmZvclZlcnRpY2FsKHByb3BzKSA6XG4gICAgICBOYXZpZ2F0aW9uQ2FyZFN0YWNrUGFuUmVzcG9uZGVyLmZvckhvcml6b250YWwocHJvcHMpO1xuICB9XG5cbiAgc3RhdGljIGRpc3BhdGNoRm9jdXNBY3Rpb24oeyBuYXZpZ2F0aW9uU3RhdGUgfSkge1xuICAgIGlmICghbmF2aWdhdGlvblN0YXRlIHx8IG5hdmlnYXRpb25TdGF0ZS5jb21wb25lbnQgfHwgbmF2aWdhdGlvblN0YXRlLnRhYnMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3Qgc2NlbmUgPSBuYXZpZ2F0aW9uU3RhdGUuY2hpbGRyZW5bbmF2aWdhdGlvblN0YXRlLmluZGV4XTtcbiAgICBBY3Rpb25zLmZvY3VzKHsgc2NlbmUgfSk7XG4gIH1cblxuICBzdGF0aWMgY2hvb3NlSW50ZXJwb2xhdG9yKGRpcmVjdGlvbiwgcHJvcHMpIHtcbiAgICBzd2l0Y2ggKGRpcmVjdGlvbikge1xuICAgICAgY2FzZSAndmVydGljYWwnOlxuICAgICAgICByZXR1cm4gTmF2aWdhdGlvbkNhcmRTdGFja1N0eWxlSW50ZXJwb2xhdG9yLmZvclZlcnRpY2FsKHByb3BzKTtcbiAgICAgIGNhc2UgJ2ZhZGUnOlxuICAgICAgICByZXR1cm4gZmFkZUluU2NlbmUocHJvcHMpO1xuICAgICAgY2FzZSAnbGVmdFRvUmlnaHQnOlxuICAgICAgICByZXR1cm4gbGVmdFRvUmlnaHQocHJvcHMpO1xuICAgICAgY2FzZSAndG9wVG9Cb3R0b20nOlxuICAgICAgICByZXR1cm4gdG9wVG9Cb3R0b20ocHJvcHMpO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIE5hdmlnYXRpb25DYXJkU3RhY2tTdHlsZUludGVycG9sYXRvci5mb3JIb3Jpem9udGFsKHByb3BzKTtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgcmVuZGVyU2NlbmUoLyogTmF2aWdhdGlvblNjZW5lUmVuZGVyZXJQcm9wcyAqLyBwcm9wcykge1xuICAgIHJldHVybiAoXG4gICAgICA8RGVmYXVsdFJlbmRlcmVyXG4gICAgICAgIGtleT17cHJvcHMuc2NlbmUubmF2aWdhdGlvblN0YXRlLmtleX1cbiAgICAgICAgb25OYXZpZ2F0ZT17cHJvcHMub25OYXZpZ2F0ZX1cbiAgICAgICAgbmF2aWdhdGlvblN0YXRlPXtwcm9wcy5zY2VuZS5uYXZpZ2F0aW9uU3RhdGV9XG4gICAgICAvPlxuICAgICk7XG4gIH1cblxuICBzdGF0aWMgcmVuZGVySGVhZGVyKC8qIE5hdmlnYXRpb25TY2VuZVJlbmRlcmVyUHJvcHMgKi8gcHJvcHMpIHtcbiAgICBjb25zdCBzdGF0ZSA9IHByb3BzLm5hdmlnYXRpb25TdGF0ZTtcbiAgICBjb25zdCBjaGlsZCA9IHN0YXRlLmNoaWxkcmVuW3N0YXRlLmluZGV4XTtcbiAgICBsZXQgc2VsZWN0ZWQgPSBzdGF0ZS5jaGlsZHJlbltzdGF0ZS5pbmRleF07XG4gICAgd2hpbGUgKHt9Lmhhc093blByb3BlcnR5LmNhbGwoc2VsZWN0ZWQsICdjaGlsZHJlbicpKSB7XG4gICAgICBzZWxlY3RlZCA9IHNlbGVjdGVkLmNoaWxkcmVuW3NlbGVjdGVkLmluZGV4XTtcbiAgICB9XG4gICAgaWYgKGNoaWxkICE9PSBzZWxlY3RlZCkge1xuICAgICAgLy8gY29uc29sZS5sb2coYFNLSVBQSU5HIHJlbmRlckhlYWRlciBiZWNhdXNlICR7Y2hpbGQua2V5fSAhPT0gJHtzZWxlY3RlZC5rZXl9YCk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgaGlkZU5hdkJhciA9IGRlZXBlc3RFeHBsaWNpdFZhbHVlRm9yS2V5KHN0YXRlLCAnaGlkZU5hdkJhcicpO1xuICAgIGlmIChoaWRlTmF2QmFyKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhgU0tJUFBJTkcgcmVuZGVySGVhZGVyIGJlY2F1c2UgJHtjaGlsZC5rZXl9IGhpZGVOYXZCYXIgPT09IHRydWVgKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8vIGNvbnNvbGUubG9nKGByZW5kZXJIZWFkZXIgZm9yICR7Y2hpbGQua2V5fWApO1xuXG4gICAgaWYgKHNlbGVjdGVkLmNvbXBvbmVudCAmJiBzZWxlY3RlZC5jb21wb25lbnQucmVuZGVyTmF2aWdhdGlvbkJhcikge1xuICAgICAgcmV0dXJuIHNlbGVjdGVkLmNvbXBvbmVudC5yZW5kZXJOYXZpZ2F0aW9uQmFyKHsgLi4ucHJvcHMsIC4uLnNlbGVjdGVkIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IEhlYWRlckNvbXBvbmVudCA9IHNlbGVjdGVkLm5hdkJhciB8fCBjaGlsZC5uYXZCYXIgfHwgc3RhdGUubmF2QmFyIHx8IE5hdkJhcjtcbiAgICBjb25zdCBuYXZCYXJQcm9wcyA9IHsgLi4uc3RhdGUsIC4uLmNoaWxkLCAuLi5zZWxlY3RlZCB9O1xuXG4gICAgaWYgKHNlbGVjdGVkLmNvbXBvbmVudCAmJiBzZWxlY3RlZC5jb21wb25lbnQub25SaWdodCkge1xuICAgICAgbmF2QmFyUHJvcHMub25SaWdodCA9IHNlbGVjdGVkLmNvbXBvbmVudC5vblJpZ2h0O1xuICAgIH1cblxuICAgIGlmIChzZWxlY3RlZC5jb21wb25lbnQgJiYgc2VsZWN0ZWQuY29tcG9uZW50Lm9uTGVmdCkge1xuICAgICAgbmF2QmFyUHJvcHMub25MZWZ0ID0gc2VsZWN0ZWQuY29tcG9uZW50Lm9uTGVmdDtcbiAgICB9XG5cbiAgICBpZiAoKG5hdkJhclByb3BzLmxlZnRUaXRsZSB8fCBuYXZCYXJQcm9wcy5sZWZ0QnV0dG9uSW1hZ2UpICYmIG5hdkJhclByb3BzLm9uTGVmdCkge1xuICAgICAgZGVsZXRlIG5hdkJhclByb3BzLmxlZnRCdXR0b247XG4gICAgfVxuXG4gICAgaWYgKChuYXZCYXJQcm9wcy5yaWdodFRpdGxlIHx8IG5hdkJhclByb3BzLnJpZ2h0QnV0dG9uSW1hZ2UpICYmIG5hdkJhclByb3BzLm9uUmlnaHQpIHtcbiAgICAgIGRlbGV0ZSBuYXZCYXJQcm9wcy5yaWdodEJ1dHRvbjtcbiAgICB9XG5cbiAgICBpZiAobmF2QmFyUHJvcHMucmlnaHRCdXR0b24pIHtcbiAgICAgIGRlbGV0ZSBuYXZCYXJQcm9wcy5yaWdodFRpdGxlO1xuICAgICAgZGVsZXRlIG5hdkJhclByb3BzLm9uUmlnaHQ7XG4gICAgICBkZWxldGUgbmF2QmFyUHJvcHMucmlnaHRCdXR0b25JbWFnZTtcbiAgICB9XG5cbiAgICBpZiAobmF2QmFyUHJvcHMubGVmdEJ1dHRvbikge1xuICAgICAgZGVsZXRlIG5hdkJhclByb3BzLmxlZnRUaXRsZTtcbiAgICAgIGRlbGV0ZSBuYXZCYXJQcm9wcy5vbkxlZnQ7XG4gICAgICBkZWxldGUgbmF2QmFyUHJvcHMubGVmdEJ1dHRvbkltYWdlO1xuICAgIH1cbiAgICBkZWxldGUgbmF2QmFyUHJvcHMuc3R5bGU7XG5cbiAgICBjb25zdCBnZXRUaXRsZSA9IHNlbGVjdGVkLmdldFRpdGxlIHx8IChvcHRzID0+IG9wdHMudGl0bGUpO1xuICAgIHJldHVybiA8SGVhZGVyQ29tcG9uZW50IHsuLi5wcm9wc30gey4uLm5hdkJhclByb3BzfSBnZXRUaXRsZT17Z2V0VGl0bGV9IC8+O1xuICB9XG5cbiAgc3RhdGljIHJlbmRlckNhcmQoLyogTmF2aWdhdGlvblNjZW5lUmVuZGVyZXJQcm9wcyAqLyBwcm9wcykge1xuICAgIGNvbnN0IHsga2V5LFxuICAgICAgZGlyZWN0aW9uLFxuICAgICAgYW5pbWF0aW9uLFxuICAgICAgZ2V0U2NlbmVTdHlsZSxcbiAgICB9ID0gcHJvcHMuc2NlbmUubmF2aWdhdGlvblN0YXRlO1xuXG4gICAgY29uc3Qgc3RhdGUgPSBwcm9wcy5uYXZpZ2F0aW9uU3RhdGU7XG4gICAgY29uc3QgY2hpbGQgPSBzdGF0ZS5jaGlsZHJlbltzdGF0ZS5pbmRleF07XG4gICAgbGV0IHNlbGVjdGVkID0gc3RhdGUuY2hpbGRyZW5bc3RhdGUuaW5kZXhdO1xuICAgIHdoaWxlICh7fS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNlbGVjdGVkLCAnY2hpbGRyZW4nKSkge1xuICAgICAgc2VsZWN0ZWQgPSBzZWxlY3RlZC5jaGlsZHJlbltzZWxlY3RlZC5pbmRleF07XG4gICAgfVxuXG4gICAgY29uc3QgeyBnZXRQYW5IYW5kbGVycyB9ID0gc2VsZWN0ZWQ7XG4gICAgbGV0IHsgcGFuSGFuZGxlcnMgfSA9IHNlbGVjdGVkO1xuICAgIGxldCB7IGFuaW1hdGlvblN0eWxlIH0gPSBwcm9wcy5zY2VuZS5uYXZpZ2F0aW9uU3RhdGU7XG5cbiAgICBjb25zdCBpc0FjdGl2ZSA9IGNoaWxkID09PSBzZWxlY3RlZDtcbiAgICBjb25zdCBjb21wdXRlZFByb3BzID0geyBpc0FjdGl2ZSB9O1xuICAgIGlmIChpc0FjdGl2ZSkge1xuICAgICAgY29tcHV0ZWRQcm9wcy5oaWRlTmF2QmFyID0gZGVlcGVzdEV4cGxpY2l0VmFsdWVGb3JLZXkocHJvcHMubmF2aWdhdGlvblN0YXRlLCAnaGlkZU5hdkJhcicpO1xuICAgICAgY29tcHV0ZWRQcm9wcy5oaWRlVGFiQmFyID0gZGVlcGVzdEV4cGxpY2l0VmFsdWVGb3JLZXkocHJvcHMubmF2aWdhdGlvblN0YXRlLCAnaGlkZVRhYkJhcicpO1xuICAgIH1cblxuICAgIGNvbnN0IHN0eWxlID0gZ2V0U2NlbmVTdHlsZSA/IGdldFNjZW5lU3R5bGUocHJvcHMsIGNvbXB1dGVkUHJvcHMpIDogbnVsbDtcblxuICAgIC8vIGRpcmVjdGlvbiBvdmVycmlkZXMgYW5pbWF0aW9uIGlmIGJvdGggYXJlIHN1cHBsaWVkXG4gICAgY29uc3QgYW5pbVR5cGUgPSAoYW5pbWF0aW9uICYmICFkaXJlY3Rpb24pID8gYW5pbWF0aW9uIDogZGlyZWN0aW9uO1xuXG4gICAgaWYgKHR5cGVvZiAoYW5pbWF0aW9uU3R5bGUpID09PSAndW5kZWZpbmVkJykge1xuICAgICAgYW5pbWF0aW9uU3R5bGUgPSBEZWZhdWx0UmVuZGVyZXIuY2hvb3NlSW50ZXJwb2xhdG9yKGFuaW1UeXBlLCBwcm9wcyk7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiAoYW5pbWF0aW9uU3R5bGUpID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBhbmltYXRpb25TdHlsZSA9IGFuaW1hdGlvblN0eWxlKHByb3BzKTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIChwYW5IYW5kbGVycykgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBwYW5IYW5kbGVycyA9IGdldFBhbkhhbmRsZXJzID9cbiAgICAgICAgZ2V0UGFuSGFuZGxlcnMocHJvcHMsIGRpcmVjdGlvbikgOlxuICAgICAgICBEZWZhdWx0UmVuZGVyZXIuZ2V0UGFuSGFuZGxlcnMoZGlyZWN0aW9uLCBwcm9wcyk7XG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICA8TmF2aWdhdGlvbkNhcmRcbiAgICAgICAgey4uLnByb3BzfVxuICAgICAgICBrZXk9e2BjYXJkXyR7a2V5fWB9XG4gICAgICAgIHN0eWxlPXtbYW5pbWF0aW9uU3R5bGUsIHN0eWxlXX1cbiAgICAgICAgcGFuSGFuZGxlcnM9e3BhbkhhbmRsZXJzfVxuICAgICAgICByZW5kZXJTY2VuZT17RGVmYXVsdFJlbmRlcmVyLnJlbmRlclNjZW5lfVxuICAgICAgLz5cbiAgICApO1xuICB9XG5cbiAgZ2V0Q2hpbGRDb250ZXh0KCkge1xuICAgIHJldHVybiB7XG4gICAgICBuYXZpZ2F0aW9uU3RhdGU6IHRoaXMucHJvcHMubmF2aWdhdGlvblN0YXRlLFxuICAgIH07XG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICBEZWZhdWx0UmVuZGVyZXIuZGlzcGF0Y2hGb2N1c0FjdGlvbih0aGlzLnByb3BzKTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgaWYgKG5leHRQcm9wcy5uYXZpZ2F0aW9uU3RhdGUgIT09IHRoaXMucHJvcHMubmF2aWdhdGlvblN0YXRlKSB7XG4gICAgICBEZWZhdWx0UmVuZGVyZXIuZGlzcGF0Y2hGb2N1c0FjdGlvbihuZXh0UHJvcHMpO1xuICAgIH1cbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IG5hdmlnYXRpb25TdGF0ZSwgb25OYXZpZ2F0ZSB9ID0gdGhpcy5wcm9wcztcblxuICAgIGlmICghbmF2aWdhdGlvblN0YXRlIHx8ICFvbk5hdmlnYXRlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCduYXZpZ2F0aW9uU3RhdGUgYW5kIG9uTmF2aWdhdGUgcHJvcGVydHkgc2hvdWxkIGJlIG5vdCBudWxsJyk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBsZXQgU2NlbmVDb21wb25lbnQgPSBuYXZpZ2F0aW9uU3RhdGUuY29tcG9uZW50O1xuXG4gICAgaWYgKG5hdmlnYXRpb25TdGF0ZS50YWJzICYmICFTY2VuZUNvbXBvbmVudCkge1xuICAgICAgU2NlbmVDb21wb25lbnQgPSBUYWJCYXI7XG4gICAgfVxuXG4gICAgaWYgKFNjZW5lQ29tcG9uZW50KSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8Vmlld1xuICAgICAgICAgIHN0eWxlPXtbc3R5bGVzLnNjZW5lU3R5bGUsIG5hdmlnYXRpb25TdGF0ZS5zY2VuZVN0eWxlXX1cbiAgICAgICAgPlxuICAgICAgICAgIDxTY2VuZUNvbXBvbmVudCB7Li4udGhpcy5wcm9wc30gey4uLm5hdmlnYXRpb25TdGF0ZX0gLz5cbiAgICAgICAgPC9WaWV3PlxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBvcHRpb25hbHMgPSB7fTtcbiAgICBjb25zdCBzZWxlY3RlZCA9IG5hdmlnYXRpb25TdGF0ZS5jaGlsZHJlbltuYXZpZ2F0aW9uU3RhdGUuaW5kZXhdO1xuICAgIGNvbnN0IGFwcGx5QW5pbWF0aW9uID0gc2VsZWN0ZWQuYXBwbHlBbmltYXRpb24gfHwgbmF2aWdhdGlvblN0YXRlLmFwcGx5QW5pbWF0aW9uO1xuICAgIGNvbnN0IHN0eWxlID0gc2VsZWN0ZWQuc3R5bGUgfHwgbmF2aWdhdGlvblN0YXRlLnN0eWxlO1xuXG4gICAgaWYgKGFwcGx5QW5pbWF0aW9uKSB7XG4gICAgICBvcHRpb25hbHMuYXBwbHlBbmltYXRpb24gPSBhcHBseUFuaW1hdGlvbjtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IGR1cmF0aW9uID0gc2VsZWN0ZWQuZHVyYXRpb247XG4gICAgICBpZiAoZHVyYXRpb24gPT09IG51bGwgfHwgZHVyYXRpb24gPT09IHVuZGVmaW5lZCkgZHVyYXRpb24gPSBuYXZpZ2F0aW9uU3RhdGUuZHVyYXRpb247XG4gICAgICBpZiAoZHVyYXRpb24gIT09IG51bGwgJiYgZHVyYXRpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBvcHRpb25hbHMuYXBwbHlBbmltYXRpb24gPSAocG9zLCBuYXZTdGF0ZSkgPT4ge1xuICAgICAgICAgIGlmIChkdXJhdGlvbiA9PT0gMCkge1xuICAgICAgICAgICAgcG9zLnNldFZhbHVlKG5hdlN0YXRlLmluZGV4KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgQW5pbWF0ZWQudGltaW5nKHBvcywgeyB0b1ZhbHVlOiBuYXZTdGF0ZS5pbmRleCwgZHVyYXRpb24gfSkuc3RhcnQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gY29uc29sZS5sb2coYE5hdmlnYXRpb25BbmltYXRlZFZpZXcgZm9yICR7bmF2aWdhdGlvblN0YXRlLmtleX1gKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8TmF2aWdhdGlvbkFuaW1hdGVkVmlld1xuICAgICAgICBuYXZpZ2F0aW9uU3RhdGU9e25hdmlnYXRpb25TdGF0ZX1cbiAgICAgICAgc3R5bGU9e1tzdHlsZXMuYW5pbWF0ZWRWaWV3LCBzdHlsZV19XG4gICAgICAgIHJlbmRlck92ZXJsYXk9e0RlZmF1bHRSZW5kZXJlci5yZW5kZXJIZWFkZXJ9XG4gICAgICAgIHJlbmRlclNjZW5lPXtEZWZhdWx0UmVuZGVyZXIucmVuZGVyQ2FyZH1cbiAgICAgICAgey4uLm9wdGlvbmFsc31cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxufVxuIl19