cb45047ef255ffb17d6e41dc53d57b79











'use strict';var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}

var Animated=require('react-native').Animated;
var NavigationContainer=require('./NavigationContainer');
var NavigationPropTypes=require('./NavigationPropTypes');
var NavigationScenesReducer=require('./NavigationScenesReducer');
var React=require('react');
var StyleSheet=require('react-native').StyleSheet;
var View=require('react-native').View;


























var PropTypes=require('prop-types');

function applyDefaultAnimation(
position,
navigationState)
{
Animated.spring(
position,
{
bounciness:0,
toValue:navigationState.index}).

start();
}var

NavigationAnimatedView=function(_React$Component){_inherits(NavigationAnimatedView,_React$Component);





















function NavigationAnimatedView(props,context){_classCallCheck(this,NavigationAnimatedView);var _this=_possibleConstructorReturn(this,(NavigationAnimatedView.__proto__||Object.getPrototypeOf(NavigationAnimatedView)).call(this,
props,context));



var layout={
height:new Animated.Value(0),
initHeight:0,
initWidth:0,
isMeasured:false,
width:new Animated.Value(0)};


_this.state={
layout:layout,
position:new Animated.Value(_this.props.navigationState.index),
scenes:NavigationScenesReducer([],_this.props.navigationState)};return _this;

}_createClass(NavigationAnimatedView,[{key:'componentWillMount',value:function componentWillMount()

{
this._onLayout=this._onLayout.bind(this);
this._onProgressChange=this._onProgressChange.bind(this);
}},{key:'componentDidMount',value:function componentDidMount()

{
this._positionListener=
this.state.position.addListener(this._onProgressChange);
}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(

nextProps){
if(nextProps.navigationState!==this.props.navigationState){
this.setState({
scenes:NavigationScenesReducer(
this.state.scenes,
nextProps.navigationState,
this.props.navigationState)});


}
}},{key:'componentDidUpdate',value:function componentDidUpdate(

lastProps){
if(lastProps.navigationState.index!==this.props.navigationState.index){
this.props.applyAnimation(
this.state.position,
this.props.navigationState,
lastProps.navigationState);

}
}},{key:'componentWillUnmount',value:function componentWillUnmount()

{
this.state.position.removeListener(this._positionListener);
}},{key:'_onProgressChange',value:function _onProgressChange(

data){
var delta=Math.abs(data.value-this.props.navigationState.index);
if(delta>Number.EPSILON){
return;
}

var scenes=this.state.scenes.filter(function(scene){
return!scene.isStale;
});

if(scenes.length!==this.state.scenes.length){
this.setState({scenes:scenes});
}
}},{key:'render',value:function render()

{
var overlay=this._renderOverlay();
var scenes=this._renderScenes();
return(
React.createElement(View,{
onLayout:this._onLayout,
style:this.props.style},
React.createElement(View,{style:styles.scenes,key:'scenes'},
scenes),

overlay));


}},{key:'_renderScenes',value:function _renderScenes()

{
return this.state.scenes.map(this._renderScene,this);
}},{key:'_renderScene',value:function _renderScene(

scene){var _props=




this.props,navigationState=_props.navigationState,onNavigate=_props.onNavigate,renderScene=_props.renderScene;var _state=




this.state,position=_state.position,scenes=_state.scenes;

return renderScene({
layout:this.state.layout,
navigationState:navigationState,
onNavigate:onNavigate,
position:position,
scene:scene,
scenes:scenes});

}},{key:'_renderOverlay',value:function _renderOverlay()

{
if(this.props.renderOverlay){var _props2=




this.props,_navigationState=_props2.navigationState,_onNavigate=_props2.onNavigate,_renderOverlay2=_props2.renderOverlay;var _state2=




this.state,_position=_state2.position,_scenes=_state2.scenes;

return _renderOverlay2({
layout:this.state.layout,
navigationState:_navigationState,
onNavigate:_onNavigate,
position:_position,
scene:_scenes[_navigationState.index],
scenes:_scenes});

}
return null;
}},{key:'_onLayout',value:function _onLayout(

event){var _event$nativeEvent$la=
event.nativeEvent.layout,height=_event$nativeEvent$la.height,width=_event$nativeEvent$la.width;

var layout=_extends({},
this.state.layout,{
initHeight:height,
initWidth:width,
isMeasured:true});


layout.height.setValue(height);
layout.width.setValue(width);

this.setState({layout:layout});
}}]);return NavigationAnimatedView;}(React.Component);NavigationAnimatedView.propTypes={applyAnimation:PropTypes.func,navigationState:NavigationPropTypes.navigationState.isRequired,onNavigate:PropTypes.func.isRequired,renderOverlay:PropTypes.func,renderScene:PropTypes.func.isRequired};NavigationAnimatedView.defaultProps={applyAnimation:applyDefaultAnimation};


var styles=StyleSheet.create({
scenes:{
flex:1}});



NavigationAnimatedView=NavigationContainer.create(NavigationAnimatedView);

module.exports=NavigationAnimatedView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk5hdmlnYXRpb25BbmltYXRlZFZpZXcuanMiXSwibmFtZXMiOlsiQW5pbWF0ZWQiLCJyZXF1aXJlIiwiTmF2aWdhdGlvbkNvbnRhaW5lciIsIk5hdmlnYXRpb25Qcm9wVHlwZXMiLCJOYXZpZ2F0aW9uU2NlbmVzUmVkdWNlciIsIlJlYWN0IiwiU3R5bGVTaGVldCIsIlZpZXciLCJQcm9wVHlwZXMiLCJhcHBseURlZmF1bHRBbmltYXRpb24iLCJwb3NpdGlvbiIsIm5hdmlnYXRpb25TdGF0ZSIsInNwcmluZyIsImJvdW5jaW5lc3MiLCJ0b1ZhbHVlIiwiaW5kZXgiLCJzdGFydCIsIk5hdmlnYXRpb25BbmltYXRlZFZpZXciLCJwcm9wcyIsImNvbnRleHQiLCJsYXlvdXQiLCJoZWlnaHQiLCJWYWx1ZSIsImluaXRIZWlnaHQiLCJpbml0V2lkdGgiLCJpc01lYXN1cmVkIiwid2lkdGgiLCJzdGF0ZSIsInNjZW5lcyIsIl9vbkxheW91dCIsImJpbmQiLCJfb25Qcm9ncmVzc0NoYW5nZSIsIl9wb3NpdGlvbkxpc3RlbmVyIiwiYWRkTGlzdGVuZXIiLCJuZXh0UHJvcHMiLCJzZXRTdGF0ZSIsImxhc3RQcm9wcyIsImFwcGx5QW5pbWF0aW9uIiwicmVtb3ZlTGlzdGVuZXIiLCJkYXRhIiwiZGVsdGEiLCJNYXRoIiwiYWJzIiwidmFsdWUiLCJOdW1iZXIiLCJFUFNJTE9OIiwiZmlsdGVyIiwic2NlbmUiLCJpc1N0YWxlIiwibGVuZ3RoIiwib3ZlcmxheSIsIl9yZW5kZXJPdmVybGF5IiwiX3JlbmRlclNjZW5lcyIsInN0eWxlIiwic3R5bGVzIiwibWFwIiwiX3JlbmRlclNjZW5lIiwib25OYXZpZ2F0ZSIsInJlbmRlclNjZW5lIiwicmVuZGVyT3ZlcmxheSIsImV2ZW50IiwibmF0aXZlRXZlbnQiLCJzZXRWYWx1ZSIsIkNvbXBvbmVudCIsInByb3BUeXBlcyIsImZ1bmMiLCJpc1JlcXVpcmVkIiwiZGVmYXVsdFByb3BzIiwiY3JlYXRlIiwiZmxleCIsIm1vZHVsZSIs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QWlCUixvQkFBb0JRLGVBQXBCLENBQW9DdUQsVUFGcEMsQ0FHakJULFdBQVlqRCxVQUFVeUQsSUFBVixDQUFlQyxVQUhWLENBSWpCUCxjQUFlbkQsVUFBVXlELElBSlIsQ0FLakJQLFlBQWFsRCxVQUFVeUQsSUFBVixDQUFlQyxVQUxYLEMsQ0FWZmpELHNCLENBa0JHa0QsWSxDQUFlLENBQ3BCOUIsZUFBZ0I1QixxQkFESSxDOzs7QUE4SnhCLEdBQU02QyxRQUFTaEQsV0FBVzhELE1BQVgsQ0FBa0I7QUFDL0J4QyxPQUFRO0FBQ055QyxLQUFNLENBREEsQ0FEdUIsQ0FBbEIsQ0FBZjs7OztBQU1BcEQsdUJBQXlCZixvQkFBb0JrRSxNQUFwQixDQUEyQm5ELHNCQUEzQixDQUF6Qjs7QUFFQXFELE9BQU9DLE9BQVAsQ0FBaUJ0RCxzQkFBakIiLCJmaWxlIjoiTmF2aWdhdGlvbkFuaW1hdGVkVmlldy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cbiAqXG4gKiBAcHJvdmlkZXNNb2R1bGUgTmF2aWdhdGlvbkFuaW1hdGVkVmlld1xuICogQGZsb3dcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBBbmltYXRlZCA9IHJlcXVpcmUoJ3JlYWN0LW5hdGl2ZScpLkFuaW1hdGVkO1xuY29uc3QgTmF2aWdhdGlvbkNvbnRhaW5lciA9IHJlcXVpcmUoJy4vTmF2aWdhdGlvbkNvbnRhaW5lcicpO1xuY29uc3QgTmF2aWdhdGlvblByb3BUeXBlcyA9IHJlcXVpcmUoJy4vTmF2aWdhdGlvblByb3BUeXBlcycpO1xuY29uc3QgTmF2aWdhdGlvblNjZW5lc1JlZHVjZXIgPSByZXF1aXJlKCcuL05hdmlnYXRpb25TY2VuZXNSZWR1Y2VyJyk7XG5jb25zdCBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5jb25zdCBTdHlsZVNoZWV0ID0gcmVxdWlyZSgncmVhY3QtbmF0aXZlJykuU3R5bGVTaGVldDtcbmNvbnN0IFZpZXcgPSByZXF1aXJlKCdyZWFjdC1uYXRpdmUnKS5WaWV3O1xuXG5pbXBvcnQgdHlwZSB7XG4gIE5hdmlnYXRpb25BY3Rpb25DYWxsZXIsXG4gIE5hdmlnYXRpb25BbmltYXRlZFZhbHVlLFxuICBOYXZpZ2F0aW9uQW5pbWF0aW9uU2V0dGVyLFxuICBOYXZpZ2F0aW9uTGF5b3V0LFxuICBOYXZpZ2F0aW9uUGFyZW50U3RhdGUsXG4gIE5hdmlnYXRpb25TY2VuZSxcbiAgTmF2aWdhdGlvblNjZW5lUmVuZGVyZXIsXG59IGZyb20gJ05hdmlnYXRpb25UeXBlRGVmaW5pdGlvbic7XG5cbnR5cGUgUHJvcHMgPSB7XG4gIGFwcGx5QW5pbWF0aW9uOiBOYXZpZ2F0aW9uQW5pbWF0aW9uU2V0dGVyLFxuICBuYXZpZ2F0aW9uU3RhdGU6IE5hdmlnYXRpb25QYXJlbnRTdGF0ZSxcbiAgb25OYXZpZ2F0ZTogTmF2aWdhdGlvbkFjdGlvbkNhbGxlcixcbiAgcmVuZGVyT3ZlcmxheTogP05hdmlnYXRpb25TY2VuZVJlbmRlcmVyLFxuICByZW5kZXJTY2VuZTogTmF2aWdhdGlvblNjZW5lUmVuZGVyZXIsXG4gIHN0eWxlOiBhbnksXG59O1xuXG50eXBlIFN0YXRlID0ge1xuICBsYXlvdXQ6IE5hdmlnYXRpb25MYXlvdXQsXG4gIHBvc2l0aW9uOiBOYXZpZ2F0aW9uQW5pbWF0ZWRWYWx1ZSxcbiAgc2NlbmVzOiBBcnJheTxOYXZpZ2F0aW9uU2NlbmU+LFxufTtcblxuY29uc3QgUHJvcFR5cGVzID0gcmVxdWlyZSgncHJvcC10eXBlcycpO1xuXG5mdW5jdGlvbiBhcHBseURlZmF1bHRBbmltYXRpb24oXG4gIHBvc2l0aW9uOiBOYXZpZ2F0aW9uQW5pbWF0ZWRWYWx1ZSxcbiAgbmF2aWdhdGlvblN0YXRlOiBOYXZpZ2F0aW9uUGFyZW50U3RhdGUsXG4pOiB2b2lkIHtcbiAgQW5pbWF0ZWQuc3ByaW5nKFxuICAgIHBvc2l0aW9uLFxuICAgIHtcbiAgICAgIGJvdW5jaW5lc3M6IDAsXG4gICAgICB0b1ZhbHVlOiBuYXZpZ2F0aW9uU3RhdGUuaW5kZXgsXG4gICAgfVxuICApLnN0YXJ0KCk7XG59XG5cbmNsYXNzIE5hdmlnYXRpb25BbmltYXRlZFZpZXdcbiAgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8YW55LCBQcm9wcywgU3RhdGU+IHtcblxuICBfb25MYXlvdXQ6IChldmVudDogYW55KSA9PiB2b2lkO1xuICBfb25Qcm9ncmVzc0NoYW5nZTogKGRhdGE6IHt2YWx1ZTogbnVtYmVyfSkgPT4gdm9pZDtcbiAgX3Bvc2l0aW9uTGlzdGVuZXI6IGFueTtcblxuICBwcm9wczogUHJvcHM7XG4gIHN0YXRlOiBTdGF0ZTtcblxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIGFwcGx5QW5pbWF0aW9uOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBuYXZpZ2F0aW9uU3RhdGU6IE5hdmlnYXRpb25Qcm9wVHlwZXMubmF2aWdhdGlvblN0YXRlLmlzUmVxdWlyZWQsXG4gICAgb25OYXZpZ2F0ZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICByZW5kZXJPdmVybGF5OiBQcm9wVHlwZXMuZnVuYyxcbiAgICByZW5kZXJTY2VuZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgfTtcblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIGFwcGx5QW5pbWF0aW9uOiBhcHBseURlZmF1bHRBbmltYXRpb24sXG4gIH07XG5cbiAgY29uc3RydWN0b3IocHJvcHM6IFByb3BzLCBjb250ZXh0OiBhbnkpIHtcbiAgICBzdXBlcihwcm9wcywgY29udGV4dCk7XG5cbiAgICAvLyBUaGUgaW5pdGlhbCBsYXlvdXQgaXNuJ3QgbWVhc3VyZWQuIE1lYXN1cmVkIGxheW91dCB3aWxsIGJlIG9ubHkgYXZhaWxhYmxlXG4gICAgLy8gd2hlbiB0aGUgY29tcG9uZW50IGlzIG1vdW50ZWQuXG4gICAgY29uc3QgbGF5b3V0ID0ge1xuICAgICAgaGVpZ2h0OiBuZXcgQW5pbWF0ZWQuVmFsdWUoMCksXG4gICAgICBpbml0SGVpZ2h0OiAwLFxuICAgICAgaW5pdFdpZHRoOiAwLFxuICAgICAgaXNNZWFzdXJlZDogZmFsc2UsXG4gICAgICB3aWR0aDogbmV3IEFuaW1hdGVkLlZhbHVlKDApLFxuICAgIH07XG5cbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgbGF5b3V0LFxuICAgICAgcG9zaXRpb246IG5ldyBBbmltYXRlZC5WYWx1ZSh0aGlzLnByb3BzLm5hdmlnYXRpb25TdGF0ZS5pbmRleCksXG4gICAgICBzY2VuZXM6IE5hdmlnYXRpb25TY2VuZXNSZWR1Y2VyKFtdLCB0aGlzLnByb3BzLm5hdmlnYXRpb25TdGF0ZSksXG4gICAgfTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxNb3VudCgpOiB2b2lkIHtcbiAgICB0aGlzLl9vbkxheW91dCA9IHRoaXMuX29uTGF5b3V0LmJpbmQodGhpcyk7XG4gICAgdGhpcy5fb25Qcm9ncmVzc0NoYW5nZSA9IHRoaXMuX29uUHJvZ3Jlc3NDaGFuZ2UuYmluZCh0aGlzKTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCk6IHZvaWQge1xuICAgIHRoaXMuX3Bvc2l0aW9uTGlzdGVuZXIgPVxuICAgICAgdGhpcy5zdGF0ZS5wb3NpdGlvbi5hZGRMaXN0ZW5lcih0aGlzLl9vblByb2dyZXNzQ2hhbmdlKTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzOiBQcm9wcyk6IHZvaWQge1xuICAgIGlmIChuZXh0UHJvcHMubmF2aWdhdGlvblN0YXRlICE9PSB0aGlzLnByb3BzLm5hdmlnYXRpb25TdGF0ZSkge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIHNjZW5lczogTmF2aWdhdGlvblNjZW5lc1JlZHVjZXIoXG4gICAgICAgICAgdGhpcy5zdGF0ZS5zY2VuZXMsXG4gICAgICAgICAgbmV4dFByb3BzLm5hdmlnYXRpb25TdGF0ZSxcbiAgICAgICAgICB0aGlzLnByb3BzLm5hdmlnYXRpb25TdGF0ZVxuICAgICAgICApLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgY29tcG9uZW50RGlkVXBkYXRlKGxhc3RQcm9wczogUHJvcHMpOiB2b2lkIHtcbiAgICBpZiAobGFzdFByb3BzLm5hdmlnYXRpb25TdGF0ZS5pbmRleCAhPT0gdGhpcy5wcm9wcy5uYXZpZ2F0aW9uU3RhdGUuaW5kZXgpIHtcbiAgICAgIHRoaXMucHJvcHMuYXBwbHlBbmltYXRpb24oXG4gICAgICAgIHRoaXMuc3RhdGUucG9zaXRpb24sXG4gICAgICAgIHRoaXMucHJvcHMubmF2aWdhdGlvblN0YXRlLFxuICAgICAgICBsYXN0UHJvcHMubmF2aWdhdGlvblN0YXRlXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCk6IHZvaWQge1xuICAgIHRoaXMuc3RhdGUucG9zaXRpb24ucmVtb3ZlTGlzdGVuZXIodGhpcy5fcG9zaXRpb25MaXN0ZW5lcik7XG4gIH1cblxuICBfb25Qcm9ncmVzc0NoYW5nZShkYXRhOiBPYmplY3QpOiB2b2lkIHtcbiAgICBjb25zdCBkZWx0YSA9IE1hdGguYWJzKGRhdGEudmFsdWUgLSB0aGlzLnByb3BzLm5hdmlnYXRpb25TdGF0ZS5pbmRleCk7XG4gICAgaWYgKGRlbHRhID4gTnVtYmVyLkVQU0lMT04pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBzY2VuZXMgPSB0aGlzLnN0YXRlLnNjZW5lcy5maWx0ZXIoc2NlbmUgPT4ge1xuICAgICAgcmV0dXJuICFzY2VuZS5pc1N0YWxlO1xuICAgIH0pO1xuXG4gICAgaWYgKHNjZW5lcy5sZW5ndGggIT09IHRoaXMuc3RhdGUuc2NlbmVzLmxlbmd0aCkge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNjZW5lcyB9KTtcbiAgICB9XG4gIH1cblxuICByZW5kZXIoKTogUmVhY3RFbGVtZW50IHtcbiAgICBjb25zdCBvdmVybGF5ID0gdGhpcy5fcmVuZGVyT3ZlcmxheSgpO1xuICAgIGNvbnN0IHNjZW5lcyA9IHRoaXMuX3JlbmRlclNjZW5lcygpO1xuICAgIHJldHVybiAoXG4gICAgICA8Vmlld1xuICAgICAgICBvbkxheW91dD17dGhpcy5fb25MYXlvdXR9XG4gICAgICAgIHN0eWxlPXt0aGlzLnByb3BzLnN0eWxlfT5cbiAgICAgICAgPFZpZXcgc3R5bGU9e3N0eWxlcy5zY2VuZXN9IGtleT1cInNjZW5lc1wiPlxuICAgICAgICAgIHtzY2VuZXN9XG4gICAgICAgIDwvVmlldz5cbiAgICAgICAge292ZXJsYXl9XG4gICAgICA8L1ZpZXc+XG4gICAgKTtcbiAgfVxuXG4gIF9yZW5kZXJTY2VuZXMoKTogQXJyYXk8P1JlYWN0RWxlbWVudD4ge1xuICAgIHJldHVybiB0aGlzLnN0YXRlLnNjZW5lcy5tYXAodGhpcy5fcmVuZGVyU2NlbmUsIHRoaXMpO1xuICB9XG5cbiAgX3JlbmRlclNjZW5lKHNjZW5lOiBOYXZpZ2F0aW9uU2NlbmUpOiA/UmVhY3RFbGVtZW50IHtcbiAgICBjb25zdCB7XG4gICAgICBuYXZpZ2F0aW9uU3RhdGUsXG4gICAgICBvbk5hdmlnYXRlLFxuICAgICAgcmVuZGVyU2NlbmUsXG4gICAgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBjb25zdCB7XG4gICAgICBwb3NpdGlvbixcbiAgICAgIHNjZW5lcyxcbiAgICB9ID0gdGhpcy5zdGF0ZTtcblxuICAgIHJldHVybiByZW5kZXJTY2VuZSh7XG4gICAgICBsYXlvdXQ6IHRoaXMuc3RhdGUubGF5b3V0LFxuICAgICAgbmF2aWdhdGlvblN0YXRlLFxuICAgICAgb25OYXZpZ2F0ZSxcbiAgICAgIHBvc2l0aW9uLFxuICAgICAgc2NlbmUsXG4gICAgICBzY2VuZXMsXG4gICAgfSk7XG4gIH1cblxuICBfcmVuZGVyT3ZlcmxheSgpOiA/UmVhY3RFbGVtZW50IHtcbiAgICBpZiAodGhpcy5wcm9wcy5yZW5kZXJPdmVybGF5KSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIG5hdmlnYXRpb25TdGF0ZSxcbiAgICAgICAgb25OYXZpZ2F0ZSxcbiAgICAgICAgcmVuZGVyT3ZlcmxheSxcbiAgICAgIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgICBjb25zdCB7XG4gICAgICAgIHBvc2l0aW9uLFxuICAgICAgICBzY2VuZXMsXG4gICAgICB9ID0gdGhpcy5zdGF0ZTtcblxuICAgICAgcmV0dXJuIHJlbmRlck92ZXJsYXkoe1xuICAgICAgICBsYXlvdXQ6IHRoaXMuc3RhdGUubGF5b3V0LFxuICAgICAgICBuYXZpZ2F0aW9uU3RhdGUsXG4gICAgICAgIG9uTmF2aWdhdGUsXG4gICAgICAgIHBvc2l0aW9uLFxuICAgICAgICBzY2VuZTogc2NlbmVzW25hdmlnYXRpb25TdGF0ZS5pbmRleF0sXG4gICAgICAgIHNjZW5lcyxcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIF9vbkxheW91dChldmVudDogYW55KTogdm9pZCB7XG4gICAgY29uc3Qge2hlaWdodCwgd2lkdGh9ID0gZXZlbnQubmF0aXZlRXZlbnQubGF5b3V0O1xuXG4gICAgY29uc3QgbGF5b3V0ID0ge1xuICAgICAgLi4udGhpcy5zdGF0ZS5sYXlvdXQsXG4gICAgICBpbml0SGVpZ2h0OiBoZWlnaHQsXG4gICAgICBpbml0V2lkdGg6IHdpZHRoLFxuICAgICAgaXNNZWFzdXJlZDogdHJ1ZSxcbiAgICB9O1xuXG4gICAgbGF5b3V0LmhlaWdodC5zZXRWYWx1ZShoZWlnaHQpO1xuICAgIGxheW91dC53aWR0aC5zZXRWYWx1ZSh3aWR0aCk7XG5cbiAgICB0aGlzLnNldFN0YXRlKHsgbGF5b3V0IH0pO1xuICB9XG59XG5cbmNvbnN0IHN0eWxlcyA9IFN0eWxlU2hlZXQuY3JlYXRlKHtcbiAgc2NlbmVzOiB7XG4gICAgZmxleDogMSxcbiAgfSxcbn0pO1xuXG5OYXZpZ2F0aW9uQW5pbWF0ZWRWaWV3ID0gTmF2aWdhdGlvbkNvbnRhaW5lci5jcmVhdGUoTmF2aWdhdGlvbkFuaW1hdGVkVmlldyk7XG5cbm1vZHVsZS5leHBvcnRzID0gTmF2aWdhdGlvbkFuaW1hdGVkVmlldztcbiJdfQ==