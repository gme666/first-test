5c4e3a7107722dd9bd4b0e7e470d0eaa











'use strict';var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};

var BatchedBridge=require('BatchedBridge');
var BugReporting=require('BugReporting');
var NativeModules=require('NativeModules');
var ReactNative=require('ReactNative');
var SceneTracker=require('SceneTracker');

var infoLog=require('infoLog');
var invariant=require('fbjs/lib/invariant');
var renderApplication=require('renderApplication');

























var runnables={};
var runCount=1;
var sections={};
var tasks=new Map();
var componentProviderInstrumentationHook=
function componentProviderInstrumentationHook(component){return component();};

var wrapperComponentProvider=void 0;



























var AppRegistry={
setWrapperComponentProvider:function setWrapperComponentProvider(provider){
wrapperComponentProvider=provider;
},

registerConfig:function registerConfig(config){
config.forEach(function(appConfig){
if(appConfig.run){
AppRegistry.registerRunnable(appConfig.appKey,appConfig.run);
}else{
invariant(
appConfig.component!=null,
'AppRegistry.registerConfig(...): Every config is expected to set '+
'either `run` or `component`, but `%s` has neither.',
appConfig.appKey);

AppRegistry.registerComponent(
appConfig.appKey,
appConfig.component,
appConfig.section);

}
});
},

registerComponent:function registerComponent(
appKey,
componentProvider,
section)
{
runnables[appKey]={
componentProvider:componentProvider,
run:function run(appParameters){return(
renderApplication(
componentProviderInstrumentationHook(componentProvider),
appParameters.initialProps,
appParameters.rootTag,
wrapperComponentProvider&&wrapperComponentProvider(appParameters)));}};


if(section){
sections[appKey]=runnables[appKey];
}
return appKey;
},

registerRunnable:function registerRunnable(appKey,run){
runnables[appKey]={run:run};
return appKey;
},

registerSection:function registerSection(appKey,component){
AppRegistry.registerComponent(appKey,component,true);
},

getAppKeys:function getAppKeys(){
return Object.keys(runnables);
},

getSectionKeys:function getSectionKeys(){
return Object.keys(sections);
},

getSections:function getSections(){
return _extends({},
sections);

},

getRunnable:function getRunnable(appKey){
return runnables[appKey];
},

getRegistry:function getRegistry(){
return{
sections:AppRegistry.getSectionKeys(),
runnables:_extends({},runnables)};

},

setComponentProviderInstrumentationHook:function setComponentProviderInstrumentationHook(hook){
componentProviderInstrumentationHook=hook;
},

runApplication:function runApplication(appKey,appParameters){
var msg=
'Running application "'+appKey+'" with appParams: '+
JSON.stringify(appParameters)+'. '+
'__DEV__ === '+String(__DEV__)+
', development-level warning are '+(__DEV__?'ON':'OFF')+
', performance optimizations are '+(__DEV__?'OFF':'ON');
infoLog(msg);
BugReporting.addSource('AppRegistry.runApplication'+runCount++,function(){return msg;});
invariant(
runnables[appKey]&&runnables[appKey].run,
'Application '+appKey+' has not been registered.\n\n'+
'Hint: This error often happens when you\'re running the packager '+
'(local dev server) from a wrong folder. For example you have '+
'multiple apps and the packager is still running for the app you '+
'were working on before.\nIf this is the case, simply kill the old '+
'packager instance (e.g. close the packager terminal window) '+
'and start the packager in the correct app folder (e.g. cd into app '+
'folder and run \'npm start\').\n\n'+
'This error can also happen due to a require() error during '+
'initialization or failure to call AppRegistry.registerComponent.\n\n');


SceneTracker.setActiveScene({name:appKey});
runnables[appKey].run(appParameters);
},

unmountApplicationComponentAtRootTag:function unmountApplicationComponentAtRootTag(rootTag){
ReactNative.unmountComponentAtNodeAndRemoveContainer(rootTag);
},








registerHeadlessTask:function registerHeadlessTask(taskKey,task){
if(tasks.has(taskKey)){
console.warn('registerHeadlessTask called multiple times for same key \''+taskKey+'\'');
}
tasks.set(taskKey,task);
},








startHeadlessTask:function startHeadlessTask(taskId,taskKey,data){
var taskProvider=tasks.get(taskKey);
if(!taskProvider){
throw new Error('No task registered for key '+taskKey);
}
taskProvider()(data).
then(function(){return NativeModules.HeadlessJsTaskSupport.notifyTaskFinished(taskId);}).
catch(function(reason){
console.error(reason);
NativeModules.HeadlessJsTaskSupport.notifyTaskFinished(taskId);
});
}};



BatchedBridge.registerCallableModule(
'AppRegistry',
AppRegistry);


module.exports=AppRegistry;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFwcFJlZ2lzdHJ5LmpzIl0sIm5hbWVzIjpbIkJhdGNoZWRCcmlkZ2UiLCJyZXF1aXJlIiwiQnVnUmVwb3J0aW5nIiwiTmF0aXZlTW9kdWxlcyIsIlJlYWN0TmF0aXZlIiwiU2NlbmVUcmFja2VyIiwiaW5mb0xvZyIsImludmFyaWFudCIsInJlbmRlckFwcGxpY2F0aW9uIiwicnVubmFibGVzIiwicnVuQ291bnQiLCJzZWN0aW9ucyIsInRhc2tzIiwiTWFwIiwiY29tcG9uZW50UHJvdmlkZXJJbnN0cnVtZW50YXRpb25Ib29rIiwiY29tcG9uZW50Iiwid3JhcHBlckNvbXBvbmVudFByb3ZpZGVyIiwiQXBwUmVnaXN0cnkiLCJzZXRXcmFwcGVyQ29tcG9uZW50UHJvdmlkZXIiLCJwcm92aWRlciIsInJlZ2lzdGVyQ29uZmlnIiwiY29uZmlnIiwiZm9yRWFjaCIsImFwcENvbmZpZyIsInJ1biIsInJlZ2lzdGVyUnVubmFibGUiLCJhcHBLZXkiLCJyZWdpc3RlckNvbXBvbmVudCIsInNlY3Rpb24iLCJjb21wb25lbnRQcm92aWRlciIsImFwcFBhcmFtZXRlcnMiLCJpbml0aWFsUHJvcHMiLCJyb290VGFnIiwicmVnaXN0ZXJTZWN0aW9uIiwiZ2V0QXBwS2V5cyIsIk9iamVjdCIsImtleXMiLCJnZXRTZWN0aW9uS2V5cyIsImdldFNlY3Rpb25zIiwiZ2V0UnVubmFibGUiLCJnZXRSZWdpc3RyeSIsInNldENvbXBvbmVudFByb3ZpZGVySW5zdHJ1bWVudGF0aW9uSG9vayIsImhvb2siLCJydW5BcHBsaWNhdGlvbiIsIm1zZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJTdHJpbmciLCJfX0RFVl9fIiwiYWRkU291cmNlIiwic2V0QWN0aXZlU2NlbmUiLCJuYW1lIiwidW5tb3VudEFwcGxpY2F0aW9uQ29tcG9uZW50QXRSb290VGFnIiwidW5tb3VudENvbXBvbmVudEF0Tm9kZUFuZFJlbW92ZUNvbnRhaW5lciIsInJlZ2lzdGVySGVhZGxlc3NUYXNrIiwidGFza0tleSIsInRhc2siLCJoYXMiLCJjb25zb2xlIiwid2FybiIsInNldCIsInN0YXJ0SGVhZGxlc3NUYXNrIiwidGFza0lkIiwiZGF0YSIsInRhc2tQcm92aWRlciIsImdldCIsIkVycm9yIiwidGhlbiIsIkhlYWRsZXNzSnNUYXNrU3VwcG9ydCIsIm5vdGlmeVRhc2tGaW5pc2hlZCIsImNhdGNoIiwiZXJyb3IiLCJyZWFzb24iLCJyZWdpc3RlckNhbGxhYmxlTW9kdWxlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFXQSxhOztBQUVBLEdBQU1BLGVBQWdCQyxRQUFRLGVBQVIsQ0FBdEI7QUFDQSxHQUFNQyxjQUFlRCxRQUFRLGNBQVIsQ0FBckI7QUFDQSxHQUFNRSxlQUFnQkYsUUFBUSxlQUFSLENBQXRCO0FBQ0EsR0FBTUcsYUFBY0gsUUFBUSxhQUFSLENBQXBCO0FBQ0EsR0FBTUksY0FBZUosUUFBUSxjQUFSLENBQXJCOztBQUVBLEdBQU1LLFNBQVVMLFFBQVEsU0FBUixDQUFoQjtBQUNBLEdBQU1NLFdBQVlOLFFBQVEsb0JBQVIsQ0FBbEI7QUFDQSxHQUFNTyxtQkFBb0JQLFFBQVEsbUJBQVIsQ0FBMUI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMEJBLEdBQU1RLFdBQXVCLEVBQTdCO0FBQ0EsR0FBSUMsVUFBVyxDQUFmO0FBQ0EsR0FBTUMsVUFBc0IsRUFBNUI7QUFDQSxHQUFNQyxPQUFtQyxHQUFJQyxJQUFKLEVBQXpDO0FBQ0EsR0FBSUM7QUFDRiw4Q0FBQ0MsU0FBRCxRQUFrQ0EsWUFBbEMsRUFERjs7QUFHQSxHQUFJQyxnQ0FBSjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTRCQSxHQUFNQyxhQUFjO0FBQ2xCQywyQkFEa0Isc0NBQ1VDLFFBRFYsQ0FDOEM7QUFDOURILHlCQUEyQkcsUUFBM0I7QUFDRCxDQUhpQjs7QUFLbEJDLGNBTGtCLHlCQUtIQyxNQUxHLENBSzZCO0FBQzdDQSxPQUFPQyxPQUFQLENBQWUsU0FBQ0MsU0FBRCxDQUFlO0FBQzVC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QURGO0FBRUV4RCxXQUZGOzs7QUFLQXlELE9BQU9DLE9BQVAsQ0FBaUIxRCxXQUFqQiIsImZpbGUiOiJBcHBSZWdpc3RyeS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cbiAqXG4gKiBAcHJvdmlkZXNNb2R1bGUgQXBwUmVnaXN0cnlcbiAqIEBmbG93XG4gKi9cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgQmF0Y2hlZEJyaWRnZSA9IHJlcXVpcmUoJ0JhdGNoZWRCcmlkZ2UnKTtcbmNvbnN0IEJ1Z1JlcG9ydGluZyA9IHJlcXVpcmUoJ0J1Z1JlcG9ydGluZycpO1xuY29uc3QgTmF0aXZlTW9kdWxlcyA9IHJlcXVpcmUoJ05hdGl2ZU1vZHVsZXMnKTtcbmNvbnN0IFJlYWN0TmF0aXZlID0gcmVxdWlyZSgnUmVhY3ROYXRpdmUnKTtcbmNvbnN0IFNjZW5lVHJhY2tlciA9IHJlcXVpcmUoJ1NjZW5lVHJhY2tlcicpO1xuXG5jb25zdCBpbmZvTG9nID0gcmVxdWlyZSgnaW5mb0xvZycpO1xuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnZmJqcy9saWIvaW52YXJpYW50Jyk7XG5jb25zdCByZW5kZXJBcHBsaWNhdGlvbiA9IHJlcXVpcmUoJ3JlbmRlckFwcGxpY2F0aW9uJyk7XG5cbnR5cGUgVGFzayA9ICh0YXNrRGF0YTogYW55KSA9PiBQcm9taXNlPHZvaWQ+O1xudHlwZSBUYXNrUHJvdmlkZXIgPSAoKSA9PiBUYXNrO1xuZXhwb3J0IHR5cGUgQ29tcG9uZW50UHJvdmlkZXIgPSAoKSA9PiBSZWFjdENsYXNzPGFueT47XG5leHBvcnQgdHlwZSBDb21wb25lbnRQcm92aWRlckluc3RydW1lbnRhdGlvbkhvb2sgPVxuICAoY29tcG9uZW50OiBDb21wb25lbnRQcm92aWRlcikgPT4gUmVhY3RDbGFzczxhbnk+O1xuZXhwb3J0IHR5cGUgQXBwQ29uZmlnID0ge1xuICBhcHBLZXk6IHN0cmluZyxcbiAgY29tcG9uZW50PzogQ29tcG9uZW50UHJvdmlkZXIsXG4gIHJ1bj86IEZ1bmN0aW9uLFxuICBzZWN0aW9uPzogYm9vbGVhbixcbn07XG5leHBvcnQgdHlwZSBSdW5uYWJsZSA9IHtcbiAgY29tcG9uZW50PzogQ29tcG9uZW50UHJvdmlkZXIsXG4gIHJ1bjogRnVuY3Rpb24sXG59O1xuZXhwb3J0IHR5cGUgUnVubmFibGVzID0ge1xuICBbYXBwS2V5OiBzdHJpbmddOiBSdW5uYWJsZSxcbn07XG5leHBvcnQgdHlwZSBSZWdpc3RyeSA9IHtcbiAgc2VjdGlvbnM6IEFycmF5PHN0cmluZz4sXG4gIHJ1bm5hYmxlczogUnVubmFibGVzLFxufTtcbmV4cG9ydCB0eXBlIFdyYXBwZXJDb21wb25lbnRQcm92aWRlciA9IGFueSA9PiBSZWFjdENsYXNzPCo+O1xuXG5jb25zdCBydW5uYWJsZXM6IFJ1bm5hYmxlcyA9IHt9O1xubGV0IHJ1bkNvdW50ID0gMTtcbmNvbnN0IHNlY3Rpb25zOiBSdW5uYWJsZXMgPSB7fTtcbmNvbnN0IHRhc2tzOiBNYXA8c3RyaW5nLCBUYXNrUHJvdmlkZXI+ID0gbmV3IE1hcCgpO1xubGV0IGNvbXBvbmVudFByb3ZpZGVySW5zdHJ1bWVudGF0aW9uSG9vazogQ29tcG9uZW50UHJvdmlkZXJJbnN0cnVtZW50YXRpb25Ib29rID1cbiAgKGNvbXBvbmVudDogQ29tcG9uZW50UHJvdmlkZXIpID0+IGNvbXBvbmVudCgpO1xuXG5sZXQgd3JhcHBlckNvbXBvbmVudFByb3ZpZGVyOiA/V3JhcHBlckNvbXBvbmVudFByb3ZpZGVyO1xuXG4vKipcbiAqIDxkaXYgY2xhc3M9XCJiYW5uZXItY3JuYS1lamVjdGVkXCI+XG4gKiAgIDxoMz5Qcm9qZWN0IHdpdGggTmF0aXZlIENvZGUgUmVxdWlyZWQ8L2gzPlxuICogICA8cD5cbiAqICAgICBUaGlzIEFQSSBvbmx5IHdvcmtzIGluIHByb2plY3RzIG1hZGUgd2l0aCA8Y29kZT5yZWFjdC1uYXRpdmUgaW5pdDwvY29kZT5cbiAqICAgICBvciBpbiB0aG9zZSBtYWRlIHdpdGggQ3JlYXRlIFJlYWN0IE5hdGl2ZSBBcHAgd2hpY2ggaGF2ZSBzaW5jZSBlamVjdGVkLiBGb3JcbiAqICAgICBtb3JlIGluZm9ybWF0aW9uIGFib3V0IGVqZWN0aW5nLCBwbGVhc2Ugc2VlXG4gKiAgICAgdGhlIDxhIGhyZWY9XCJodHRwczovL2dpdGh1Yi5jb20vcmVhY3QtY29tbXVuaXR5L2NyZWF0ZS1yZWFjdC1uYXRpdmUtYXBwL2Jsb2IvbWFzdGVyL0VKRUNUSU5HLm1kXCIgdGFyZ2V0PVwiX2JsYW5rXCI+Z3VpZGU8L2E+IG9uXG4gKiAgICAgdGhlIENyZWF0ZSBSZWFjdCBOYXRpdmUgQXBwIHJlcG9zaXRvcnkuXG4gKiAgIDwvcD5cbiAqIDwvZGl2PlxuICpcbiAqIGBBcHBSZWdpc3RyeWAgaXMgdGhlIEpTIGVudHJ5IHBvaW50IHRvIHJ1bm5pbmcgYWxsIFJlYWN0IE5hdGl2ZSBhcHBzLiAgQXBwXG4gKiByb290IGNvbXBvbmVudHMgc2hvdWxkIHJlZ2lzdGVyIHRoZW1zZWx2ZXMgd2l0aFxuICogYEFwcFJlZ2lzdHJ5LnJlZ2lzdGVyQ29tcG9uZW50YCwgdGhlbiB0aGUgbmF0aXZlIHN5c3RlbSBjYW4gbG9hZCB0aGUgYnVuZGxlXG4gKiBmb3IgdGhlIGFwcCBhbmQgdGhlbiBhY3R1YWxseSBydW4gdGhlIGFwcCB3aGVuIGl0J3MgcmVhZHkgYnkgaW52b2tpbmdcbiAqIGBBcHBSZWdpc3RyeS5ydW5BcHBsaWNhdGlvbmAuXG4gKlxuICogVG8gXCJzdG9wXCIgYW4gYXBwbGljYXRpb24gd2hlbiBhIHZpZXcgc2hvdWxkIGJlIGRlc3Ryb3llZCwgY2FsbFxuICogYEFwcFJlZ2lzdHJ5LnVubW91bnRBcHBsaWNhdGlvbkNvbXBvbmVudEF0Um9vdFRhZ2Agd2l0aCB0aGUgdGFnIHRoYXQgd2FzXG4gKiBwYXNzZWQgaW50byBgcnVuQXBwbGljYXRpb25gLiBUaGVzZSBzaG91bGQgYWx3YXlzIGJlIHVzZWQgYXMgYSBwYWlyLlxuICpcbiAqIGBBcHBSZWdpc3RyeWAgc2hvdWxkIGJlIGByZXF1aXJlYGQgZWFybHkgaW4gdGhlIGByZXF1aXJlYCBzZXF1ZW5jZSB0byBtYWtlXG4gKiBzdXJlIHRoZSBKUyBleGVjdXRpb24gZW52aXJvbm1lbnQgaXMgc2V0dXAgYmVmb3JlIG90aGVyIG1vZHVsZXMgYXJlXG4gKiBgcmVxdWlyZWBkLlxuICovXG5jb25zdCBBcHBSZWdpc3RyeSA9IHtcbiAgc2V0V3JhcHBlckNvbXBvbmVudFByb3ZpZGVyKHByb3ZpZGVyOiBXcmFwcGVyQ29tcG9uZW50UHJvdmlkZXIpIHtcbiAgICB3cmFwcGVyQ29tcG9uZW50UHJvdmlkZXIgPSBwcm92aWRlcjtcbiAgfSxcblxuICByZWdpc3RlckNvbmZpZyhjb25maWc6IEFycmF5PEFwcENvbmZpZz4pOiB2b2lkIHtcbiAgICBjb25maWcuZm9yRWFjaCgoYXBwQ29uZmlnKSA9PiB7XG4gICAgICBpZiAoYXBwQ29uZmlnLnJ1bikge1xuICAgICAgICBBcHBSZWdpc3RyeS5yZWdpc3RlclJ1bm5hYmxlKGFwcENvbmZpZy5hcHBLZXksIGFwcENvbmZpZy5ydW4pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaW52YXJpYW50KFxuICAgICAgICAgIGFwcENvbmZpZy5jb21wb25lbnQgIT0gbnVsbCxcbiAgICAgICAgICAnQXBwUmVnaXN0cnkucmVnaXN0ZXJDb25maWcoLi4uKTogRXZlcnkgY29uZmlnIGlzIGV4cGVjdGVkIHRvIHNldCAnICtcbiAgICAgICAgICAnZWl0aGVyIGBydW5gIG9yIGBjb21wb25lbnRgLCBidXQgYCVzYCBoYXMgbmVpdGhlci4nLFxuICAgICAgICAgIGFwcENvbmZpZy5hcHBLZXlcbiAgICAgICAgKTtcbiAgICAgICAgQXBwUmVnaXN0cnkucmVnaXN0ZXJDb21wb25lbnQoXG4gICAgICAgICAgYXBwQ29uZmlnLmFwcEtleSxcbiAgICAgICAgICBhcHBDb25maWcuY29tcG9uZW50LFxuICAgICAgICAgIGFwcENvbmZpZy5zZWN0aW9uLFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIHJlZ2lzdGVyQ29tcG9uZW50KFxuICAgIGFwcEtleTogc3RyaW5nLFxuICAgIGNvbXBvbmVudFByb3ZpZGVyOiBDb21wb25lbnRQcm92aWRlcixcbiAgICBzZWN0aW9uPzogYm9vbGVhbixcbiAgKTogc3RyaW5nIHtcbiAgICBydW5uYWJsZXNbYXBwS2V5XSA9IHtcbiAgICAgIGNvbXBvbmVudFByb3ZpZGVyLFxuICAgICAgcnVuOiAoYXBwUGFyYW1ldGVycykgPT5cbiAgICAgICAgcmVuZGVyQXBwbGljYXRpb24oXG4gICAgICAgICAgY29tcG9uZW50UHJvdmlkZXJJbnN0cnVtZW50YXRpb25Ib29rKGNvbXBvbmVudFByb3ZpZGVyKSxcbiAgICAgICAgICBhcHBQYXJhbWV0ZXJzLmluaXRpYWxQcm9wcyxcbiAgICAgICAgICBhcHBQYXJhbWV0ZXJzLnJvb3RUYWcsXG4gICAgICAgICAgd3JhcHBlckNvbXBvbmVudFByb3ZpZGVyICYmIHdyYXBwZXJDb21wb25lbnRQcm92aWRlcihhcHBQYXJhbWV0ZXJzKSxcbiAgICAgICAgKVxuICAgIH07XG4gICAgaWYgKHNlY3Rpb24pIHtcbiAgICAgIHNlY3Rpb25zW2FwcEtleV0gPSBydW5uYWJsZXNbYXBwS2V5XTtcbiAgICB9XG4gICAgcmV0dXJuIGFwcEtleTtcbiAgfSxcblxuICByZWdpc3RlclJ1bm5hYmxlKGFwcEtleTogc3RyaW5nLCBydW46IEZ1bmN0aW9uKTogc3RyaW5nIHtcbiAgICBydW5uYWJsZXNbYXBwS2V5XSA9IHtydW59O1xuICAgIHJldHVybiBhcHBLZXk7XG4gIH0sXG5cbiAgcmVnaXN0ZXJTZWN0aW9uKGFwcEtleTogc3RyaW5nLCBjb21wb25lbnQ6IENvbXBvbmVudFByb3ZpZGVyKTogdm9pZCB7XG4gICAgQXBwUmVnaXN0cnkucmVnaXN0ZXJDb21wb25lbnQoYXBwS2V5LCBjb21wb25lbnQsIHRydWUpO1xuICB9LFxuXG4gIGdldEFwcEtleXMoKTogQXJyYXk8c3RyaW5nPiB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHJ1bm5hYmxlcyk7XG4gIH0sXG5cbiAgZ2V0U2VjdGlvbktleXMoKTogQXJyYXk8c3RyaW5nPiB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHNlY3Rpb25zKTtcbiAgfSxcblxuICBnZXRTZWN0aW9ucygpOiBSdW5uYWJsZXMge1xuICAgIHJldHVybiB7XG4gICAgICAuLi5zZWN0aW9uc1xuICAgIH07XG4gIH0sXG5cbiAgZ2V0UnVubmFibGUoYXBwS2V5OiBzdHJpbmcpOiA/UnVubmFibGUge1xuICAgIHJldHVybiBydW5uYWJsZXNbYXBwS2V5XTtcbiAgfSxcblxuICBnZXRSZWdpc3RyeSgpOiBSZWdpc3RyeSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNlY3Rpb25zOiBBcHBSZWdpc3RyeS5nZXRTZWN0aW9uS2V5cygpLFxuICAgICAgcnVubmFibGVzOiB7Li4ucnVubmFibGVzfSxcbiAgICB9O1xuICB9LFxuXG4gIHNldENvbXBvbmVudFByb3ZpZGVySW5zdHJ1bWVudGF0aW9uSG9vayhob29rOiBDb21wb25lbnRQcm92aWRlckluc3RydW1lbnRhdGlvbkhvb2spIHtcbiAgICBjb21wb25lbnRQcm92aWRlckluc3RydW1lbnRhdGlvbkhvb2sgPSBob29rO1xuICB9LFxuXG4gIHJ1bkFwcGxpY2F0aW9uKGFwcEtleTogc3RyaW5nLCBhcHBQYXJhbWV0ZXJzOiBhbnkpOiB2b2lkIHtcbiAgICBjb25zdCBtc2cgPVxuICAgICAgJ1J1bm5pbmcgYXBwbGljYXRpb24gXCInICsgYXBwS2V5ICsgJ1wiIHdpdGggYXBwUGFyYW1zOiAnICtcbiAgICAgIEpTT04uc3RyaW5naWZ5KGFwcFBhcmFtZXRlcnMpICsgJy4gJyArXG4gICAgICAnX19ERVZfXyA9PT0gJyArIFN0cmluZyhfX0RFVl9fKSArXG4gICAgICAnLCBkZXZlbG9wbWVudC1sZXZlbCB3YXJuaW5nIGFyZSAnICsgKF9fREVWX18gPyAnT04nIDogJ09GRicpICtcbiAgICAgICcsIHBlcmZvcm1hbmNlIG9wdGltaXphdGlvbnMgYXJlICcgKyAoX19ERVZfXyA/ICdPRkYnIDogJ09OJyk7XG4gICAgaW5mb0xvZyhtc2cpO1xuICAgIEJ1Z1JlcG9ydGluZy5hZGRTb3VyY2UoJ0FwcFJlZ2lzdHJ5LnJ1bkFwcGxpY2F0aW9uJyArIHJ1bkNvdW50KyssICgpID0+IG1zZyk7XG4gICAgaW52YXJpYW50KFxuICAgICAgcnVubmFibGVzW2FwcEtleV0gJiYgcnVubmFibGVzW2FwcEtleV0ucnVuLFxuICAgICAgJ0FwcGxpY2F0aW9uICcgKyBhcHBLZXkgKyAnIGhhcyBub3QgYmVlbiByZWdpc3RlcmVkLlxcblxcbicgK1xuICAgICAgJ0hpbnQ6IFRoaXMgZXJyb3Igb2Z0ZW4gaGFwcGVucyB3aGVuIHlvdVxcJ3JlIHJ1bm5pbmcgdGhlIHBhY2thZ2VyICcgK1xuICAgICAgJyhsb2NhbCBkZXYgc2VydmVyKSBmcm9tIGEgd3JvbmcgZm9sZGVyLiBGb3IgZXhhbXBsZSB5b3UgaGF2ZSAnICtcbiAgICAgICdtdWx0aXBsZSBhcHBzIGFuZCB0aGUgcGFja2FnZXIgaXMgc3RpbGwgcnVubmluZyBmb3IgdGhlIGFwcCB5b3UgJyArXG4gICAgICAnd2VyZSB3b3JraW5nIG9uIGJlZm9yZS5cXG5JZiB0aGlzIGlzIHRoZSBjYXNlLCBzaW1wbHkga2lsbCB0aGUgb2xkICcgK1xuICAgICAgJ3BhY2thZ2VyIGluc3RhbmNlIChlLmcuIGNsb3NlIHRoZSBwYWNrYWdlciB0ZXJtaW5hbCB3aW5kb3cpICcgK1xuICAgICAgJ2FuZCBzdGFydCB0aGUgcGFja2FnZXIgaW4gdGhlIGNvcnJlY3QgYXBwIGZvbGRlciAoZS5nLiBjZCBpbnRvIGFwcCAnICtcbiAgICAgICdmb2xkZXIgYW5kIHJ1biBcXCducG0gc3RhcnRcXCcpLlxcblxcbicgK1xuICAgICAgJ1RoaXMgZXJyb3IgY2FuIGFsc28gaGFwcGVuIGR1ZSB0byBhIHJlcXVpcmUoKSBlcnJvciBkdXJpbmcgJyArXG4gICAgICAnaW5pdGlhbGl6YXRpb24gb3IgZmFpbHVyZSB0byBjYWxsIEFwcFJlZ2lzdHJ5LnJlZ2lzdGVyQ29tcG9uZW50LlxcblxcbidcbiAgICApO1xuXG4gICAgU2NlbmVUcmFja2VyLnNldEFjdGl2ZVNjZW5lKHtuYW1lOiBhcHBLZXl9KTtcbiAgICBydW5uYWJsZXNbYXBwS2V5XS5ydW4oYXBwUGFyYW1ldGVycyk7XG4gIH0sXG5cbiAgdW5tb3VudEFwcGxpY2F0aW9uQ29tcG9uZW50QXRSb290VGFnKHJvb3RUYWc6IG51bWJlcik6IHZvaWQge1xuICAgIFJlYWN0TmF0aXZlLnVubW91bnRDb21wb25lbnRBdE5vZGVBbmRSZW1vdmVDb250YWluZXIocm9vdFRhZyk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJlZ2lzdGVyIGEgaGVhZGxlc3MgdGFzay4gQSBoZWFkbGVzcyB0YXNrIGlzIGEgYml0IG9mIGNvZGUgdGhhdCBydW5zIHdpdGhvdXQgYSBVSS5cbiAgICogQHBhcmFtIHRhc2tLZXkgdGhlIGtleSBhc3NvY2lhdGVkIHdpdGggdGhpcyB0YXNrXG4gICAqIEBwYXJhbSB0YXNrICAgIGEgcHJvbWlzZSByZXR1cm5pbmcgZnVuY3Rpb24gdGhhdCB0YWtlcyBzb21lIGRhdGEgcGFzc2VkIGZyb20gdGhlIG5hdGl2ZSBzaWRlIGFzXG4gICAqICAgICAgICAgICAgICAgIHRoZSBvbmx5IGFyZ3VtZW50OyB3aGVuIHRoZSBwcm9taXNlIGlzIHJlc29sdmVkIG9yIHJlamVjdGVkIHRoZSBuYXRpdmUgc2lkZSBpc1xuICAgKiAgICAgICAgICAgICAgICBub3RpZmllZCBvZiB0aGlzIGV2ZW50IGFuZCBpdCBtYXkgZGVjaWRlIHRvIGRlc3Ryb3kgdGhlIEpTIGNvbnRleHQuXG4gICAqL1xuICByZWdpc3RlckhlYWRsZXNzVGFzayh0YXNrS2V5OiBzdHJpbmcsIHRhc2s6IFRhc2tQcm92aWRlcik6IHZvaWQge1xuICAgIGlmICh0YXNrcy5oYXModGFza0tleSkpIHtcbiAgICAgIGNvbnNvbGUud2FybihgcmVnaXN0ZXJIZWFkbGVzc1Rhc2sgY2FsbGVkIG11bHRpcGxlIHRpbWVzIGZvciBzYW1lIGtleSAnJHt0YXNrS2V5fSdgKTtcbiAgICB9XG4gICAgdGFza3Muc2V0KHRhc2tLZXksIHRhc2spO1xuICB9LFxuXG4gIC8qKlxuICAgKiBPbmx5IGNhbGxlZCBmcm9tIG5hdGl2ZSBjb2RlLiBTdGFydHMgYSBoZWFkbGVzcyB0YXNrLlxuICAgKlxuICAgKiBAcGFyYW0gdGFza0lkIHRoZSBuYXRpdmUgaWQgZm9yIHRoaXMgdGFzayBpbnN0YW5jZSB0byBrZWVwIHRyYWNrIG9mIGl0cyBleGVjdXRpb25cbiAgICogQHBhcmFtIHRhc2tLZXkgdGhlIGtleSBmb3IgdGhlIHRhc2sgdG8gc3RhcnRcbiAgICogQHBhcmFtIGRhdGEgdGhlIGRhdGEgdG8gcGFzcyB0byB0aGUgdGFza1xuICAgKi9cbiAgc3RhcnRIZWFkbGVzc1Rhc2sodGFza0lkOiBudW1iZXIsIHRhc2tLZXk6IHN0cmluZywgZGF0YTogYW55KTogdm9pZCB7XG4gICAgY29uc3QgdGFza1Byb3ZpZGVyID0gdGFza3MuZ2V0KHRhc2tLZXkpO1xuICAgIGlmICghdGFza1Byb3ZpZGVyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIHRhc2sgcmVnaXN0ZXJlZCBmb3Iga2V5ICR7dGFza0tleX1gKTtcbiAgICB9XG4gICAgdGFza1Byb3ZpZGVyKCkoZGF0YSlcbiAgICAgIC50aGVuKCgpID0+IE5hdGl2ZU1vZHVsZXMuSGVhZGxlc3NKc1Rhc2tTdXBwb3J0Lm5vdGlmeVRhc2tGaW5pc2hlZCh0YXNrSWQpKVxuICAgICAgLmNhdGNoKHJlYXNvbiA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IocmVhc29uKTtcbiAgICAgICAgTmF0aXZlTW9kdWxlcy5IZWFkbGVzc0pzVGFza1N1cHBvcnQubm90aWZ5VGFza0ZpbmlzaGVkKHRhc2tJZCk7XG4gICAgICB9KTtcbiAgfVxuXG59O1xuXG5CYXRjaGVkQnJpZGdlLnJlZ2lzdGVyQ2FsbGFibGVNb2R1bGUoXG4gICdBcHBSZWdpc3RyeScsXG4gIEFwcFJlZ2lzdHJ5XG4pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEFwcFJlZ2lzdHJ5O1xuIl19